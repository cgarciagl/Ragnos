{"config":{"indexing":"full","lang":["en","es"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Ragnos Framework Ragnos es un framework moderno y ligero para el desarrollo de aplicaciones web. Su objetivo es proporcionar una base s\u00f3lida y flexible para construir aplicaciones escalables y de alto rendimiento. Est\u00e1 basado en CodeIgniter 4 , lo que garantiza un n\u00facleo robusto y probado en el tiempo. Adem\u00e1s, utiliza tecnolog\u00edas como jQuery , DataTables y AdminLTE para ofrecer una experiencia de desarrollo completa y eficiente. Prerrequisitos Recomendados Aunque Ragnos facilita mucho el desarrollo, es muy recomendable familiarizarse con CodeIgniter 4 y tener conocimientos b\u00e1sicos de SQL antes de iniciar. Esto te permitir\u00e1 aprovechar al m\u00e1ximo la flexibilidad del framework y entender mejor lo que ocurre \"bajo el cap\u00f3\". Caracter\u00edsticas Ligero y r\u00e1pido : Dise\u00f1ado para ser eficiente y minimizar el uso de recursos. Modular : Estructura modular que permite a\u00f1adir o quitar componentes seg\u00fan sea necesario. Escalable : Ideal para proyectos peque\u00f1os y grandes, con capacidad de crecer seg\u00fan las necesidades. F\u00e1cil de usar : Sintaxis clara y documentaci\u00f3n completa para facilitar el desarrollo. Basado en CodeIgniter 4 : Aprovecha las ventajas de un framework PHP moderno, con soporte para namespaces, controladores, modelos y vistas. Integraci\u00f3n con jQuery : Simplifica la manipulaci\u00f3n del DOM, las solicitudes AJAX y la interacci\u00f3n con el usuario. Uso de DataTables : Permite la creaci\u00f3n de tablas din\u00e1micas con funcionalidades como b\u00fasqueda, paginaci\u00f3n y ordenamiento. Dise\u00f1o con AdminLTE : Proporciona una interfaz de usuario moderna y responsiva, ideal para paneles de administraci\u00f3n y aplicaciones web. Flexibilidad Frontend Aunque Ragnos utiliza jQuery por defecto para facilitar el desarrollo r\u00e1pido, no est\u00e1s obligado a usarlo . Si te sientes m\u00e1s c\u00f3modo con bibliotecas reactivas modernas como Alpine.js , Vue.js o React , puedes integrarlas sin problemas. Incluso puedes optar por construir tus propias interfaces de usuario totalmente personalizadas consumiendo los datos a trav\u00e9s del Modo API de Ragnos. Funcionalidades y beneficios Desarrollo r\u00e1pido : Gracias a su estructura basada en CodeIgniter 4, Ragnos permite a los desarrolladores centrarse en la l\u00f3gica de negocio sin preocuparse por configuraciones complejas. Interfaz moderna : AdminLTE ofrece un dise\u00f1o atractivo y responsivo, asegurando que las aplicaciones se vean bien en cualquier dispositivo. Gesti\u00f3n de datos eficiente : DataTables facilita la visualizaci\u00f3n y manipulaci\u00f3n de grandes conjuntos de datos de manera interactiva. Flexibilidad : Su arquitectura modular permite personalizar el framework seg\u00fan las necesidades espec\u00edficas del proyecto. Comunidad y soporte : Al estar basado en tecnolog\u00edas ampliamente utilizadas como CodeIgniter y jQuery, los desarrolladores tienen acceso a una gran cantidad de recursos y soporte en l\u00ednea. Organizaci\u00f3n de la Documentaci\u00f3n Esta documentaci\u00f3n est\u00e1 dividida en cuatro secciones principales para facilitar tu aprendizaje: \ud83d\udd30 Fundamentos Todo lo necesario para empezar. Comienza con la Instalaci\u00f3n , revisa la Configuraci\u00f3n y crea tu primer m\u00f3dulo en Primeros Pasos . \ud83d\udcbe Datasets y Modelos El n\u00facleo de Ragnos. Aprende a declarar Datasets , definir Campos y manejar relaciones Maestro-Detalle . \ud83d\ude80 Funcionalidades Avanzadas Para usuarios intermedios. Profundiza en el Modo API , sistema de Hooks y Despliegue en Producci\u00f3n . \ud83c\udfa8 Frontend y UI Personalizaci\u00f3n de la interfaz. Aprende a modificar Men\u00fas o Temas y generar Reportes . Demo en vivo Para ver Ragnos en acci\u00f3n con la base de datos de ejemplo Classicmodels , visita la secci\u00f3n Base de Datos Demo donde encontrar\u00e1s credenciales de acceso y una explicaci\u00f3n detallada de los datos.","title":"Inicio"},{"location":"#ragnos-framework","text":"Ragnos es un framework moderno y ligero para el desarrollo de aplicaciones web. Su objetivo es proporcionar una base s\u00f3lida y flexible para construir aplicaciones escalables y de alto rendimiento. Est\u00e1 basado en CodeIgniter 4 , lo que garantiza un n\u00facleo robusto y probado en el tiempo. Adem\u00e1s, utiliza tecnolog\u00edas como jQuery , DataTables y AdminLTE para ofrecer una experiencia de desarrollo completa y eficiente. Prerrequisitos Recomendados Aunque Ragnos facilita mucho el desarrollo, es muy recomendable familiarizarse con CodeIgniter 4 y tener conocimientos b\u00e1sicos de SQL antes de iniciar. Esto te permitir\u00e1 aprovechar al m\u00e1ximo la flexibilidad del framework y entender mejor lo que ocurre \"bajo el cap\u00f3\".","title":"Ragnos Framework"},{"location":"#caracteristicas","text":"Ligero y r\u00e1pido : Dise\u00f1ado para ser eficiente y minimizar el uso de recursos. Modular : Estructura modular que permite a\u00f1adir o quitar componentes seg\u00fan sea necesario. Escalable : Ideal para proyectos peque\u00f1os y grandes, con capacidad de crecer seg\u00fan las necesidades. F\u00e1cil de usar : Sintaxis clara y documentaci\u00f3n completa para facilitar el desarrollo. Basado en CodeIgniter 4 : Aprovecha las ventajas de un framework PHP moderno, con soporte para namespaces, controladores, modelos y vistas. Integraci\u00f3n con jQuery : Simplifica la manipulaci\u00f3n del DOM, las solicitudes AJAX y la interacci\u00f3n con el usuario. Uso de DataTables : Permite la creaci\u00f3n de tablas din\u00e1micas con funcionalidades como b\u00fasqueda, paginaci\u00f3n y ordenamiento. Dise\u00f1o con AdminLTE : Proporciona una interfaz de usuario moderna y responsiva, ideal para paneles de administraci\u00f3n y aplicaciones web. Flexibilidad Frontend Aunque Ragnos utiliza jQuery por defecto para facilitar el desarrollo r\u00e1pido, no est\u00e1s obligado a usarlo . Si te sientes m\u00e1s c\u00f3modo con bibliotecas reactivas modernas como Alpine.js , Vue.js o React , puedes integrarlas sin problemas. Incluso puedes optar por construir tus propias interfaces de usuario totalmente personalizadas consumiendo los datos a trav\u00e9s del Modo API de Ragnos.","title":"Caracter\u00edsticas"},{"location":"#funcionalidades-y-beneficios","text":"Desarrollo r\u00e1pido : Gracias a su estructura basada en CodeIgniter 4, Ragnos permite a los desarrolladores centrarse en la l\u00f3gica de negocio sin preocuparse por configuraciones complejas. Interfaz moderna : AdminLTE ofrece un dise\u00f1o atractivo y responsivo, asegurando que las aplicaciones se vean bien en cualquier dispositivo. Gesti\u00f3n de datos eficiente : DataTables facilita la visualizaci\u00f3n y manipulaci\u00f3n de grandes conjuntos de datos de manera interactiva. Flexibilidad : Su arquitectura modular permite personalizar el framework seg\u00fan las necesidades espec\u00edficas del proyecto. Comunidad y soporte : Al estar basado en tecnolog\u00edas ampliamente utilizadas como CodeIgniter y jQuery, los desarrolladores tienen acceso a una gran cantidad de recursos y soporte en l\u00ednea.","title":"Funcionalidades y beneficios"},{"location":"#organizacion-de-la-documentacion","text":"Esta documentaci\u00f3n est\u00e1 dividida en cuatro secciones principales para facilitar tu aprendizaje: \ud83d\udd30 Fundamentos Todo lo necesario para empezar. Comienza con la Instalaci\u00f3n , revisa la Configuraci\u00f3n y crea tu primer m\u00f3dulo en Primeros Pasos . \ud83d\udcbe Datasets y Modelos El n\u00facleo de Ragnos. Aprende a declarar Datasets , definir Campos y manejar relaciones Maestro-Detalle . \ud83d\ude80 Funcionalidades Avanzadas Para usuarios intermedios. Profundiza en el Modo API , sistema de Hooks y Despliegue en Producci\u00f3n . \ud83c\udfa8 Frontend y UI Personalizaci\u00f3n de la interfaz. Aprende a modificar Men\u00fas o Temas y generar Reportes . Demo en vivo Para ver Ragnos en acci\u00f3n con la base de datos de ejemplo Classicmodels , visita la secci\u00f3n Base de Datos Demo donde encontrar\u00e1s credenciales de acceso y una explicaci\u00f3n detallada de los datos.","title":"Organizaci\u00f3n de la Documentaci\u00f3n"},{"location":"avanzado/auditlog/","text":"Registro de Auditor\u00eda (Audit Log) El framework Ragnos incluye un sistema nativo y autom\u00e1tico para registrar los cambios realizados en los datos de las entidades. Este sistema permite rastrear qui\u00e9n realiz\u00f3 una acci\u00f3n, cu\u00e1ndo, desde qu\u00e9 direcci\u00f3n IP y qu\u00e9 datos espec\u00edficos fueron modificados, proporcionando una trazabilidad completa de las operaciones. Configuraci\u00f3n Uso en Datasets (RDatasetController) Activado por defecto Todas las clases que extienden de RDatasetController tienen el registro de auditor\u00eda activado autom\u00e1ticamente . Si desea desactivar la auditor\u00eda para un dataset espec\u00edfico (por ejemplo, para tablas temporales o de movimientos masivos donde no se requiere trazabilidad), puede utilizar el m\u00e9todo setEnableAudit(false) dentro del constructor. Ejemplo: class LogsTemporales extends RDatasetController { public function __construct() { parent::__construct(); $this->setTableName('logs_temp'); $this->setIdField('id'); // \u274c Desactivar auditor\u00eda para este controlador $this->setEnableAudit(false); // ... resto de configuraci\u00f3n } } Uso en Modelos Manuales Para activar el registro de auditor\u00eda en un modelo personalizado (que no es gestionado por un Dataset), debe establecer la propiedad $enableAudit en true . Este modelo debe estar utilizando el CrudOperationsTrait (o heredar de una clase base que lo use, como RdatasetModel ). class ClientesModel extends RdatasetModel { protected $table = 'clientes'; protected $primaryKey = 'id_cliente'; // Habilitar auditor\u00eda autom\u00e1tica para esta entidad protected $enableAudit = true; // ... definici\u00f3n de campos } Al habilitar esta propiedad, todas las operaciones de inserci\u00f3n, actualizaci\u00f3n y eliminaci\u00f3n realizadas a trav\u00e9s del controlador/modelo ser\u00e1n interceptadas y registradas autom\u00e1ticamente sin necesidad de c\u00f3digo adicional en sus controladores. Funcionamiento Interno El sistema funciona a trav\u00e9s de App\\ThirdParty\\Ragnos\\Models\\Traits\\CrudOperationsTrait . Cuando se ejecuta una acci\u00f3n de escritura, el sistema realiza los siguientes pasos de manera transparente: 1. Inserci\u00f3n (INSERT) Se ejecuta despu\u00e9s de que el registro ha sido guardado exitosamente. Guarda en el log todos los datos del nuevo registro bajo la clave new . 2. Actualizaci\u00f3n (UPDATE) Antes de guardar, el sistema compara los valores actuales en la base de datos con los nuevos valores enviados. Solo si hay diferencias reales, se procede a guardar el log. Optimizaci\u00f3n : Se registra un JSON que contiene \u00fanicamente los campos que cambiaron, con su valor anterior ( old ) y el nuevo ( new ). Ejemplo de JSON guardado: { \"status\" : { \"old\" : \"pendiente\" , \"new\" : \"activo\" }, \"limite_credito\" : { \"old\" : \"1000.00\" , \"new\" : \"2500.00\" } } 3. Eliminaci\u00f3n (DELETE) Antes de eliminar el registro f\u00edsico, el sistema realiza una consulta para obtener los datos actuales. Guarda una copia completa de los datos del registro eliminado bajo la clave deleted_data para permitir una eventual consulta hist\u00f3rica o restauraci\u00f3n manual. Informaci\u00f3n Registrada Para cada evento, el modelo AuditLogModel (tabla gen_audit_logs ) almacena la siguiente informaci\u00f3n de contexto: Campo Descripci\u00f3n user_id ID del usuario que realiz\u00f3 la acci\u00f3n. El sistema resuelve autom\u00e1ticamente la identidad ya sea por sesi\u00f3n activa (Web) o por Token Bearer (API). table_name Nombre de la tabla de la base de datos donde ocurri\u00f3 el cambio. record_id ID (Clave primaria) del registro afectado. action Tipo de operaci\u00f3n: INSERT , UPDATE o DELETE . changes Carga \u00fatil (Payload) en formato JSON con los detalles del cambio (ver secci\u00f3n anterior). Se almacena con soporte Unicode para caracteres especiales. ip_address Direcci\u00f3n IP desde donde se origin\u00f3 la solicitud. user_agent Informaci\u00f3n del navegador o cliente HTTP utilizado. Detecci\u00f3n de Usuario (Web y API) El mecanismo de auditor\u00eda es agn\u00f3stico al origen de la petici\u00f3n. El m\u00e9todo getCurrentUserId() intenta resolver la identidad del actor de la siguiente manera: Sesi\u00f3n Web: Verifica si existe una sesi\u00f3n activa de CodeIgniter ( session()->get('usu_id') ). API Token: Si es una llamada API, inspecciona el encabezado Authorization . Extrae el token Bearer y busca al usuario correspondiente en la tabla gen_usuarios . Fallback: Si no se identifica al usuario, se registra el ID 0 (Sistema/An\u00f3nimo).","title":"Audit Log"},{"location":"avanzado/auditlog/#registro-de-auditoria-audit-log","text":"El framework Ragnos incluye un sistema nativo y autom\u00e1tico para registrar los cambios realizados en los datos de las entidades. Este sistema permite rastrear qui\u00e9n realiz\u00f3 una acci\u00f3n, cu\u00e1ndo, desde qu\u00e9 direcci\u00f3n IP y qu\u00e9 datos espec\u00edficos fueron modificados, proporcionando una trazabilidad completa de las operaciones.","title":"Registro de Auditor\u00eda (Audit Log)"},{"location":"avanzado/auditlog/#configuracion","text":"","title":"Configuraci\u00f3n"},{"location":"avanzado/auditlog/#uso-en-datasets-rdatasetcontroller","text":"Activado por defecto Todas las clases que extienden de RDatasetController tienen el registro de auditor\u00eda activado autom\u00e1ticamente . Si desea desactivar la auditor\u00eda para un dataset espec\u00edfico (por ejemplo, para tablas temporales o de movimientos masivos donde no se requiere trazabilidad), puede utilizar el m\u00e9todo setEnableAudit(false) dentro del constructor. Ejemplo: class LogsTemporales extends RDatasetController { public function __construct() { parent::__construct(); $this->setTableName('logs_temp'); $this->setIdField('id'); // \u274c Desactivar auditor\u00eda para este controlador $this->setEnableAudit(false); // ... resto de configuraci\u00f3n } }","title":"Uso en Datasets (RDatasetController)"},{"location":"avanzado/auditlog/#uso-en-modelos-manuales","text":"Para activar el registro de auditor\u00eda en un modelo personalizado (que no es gestionado por un Dataset), debe establecer la propiedad $enableAudit en true . Este modelo debe estar utilizando el CrudOperationsTrait (o heredar de una clase base que lo use, como RdatasetModel ). class ClientesModel extends RdatasetModel { protected $table = 'clientes'; protected $primaryKey = 'id_cliente'; // Habilitar auditor\u00eda autom\u00e1tica para esta entidad protected $enableAudit = true; // ... definici\u00f3n de campos } Al habilitar esta propiedad, todas las operaciones de inserci\u00f3n, actualizaci\u00f3n y eliminaci\u00f3n realizadas a trav\u00e9s del controlador/modelo ser\u00e1n interceptadas y registradas autom\u00e1ticamente sin necesidad de c\u00f3digo adicional en sus controladores.","title":"Uso en Modelos Manuales"},{"location":"avanzado/auditlog/#funcionamiento-interno","text":"El sistema funciona a trav\u00e9s de App\\ThirdParty\\Ragnos\\Models\\Traits\\CrudOperationsTrait . Cuando se ejecuta una acci\u00f3n de escritura, el sistema realiza los siguientes pasos de manera transparente:","title":"Funcionamiento Interno"},{"location":"avanzado/auditlog/#1-insercion-insert","text":"Se ejecuta despu\u00e9s de que el registro ha sido guardado exitosamente. Guarda en el log todos los datos del nuevo registro bajo la clave new .","title":"1. Inserci\u00f3n (INSERT)"},{"location":"avanzado/auditlog/#2-actualizacion-update","text":"Antes de guardar, el sistema compara los valores actuales en la base de datos con los nuevos valores enviados. Solo si hay diferencias reales, se procede a guardar el log. Optimizaci\u00f3n : Se registra un JSON que contiene \u00fanicamente los campos que cambiaron, con su valor anterior ( old ) y el nuevo ( new ). Ejemplo de JSON guardado: { \"status\" : { \"old\" : \"pendiente\" , \"new\" : \"activo\" }, \"limite_credito\" : { \"old\" : \"1000.00\" , \"new\" : \"2500.00\" } }","title":"2. Actualizaci\u00f3n (UPDATE)"},{"location":"avanzado/auditlog/#3-eliminacion-delete","text":"Antes de eliminar el registro f\u00edsico, el sistema realiza una consulta para obtener los datos actuales. Guarda una copia completa de los datos del registro eliminado bajo la clave deleted_data para permitir una eventual consulta hist\u00f3rica o restauraci\u00f3n manual.","title":"3. Eliminaci\u00f3n (DELETE)"},{"location":"avanzado/auditlog/#informacion-registrada","text":"Para cada evento, el modelo AuditLogModel (tabla gen_audit_logs ) almacena la siguiente informaci\u00f3n de contexto: Campo Descripci\u00f3n user_id ID del usuario que realiz\u00f3 la acci\u00f3n. El sistema resuelve autom\u00e1ticamente la identidad ya sea por sesi\u00f3n activa (Web) o por Token Bearer (API). table_name Nombre de la tabla de la base de datos donde ocurri\u00f3 el cambio. record_id ID (Clave primaria) del registro afectado. action Tipo de operaci\u00f3n: INSERT , UPDATE o DELETE . changes Carga \u00fatil (Payload) en formato JSON con los detalles del cambio (ver secci\u00f3n anterior). Se almacena con soporte Unicode para caracteres especiales. ip_address Direcci\u00f3n IP desde donde se origin\u00f3 la solicitud. user_agent Informaci\u00f3n del navegador o cliente HTTP utilizado.","title":"Informaci\u00f3n Registrada"},{"location":"avanzado/auditlog/#deteccion-de-usuario-web-y-api","text":"El mecanismo de auditor\u00eda es agn\u00f3stico al origen de la petici\u00f3n. El m\u00e9todo getCurrentUserId() intenta resolver la identidad del actor de la siguiente manera: Sesi\u00f3n Web: Verifica si existe una sesi\u00f3n activa de CodeIgniter ( session()->get('usu_id') ). API Token: Si es una llamada API, inspecciona el encabezado Authorization . Extrae el token Bearer y busca al usuario correspondiente en la tabla gen_usuarios . Fallback: Si no se identifica al usuario, se registra el ID 0 (Sistema/An\u00f3nimo).","title":"Detecci\u00f3n de Usuario (Web y API)"},{"location":"avanzado/autenticacion_integrada/","text":"Sistema de Autenticaci\u00f3n y Permisos en Ragnos Ragnos incorpora un sistema de autenticaci\u00f3n ligero y flexible integrado directamente en el n\u00facleo del framework. Este sistema gestiona sesiones de usuario, protecci\u00f3n de controladores y control de acceso basado en roles (grupos). El sistema se apoya principalmente en el servicio App\\Services\\Admin_aut y en la clase BaseController . Tablas de Base de Datos El sistema espera una estructura de base de datos espec\u00edfica: gen_usuarios : Tabla de usuarios ( usu_id , usu_nombre , usu_login , usu_pword , usu_activo , usu_grupo ). gen_gruposdeusuarios : Tabla de roles ( gru_id , gru_nombre ). Protecci\u00f3n de Controladores Todos los controladores que extienden de BaseController (incluyendo RDatasetController , RProcessController , etc.) tienen acceso a m\u00e9todos de protecci\u00f3n simplificados. Flujo de Verificaci\u00f3n graph TD Req[\"Petici\u00f3n Entrante\"] --> Controller[\"Controlador\"] Controller -->|Llama| Check{\"checkLogin( )\"} Check -- \"No hay sesi\u00f3n\" --> Type{\"\u00bfEs API?\"} Type -- \"S\u00ed\" --> Error401[\"JSON 401 Unauthorized\"] Type -- \"No\" --> Login[\"Redirigir a Login\"] Check -- \"Hay sesi\u00f3n\" --> Group{\"\u00bfcheckUserInGroup( )?\"} Group -- \"No requerido\" --> Access[\"\u2705 Acceso Permitido\"] Group -- \"Requerido\" --> Role{\"\u00bfUsuario en Grupo?\"} Role -- \"S\u00ed\" --> Access Role -- \"No\" --> Error403[\"\u26d4 Redirigir / Error 403\"] %% Estilos mejorados style Access fill:#d4edda,stroke:#155724,stroke-width:2px,color:#155724 style Error401 fill:#f8d7da,stroke:#721c24,stroke-width:2px,color:#721c24 style Login fill:#fff3cd,stroke:#856404,stroke-width:2px,color:#856404 style Error403 fill:#f8d7da,stroke:#721c24,stroke-width:2px,color:#721c24 checkLogin() Este m\u00e9todo verifica si el usuario tiene una sesi\u00f3n activa. Si no la tiene: Para peticiones Web: Redirige al login ( admin/login ). Para API: Verifica el header Authorization contra el usu_token en base de datos. Si falla, devuelve un error 401 JSON. Uso: Se recomienda llamarlo al inicio de cualquier funci\u00f3n que requiera autenticaci\u00f3n, o en el constructor si todo el controlador es privado. Controllers P\u00fablicos Si tienes un controlador p\u00fablico (ej. p\u00e1gina de inicio), simplemente no llames a checkLogin() . public function miFunciopPrivada() { $this->checkLogin(); // El resto del c\u00f3digo solo se ejecuta si el usuario est\u00e1 logueado return view('mi_vista'); } checkUserInGroup($grupos) Restringe el acceso exclusivamente a usuarios que pertenezcan a los grupos especificados. Par\u00e1metro : Puede ser un string con el nombre de un grupo o un array de strings para permitir m\u00faltiples grupos. Comportamiento : Si no cumple la condici\u00f3n, redirige a admin/index (o devuelve 403/401 si es API). Internamente llama a checkLogin() , por lo que no es necesario llamar a ambos. Uso: public function __construct() { // Solo permitir acceso a Administradores $this->checkUserInGroup('Administrador'); } public function reporteGerencial() { // Permitir acceso a Administradores o Gerentes $this->checkUserInGroup(['Administrador', 'Gerencia']); // L\u00f3gica del reporte... } Servicio Admin_aut Para l\u00f3gica m\u00e1s granular dentro de tus vistas o controladores, puedes acceder directamente al servicio de autenticaci\u00f3n. Lo ideal es invocarlo mediante service('Admin_aut') . Funciones Principales isLoggedIn() Devuelve true si hay un usuario logueado, false en caso contrario. if (service('Admin_aut')->isLoggedIn()) { echo \"Usuario conectado\"; } id() Devuelve el ID ( usu_id ) del usuario actual. name() Devuelve el nombre completo ( usu_nombre ) del usuario actual. isUserInGroup($grupo) Eval\u00faa si el usuario actual pertenece al grupo indicado. Es muy \u00fatil para ocultar o mostrar botones en las vistas o aplicar l\u00f3gica condicional. Comparaci\u00f3n case-insensitive . // En un controlador o vista if (service('Admin_aut')->isUserInGroup('Ventas')) { // Mostrar bot\u00f3n de crear pedido } campo($nombreCampo) Obtiene cualquier campo de la tabla gen_usuarios para el usuario actual. La informaci\u00f3n se carga bajo demanda (lazy loading) la primera vez que se solicita un campo. // Obtener el email o cualquier campo personalizado $email = service('Admin_aut')->getField('usu_email'); Autenticaci\u00f3n v\u00eda API El sistema soporta autenticaci\u00f3n para APIs REST de forma transparente. Al hacer login, se genera un token seguro en usu_token . El cliente debe enviar este token en el header Authorization . checkLogin() detecta autom\u00e1ticamente si la petici\u00f3n es una llamada API ( isApiCall() ) y valida el token en lugar de la sesi\u00f3n de PHP. Esto permite utilizar los mismos controladores para la interfaz web y para aplicaciones m\u00f3viles o frontends desacoplados. Ejemplo Completo <?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; class Pedidos extends BaseController { public function __construct () { // Cargar helpers necesarios helper ([ 'form' , 'url' ]); } public function index () { // 1. Asegurar que est\u00e9 logueado $this -> checkLogin (); $auth = service ( 'Admin_aut' ); // 2. Obtener datos del usuario $data [ 'usuario' ] = $auth -> name (); $data [ 'esAdmin' ] = $auth -> isUserInGroup ( 'Administrador' ); return view ( 'pedidos/index' , $data ); } public function eliminar ( $id ) { // 3. Restricci\u00f3n estricta: Solo Admins pueden eliminar $this -> checkUserInGroup ( 'Administrador' ); $model = new \\App\\Models\\PedidosModel (); $model -> delete ( $id ); return redirect () -> to ( '/pedidos' ); } }","title":"Autenticaci\u00f3n"},{"location":"avanzado/autenticacion_integrada/#sistema-de-autenticacion-y-permisos-en-ragnos","text":"Ragnos incorpora un sistema de autenticaci\u00f3n ligero y flexible integrado directamente en el n\u00facleo del framework. Este sistema gestiona sesiones de usuario, protecci\u00f3n de controladores y control de acceso basado en roles (grupos). El sistema se apoya principalmente en el servicio App\\Services\\Admin_aut y en la clase BaseController .","title":"Sistema de Autenticaci\u00f3n y Permisos en Ragnos"},{"location":"avanzado/autenticacion_integrada/#tablas-de-base-de-datos","text":"El sistema espera una estructura de base de datos espec\u00edfica: gen_usuarios : Tabla de usuarios ( usu_id , usu_nombre , usu_login , usu_pword , usu_activo , usu_grupo ). gen_gruposdeusuarios : Tabla de roles ( gru_id , gru_nombre ).","title":"Tablas de Base de Datos"},{"location":"avanzado/autenticacion_integrada/#proteccion-de-controladores","text":"Todos los controladores que extienden de BaseController (incluyendo RDatasetController , RProcessController , etc.) tienen acceso a m\u00e9todos de protecci\u00f3n simplificados.","title":"Protecci\u00f3n de Controladores"},{"location":"avanzado/autenticacion_integrada/#flujo-de-verificacion","text":"graph TD Req[\"Petici\u00f3n Entrante\"] --> Controller[\"Controlador\"] Controller -->|Llama| Check{\"checkLogin( )\"} Check -- \"No hay sesi\u00f3n\" --> Type{\"\u00bfEs API?\"} Type -- \"S\u00ed\" --> Error401[\"JSON 401 Unauthorized\"] Type -- \"No\" --> Login[\"Redirigir a Login\"] Check -- \"Hay sesi\u00f3n\" --> Group{\"\u00bfcheckUserInGroup( )?\"} Group -- \"No requerido\" --> Access[\"\u2705 Acceso Permitido\"] Group -- \"Requerido\" --> Role{\"\u00bfUsuario en Grupo?\"} Role -- \"S\u00ed\" --> Access Role -- \"No\" --> Error403[\"\u26d4 Redirigir / Error 403\"] %% Estilos mejorados style Access fill:#d4edda,stroke:#155724,stroke-width:2px,color:#155724 style Error401 fill:#f8d7da,stroke:#721c24,stroke-width:2px,color:#721c24 style Login fill:#fff3cd,stroke:#856404,stroke-width:2px,color:#856404 style Error403 fill:#f8d7da,stroke:#721c24,stroke-width:2px,color:#721c24","title":"Flujo de Verificaci\u00f3n"},{"location":"avanzado/autenticacion_integrada/#checklogin","text":"Este m\u00e9todo verifica si el usuario tiene una sesi\u00f3n activa. Si no la tiene: Para peticiones Web: Redirige al login ( admin/login ). Para API: Verifica el header Authorization contra el usu_token en base de datos. Si falla, devuelve un error 401 JSON. Uso: Se recomienda llamarlo al inicio de cualquier funci\u00f3n que requiera autenticaci\u00f3n, o en el constructor si todo el controlador es privado. Controllers P\u00fablicos Si tienes un controlador p\u00fablico (ej. p\u00e1gina de inicio), simplemente no llames a checkLogin() . public function miFunciopPrivada() { $this->checkLogin(); // El resto del c\u00f3digo solo se ejecuta si el usuario est\u00e1 logueado return view('mi_vista'); }","title":"checkLogin()"},{"location":"avanzado/autenticacion_integrada/#checkuseringroupgrupos","text":"Restringe el acceso exclusivamente a usuarios que pertenezcan a los grupos especificados. Par\u00e1metro : Puede ser un string con el nombre de un grupo o un array de strings para permitir m\u00faltiples grupos. Comportamiento : Si no cumple la condici\u00f3n, redirige a admin/index (o devuelve 403/401 si es API). Internamente llama a checkLogin() , por lo que no es necesario llamar a ambos. Uso: public function __construct() { // Solo permitir acceso a Administradores $this->checkUserInGroup('Administrador'); } public function reporteGerencial() { // Permitir acceso a Administradores o Gerentes $this->checkUserInGroup(['Administrador', 'Gerencia']); // L\u00f3gica del reporte... }","title":"checkUserInGroup($grupos)"},{"location":"avanzado/autenticacion_integrada/#servicio-admin_aut","text":"Para l\u00f3gica m\u00e1s granular dentro de tus vistas o controladores, puedes acceder directamente al servicio de autenticaci\u00f3n. Lo ideal es invocarlo mediante service('Admin_aut') .","title":"Servicio Admin_aut"},{"location":"avanzado/autenticacion_integrada/#funciones-principales","text":"","title":"Funciones Principales"},{"location":"avanzado/autenticacion_integrada/#isloggedin","text":"Devuelve true si hay un usuario logueado, false en caso contrario. if (service('Admin_aut')->isLoggedIn()) { echo \"Usuario conectado\"; }","title":"isLoggedIn()"},{"location":"avanzado/autenticacion_integrada/#id","text":"Devuelve el ID ( usu_id ) del usuario actual.","title":"id()"},{"location":"avanzado/autenticacion_integrada/#name","text":"Devuelve el nombre completo ( usu_nombre ) del usuario actual.","title":"name()"},{"location":"avanzado/autenticacion_integrada/#isuseringroupgrupo","text":"Eval\u00faa si el usuario actual pertenece al grupo indicado. Es muy \u00fatil para ocultar o mostrar botones en las vistas o aplicar l\u00f3gica condicional. Comparaci\u00f3n case-insensitive . // En un controlador o vista if (service('Admin_aut')->isUserInGroup('Ventas')) { // Mostrar bot\u00f3n de crear pedido }","title":"isUserInGroup($grupo)"},{"location":"avanzado/autenticacion_integrada/#camponombrecampo","text":"Obtiene cualquier campo de la tabla gen_usuarios para el usuario actual. La informaci\u00f3n se carga bajo demanda (lazy loading) la primera vez que se solicita un campo. // Obtener el email o cualquier campo personalizado $email = service('Admin_aut')->getField('usu_email');","title":"campo($nombreCampo)"},{"location":"avanzado/autenticacion_integrada/#autenticacion-via-api","text":"El sistema soporta autenticaci\u00f3n para APIs REST de forma transparente. Al hacer login, se genera un token seguro en usu_token . El cliente debe enviar este token en el header Authorization . checkLogin() detecta autom\u00e1ticamente si la petici\u00f3n es una llamada API ( isApiCall() ) y valida el token en lugar de la sesi\u00f3n de PHP. Esto permite utilizar los mismos controladores para la interfaz web y para aplicaciones m\u00f3viles o frontends desacoplados.","title":"Autenticaci\u00f3n v\u00eda API"},{"location":"avanzado/autenticacion_integrada/#ejemplo-completo","text":"<?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; class Pedidos extends BaseController { public function __construct () { // Cargar helpers necesarios helper ([ 'form' , 'url' ]); } public function index () { // 1. Asegurar que est\u00e9 logueado $this -> checkLogin (); $auth = service ( 'Admin_aut' ); // 2. Obtener datos del usuario $data [ 'usuario' ] = $auth -> name (); $data [ 'esAdmin' ] = $auth -> isUserInGroup ( 'Administrador' ); return view ( 'pedidos/index' , $data ); } public function eliminar ( $id ) { // 3. Restricci\u00f3n estricta: Solo Admins pueden eliminar $this -> checkUserInGroup ( 'Administrador' ); $model = new \\App\\Models\\PedidosModel (); $model -> delete ( $id ); return redirect () -> to ( '/pedidos' ); } }","title":"Ejemplo Completo"},{"location":"avanzado/despliegue/","text":"Gu\u00eda de Despliegue (Production) Esta gu\u00eda cubre los pasos esenciales para llevar tu aplicaci\u00f3n Ragnos de un entorno de desarrollo local a un servidor de producci\u00f3n. 1. Configuraci\u00f3n de Entorno Importante En producci\u00f3n, nunca debes ejecutar la aplicaci\u00f3n en modo development . Esto expondr\u00eda informaci\u00f3n sensible y ralentizar\u00eda la aplicaci\u00f3n. Edita el archivo .env en tu servidor. Establece la variable de entorno: CI_ENVIRONMENT = production Esto desactivar\u00e1 la barra de depuraci\u00f3n (debug toolbar), ocultar\u00e1 los errores detallados de PHP en pantalla y activar\u00e1 el cach\u00e9 de configuraciones. 2. Permisos del Sistema de Archivos Aseg\u00farate de que el usuario del servidor web (ej. www-data en Apache/Nginx) tenga permisos de escritura en la carpeta writable y todas sus subcarpetas. chmod -R 775 writable/ chown -R www-data:www-data writable/ Las dem\u00e1s carpetas ( app , system , public ) deben ser de solo lectura para el servidor web por motivos de seguridad, a menos que tengas necesidades espec\u00edficas. 3. Base de Datos Actualiza las credenciales de conexi\u00f3n en el archivo .env apuntando a tu base de datos de producci\u00f3n. Aseg\u00farate de que app.baseURL est\u00e9 configurado correctamente con el dominio real (HTTPS recomendado). app.baseURL = 'https://mi-sistema-produccion.com/' 4. Eliminar archivos de desarrollo Se recomienda no subir archivos innecesarios al servidor de producci\u00f3n: Tests ( tests/ ) Archivos de git ( .git/ , .gitignore ) Documentaci\u00f3n interna ( documentacion/ ) Archivos SQL de ejemplos ( sampledatabase/ ) Soluci\u00f3n de Problemas Comunes Error 404 en todas las p\u00e1ginas excepto el Home: Esto suele ser un problema de configuraci\u00f3n del servidor web (Apache/Nginx) que no est\u00e1 redirigiendo las peticiones a index.php . Aseg\u00farate de que el archivo public/.htaccess est\u00e9 presente y que el m\u00f3dulo mod_rewrite est\u00e9 activo en Apache. P\u00e1gina en blanco o Error 500: Verifica los logs en writable/logs/ para ver el error real, ya que en modo producci\u00f3n no se muestran en pantalla.","title":"Despliegue"},{"location":"avanzado/despliegue/#guia-de-despliegue-production","text":"Esta gu\u00eda cubre los pasos esenciales para llevar tu aplicaci\u00f3n Ragnos de un entorno de desarrollo local a un servidor de producci\u00f3n.","title":"Gu\u00eda de Despliegue (Production)"},{"location":"avanzado/despliegue/#1-configuracion-de-entorno","text":"Importante En producci\u00f3n, nunca debes ejecutar la aplicaci\u00f3n en modo development . Esto expondr\u00eda informaci\u00f3n sensible y ralentizar\u00eda la aplicaci\u00f3n. Edita el archivo .env en tu servidor. Establece la variable de entorno: CI_ENVIRONMENT = production Esto desactivar\u00e1 la barra de depuraci\u00f3n (debug toolbar), ocultar\u00e1 los errores detallados de PHP en pantalla y activar\u00e1 el cach\u00e9 de configuraciones.","title":"1. Configuraci\u00f3n de Entorno"},{"location":"avanzado/despliegue/#2-permisos-del-sistema-de-archivos","text":"Aseg\u00farate de que el usuario del servidor web (ej. www-data en Apache/Nginx) tenga permisos de escritura en la carpeta writable y todas sus subcarpetas. chmod -R 775 writable/ chown -R www-data:www-data writable/ Las dem\u00e1s carpetas ( app , system , public ) deben ser de solo lectura para el servidor web por motivos de seguridad, a menos que tengas necesidades espec\u00edficas.","title":"2. Permisos del Sistema de Archivos"},{"location":"avanzado/despliegue/#3-base-de-datos","text":"Actualiza las credenciales de conexi\u00f3n en el archivo .env apuntando a tu base de datos de producci\u00f3n. Aseg\u00farate de que app.baseURL est\u00e9 configurado correctamente con el dominio real (HTTPS recomendado). app.baseURL = 'https://mi-sistema-produccion.com/'","title":"3. Base de Datos"},{"location":"avanzado/despliegue/#4-eliminar-archivos-de-desarrollo","text":"Se recomienda no subir archivos innecesarios al servidor de producci\u00f3n: Tests ( tests/ ) Archivos de git ( .git/ , .gitignore ) Documentaci\u00f3n interna ( documentacion/ ) Archivos SQL de ejemplos ( sampledatabase/ )","title":"4. Eliminar archivos de desarrollo"},{"location":"avanzado/despliegue/#solucion-de-problemas-comunes","text":"Error 404 en todas las p\u00e1ginas excepto el Home: Esto suele ser un problema de configuraci\u00f3n del servidor web (Apache/Nginx) que no est\u00e1 redirigiendo las peticiones a index.php . Aseg\u00farate de que el archivo public/.htaccess est\u00e9 presente y que el m\u00f3dulo mod_rewrite est\u00e9 activo en Apache. P\u00e1gina en blanco o Error 500: Verifica los logs en writable/logs/ para ver el error real, ya que en modo producci\u00f3n no se muestran en pantalla.","title":"Soluci\u00f3n de Problemas Comunes"},{"location":"avanzado/guia_modo_api/","text":"Gu\u00eda de Uso: Ragnos API Mode A partir de la versi\u00f3n v1.1, Ragnos Framework soporta controladores h\u00edbridos. Esto significa que el mismo controlador que sirve tu panel administrativo (HTML) puede funcionar como una API RESTful (JSON) sin escribir c\u00f3digo adicional. \ud83d\udccb Requisitos Previos Token de Acceso: Debes tener un api_token v\u00e1lido asignado a tu usuario en la base de datos. Endpoint: La URL es la misma que usas en el navegador (ej. https://tu-sitio.com/tienda/productos ). Autenticar con el Modo API y obtener el token Para usar el Modo API, primero debes autenticarte y obtener un token. Puedes hacerlo enviando una solicitud POST al endpoint de login con tus credenciales. Request: POST /admin/login Headers: Content-Type: application/json Accept: application/json Body (JSON): { \"usuario\": \"admin\", \"pword\": \"tu_contrase\u00f1a\" } Respuesta (200 OK): { \"status\" : \"success\" , \"message\" : \"Login successful\" , \"token\" : \"4984656be2ff893362b3b023d0b55df74494fb87552916031143e6431e8d9a7c\" , \"user_id\" : \"1\" } As\u00ed obtendr\u00e1s un token que deber\u00e1s usar en las cabeceras de tus futuras solicitudes API. \ud83d\udd10 Autenticaci\u00f3n y Cabeceras Para activar el \"Modo API\", el cliente debe enviar las siguientes cabeceras HTTP. Si no se env\u00edan, Ragnos responder\u00e1 con HTML (redirecciones y vistas). Header Valor Descripci\u00f3n Accept application/json Obligatorio. Le dice a Ragnos que no quieres HTML, sino JSON. Authorization Bearer TU_TOKEN_AQUI Obligatorio. Tu token de seguridad. Content-Type application/json Necesario cuando env\u00edas datos (POST/PUT). \ud83d\udce1 Endpoints y Operaciones Supongamos que tu controlador es Tienda/Productos . 1. Listar Registros (GET) Obtiene la lista de datos aplicando los filtros de la grilla. Request: GET /tienda/productos Headers: Accept: application/json Authorization: Bearer xyz123 Respuesta (200 OK): { \"status\" : 200 , \"data\" : [ { \"id\" : 1 , \"nombre\" : \"Laptop\" , \"precio\" : 1500 }, { \"id\" : 2 , \"nombre\" : \"Mouse\" , \"precio\" : 20 } ], \"count\" : 2 } 2. Crear un Registro (POST) Request: POST /tienda/productos/save Headers: Content-Type: application/json Accept: application/json Authorization: Bearer xyz123 Body (JSON): { \"nombre\": \"Teclado Mec\u00e1nico\", \"precio\": 85.50, \"stock\": 10 } Respuesta (201 Created): { \"status\" : 201 , \"message\" : \"Registro creado exitosamente.\" , \"data\" : { \"id\" : 15 } } 3. Actualizar un Registro (POST/PUT) En Ragnos, la actualizaci\u00f3n se maneja en el mismo endpoint save . La diferencia es que debes incluir el ID (clave primaria). Request: POST /tienda/productos/save Headers: ... (mismos de arriba) Body (JSON): { \"id\": 15, \"precio\": 90.00 } Respuesta (200 OK): { \"status\" : 200 , \"message\" : \"Registro actualizado exitosamente.\" , \"data\" : { \"id\" : 15 } } 4. Eliminar un Registro (POST/DELETE) Puedes enviar el ID en la URL o en el cuerpo del JSON. Opci\u00f3n A (URL): POST /tienda/productos/delete/15 Opci\u00f3n B (JSON Body): Request: POST /tienda/productos/delete Headers: ... Body (JSON): { \"id\": 15 } Respuesta (200 OK): { \"status\" : 200 , \"message\" : \"Registro eliminado correctamente\" } \u26a0\ufe0f Manejo de Errores Si algo sale mal (validaci\u00f3n o servidor), Ragnos devolver\u00e1 un c\u00f3digo de estado HTTP apropiado y un JSON de error. Ejemplo: Error de Validaci\u00f3n (400 Bad Request) { \"status\" : 400 , \"error\" : 400 , \"messages\" : { \"precio\" : \"El campo Precio es obligatorio.\" , \"stock\" : \"El campo Stock debe ser num\u00e9rico.\" } } Ejemplo: Token Inv\u00e1lido (401 Unauthorized) { \"status\" : 401 , \"error\" : \"Token inv\u00e1lido o expirado\" } \ud83d\udcbb Ejemplos de Cliente JavaScript (Fetch) const token = \"TU_API_TOKEN\" ; // Ejemplo: Guardar producto fetch ( \"https://tusitio.com/tienda/productos/save\" , { method : \"POST\" , headers : { \"Content-Type\" : \"application/json\" , Accept : \"application/json\" , Authorization : `Bearer ${ token } ` , }, body : JSON . stringify ({ nombre : \"Monitor 4K\" , precio : 300 , }), }) . then (( response ) => response . json ()) . then (( data ) => console . log ( data )) . catch (( error ) => console . error ( \"Error:\" , error )); cURL (Terminal) curl -X GET https://tusitio.com/tienda/productos -H \"Accept: application/json\" -H \"Authorization: Bearer TU_API_TOKEN\"","title":"Modo API"},{"location":"avanzado/guia_modo_api/#guia-de-uso-ragnos-api-mode","text":"A partir de la versi\u00f3n v1.1, Ragnos Framework soporta controladores h\u00edbridos. Esto significa que el mismo controlador que sirve tu panel administrativo (HTML) puede funcionar como una API RESTful (JSON) sin escribir c\u00f3digo adicional.","title":"Gu\u00eda de Uso: Ragnos API Mode"},{"location":"avanzado/guia_modo_api/#requisitos-previos","text":"Token de Acceso: Debes tener un api_token v\u00e1lido asignado a tu usuario en la base de datos. Endpoint: La URL es la misma que usas en el navegador (ej. https://tu-sitio.com/tienda/productos ).","title":"\ud83d\udccb Requisitos Previos"},{"location":"avanzado/guia_modo_api/#autenticar-con-el-modo-api-y-obtener-el-token","text":"Para usar el Modo API, primero debes autenticarte y obtener un token. Puedes hacerlo enviando una solicitud POST al endpoint de login con tus credenciales. Request: POST /admin/login Headers: Content-Type: application/json Accept: application/json Body (JSON): { \"usuario\": \"admin\", \"pword\": \"tu_contrase\u00f1a\" } Respuesta (200 OK): { \"status\" : \"success\" , \"message\" : \"Login successful\" , \"token\" : \"4984656be2ff893362b3b023d0b55df74494fb87552916031143e6431e8d9a7c\" , \"user_id\" : \"1\" } As\u00ed obtendr\u00e1s un token que deber\u00e1s usar en las cabeceras de tus futuras solicitudes API.","title":"Autenticar con el Modo API y obtener el token"},{"location":"avanzado/guia_modo_api/#autenticacion-y-cabeceras","text":"Para activar el \"Modo API\", el cliente debe enviar las siguientes cabeceras HTTP. Si no se env\u00edan, Ragnos responder\u00e1 con HTML (redirecciones y vistas). Header Valor Descripci\u00f3n Accept application/json Obligatorio. Le dice a Ragnos que no quieres HTML, sino JSON. Authorization Bearer TU_TOKEN_AQUI Obligatorio. Tu token de seguridad. Content-Type application/json Necesario cuando env\u00edas datos (POST/PUT).","title":"\ud83d\udd10 Autenticaci\u00f3n y Cabeceras"},{"location":"avanzado/guia_modo_api/#endpoints-y-operaciones","text":"Supongamos que tu controlador es Tienda/Productos .","title":"\ud83d\udce1 Endpoints y Operaciones"},{"location":"avanzado/guia_modo_api/#1-listar-registros-get","text":"Obtiene la lista de datos aplicando los filtros de la grilla. Request: GET /tienda/productos Headers: Accept: application/json Authorization: Bearer xyz123 Respuesta (200 OK): { \"status\" : 200 , \"data\" : [ { \"id\" : 1 , \"nombre\" : \"Laptop\" , \"precio\" : 1500 }, { \"id\" : 2 , \"nombre\" : \"Mouse\" , \"precio\" : 20 } ], \"count\" : 2 }","title":"1. Listar Registros (GET)"},{"location":"avanzado/guia_modo_api/#2-crear-un-registro-post","text":"Request: POST /tienda/productos/save Headers: Content-Type: application/json Accept: application/json Authorization: Bearer xyz123 Body (JSON): { \"nombre\": \"Teclado Mec\u00e1nico\", \"precio\": 85.50, \"stock\": 10 } Respuesta (201 Created): { \"status\" : 201 , \"message\" : \"Registro creado exitosamente.\" , \"data\" : { \"id\" : 15 } }","title":"2. Crear un Registro (POST)"},{"location":"avanzado/guia_modo_api/#3-actualizar-un-registro-postput","text":"En Ragnos, la actualizaci\u00f3n se maneja en el mismo endpoint save . La diferencia es que debes incluir el ID (clave primaria). Request: POST /tienda/productos/save Headers: ... (mismos de arriba) Body (JSON): { \"id\": 15, \"precio\": 90.00 } Respuesta (200 OK): { \"status\" : 200 , \"message\" : \"Registro actualizado exitosamente.\" , \"data\" : { \"id\" : 15 } }","title":"3. Actualizar un Registro (POST/PUT)"},{"location":"avanzado/guia_modo_api/#4-eliminar-un-registro-postdelete","text":"Puedes enviar el ID en la URL o en el cuerpo del JSON. Opci\u00f3n A (URL): POST /tienda/productos/delete/15 Opci\u00f3n B (JSON Body): Request: POST /tienda/productos/delete Headers: ... Body (JSON): { \"id\": 15 } Respuesta (200 OK): { \"status\" : 200 , \"message\" : \"Registro eliminado correctamente\" }","title":"4. Eliminar un Registro (POST/DELETE)"},{"location":"avanzado/guia_modo_api/#manejo-de-errores","text":"Si algo sale mal (validaci\u00f3n o servidor), Ragnos devolver\u00e1 un c\u00f3digo de estado HTTP apropiado y un JSON de error. Ejemplo: Error de Validaci\u00f3n (400 Bad Request) { \"status\" : 400 , \"error\" : 400 , \"messages\" : { \"precio\" : \"El campo Precio es obligatorio.\" , \"stock\" : \"El campo Stock debe ser num\u00e9rico.\" } } Ejemplo: Token Inv\u00e1lido (401 Unauthorized) { \"status\" : 401 , \"error\" : \"Token inv\u00e1lido o expirado\" }","title":"\u26a0\ufe0f Manejo de Errores"},{"location":"avanzado/guia_modo_api/#ejemplos-de-cliente","text":"","title":"\ud83d\udcbb Ejemplos de Cliente"},{"location":"avanzado/guia_modo_api/#javascript-fetch","text":"const token = \"TU_API_TOKEN\" ; // Ejemplo: Guardar producto fetch ( \"https://tusitio.com/tienda/productos/save\" , { method : \"POST\" , headers : { \"Content-Type\" : \"application/json\" , Accept : \"application/json\" , Authorization : `Bearer ${ token } ` , }, body : JSON . stringify ({ nombre : \"Monitor 4K\" , precio : 300 , }), }) . then (( response ) => response . json ()) . then (( data ) => console . log ( data )) . catch (( error ) => console . error ( \"Error:\" , error ));","title":"JavaScript (Fetch)"},{"location":"avanzado/guia_modo_api/#curl-terminal","text":"curl -X GET https://tusitio.com/tienda/productos -H \"Accept: application/json\" -H \"Authorization: Bearer TU_API_TOKEN\"","title":"cURL (Terminal)"},{"location":"avanzado/helpers/","text":"Helpers y Utilidades PHP Ragnos incluye una colecci\u00f3n de funciones auxiliares (helpers) globales dise\u00f1adas para agilizar tareas comunes y mejorar el rendimiento de la aplicaci\u00f3n. Estas funciones est\u00e1n disponibles en todo el framework autom\u00e1ticamente. Gesti\u00f3n de Base de Datos y Cach\u00e9 getCachedData() Esta funci\u00f3n ejecuta una consulta SQL pura y almacena el resultado en el sistema de cach\u00e9 de CodeIgniter 4. Es ideal para consultas pesadas o reportes que no requieren datos en tiempo real. function getCachedData(string $sql, array $params = [], ?string $cacheKey = null, int $ttl = 86400): array Par\u00e1metros Par\u00e1metro Tipo Descripci\u00f3n $sql string La consulta SQL a ejecutar. $params array (Opcional) Array de valores para los par\u00e1metros vinculados ( ? ) en la consulta. $cacheKey string (Opcional) Identificador \u00fanico para el cach\u00e9. Si es null , se generar\u00e1 un hash autom\u00e1tico basado en la consulta y los par\u00e1metros. $ttl int (Opcional) Tiempo de vida (Time To Live) en segundos. Por defecto es 86400 (24 horas). Retorno Retorna un array asociativo con los resultados de la consulta. Ejemplo de Uso // En un Modelo o Controlador public function obtenerMetricas() { $sql = \"SELECT p.productLine, SUM(od.quantityOrdered * od.priceEach) as Total FROM products p JOIN orderdetails od ON p.productCode = od.productCode GROUP BY p.productLine\"; // Cachear el resultado por 1 hora (3600 segundos) con una clave espec\u00edfica return getCachedData($sql, [], 'metricas_dashboard', 3600); } \u26a0\ufe0f Advertencias y Consideraciones Datos en Tiempo Real: No utilice esta funci\u00f3n para datos cr\u00edticos que cambian constantemente (ej. inventario en tiempo real si hay alta concurrencia, saldos bancarios). La informaci\u00f3n servida puede tener hasta $ttl segundos de antig\u00fcedad. Invalidaci\u00f3n de Cach\u00e9: Si utiliza una $cacheKey personalizada (como 'metricas_dashboard' ), puede limpiar manualmente ese cach\u00e9 cuando los datos cambien usando cache()->delete('metricas_dashboard') . Si deja que el sistema genere la clave autom\u00e1ticamente, la invalidaci\u00f3n manual es m\u00e1s dif\u00edcil. Entorno de Desarrollo: Recuerde que si est\u00e1 desarrollando y cambiando datos, es posible que siga viendo los datos antiguos hasta que limpie el cach\u00e9 ( php spark cache:clear ). queryToAssocArray() Ejecuta una consulta SQL y transforma el resultado directamente en un array asociativo del tipo [id => valor] . Es extremadamente \u00fatil para poblar listas desplegables ( <select> ). function queryToAssocArray(string $sql, string $index_key, string $column_key): array Ejemplo // Obtener lista de categor\u00edas para un Dropdown $sql = \"SELECT id, nombre FROM categorias ORDER BY nombre ASC\"; $opciones = queryToAssocArray($sql, 'id', 'nombre'); // Resultado: [1 => 'Electr\u00f3nica', 2 => 'Hogar', ...] Depuraci\u00f3n y Diagn\u00f3stico dbgConsola() Env\u00eda datos de PHP directamente a la consola del navegador del desarrollador. Utiliza console.log v\u00eda inyecci\u00f3n de script. Solo funciona en entorno de desarrollo ( development ). function dbgConsola($data, string $label = 'dbgConsola') Ejemplo $usuarios = $model->findAll(); dbgConsola($usuarios, 'Lista de Usuarios'); // Verifica la consola de Chrome/Firefox (F12) dbgDie() Mata la ejecuci\u00f3n del script y devuelve los datos proporcionados en formato JSON. Es perfecto para depurar llamadas API o AJAX. function dbgDie($data, int $statusCode = 200): never Formato y UI currency() Formatea n\u00fameros como moneda respetando la configuraci\u00f3n regional ( locale ) sin necesidad de extensiones complejas. function currency(float|int $number, bool $includeSymbol = true): string Ejemplo echo currency(1500.50); // Muestra \"$1,500.50\" (dependiendo de config) returnAsJSON() Estandariza las respuestas JSON de tu API o controladores AJAX. Maneja autom\u00e1ticamente los encabezados HTTP y la codificaci\u00f3n UTF-8. function returnAsJSON($data, $statusCode = 200) Ejemplo if (!$usuario) { returnAsJSON(['error' => 'Usuario no encontrado'], 404); } returnAsJSON($usuario);","title":"Helpers y Utilidades"},{"location":"avanzado/helpers/#helpers-y-utilidades-php","text":"Ragnos incluye una colecci\u00f3n de funciones auxiliares (helpers) globales dise\u00f1adas para agilizar tareas comunes y mejorar el rendimiento de la aplicaci\u00f3n. Estas funciones est\u00e1n disponibles en todo el framework autom\u00e1ticamente.","title":"Helpers y Utilidades PHP"},{"location":"avanzado/helpers/#gestion-de-base-de-datos-y-cache","text":"","title":"Gesti\u00f3n de Base de Datos y Cach\u00e9"},{"location":"avanzado/helpers/#getcacheddata","text":"Esta funci\u00f3n ejecuta una consulta SQL pura y almacena el resultado en el sistema de cach\u00e9 de CodeIgniter 4. Es ideal para consultas pesadas o reportes que no requieren datos en tiempo real. function getCachedData(string $sql, array $params = [], ?string $cacheKey = null, int $ttl = 86400): array","title":"getCachedData()"},{"location":"avanzado/helpers/#parametros","text":"Par\u00e1metro Tipo Descripci\u00f3n $sql string La consulta SQL a ejecutar. $params array (Opcional) Array de valores para los par\u00e1metros vinculados ( ? ) en la consulta. $cacheKey string (Opcional) Identificador \u00fanico para el cach\u00e9. Si es null , se generar\u00e1 un hash autom\u00e1tico basado en la consulta y los par\u00e1metros. $ttl int (Opcional) Tiempo de vida (Time To Live) en segundos. Por defecto es 86400 (24 horas).","title":"Par\u00e1metros"},{"location":"avanzado/helpers/#retorno","text":"Retorna un array asociativo con los resultados de la consulta.","title":"Retorno"},{"location":"avanzado/helpers/#ejemplo-de-uso","text":"// En un Modelo o Controlador public function obtenerMetricas() { $sql = \"SELECT p.productLine, SUM(od.quantityOrdered * od.priceEach) as Total FROM products p JOIN orderdetails od ON p.productCode = od.productCode GROUP BY p.productLine\"; // Cachear el resultado por 1 hora (3600 segundos) con una clave espec\u00edfica return getCachedData($sql, [], 'metricas_dashboard', 3600); }","title":"Ejemplo de Uso"},{"location":"avanzado/helpers/#advertencias-y-consideraciones","text":"Datos en Tiempo Real: No utilice esta funci\u00f3n para datos cr\u00edticos que cambian constantemente (ej. inventario en tiempo real si hay alta concurrencia, saldos bancarios). La informaci\u00f3n servida puede tener hasta $ttl segundos de antig\u00fcedad. Invalidaci\u00f3n de Cach\u00e9: Si utiliza una $cacheKey personalizada (como 'metricas_dashboard' ), puede limpiar manualmente ese cach\u00e9 cuando los datos cambien usando cache()->delete('metricas_dashboard') . Si deja que el sistema genere la clave autom\u00e1ticamente, la invalidaci\u00f3n manual es m\u00e1s dif\u00edcil. Entorno de Desarrollo: Recuerde que si est\u00e1 desarrollando y cambiando datos, es posible que siga viendo los datos antiguos hasta que limpie el cach\u00e9 ( php spark cache:clear ).","title":"\u26a0\ufe0f Advertencias y Consideraciones"},{"location":"avanzado/helpers/#querytoassocarray","text":"Ejecuta una consulta SQL y transforma el resultado directamente en un array asociativo del tipo [id => valor] . Es extremadamente \u00fatil para poblar listas desplegables ( <select> ). function queryToAssocArray(string $sql, string $index_key, string $column_key): array","title":"queryToAssocArray()"},{"location":"avanzado/helpers/#ejemplo","text":"// Obtener lista de categor\u00edas para un Dropdown $sql = \"SELECT id, nombre FROM categorias ORDER BY nombre ASC\"; $opciones = queryToAssocArray($sql, 'id', 'nombre'); // Resultado: [1 => 'Electr\u00f3nica', 2 => 'Hogar', ...]","title":"Ejemplo"},{"location":"avanzado/helpers/#depuracion-y-diagnostico","text":"","title":"Depuraci\u00f3n y Diagn\u00f3stico"},{"location":"avanzado/helpers/#dbgconsola","text":"Env\u00eda datos de PHP directamente a la consola del navegador del desarrollador. Utiliza console.log v\u00eda inyecci\u00f3n de script. Solo funciona en entorno de desarrollo ( development ). function dbgConsola($data, string $label = 'dbgConsola')","title":"dbgConsola()"},{"location":"avanzado/helpers/#ejemplo_1","text":"$usuarios = $model->findAll(); dbgConsola($usuarios, 'Lista de Usuarios'); // Verifica la consola de Chrome/Firefox (F12)","title":"Ejemplo"},{"location":"avanzado/helpers/#dbgdie","text":"Mata la ejecuci\u00f3n del script y devuelve los datos proporcionados en formato JSON. Es perfecto para depurar llamadas API o AJAX. function dbgDie($data, int $statusCode = 200): never","title":"dbgDie()"},{"location":"avanzado/helpers/#formato-y-ui","text":"","title":"Formato y UI"},{"location":"avanzado/helpers/#currency","text":"Formatea n\u00fameros como moneda respetando la configuraci\u00f3n regional ( locale ) sin necesidad de extensiones complejas. function currency(float|int $number, bool $includeSymbol = true): string","title":"currency()"},{"location":"avanzado/helpers/#ejemplo_2","text":"echo currency(1500.50); // Muestra \"$1,500.50\" (dependiendo de config)","title":"Ejemplo"},{"location":"avanzado/helpers/#returnasjson","text":"Estandariza las respuestas JSON de tu API o controladores AJAX. Maneja autom\u00e1ticamente los encabezados HTTP y la codificaci\u00f3n UTF-8. function returnAsJSON($data, $statusCode = 200)","title":"returnAsJSON()"},{"location":"avanzado/helpers/#ejemplo_3","text":"if (!$usuario) { returnAsJSON(['error' => 'Usuario no encontrado'], 404); } returnAsJSON($usuario);","title":"Ejemplo"},{"location":"avanzado/hooks/","text":"Hooks y ciclo de vida en Ragnos En Ragnos, los hooks permiten ejecutar l\u00f3gica personalizada en distintos momentos del ciclo de vida de un dataset. Son el mecanismo principal para extender comportamiento sin romper el modelo declarativo. Los hooks se definen como m\u00e9todos protegidos dentro del controlador que extiende RDatasetController . Concepto Clave El controlador no implementa el CRUD manualmente. Ragnos se encarga de la operaci\u00f3n de base de datos, y t\u00fa solo \"te enganchas\" (hook) en los puntos clave para inyectar tu l\u00f3gica de negocio. Ciclo de Vida Visual Entender el flujo de ejecuci\u00f3n es crucial para saber d\u00f3nde colocar tu l\u00f3gica. graph TD A[\"Petici\u00f3n del Usuario\"] --> B{\"Validaci\u00f3n de Campos\"} B -- Fallo --> Z[\"Mostrar Error\"] B -- \u00c9xito --> C{\"\u00bfExiste Hook _before*?\"} C -- S\u00ed --> D[\"Ejecutar _before*( )\"] D -- \"raise( )\" --> Z C -- No --> E[\"Operaci\u00f3n en Base de Datos\"] D -- \u00c9xito --> E E --> F{\"\u00bfOperaci\u00f3n Exitosa?\"} F -- No --> Z F -- S\u00ed --> G{\"\u00bfExiste Hook _after*?\"} G -- S\u00ed --> H[\"Ejecutar _after*( )\"] G -- No --> I[\"Respuesta Exitosa\"] H --> I Hooks disponibles Ragnos expone los siguientes hooks, todos opcionales: Hook Momento de ejecuci\u00f3n _beforeInsert() Antes de insertar un registro _afterInsert() Despu\u00e9s de insertar un registro _beforeUpdate() Antes de actualizar un registro _afterUpdate() Despu\u00e9s de actualizar un registro _beforeDelete() Antes de eliminar un registro _afterDelete() Despu\u00e9s de eliminar un registro Herramientas y conceptos fundamentales Antes de escribir funciones espec\u00edficas, es importante conocer las herramientas que Ragnos proporciona dentro de los hooks para interactuar con los datos y el flujo de la aplicaci\u00f3n. 1. Estructura b\u00e1sica Los hooks de tipo _before* (Insert y Update) reciben por referencia el array $data , permitiendo modificar los valores antes de que lleguen a la base de datos. Si no necesitas modificar datos, en algunos casos puedes omitir el argumento o no usarlo. // Hook con manipulaci\u00f3n de datos (por referencia) protected function _beforeInsert(&$data) { $data['creado_el'] = date('Y-m-d'); } 2. Acceso a valores: newValue() y oldValue() Para facilitar la l\u00f3gica de negocio, Ragnos proporciona funciones helper para inspeccionar el estado de los datos: newValue('campo') : Valor que se est\u00e1 intentando guardar (payload de la petici\u00f3n). oldValue('campo') : Valor original que ya existe en la base de datos (antes de la modificaci\u00f3n). Helper Insert Update Delete newValue() \u2705 \u2705 \u274c oldValue() \u274c \u2705 \u2705 3. Detecci\u00f3n de cambios: fieldHasChanged() \u00datil especialmente en actualizaciones para ejecutar acciones solo si un campo espec\u00edfico ha sido modificado. if (fieldHasChanged('status')) { // Enviar notificaci\u00f3n de cambio de estatus } 4. Interrupci\u00f3n segura: raise() Si necesitas detener una operaci\u00f3n debido a una regla de negocio, usa raise() . Esto detiene el proceso y muestra un mensaje de error al usuario, evitando que la operaci\u00f3n CRUD contin\u00fae. if (oldValue('locked') === true) { raise('No se puede modificar un registro bloqueado.'); } Nota de Dise\u00f1o raise() es preferible a throw new Exception para errores de validaci\u00f3n l\u00f3gica (\"Soft errors\") que el usuario debe corregir. Refactorizaci\u00f3n y Organizaci\u00f3n Aunque Ragnos no te obliga a crear clases externas para las funciones de los hooks (puedes escribir la l\u00f3gica directamente en el controlador), si las reglas de negocio son suficientemente complejas , es conveniente y recomendable refactorizarlas en Modelos , Librer\u00edas o Servicios dedicados. Esto ayuda a mantener el c\u00f3digo organizado, reutilizable y m\u00e1s f\u00e1cil de mantener. Hooks de Inserci\u00f3n Estos hooks se ejecutan durante la creaci\u00f3n de nuevos registros. _beforeInsert(&$data) Se ejecuta antes del INSERT. Recibe $data por referencia. Usos comunes: Inicializar valores autom\u00e1ticos (fechas, UUIDs). Normalizar datos (may\u00fasculas, formatos). Validaciones personalizadas del payload. protected function _beforeInsert(&$data) { // Asignar fecha de creaci\u00f3n manual $data['created_at'] = date('Y-m-d H:i:s'); // Forzar may\u00fasculas en el RFC if (isset($data['rfc'])) { $data['rfc'] = strtoupper($data['rfc']); } } _afterInsert() Se ejecuta despu\u00e9s de un INSERT exitoso. Usos comunes: Logs de auditor\u00eda. Env\u00edo de notificaciones de bienvenida. protected function _afterInsert() { log_message('info', 'Nuevo usuario registrado con ID ' . $this->insertID()); } Hooks de Actualizaci\u00f3n Estos hooks gestionan la modificaci\u00f3n de registros existentes. Es donde reside la mayor parte de la l\u00f3gica de negocio compleja. _beforeUpdate(&$data) Se ejecuta antes del UPDATE. Recibe $data con los campos a actualizar. Usos comunes: Validaciones de transici\u00f3n de estados. Registrar metadatos de edici\u00f3n ( updated_by ). Protecci\u00f3n de campos cr\u00edticos. protected function _beforeUpdate(&$data) { // Registrar qui\u00e9n modific\u00f3 el registro $data['updated_by'] = session('user_id'); // Validar regla de negocio: No reabrir tareas completadas if (oldValue('status') === 'completed' && newValue('status') === 'pending') { raise('No se puede reabrir una tarea completada.'); } } _afterUpdate() Se ejecuta despu\u00e9s de un UPDATE exitoso. Usos comunes: Invalidar cache. Recalcular datos dependientes en otras tablas. protected function _afterUpdate() { // Si cambi\u00f3 el l\u00edmite de cr\u00e9dito, invalidar el cache de estados de cuenta if (fieldHasChanged('creditLimit')) { \\Config\\Services::cache()->delete('estadosdecuenta'); } } Hooks de Eliminaci\u00f3n Gestionan el borrado de informaci\u00f3n. _beforeDelete() Se ejecuta antes del DELETE. Usos comunes: Validar dependencias (integridad referencial manual). Evitar borrado de registros del sistema. protected function _beforeDelete() { // Proteger al usuario Administrador (ID 1) if (oldValue('user_id') == 1) { raise('No se puede eliminar al usuario administrador principal.'); } // Verificar relaciones manualmente if ($this->hasRelations()) { raise('No se puede eliminar el registro porque tiene datos asociados.'); } } _afterDelete() Se ejecuta despu\u00e9s del DELETE. Usos comunes: Limpieza de archivos adjuntos (im\u00e1genes, documentos). Logs de actividad. protected function _afterDelete() { log_message('info', 'Registro eliminado correctamente.'); } Caso de Estudio: Cifrado de Contrase\u00f1as Este ejemplo real muestra c\u00f3mo combinar hooks para gestionar contrase\u00f1as de usuarios de forma segura. // Al crear, SIEMPRE se cifra la contrase\u00f1a public function _beforeInsert(&$userData) { $userData['usu_pword'] = md5(strtoupper($userData['usu_pword'])); } // Al editar, SOLO se cifra si el usuario escribi\u00f3 una nueva contrase\u00f1a public function _beforeUpdate(&$userData) { if (fieldHasChanged('usu_pword')) { $userData['usu_pword'] = md5(strtoupper($userData['usu_pword'])); } } Explicaci\u00f3n: En _beforeInsert , la contrase\u00f1a siempre viene en texto plano, as\u00ed que se cifra incondicionalmente. En _beforeUpdate , usamos fieldHasChanged para detectar si el usuario ingres\u00f3 una nueva clave. Si no se verifica esto, se podr\u00eda volver a cifrar el hash existente, corrompiendo la contrase\u00f1a. Hooks de Interfaz (UI) Ragnos permite intervenir tambi\u00e9n en la interfaz visual generada. _customFormDataFooter() Inserta HTML o scripts al pie del formulario de edici\u00f3n. function _customFormDataFooter() { $id = $this->request->getPost($this->getIdField()); // Retornamos una vista parcial return view('Tienda/detalle_pedidos', ['orderId' => $id]); } Buenas pr\u00e1cticas Recomendado Mant\u00e9n los hooks peque\u00f1os: La l\u00f3gica compleja debe ir a Servicios o Librer\u00edas. Documenta efectos secundarios: Si un hook altera otra tabla, deja un comentario claro. - Usa raise() para errores de validaci\u00f3n en lugar de excepciones duras. A evitar No reemplaces el controlador: Los hooks son para extender , no para reescribir el flujo CRUD. Cuidado con el SQL manual: Intenta usar los modelos siempre que sea posible. Filosof\u00eda Los hooks en Ragnos permiten extender sin romper : Desacoplamiento: No acoplan l\u00f3gica de negocio dura al mecanismo CRUD gen\u00e9rico. Declarativo: Mantienen el enfoque de configuraci\u00f3n sobre programaci\u00f3n. Mantenibilidad: Separan claramente la responsabilidad \"Qu\u00e9 guardar\" de \"Qu\u00e9 hacer cuando se guarda\". Filosof\u00eda Ragnos En Ragnos, los hooks no controlan el flujo: reaccionan al dominio.","title":"Hooks y eventos"},{"location":"avanzado/hooks/#hooks-y-ciclo-de-vida-en-ragnos","text":"En Ragnos, los hooks permiten ejecutar l\u00f3gica personalizada en distintos momentos del ciclo de vida de un dataset. Son el mecanismo principal para extender comportamiento sin romper el modelo declarativo. Los hooks se definen como m\u00e9todos protegidos dentro del controlador que extiende RDatasetController . Concepto Clave El controlador no implementa el CRUD manualmente. Ragnos se encarga de la operaci\u00f3n de base de datos, y t\u00fa solo \"te enganchas\" (hook) en los puntos clave para inyectar tu l\u00f3gica de negocio.","title":"Hooks y ciclo de vida en Ragnos"},{"location":"avanzado/hooks/#ciclo-de-vida-visual","text":"Entender el flujo de ejecuci\u00f3n es crucial para saber d\u00f3nde colocar tu l\u00f3gica. graph TD A[\"Petici\u00f3n del Usuario\"] --> B{\"Validaci\u00f3n de Campos\"} B -- Fallo --> Z[\"Mostrar Error\"] B -- \u00c9xito --> C{\"\u00bfExiste Hook _before*?\"} C -- S\u00ed --> D[\"Ejecutar _before*( )\"] D -- \"raise( )\" --> Z C -- No --> E[\"Operaci\u00f3n en Base de Datos\"] D -- \u00c9xito --> E E --> F{\"\u00bfOperaci\u00f3n Exitosa?\"} F -- No --> Z F -- S\u00ed --> G{\"\u00bfExiste Hook _after*?\"} G -- S\u00ed --> H[\"Ejecutar _after*( )\"] G -- No --> I[\"Respuesta Exitosa\"] H --> I","title":"Ciclo de Vida Visual"},{"location":"avanzado/hooks/#hooks-disponibles","text":"Ragnos expone los siguientes hooks, todos opcionales: Hook Momento de ejecuci\u00f3n _beforeInsert() Antes de insertar un registro _afterInsert() Despu\u00e9s de insertar un registro _beforeUpdate() Antes de actualizar un registro _afterUpdate() Despu\u00e9s de actualizar un registro _beforeDelete() Antes de eliminar un registro _afterDelete() Despu\u00e9s de eliminar un registro","title":"Hooks disponibles"},{"location":"avanzado/hooks/#herramientas-y-conceptos-fundamentales","text":"Antes de escribir funciones espec\u00edficas, es importante conocer las herramientas que Ragnos proporciona dentro de los hooks para interactuar con los datos y el flujo de la aplicaci\u00f3n.","title":"Herramientas y conceptos fundamentales"},{"location":"avanzado/hooks/#1-estructura-basica","text":"Los hooks de tipo _before* (Insert y Update) reciben por referencia el array $data , permitiendo modificar los valores antes de que lleguen a la base de datos. Si no necesitas modificar datos, en algunos casos puedes omitir el argumento o no usarlo. // Hook con manipulaci\u00f3n de datos (por referencia) protected function _beforeInsert(&$data) { $data['creado_el'] = date('Y-m-d'); }","title":"1. Estructura b\u00e1sica"},{"location":"avanzado/hooks/#2-acceso-a-valores-newvalue-y-oldvalue","text":"Para facilitar la l\u00f3gica de negocio, Ragnos proporciona funciones helper para inspeccionar el estado de los datos: newValue('campo') : Valor que se est\u00e1 intentando guardar (payload de la petici\u00f3n). oldValue('campo') : Valor original que ya existe en la base de datos (antes de la modificaci\u00f3n). Helper Insert Update Delete newValue() \u2705 \u2705 \u274c oldValue() \u274c \u2705 \u2705","title":"2. Acceso a valores: newValue() y oldValue()"},{"location":"avanzado/hooks/#3-deteccion-de-cambios-fieldhaschanged","text":"\u00datil especialmente en actualizaciones para ejecutar acciones solo si un campo espec\u00edfico ha sido modificado. if (fieldHasChanged('status')) { // Enviar notificaci\u00f3n de cambio de estatus }","title":"3. Detecci\u00f3n de cambios: fieldHasChanged()"},{"location":"avanzado/hooks/#4-interrupcion-segura-raise","text":"Si necesitas detener una operaci\u00f3n debido a una regla de negocio, usa raise() . Esto detiene el proceso y muestra un mensaje de error al usuario, evitando que la operaci\u00f3n CRUD contin\u00fae. if (oldValue('locked') === true) { raise('No se puede modificar un registro bloqueado.'); } Nota de Dise\u00f1o raise() es preferible a throw new Exception para errores de validaci\u00f3n l\u00f3gica (\"Soft errors\") que el usuario debe corregir. Refactorizaci\u00f3n y Organizaci\u00f3n Aunque Ragnos no te obliga a crear clases externas para las funciones de los hooks (puedes escribir la l\u00f3gica directamente en el controlador), si las reglas de negocio son suficientemente complejas , es conveniente y recomendable refactorizarlas en Modelos , Librer\u00edas o Servicios dedicados. Esto ayuda a mantener el c\u00f3digo organizado, reutilizable y m\u00e1s f\u00e1cil de mantener.","title":"4. Interrupci\u00f3n segura: raise()"},{"location":"avanzado/hooks/#hooks-de-insercion","text":"Estos hooks se ejecutan durante la creaci\u00f3n de nuevos registros.","title":"Hooks de Inserci\u00f3n"},{"location":"avanzado/hooks/#_beforeinsertdata","text":"Se ejecuta antes del INSERT. Recibe $data por referencia. Usos comunes: Inicializar valores autom\u00e1ticos (fechas, UUIDs). Normalizar datos (may\u00fasculas, formatos). Validaciones personalizadas del payload. protected function _beforeInsert(&$data) { // Asignar fecha de creaci\u00f3n manual $data['created_at'] = date('Y-m-d H:i:s'); // Forzar may\u00fasculas en el RFC if (isset($data['rfc'])) { $data['rfc'] = strtoupper($data['rfc']); } }","title":"_beforeInsert(&amp;$data)"},{"location":"avanzado/hooks/#_afterinsert","text":"Se ejecuta despu\u00e9s de un INSERT exitoso. Usos comunes: Logs de auditor\u00eda. Env\u00edo de notificaciones de bienvenida. protected function _afterInsert() { log_message('info', 'Nuevo usuario registrado con ID ' . $this->insertID()); }","title":"_afterInsert()"},{"location":"avanzado/hooks/#hooks-de-actualizacion","text":"Estos hooks gestionan la modificaci\u00f3n de registros existentes. Es donde reside la mayor parte de la l\u00f3gica de negocio compleja.","title":"Hooks de Actualizaci\u00f3n"},{"location":"avanzado/hooks/#_beforeupdatedata","text":"Se ejecuta antes del UPDATE. Recibe $data con los campos a actualizar. Usos comunes: Validaciones de transici\u00f3n de estados. Registrar metadatos de edici\u00f3n ( updated_by ). Protecci\u00f3n de campos cr\u00edticos. protected function _beforeUpdate(&$data) { // Registrar qui\u00e9n modific\u00f3 el registro $data['updated_by'] = session('user_id'); // Validar regla de negocio: No reabrir tareas completadas if (oldValue('status') === 'completed' && newValue('status') === 'pending') { raise('No se puede reabrir una tarea completada.'); } }","title":"_beforeUpdate(&amp;$data)"},{"location":"avanzado/hooks/#_afterupdate","text":"Se ejecuta despu\u00e9s de un UPDATE exitoso. Usos comunes: Invalidar cache. Recalcular datos dependientes en otras tablas. protected function _afterUpdate() { // Si cambi\u00f3 el l\u00edmite de cr\u00e9dito, invalidar el cache de estados de cuenta if (fieldHasChanged('creditLimit')) { \\Config\\Services::cache()->delete('estadosdecuenta'); } }","title":"_afterUpdate()"},{"location":"avanzado/hooks/#hooks-de-eliminacion","text":"Gestionan el borrado de informaci\u00f3n.","title":"Hooks de Eliminaci\u00f3n"},{"location":"avanzado/hooks/#_beforedelete","text":"Se ejecuta antes del DELETE. Usos comunes: Validar dependencias (integridad referencial manual). Evitar borrado de registros del sistema. protected function _beforeDelete() { // Proteger al usuario Administrador (ID 1) if (oldValue('user_id') == 1) { raise('No se puede eliminar al usuario administrador principal.'); } // Verificar relaciones manualmente if ($this->hasRelations()) { raise('No se puede eliminar el registro porque tiene datos asociados.'); } }","title":"_beforeDelete()"},{"location":"avanzado/hooks/#_afterdelete","text":"Se ejecuta despu\u00e9s del DELETE. Usos comunes: Limpieza de archivos adjuntos (im\u00e1genes, documentos). Logs de actividad. protected function _afterDelete() { log_message('info', 'Registro eliminado correctamente.'); }","title":"_afterDelete()"},{"location":"avanzado/hooks/#caso-de-estudio-cifrado-de-contrasenas","text":"Este ejemplo real muestra c\u00f3mo combinar hooks para gestionar contrase\u00f1as de usuarios de forma segura. // Al crear, SIEMPRE se cifra la contrase\u00f1a public function _beforeInsert(&$userData) { $userData['usu_pword'] = md5(strtoupper($userData['usu_pword'])); } // Al editar, SOLO se cifra si el usuario escribi\u00f3 una nueva contrase\u00f1a public function _beforeUpdate(&$userData) { if (fieldHasChanged('usu_pword')) { $userData['usu_pword'] = md5(strtoupper($userData['usu_pword'])); } } Explicaci\u00f3n: En _beforeInsert , la contrase\u00f1a siempre viene en texto plano, as\u00ed que se cifra incondicionalmente. En _beforeUpdate , usamos fieldHasChanged para detectar si el usuario ingres\u00f3 una nueva clave. Si no se verifica esto, se podr\u00eda volver a cifrar el hash existente, corrompiendo la contrase\u00f1a.","title":"Caso de Estudio: Cifrado de Contrase\u00f1as"},{"location":"avanzado/hooks/#hooks-de-interfaz-ui","text":"Ragnos permite intervenir tambi\u00e9n en la interfaz visual generada.","title":"Hooks de Interfaz (UI)"},{"location":"avanzado/hooks/#_customformdatafooter","text":"Inserta HTML o scripts al pie del formulario de edici\u00f3n. function _customFormDataFooter() { $id = $this->request->getPost($this->getIdField()); // Retornamos una vista parcial return view('Tienda/detalle_pedidos', ['orderId' => $id]); }","title":"_customFormDataFooter()"},{"location":"avanzado/hooks/#buenas-practicas","text":"Recomendado Mant\u00e9n los hooks peque\u00f1os: La l\u00f3gica compleja debe ir a Servicios o Librer\u00edas. Documenta efectos secundarios: Si un hook altera otra tabla, deja un comentario claro. - Usa raise() para errores de validaci\u00f3n en lugar de excepciones duras. A evitar No reemplaces el controlador: Los hooks son para extender , no para reescribir el flujo CRUD. Cuidado con el SQL manual: Intenta usar los modelos siempre que sea posible.","title":"Buenas pr\u00e1cticas"},{"location":"avanzado/hooks/#filosofia","text":"Los hooks en Ragnos permiten extender sin romper : Desacoplamiento: No acoplan l\u00f3gica de negocio dura al mecanismo CRUD gen\u00e9rico. Declarativo: Mantienen el enfoque de configuraci\u00f3n sobre programaci\u00f3n. Mantenibilidad: Separan claramente la responsabilidad \"Qu\u00e9 guardar\" de \"Qu\u00e9 hacer cuando se guarda\". Filosof\u00eda Ragnos En Ragnos, los hooks no controlan el flujo: reaccionan al dominio.","title":"Filosof\u00eda"},{"location":"avanzado/reportes_automaticos/","text":"\ud83d\udcca Generador Autom\u00e1tico de Reportes Introducci\u00f3n El Generador Autom\u00e1tico de Reportes ( RDatasetReportGenerator ) es una caracter\u00edstica poderosa de Ragnos que permite crear reportes complejos y personalizados sin escribir c\u00f3digo adicional . Esta funcionalidad est\u00e1 integrada autom\u00e1ticamente en todos los datasets basados en RDatasetController , lo que significa que cualquier cat\u00e1logo que hayas creado ya tiene capacidades de reporter\u00eda avanzada disponibles desde el primer momento. Acceso desde la Interfaz Gr\u00e1fica Cada dataset basado en RDatasetController incluye autom\u00e1ticamente un bot\u00f3n de \"Reporte Avanzado\" (icono de impresora \ud83d\udda8\ufe0f) en la barra de herramientas de la vista de tabla: // Ubicado en: app/ThirdParty/Ragnos/Views/rdatasetcontroller/table_view.php <a href=\" <? = site_url ( $clase . '/genericAdvancedReport' ) ?> \" class=\"toolbtn btn btn-outline-secondary btn-lg bg-white shadow-sm\" title=\" <? = lang ( 'Ragnos.Ragnos_advanced_report_tooltip' ) ?> \"> <i class=\"bi bi-printer\"></i> </a> Al hacer clic en este bot\u00f3n, el usuario accede a una interfaz de configuraci\u00f3n de reportes donde puede: Generar reportes con totales y subtotales autom\u00e1ticos Mejoras de Experiencia de Usuario (UX) Premium El generador ha sido actualizado con una interfaz moderna y eficiente que optimiza el flujo de trabajo: 1. Dise\u00f1o Compacto y Eficiente Layout Optimizado: Se han reducido los espacios innecesarios (paddings y m\u00e1rgenes) para mostrar m\u00e1s informaci\u00f3n en menos pantalla, ideal para configuraciones con muchos filtros. Cabeceras y Pie de P\u00e1gina Pegajosos: El bot\u00f3n de \"Generar Reporte\" y la barra de herramientas de filtros est\u00e1n siempre visibles (sticky), eliminando la necesidad de hacer scroll infinito. Barra Lateral de Agrupamiento: En pantallas grandes, la configuraci\u00f3n de grupos se mantiene fija a la derecha para un acceso r\u00e1pido. 2. Navegaci\u00f3n Inteligente y AJAX Limpieza de Sesi\u00f3n sin Recarga: El bot\u00f3n \"Borrar/Limpiar\" ahora funciona mediante AJAX. Esto limpia los filtros instant\u00e1neamente sin recargar la p\u00e1gina, lo que evita \"ensuciar\" el historial del navegador. Ahora, al presionar el bot\u00f3n \"Volver atr\u00e1s\" del navegador, regresar\u00e1s a la p\u00e1gina anterior con un solo clic. Confirmaciones Profesionales: Se utiliza SweetAlert2 para confirmaciones cr\u00edticas, ofreciendo una est\u00e9tica mucho m\u00e1s integrada y profesional que los mensajes nativos del navegador. 3. Feedback Visual Din\u00e1mico Animaciones de Resaltado: Al agregar un nuevo filtro, este aparece con una suave animaci\u00f3n de pulso para indicar d\u00f3nde se ha a\u00f1adido. Scroll Autom\u00e1tico: La pantalla se desplaza suavemente hacia el nuevo filtro seleccionado. Estados de Carga: El bot\u00f3n de generaci\u00f3n muestra un spinner y se deshabilita durante el procesamiento para evitar env\u00edos duplicados. Funcionalidades Avanzadas de Configuraci\u00f3n 1. Auto-Agrupamiento Inteligente Cuando se a\u00f1ade un filtro de tipo B\u00fasqueda Contextual (campos con addSearch() ), el sistema intenta autom\u00e1ticamente asignar ese campo al primer nivel de agrupamiento disponible. Esto agiliza la creaci\u00f3n de reportes, ya que normalmente se desea ver los datos agrupados por la entidad que se est\u00e1 filtrando. 2. Niveles de Agrupaci\u00f3n Excluyentes Para evitar errores en la l\u00f3gica del reporte, los niveles de agrupaci\u00f3n (Nivel 1, 2 y 3) son inteligentes: si seleccionas un campo en el Nivel 1, esa opci\u00f3n se deshabilitar\u00e1 autom\u00e1ticamente en los niveles 2 y 3, asegurando una jerarqu\u00eda l\u00f3gica y sin duplicados. Caracter\u00edsticas Principales 1. Generaci\u00f3n Autom\u00e1tica de Filtros El generador analiza autom\u00e1ticamente todos los campos definidos en tu dataset mediante addField() y crea los filtros apropiados seg\u00fan el tipo de campo: Tipos de Filtros Detectados Autom\u00e1ticamente Tipo de Campo Tipo de Filtro Generado Descripci\u00f3n date / datetime Rango de Fechas Permite filtrar desde/hasta una fecha espec\u00edfica money / numeric / decimal Rango Num\u00e9rico Filtro min/max para valores num\u00e9ricos dropdown / enum Selector de Opciones Lista desplegable con las opciones definidas switch / boolean Selector Booleano Filtro S\u00ed/No o Activo/Inactivo Campos con addSearch() B\u00fasqueda Contextual Permite buscar en el dataset relacionado Texto (otros) Filtro de Texto B\u00fasqueda por coincidencia de texto Ejemplo de Detecci\u00f3n Autom\u00e1tica // En tu dataset de Clientes $this->addField('customerName', [ 'label' => 'Nombre del Cliente', 'rules' => 'required' ]); // \u2192 Se generar\u00e1 un filtro de TEXTO $this->addField('creditLimit', [ 'label' => 'L\u00edmite de Cr\u00e9dito', 'rules' => 'required|money' ]); // \u2192 Se generar\u00e1 un filtro de RANGO NUM\u00c9RICO (min/max) $this->addField('status', [ 'label' => 'Estado', 'type' => 'dropdown', 'options' => [ 'active' => 'Activo', 'inactive' => 'Inactivo', 'suspended' => 'Suspendido' ] ]); // \u2192 Se generar\u00e1 un filtro de SELECCI\u00d3N con las opciones definidas $this->addSearch('salesRepEmployeeNumber', 'Tienda\\\\Empleados'); // \u2192 Se generar\u00e1 un filtro de B\u00daSQUEDA que reutiliza el dataset de Empleados 2. Generaci\u00f3n Autom\u00e1tica de Agrupaciones Los criterios de agrupaci\u00f3n tambi\u00e9n se generan autom\u00e1ticamente bas\u00e1ndose en la configuraci\u00f3n de campos: Tipos de Agrupaci\u00f3n Detectados Tipo de Campo Agrupaciones Generadas date / datetime \u2022 Por Mes (A\u00f1o-Mes) \u2022 Por A\u00f1o Campos con addSearch() \u2022 Por Valor Exacto del campo relacionado dropdown / enum \u2022 Por Valor Exacto de la opci\u00f3n seleccionada Ejemplo de Agrupaciones Autom\u00e1ticas // Campo de fecha en el dataset de \u00d3rdenes $this->addField('orderDate', [ 'label' => 'Fecha de Orden', 'type' => 'date', 'rules' => 'required' ]); // \u2192 Genera dos opciones de agrupaci\u00f3n: // 1. \"Fecha de Orden (Por Mes)\" // 2. \"Fecha de Orden (Por A\u00f1o)\" // Campo relacionado en el dataset de Pagos $this->addSearch('customerNumber', 'Tienda\\\\Clientes'); // \u2192 Genera agrupaci\u00f3n: // \"customerNumber (Valor exacto)\" - agrupa por cliente 3. Agrupaci\u00f3n Multinivel El generador soporta hasta 3 niveles de agrupaci\u00f3n jer\u00e1rquica , permitiendo reportes complejos como: Ventas por A\u00f1o \u2192 Mes \u2192 Empleado Pagos por Cliente \u2192 A\u00f1o \u2192 M\u00e9todo de Pago Productos por L\u00ednea \u2192 A\u00f1o \u2192 Mes Cada nivel de agrupaci\u00f3n genera autom\u00e1ticamente subtotales y el reporte incluye un total general . 4. B\u00fasqueda Contextual en Filtros Cuando un campo est\u00e1 vinculado a otro dataset mediante addSearch() , el filtro del reporte hereda toda la funcionalidad de b\u00fasqueda contextual: Ejemplo Pr\u00e1ctico: En el dataset de Pagos , tienes: $this->addSearch('customerNumber', 'Tienda\\\\Clientes'); Y en el dataset de Clientes , definiste: $this->setTableFields([ 'customerName', 'Contacto', // Campo calculado 'salesRepEmployeeNumber' // Empleado a cargo ]); Resultado en el Generador de Reportes: Al filtrar pagos por cliente, el usuario puede buscar escribiendo: El nombre de la empresa El nombre del contacto El nombre del empleado a cargo \u00a1El sistema buscar\u00e1 autom\u00e1ticamente en todos los campos visibles del dataset de Clientes! Arquitectura y Funcionamiento Clase RDatasetReportGenerator Esta clase es el motor detr\u00e1s de la generaci\u00f3n autom\u00e1tica de reportes. Sus responsabilidades incluyen: Introspecci\u00f3n de Campos ( detectCapabilities() ) Analiza todos los campos del dataset Identifica tipos de filtros aplicables Detecta criterios de agrupaci\u00f3n viables Ignora campos no aptos (claves primarias, campos \u00fanicos, archivos) Procesamiento de Solicitudes ( processRequest() ) Lee los filtros y agrupaciones enviados desde el formulario Valida y normaliza los valores Construye las condiciones de consulta Generaci\u00f3n de Consultas SQL Aplica filtros simples ( WHERE campo = valor ) Aplica rangos de fechas ( WHERE fecha >= inicio AND fecha <= fin ) Aplica rangos num\u00e9ricos ( WHERE campo >= min AND campo <= max ) Maneja correctamente JOINs para campos relacionados Formateo y Agrupaci\u00f3n ( generateHTML() ) Ejecuta la consulta con todos los filtros aplicados Enriquece los datos con claves de agrupaci\u00f3n formateadas Ordena jer\u00e1rquicamente por los niveles de agrupaci\u00f3n Delega el formateo de valores al modelo (moneda, fechas, relaciones) Generaci\u00f3n de Reporte HTML Utiliza RSimpleLevelReport para generar HTML estructurado Incluye totales y subtotales autom\u00e1ticos Muestra descripci\u00f3n de filtros aplicados Flujo de Ejecuci\u00f3n graph TD A[Usuario hace clic en bot\u00f3n Reporte] --> B[genericAdvancedReport m\u00e9todo] B --> C{\u00bfEs POST?} C -->|No| D[Mostrar formulario de configuraci\u00f3n] C -->|S\u00ed| E[Procesar filtros y agrupaciones] E --> F[Ejecutar consulta SQL con filtros] F --> G[Formatear datos y agrupar] G --> H[Generar HTML con totales] H --> I[Mostrar reporte al usuario] D --> J[Usuario configura filtros/grupos] J --> K[Usuario env\u00eda formulario] K --> C Uso Pr\u00e1ctico: Ejemplo Completo Dataset de \u00d3rdenes namespace App\\Controllers\\Tienda; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Ordenes extends RDatasetController { public function __construct() { parent::__construct(); $this->checkLogin(); $this->setTitle('\u00d3rdenes de Compra'); $this->setTableName('orders'); $this->setIdField('orderNumber'); // Campo de fecha \u2192 generar\u00e1 filtro de rango + agrupaci\u00f3n por mes/a\u00f1o $this->addField('orderDate', [ 'label' => 'Fecha de Orden', 'type' => 'date', 'rules' => 'required' ]); // Campo relacionado \u2192 generar\u00e1 filtro de b\u00fasqueda + agrupaci\u00f3n por cliente $this->addSearch('customerNumber', 'Tienda\\\\Clientes'); // Campo enum \u2192 generar\u00e1 filtro de selecci\u00f3n + agrupaci\u00f3n por estado $this->addField('status', [ 'label' => 'Estado', 'type' => 'dropdown', 'options' => [ 'Shipped' => 'Enviado', 'Pending' => 'Pendiente', 'Cancelled' => 'Cancelado' ], 'rules' => 'required' ]); // Campo calculado (monto total) $this->addField('Total', [ 'label' => 'Total', 'query' => '(SELECT SUM(quantityOrdered * priceEach) FROM orderdetails WHERE orderdetails.orderNumber = orders.orderNumber)', 'rules' => 'readonly|money' ]); $this->setTableFields([ 'orderNumber', 'orderDate', 'customerNumber', 'status', 'Total' ]); } } Reportes Generados Autom\u00e1ticamente Con esta configuraci\u00f3n, el usuario puede generar reportes como: Ejemplo 1: Ventas por Cliente en un Rango de Fechas Filtro: Fecha desde 2024-01-01 hasta 2024-12-31 Agrupaci\u00f3n: Por Cliente Resultado: Lista de clientes con el total vendido a cada uno en 2024 Ejemplo 2: \u00d3rdenes Canceladas por Mes Filtro: Estado = \"Cancelado\" Agrupaci\u00f3n Nivel 1: Por Mes Resultado: Total de \u00f3rdenes canceladas agrupadas por mes con subtotales Ejemplo 3: An\u00e1lisis Jer\u00e1rquico Anual Agrupaci\u00f3n Nivel 1: Por A\u00f1o Agrupaci\u00f3n Nivel 2: Por Mes Agrupaci\u00f3n Nivel 3: Por Estado Resultado: Reporte jer\u00e1rquico: A\u00f1o \u2192 Mes \u2192 Estado con todos sus subtotales Ventajas del Sistema 1. Cero Configuraci\u00f3n Adicional No necesitas escribir controladores especiales, vistas o queries para reportes. Todo se genera autom\u00e1ticamente desde la definici\u00f3n del dataset. 2. Reutilizaci\u00f3n de L\u00f3gica Los filtros y agrupaciones reutilizan: Las validaciones definidas en addField() Las relaciones definidas con addSearch() El formateo definido en el modelo 3. Consistencia de Interfaz Todos los datasets tienen exactamente la misma interfaz de reportes, reduciendo la curva de aprendizaje para los usuarios. 4. Flexibilidad Total Los usuarios finales pueden combinar cualquier filtro con cualquier agrupaci\u00f3n, generando reportes ad-hoc seg\u00fan sus necesidades sin requerir desarrollo. 5. Escalabilidad A medida que agregas m\u00e1s campos a tu dataset, autom\u00e1ticamente se ampl\u00edan las opciones de filtros y agrupaciones disponibles. Limitaciones y Consideraciones Campos Excluidos Autom\u00e1ticamente El sistema ignora autom\u00e1ticamente ciertos tipos de campos para filtros y agrupaciones: Claves primarias : No suelen ser \u00fatiles para filtros generales Campos con is_unique : Pensados para identificadores \u00fanicos Archivos e im\u00e1genes ( fileupload , imageupload ) Contrase\u00f1as ( password ) Campos Calculados y Agrupaciones Los campos con query (calculados) pueden aparecer en el reporte, pero no se pueden usar como criterio de agrupaci\u00f3n ya que son expresiones SQL derivadas. Performance en Grandes Vol\u00famenes Para datasets con millones de registros, considera: A\u00f1adir \u00edndices en campos frecuentemente filtrados Limitar las opciones de agrupaci\u00f3n si son muy costosas Implementar paginaci\u00f3n o l\u00edmites en la consulta si es necesario Personalizaci\u00f3n Avanzada Aunque el generador es autom\u00e1tico, puedes influir en su comportamiento: Controlar qu\u00e9 Campos son Filtrables Al definir campos como hidden o con reglas espec\u00edficas, puedes controlar su aparici\u00f3n en filtros: // Este campo NO aparecer\u00e1 en filtros (es hidden y calculado) $this->addField('internalCode', [ 'label' => 'C\u00f3digo Interno', 'type' => 'hidden', 'query' => 'MD5(customerNumber)' ]); M\u00e9todos Program\u00e1ticos Tambi\u00e9n puedes usar el generador program\u00e1ticamente desde c\u00f3digo: public function reportePersonalizado() { $generator = new RDatasetReportGenerator($this); // Agregar filtros manualmente $generator->addDateRangeFilter('orderDate', '2024-01-01', '2024-12-31'); $generator->addFilter('status', 'Shipped'); // Configurar agrupaci\u00f3n $generator->setGrouping('customerNumber', 'raw', 'Cliente'); $generator->setGrouping('orderDate', 'date_month', 'Mes'); // Generar HTML $html = $generator->generateHTML(); return view('mi_plantilla_reporte', ['contenido' => $html]); } Integraci\u00f3n con el Ecosistema Ragnos Relaci\u00f3n con addSearch() Como se mencion\u00f3 en la gu\u00eda de Datasets , los campos definidos con addSearch() no solo crean selectores en formularios, sino que tambi\u00e9n: En Filtros de Reportes: Permiten b\u00fasqueda contextual avanzada En Agrupaciones: Se convierten autom\u00e1ticamente en criterios de agrupaci\u00f3n Esta sinergia hace que definir relaciones sea doblemente poderoso. Relaci\u00f3n con setTableFields() Los campos incluidos en setTableFields() son los que aparecer\u00e1n en el reporte generado. Esto te da control sobre qu\u00e9 columnas se muestran sin afectar la disponibilidad de filtros y agrupaciones. Conclusi\u00f3n El Generador Autom\u00e1tico de Reportes es una de las caracter\u00edsticas m\u00e1s potentes de Ragnos, transformando cada dataset simple en una herramienta de an\u00e1lisis avanzado sin esfuerzo adicional de desarrollo. Al aprovechar toda la metadata declarativa que defines en tu dataset ( addField , addSearch , setTableFields ), el sistema construye autom\u00e1ticamente una interfaz completa de reporter\u00eda con: \u2705 Filtros inteligentes seg\u00fan tipo de campo \u2705 Agrupaciones jer\u00e1rquicas multinivel \u2705 B\u00fasqueda contextual en relaciones \u2705 Totales y subtotales autom\u00e1ticos \u2705 Interfaz consistente en todos los m\u00f3dulos Resultado: Reportes empresariales de calidad profesional, disponibles en minutos, no en semanas.","title":"Reportes Autom\u00e1ticos"},{"location":"avanzado/reportes_automaticos/#generador-automatico-de-reportes","text":"","title":"\ud83d\udcca Generador Autom\u00e1tico de Reportes"},{"location":"avanzado/reportes_automaticos/#introduccion","text":"El Generador Autom\u00e1tico de Reportes ( RDatasetReportGenerator ) es una caracter\u00edstica poderosa de Ragnos que permite crear reportes complejos y personalizados sin escribir c\u00f3digo adicional . Esta funcionalidad est\u00e1 integrada autom\u00e1ticamente en todos los datasets basados en RDatasetController , lo que significa que cualquier cat\u00e1logo que hayas creado ya tiene capacidades de reporter\u00eda avanzada disponibles desde el primer momento.","title":"Introducci\u00f3n"},{"location":"avanzado/reportes_automaticos/#acceso-desde-la-interfaz-grafica","text":"Cada dataset basado en RDatasetController incluye autom\u00e1ticamente un bot\u00f3n de \"Reporte Avanzado\" (icono de impresora \ud83d\udda8\ufe0f) en la barra de herramientas de la vista de tabla: // Ubicado en: app/ThirdParty/Ragnos/Views/rdatasetcontroller/table_view.php <a href=\" <? = site_url ( $clase . '/genericAdvancedReport' ) ?> \" class=\"toolbtn btn btn-outline-secondary btn-lg bg-white shadow-sm\" title=\" <? = lang ( 'Ragnos.Ragnos_advanced_report_tooltip' ) ?> \"> <i class=\"bi bi-printer\"></i> </a> Al hacer clic en este bot\u00f3n, el usuario accede a una interfaz de configuraci\u00f3n de reportes donde puede: Generar reportes con totales y subtotales autom\u00e1ticos","title":"Acceso desde la Interfaz Gr\u00e1fica"},{"location":"avanzado/reportes_automaticos/#mejoras-de-experiencia-de-usuario-ux-premium","text":"El generador ha sido actualizado con una interfaz moderna y eficiente que optimiza el flujo de trabajo:","title":"Mejoras de Experiencia de Usuario (UX) Premium"},{"location":"avanzado/reportes_automaticos/#1-diseno-compacto-y-eficiente","text":"Layout Optimizado: Se han reducido los espacios innecesarios (paddings y m\u00e1rgenes) para mostrar m\u00e1s informaci\u00f3n en menos pantalla, ideal para configuraciones con muchos filtros. Cabeceras y Pie de P\u00e1gina Pegajosos: El bot\u00f3n de \"Generar Reporte\" y la barra de herramientas de filtros est\u00e1n siempre visibles (sticky), eliminando la necesidad de hacer scroll infinito. Barra Lateral de Agrupamiento: En pantallas grandes, la configuraci\u00f3n de grupos se mantiene fija a la derecha para un acceso r\u00e1pido.","title":"1. Dise\u00f1o Compacto y Eficiente"},{"location":"avanzado/reportes_automaticos/#2-navegacion-inteligente-y-ajax","text":"Limpieza de Sesi\u00f3n sin Recarga: El bot\u00f3n \"Borrar/Limpiar\" ahora funciona mediante AJAX. Esto limpia los filtros instant\u00e1neamente sin recargar la p\u00e1gina, lo que evita \"ensuciar\" el historial del navegador. Ahora, al presionar el bot\u00f3n \"Volver atr\u00e1s\" del navegador, regresar\u00e1s a la p\u00e1gina anterior con un solo clic. Confirmaciones Profesionales: Se utiliza SweetAlert2 para confirmaciones cr\u00edticas, ofreciendo una est\u00e9tica mucho m\u00e1s integrada y profesional que los mensajes nativos del navegador.","title":"2. Navegaci\u00f3n Inteligente y AJAX"},{"location":"avanzado/reportes_automaticos/#3-feedback-visual-dinamico","text":"Animaciones de Resaltado: Al agregar un nuevo filtro, este aparece con una suave animaci\u00f3n de pulso para indicar d\u00f3nde se ha a\u00f1adido. Scroll Autom\u00e1tico: La pantalla se desplaza suavemente hacia el nuevo filtro seleccionado. Estados de Carga: El bot\u00f3n de generaci\u00f3n muestra un spinner y se deshabilita durante el procesamiento para evitar env\u00edos duplicados.","title":"3. Feedback Visual Din\u00e1mico"},{"location":"avanzado/reportes_automaticos/#funcionalidades-avanzadas-de-configuracion","text":"","title":"Funcionalidades Avanzadas de Configuraci\u00f3n"},{"location":"avanzado/reportes_automaticos/#1-auto-agrupamiento-inteligente","text":"Cuando se a\u00f1ade un filtro de tipo B\u00fasqueda Contextual (campos con addSearch() ), el sistema intenta autom\u00e1ticamente asignar ese campo al primer nivel de agrupamiento disponible. Esto agiliza la creaci\u00f3n de reportes, ya que normalmente se desea ver los datos agrupados por la entidad que se est\u00e1 filtrando.","title":"1. Auto-Agrupamiento Inteligente"},{"location":"avanzado/reportes_automaticos/#2-niveles-de-agrupacion-excluyentes","text":"Para evitar errores en la l\u00f3gica del reporte, los niveles de agrupaci\u00f3n (Nivel 1, 2 y 3) son inteligentes: si seleccionas un campo en el Nivel 1, esa opci\u00f3n se deshabilitar\u00e1 autom\u00e1ticamente en los niveles 2 y 3, asegurando una jerarqu\u00eda l\u00f3gica y sin duplicados.","title":"2. Niveles de Agrupaci\u00f3n Excluyentes"},{"location":"avanzado/reportes_automaticos/#caracteristicas-principales","text":"","title":"Caracter\u00edsticas Principales"},{"location":"avanzado/reportes_automaticos/#1-generacion-automatica-de-filtros","text":"El generador analiza autom\u00e1ticamente todos los campos definidos en tu dataset mediante addField() y crea los filtros apropiados seg\u00fan el tipo de campo:","title":"1. Generaci\u00f3n Autom\u00e1tica de Filtros"},{"location":"avanzado/reportes_automaticos/#tipos-de-filtros-detectados-automaticamente","text":"Tipo de Campo Tipo de Filtro Generado Descripci\u00f3n date / datetime Rango de Fechas Permite filtrar desde/hasta una fecha espec\u00edfica money / numeric / decimal Rango Num\u00e9rico Filtro min/max para valores num\u00e9ricos dropdown / enum Selector de Opciones Lista desplegable con las opciones definidas switch / boolean Selector Booleano Filtro S\u00ed/No o Activo/Inactivo Campos con addSearch() B\u00fasqueda Contextual Permite buscar en el dataset relacionado Texto (otros) Filtro de Texto B\u00fasqueda por coincidencia de texto","title":"Tipos de Filtros Detectados Autom\u00e1ticamente"},{"location":"avanzado/reportes_automaticos/#ejemplo-de-deteccion-automatica","text":"// En tu dataset de Clientes $this->addField('customerName', [ 'label' => 'Nombre del Cliente', 'rules' => 'required' ]); // \u2192 Se generar\u00e1 un filtro de TEXTO $this->addField('creditLimit', [ 'label' => 'L\u00edmite de Cr\u00e9dito', 'rules' => 'required|money' ]); // \u2192 Se generar\u00e1 un filtro de RANGO NUM\u00c9RICO (min/max) $this->addField('status', [ 'label' => 'Estado', 'type' => 'dropdown', 'options' => [ 'active' => 'Activo', 'inactive' => 'Inactivo', 'suspended' => 'Suspendido' ] ]); // \u2192 Se generar\u00e1 un filtro de SELECCI\u00d3N con las opciones definidas $this->addSearch('salesRepEmployeeNumber', 'Tienda\\\\Empleados'); // \u2192 Se generar\u00e1 un filtro de B\u00daSQUEDA que reutiliza el dataset de Empleados","title":"Ejemplo de Detecci\u00f3n Autom\u00e1tica"},{"location":"avanzado/reportes_automaticos/#2-generacion-automatica-de-agrupaciones","text":"Los criterios de agrupaci\u00f3n tambi\u00e9n se generan autom\u00e1ticamente bas\u00e1ndose en la configuraci\u00f3n de campos:","title":"2. Generaci\u00f3n Autom\u00e1tica de Agrupaciones"},{"location":"avanzado/reportes_automaticos/#tipos-de-agrupacion-detectados","text":"Tipo de Campo Agrupaciones Generadas date / datetime \u2022 Por Mes (A\u00f1o-Mes) \u2022 Por A\u00f1o Campos con addSearch() \u2022 Por Valor Exacto del campo relacionado dropdown / enum \u2022 Por Valor Exacto de la opci\u00f3n seleccionada","title":"Tipos de Agrupaci\u00f3n Detectados"},{"location":"avanzado/reportes_automaticos/#ejemplo-de-agrupaciones-automaticas","text":"// Campo de fecha en el dataset de \u00d3rdenes $this->addField('orderDate', [ 'label' => 'Fecha de Orden', 'type' => 'date', 'rules' => 'required' ]); // \u2192 Genera dos opciones de agrupaci\u00f3n: // 1. \"Fecha de Orden (Por Mes)\" // 2. \"Fecha de Orden (Por A\u00f1o)\" // Campo relacionado en el dataset de Pagos $this->addSearch('customerNumber', 'Tienda\\\\Clientes'); // \u2192 Genera agrupaci\u00f3n: // \"customerNumber (Valor exacto)\" - agrupa por cliente","title":"Ejemplo de Agrupaciones Autom\u00e1ticas"},{"location":"avanzado/reportes_automaticos/#3-agrupacion-multinivel","text":"El generador soporta hasta 3 niveles de agrupaci\u00f3n jer\u00e1rquica , permitiendo reportes complejos como: Ventas por A\u00f1o \u2192 Mes \u2192 Empleado Pagos por Cliente \u2192 A\u00f1o \u2192 M\u00e9todo de Pago Productos por L\u00ednea \u2192 A\u00f1o \u2192 Mes Cada nivel de agrupaci\u00f3n genera autom\u00e1ticamente subtotales y el reporte incluye un total general .","title":"3. Agrupaci\u00f3n Multinivel"},{"location":"avanzado/reportes_automaticos/#4-busqueda-contextual-en-filtros","text":"Cuando un campo est\u00e1 vinculado a otro dataset mediante addSearch() , el filtro del reporte hereda toda la funcionalidad de b\u00fasqueda contextual: Ejemplo Pr\u00e1ctico: En el dataset de Pagos , tienes: $this->addSearch('customerNumber', 'Tienda\\\\Clientes'); Y en el dataset de Clientes , definiste: $this->setTableFields([ 'customerName', 'Contacto', // Campo calculado 'salesRepEmployeeNumber' // Empleado a cargo ]); Resultado en el Generador de Reportes: Al filtrar pagos por cliente, el usuario puede buscar escribiendo: El nombre de la empresa El nombre del contacto El nombre del empleado a cargo \u00a1El sistema buscar\u00e1 autom\u00e1ticamente en todos los campos visibles del dataset de Clientes!","title":"4. B\u00fasqueda Contextual en Filtros"},{"location":"avanzado/reportes_automaticos/#arquitectura-y-funcionamiento","text":"","title":"Arquitectura y Funcionamiento"},{"location":"avanzado/reportes_automaticos/#clase-rdatasetreportgenerator","text":"Esta clase es el motor detr\u00e1s de la generaci\u00f3n autom\u00e1tica de reportes. Sus responsabilidades incluyen: Introspecci\u00f3n de Campos ( detectCapabilities() ) Analiza todos los campos del dataset Identifica tipos de filtros aplicables Detecta criterios de agrupaci\u00f3n viables Ignora campos no aptos (claves primarias, campos \u00fanicos, archivos) Procesamiento de Solicitudes ( processRequest() ) Lee los filtros y agrupaciones enviados desde el formulario Valida y normaliza los valores Construye las condiciones de consulta Generaci\u00f3n de Consultas SQL Aplica filtros simples ( WHERE campo = valor ) Aplica rangos de fechas ( WHERE fecha >= inicio AND fecha <= fin ) Aplica rangos num\u00e9ricos ( WHERE campo >= min AND campo <= max ) Maneja correctamente JOINs para campos relacionados Formateo y Agrupaci\u00f3n ( generateHTML() ) Ejecuta la consulta con todos los filtros aplicados Enriquece los datos con claves de agrupaci\u00f3n formateadas Ordena jer\u00e1rquicamente por los niveles de agrupaci\u00f3n Delega el formateo de valores al modelo (moneda, fechas, relaciones) Generaci\u00f3n de Reporte HTML Utiliza RSimpleLevelReport para generar HTML estructurado Incluye totales y subtotales autom\u00e1ticos Muestra descripci\u00f3n de filtros aplicados","title":"Clase RDatasetReportGenerator"},{"location":"avanzado/reportes_automaticos/#flujo-de-ejecucion","text":"graph TD A[Usuario hace clic en bot\u00f3n Reporte] --> B[genericAdvancedReport m\u00e9todo] B --> C{\u00bfEs POST?} C -->|No| D[Mostrar formulario de configuraci\u00f3n] C -->|S\u00ed| E[Procesar filtros y agrupaciones] E --> F[Ejecutar consulta SQL con filtros] F --> G[Formatear datos y agrupar] G --> H[Generar HTML con totales] H --> I[Mostrar reporte al usuario] D --> J[Usuario configura filtros/grupos] J --> K[Usuario env\u00eda formulario] K --> C","title":"Flujo de Ejecuci\u00f3n"},{"location":"avanzado/reportes_automaticos/#uso-practico-ejemplo-completo","text":"","title":"Uso Pr\u00e1ctico: Ejemplo Completo"},{"location":"avanzado/reportes_automaticos/#dataset-de-ordenes","text":"namespace App\\Controllers\\Tienda; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Ordenes extends RDatasetController { public function __construct() { parent::__construct(); $this->checkLogin(); $this->setTitle('\u00d3rdenes de Compra'); $this->setTableName('orders'); $this->setIdField('orderNumber'); // Campo de fecha \u2192 generar\u00e1 filtro de rango + agrupaci\u00f3n por mes/a\u00f1o $this->addField('orderDate', [ 'label' => 'Fecha de Orden', 'type' => 'date', 'rules' => 'required' ]); // Campo relacionado \u2192 generar\u00e1 filtro de b\u00fasqueda + agrupaci\u00f3n por cliente $this->addSearch('customerNumber', 'Tienda\\\\Clientes'); // Campo enum \u2192 generar\u00e1 filtro de selecci\u00f3n + agrupaci\u00f3n por estado $this->addField('status', [ 'label' => 'Estado', 'type' => 'dropdown', 'options' => [ 'Shipped' => 'Enviado', 'Pending' => 'Pendiente', 'Cancelled' => 'Cancelado' ], 'rules' => 'required' ]); // Campo calculado (monto total) $this->addField('Total', [ 'label' => 'Total', 'query' => '(SELECT SUM(quantityOrdered * priceEach) FROM orderdetails WHERE orderdetails.orderNumber = orders.orderNumber)', 'rules' => 'readonly|money' ]); $this->setTableFields([ 'orderNumber', 'orderDate', 'customerNumber', 'status', 'Total' ]); } }","title":"Dataset de \u00d3rdenes"},{"location":"avanzado/reportes_automaticos/#reportes-generados-automaticamente","text":"Con esta configuraci\u00f3n, el usuario puede generar reportes como: Ejemplo 1: Ventas por Cliente en un Rango de Fechas Filtro: Fecha desde 2024-01-01 hasta 2024-12-31 Agrupaci\u00f3n: Por Cliente Resultado: Lista de clientes con el total vendido a cada uno en 2024 Ejemplo 2: \u00d3rdenes Canceladas por Mes Filtro: Estado = \"Cancelado\" Agrupaci\u00f3n Nivel 1: Por Mes Resultado: Total de \u00f3rdenes canceladas agrupadas por mes con subtotales Ejemplo 3: An\u00e1lisis Jer\u00e1rquico Anual Agrupaci\u00f3n Nivel 1: Por A\u00f1o Agrupaci\u00f3n Nivel 2: Por Mes Agrupaci\u00f3n Nivel 3: Por Estado Resultado: Reporte jer\u00e1rquico: A\u00f1o \u2192 Mes \u2192 Estado con todos sus subtotales","title":"Reportes Generados Autom\u00e1ticamente"},{"location":"avanzado/reportes_automaticos/#ventajas-del-sistema","text":"","title":"Ventajas del Sistema"},{"location":"avanzado/reportes_automaticos/#1-cero-configuracion-adicional","text":"No necesitas escribir controladores especiales, vistas o queries para reportes. Todo se genera autom\u00e1ticamente desde la definici\u00f3n del dataset.","title":"1. Cero Configuraci\u00f3n Adicional"},{"location":"avanzado/reportes_automaticos/#2-reutilizacion-de-logica","text":"Los filtros y agrupaciones reutilizan: Las validaciones definidas en addField() Las relaciones definidas con addSearch() El formateo definido en el modelo","title":"2. Reutilizaci\u00f3n de L\u00f3gica"},{"location":"avanzado/reportes_automaticos/#3-consistencia-de-interfaz","text":"Todos los datasets tienen exactamente la misma interfaz de reportes, reduciendo la curva de aprendizaje para los usuarios.","title":"3. Consistencia de Interfaz"},{"location":"avanzado/reportes_automaticos/#4-flexibilidad-total","text":"Los usuarios finales pueden combinar cualquier filtro con cualquier agrupaci\u00f3n, generando reportes ad-hoc seg\u00fan sus necesidades sin requerir desarrollo.","title":"4. Flexibilidad Total"},{"location":"avanzado/reportes_automaticos/#5-escalabilidad","text":"A medida que agregas m\u00e1s campos a tu dataset, autom\u00e1ticamente se ampl\u00edan las opciones de filtros y agrupaciones disponibles.","title":"5. Escalabilidad"},{"location":"avanzado/reportes_automaticos/#limitaciones-y-consideraciones","text":"","title":"Limitaciones y Consideraciones"},{"location":"avanzado/reportes_automaticos/#campos-excluidos-automaticamente","text":"El sistema ignora autom\u00e1ticamente ciertos tipos de campos para filtros y agrupaciones: Claves primarias : No suelen ser \u00fatiles para filtros generales Campos con is_unique : Pensados para identificadores \u00fanicos Archivos e im\u00e1genes ( fileupload , imageupload ) Contrase\u00f1as ( password )","title":"Campos Excluidos Autom\u00e1ticamente"},{"location":"avanzado/reportes_automaticos/#campos-calculados-y-agrupaciones","text":"Los campos con query (calculados) pueden aparecer en el reporte, pero no se pueden usar como criterio de agrupaci\u00f3n ya que son expresiones SQL derivadas.","title":"Campos Calculados y Agrupaciones"},{"location":"avanzado/reportes_automaticos/#performance-en-grandes-volumenes","text":"Para datasets con millones de registros, considera: A\u00f1adir \u00edndices en campos frecuentemente filtrados Limitar las opciones de agrupaci\u00f3n si son muy costosas Implementar paginaci\u00f3n o l\u00edmites en la consulta si es necesario","title":"Performance en Grandes Vol\u00famenes"},{"location":"avanzado/reportes_automaticos/#personalizacion-avanzada","text":"Aunque el generador es autom\u00e1tico, puedes influir en su comportamiento:","title":"Personalizaci\u00f3n Avanzada"},{"location":"avanzado/reportes_automaticos/#controlar-que-campos-son-filtrables","text":"Al definir campos como hidden o con reglas espec\u00edficas, puedes controlar su aparici\u00f3n en filtros: // Este campo NO aparecer\u00e1 en filtros (es hidden y calculado) $this->addField('internalCode', [ 'label' => 'C\u00f3digo Interno', 'type' => 'hidden', 'query' => 'MD5(customerNumber)' ]);","title":"Controlar qu\u00e9 Campos son Filtrables"},{"location":"avanzado/reportes_automaticos/#metodos-programaticos","text":"Tambi\u00e9n puedes usar el generador program\u00e1ticamente desde c\u00f3digo: public function reportePersonalizado() { $generator = new RDatasetReportGenerator($this); // Agregar filtros manualmente $generator->addDateRangeFilter('orderDate', '2024-01-01', '2024-12-31'); $generator->addFilter('status', 'Shipped'); // Configurar agrupaci\u00f3n $generator->setGrouping('customerNumber', 'raw', 'Cliente'); $generator->setGrouping('orderDate', 'date_month', 'Mes'); // Generar HTML $html = $generator->generateHTML(); return view('mi_plantilla_reporte', ['contenido' => $html]); }","title":"M\u00e9todos Program\u00e1ticos"},{"location":"avanzado/reportes_automaticos/#integracion-con-el-ecosistema-ragnos","text":"","title":"Integraci\u00f3n con el Ecosistema Ragnos"},{"location":"avanzado/reportes_automaticos/#relacion-con-addsearch","text":"Como se mencion\u00f3 en la gu\u00eda de Datasets , los campos definidos con addSearch() no solo crean selectores en formularios, sino que tambi\u00e9n: En Filtros de Reportes: Permiten b\u00fasqueda contextual avanzada En Agrupaciones: Se convierten autom\u00e1ticamente en criterios de agrupaci\u00f3n Esta sinergia hace que definir relaciones sea doblemente poderoso.","title":"Relaci\u00f3n con addSearch()"},{"location":"avanzado/reportes_automaticos/#relacion-con-settablefields","text":"Los campos incluidos en setTableFields() son los que aparecer\u00e1n en el reporte generado. Esto te da control sobre qu\u00e9 columnas se muestran sin afectar la disponibilidad de filtros y agrupaciones.","title":"Relaci\u00f3n con setTableFields()"},{"location":"avanzado/reportes_automaticos/#conclusion","text":"El Generador Autom\u00e1tico de Reportes es una de las caracter\u00edsticas m\u00e1s potentes de Ragnos, transformando cada dataset simple en una herramienta de an\u00e1lisis avanzado sin esfuerzo adicional de desarrollo. Al aprovechar toda la metadata declarativa que defines en tu dataset ( addField , addSearch , setTableFields ), el sistema construye autom\u00e1ticamente una interfaz completa de reporter\u00eda con: \u2705 Filtros inteligentes seg\u00fan tipo de campo \u2705 Agrupaciones jer\u00e1rquicas multinivel \u2705 B\u00fasqueda contextual en relaciones \u2705 Totales y subtotales autom\u00e1ticos \u2705 Interfaz consistente en todos los m\u00f3dulos Resultado: Reportes empresariales de calidad profesional, disponibles en minutos, no en semanas.","title":"Conclusi\u00f3n"},{"location":"avanzado/server_side_events/","text":"\u23f3 Procesos de Larga Duraci\u00f3n con Server-Side Events (SSE) El framework Ragnos incluye una implementaci\u00f3n para manejar procesos de larga duraci\u00f3n en el servidor, permitiendo enviar actualizaciones de progreso en tiempo real al navegador del usuario utilizando Server-Side Events (SSE) . Esta funcionalidad es ideal para tareas que exceden el tiempo de espera habitual de una petici\u00f3n HTTP o donde el usuario necesita retroalimentaci\u00f3n visual del avance (barras de progreso). L\u00edmites de tiempo en PHP Aunque SSE permite mantener la conexi\u00f3n abierta, tu servidor web o configuraci\u00f3n de PHP ( max_execution_time ) podr\u00eda matar el proceso si dura demasiado. Aseg\u00farate de configurar set_time_limit(0) en tu l\u00f3gica si esperas procesos muy largos. Arquitectura El sistema se basa en dos componentes principales: App\\ThirdParty\\Ragnos\\Controllers\\RProcessController : Una clase base para los controladores que ejecutar\u00e1n procesos. process_helper.php : Un helper que contiene las funciones para gestionar el flujo de eventos SSE (cabeceras, env\u00edo de datos, control de bufer, etc.). Flujo de Trabajo El usuario accede a una acci\u00f3n del controlador que renderiza la vista de progreso (m\u00e9todo showProgress ). La vista conecta mediante JavaScript ( EventSource ) al m\u00e9todo start del mismo controlador. El m\u00e9todo start ejecuta la l\u00f3gica pesada, enviando eventos de progreso peri\u00f3dicamente mediante las funciones del helper. Al finalizar, el servidor env\u00eda un evento de finalizaci\u00f3n y cierra la conexi\u00f3n. Clase RProcessController Para crear un nuevo proceso, debes crear un controlador que extienda de RProcessController . Ubicaci\u00f3n : App\\Controllers\\ o cualquier subcarpeta, siempre que el namespace sea correcto. M\u00e9todos Principales __construct() : Carga autom\u00e1ticamente el process_helper . showProgress() : Muestra la interfaz de usuario con la barra de progreso. Calcula autom\u00e1ticamente la URL del endpoint start bas\u00e1ndose en el nombre de la clase. start() : Debe ser sobreescrito . Aqu\u00ed reside la l\u00f3gica de tu proceso larga duraci\u00f3n. Funciones del Helper (process_helper) Estas funciones est\u00e1n disponibles autom\u00e1ticamente dentro de tu controlador extendido. processStart($title = 'Processing...') Inicializa el proceso SSE. Limpia buffers de salida y establece las cabeceras text/event-stream . Deshabilita l\u00edmites de tiempo ( set_time_limit(0) ) y memoria en PHP para evitar timeouts. Env\u00eda el t\u00edtulo del proceso al cliente. setProgress($percentage) Actualiza la barra de progreso al porcentaje indicado. $percentage : N\u00famero entero (0-100). setProgressText($text) Actualiza el texto descriptivo debajo de la barra de progreso. \u00datil para informar al usuario qu\u00e9 se est\u00e1 haciendo exactamente (ej: \"Procesando fila 45...\"). setProgressOf($currentStep, $total) Una funci\u00f3n de utilidad que calcula el porcentaje autom\u00e1ticamente y llama a setProgress . $currentStep : El paso actual (iterador). $total : El total de pasos a realizar. endProcess($additionalData = null) Finaliza el proceso. Calcula el tiempo total de ejecuci\u00f3n. Env\u00eda el evento de finalizaci\u00f3n al cliente con datos opcionales. Termina la ejecuci\u00f3n del script ( exit ). Aplicaciones Comunes Esta funcionalidad es \u00fatil para: Importaciones Masivas : Carga de archivos Excel/CSV con miles de registros a la base de datos. Generaci\u00f3n de Reportes : Creaci\u00f3n de PDFs complejos o excels grandes. Mantenimiento : Tareas de limpieza, rec\u00e1lculo de precios, regeneraci\u00f3n de cach\u00e9 o im\u00e1genes. Env\u00edo de Correos Masivos : Env\u00edo de newsletters donde se requiere feedback de cada bloque enviado. Ejemplos de Implementaci\u00f3n Ejemplo 1: Rec\u00e1lculo de Precios (B\u00e1sico) Este ejemplo simula un proceso que itera sobre 100 elementos. <?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class RecalculoPrecios extends RProcessController { // M\u00e9todo principal que ejecuta la l\u00f3gica public function start () { // 1. Iniciar el proceso processStart ( 'Recalculando precios del cat\u00e1logo' ); $totalProductos = 100 ; for ( $i = 1 ; $i <= $totalProductos ; $i ++ ) { // Simulamos trabajo pesado usleep ( 100000 ); // 0.1 segundos // 2. Actualizar progreso (calcula % autom\u00e1ticamente) setProgressOf ( $i , $totalProductos ); // 3. Actualizar texto informativo setProgressText ( \"Actualizando producto ID: # { $i } \" ); } // 4. Finalizar endProcess ([ 'mensaje' => 'Se han actualizado los precios correctamente' , 'total' => $totalProductos ]); } } Ejemplo 2: Importaci\u00f3n de Usuarios (Con validaci\u00f3n) Un ejemplo m\u00e1s complejo simulando una importaci\u00f3n donde se valida informaci\u00f3n. <?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class ImportarUsuarios extends RProcessController { public function start () { processStart ( 'Importando Base de Datos de Usuarios' ); // Simular obtenci\u00f3n de datos (ej. leer un CSV) $usuarios = $this -> obtenerDatosSimulados ( 500 ); $total = count ( $usuarios ); $importados = 0 ; $errores = 0 ; foreach ( $usuarios as $index => $usuario ) { $paso = $index + 1 ; // L\u00f3gica de negocio simulada if ( $this -> guardarUsuario ( $usuario )) { $importados ++ ; setProgressText ( \"Usuario { $usuario [ 'nombre' ] } importado.\" ); } else { $errores ++ ; setProgressText ( \"Error importando { $usuario [ 'nombre' ] } .\" ); } // Actualizar barra de progreso cada 5 registros para no saturar la red // en procesos muy r\u00e1pidos if ( $paso % 5 === 0 || $paso === $total ) { setProgressOf ( $paso , $total ); } // Simular tiempo de base de datos usleep ( 20000 ); } endProcess ([ 'resultado' => \"Importaci\u00f3n finalizada. \u00c9xito: { $importados } , Errores: { $errores } \" ]); } private function obtenerDatosSimulados ( $qty ) { /* ... */ return array_fill ( 0 , $qty , [ 'nombre' => 'User' ]); } private function guardarUsuario ( $user ) { return rand ( 0 , 10 ) > 1 ; } } Ejemplo 3: Generaci\u00f3n de Copia de Seguridad <?php namespace App\\Controllers\\Admin ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class BackupSystem extends RProcessController { public function start () { processStart ( 'Generando Backup del Sistema' ); $steps = [ 'Comprimiendo im\u00e1genes...' , 'Exportando base de datos...' , 'Generando archivos de log...' , 'Empaquetando ZIP final...' ]; $totalSteps = count ( $steps ); foreach ( $steps as $index => $stepName ) { setProgressText ( $stepName ); // Simular tarea larga sleep ( 2 ); setProgressOf ( $index + 1 , $totalSteps ); } endProcess ([ 'file' => 'backup_2023.zip' ]); } }","title":"Server Side Events"},{"location":"avanzado/server_side_events/#procesos-de-larga-duracion-con-server-side-events-sse","text":"El framework Ragnos incluye una implementaci\u00f3n para manejar procesos de larga duraci\u00f3n en el servidor, permitiendo enviar actualizaciones de progreso en tiempo real al navegador del usuario utilizando Server-Side Events (SSE) . Esta funcionalidad es ideal para tareas que exceden el tiempo de espera habitual de una petici\u00f3n HTTP o donde el usuario necesita retroalimentaci\u00f3n visual del avance (barras de progreso). L\u00edmites de tiempo en PHP Aunque SSE permite mantener la conexi\u00f3n abierta, tu servidor web o configuraci\u00f3n de PHP ( max_execution_time ) podr\u00eda matar el proceso si dura demasiado. Aseg\u00farate de configurar set_time_limit(0) en tu l\u00f3gica si esperas procesos muy largos.","title":"\u23f3 Procesos de Larga Duraci\u00f3n con Server-Side Events (SSE)"},{"location":"avanzado/server_side_events/#arquitectura","text":"El sistema se basa en dos componentes principales: App\\ThirdParty\\Ragnos\\Controllers\\RProcessController : Una clase base para los controladores que ejecutar\u00e1n procesos. process_helper.php : Un helper que contiene las funciones para gestionar el flujo de eventos SSE (cabeceras, env\u00edo de datos, control de bufer, etc.).","title":"Arquitectura"},{"location":"avanzado/server_side_events/#flujo-de-trabajo","text":"El usuario accede a una acci\u00f3n del controlador que renderiza la vista de progreso (m\u00e9todo showProgress ). La vista conecta mediante JavaScript ( EventSource ) al m\u00e9todo start del mismo controlador. El m\u00e9todo start ejecuta la l\u00f3gica pesada, enviando eventos de progreso peri\u00f3dicamente mediante las funciones del helper. Al finalizar, el servidor env\u00eda un evento de finalizaci\u00f3n y cierra la conexi\u00f3n.","title":"Flujo de Trabajo"},{"location":"avanzado/server_side_events/#clase-rprocesscontroller","text":"Para crear un nuevo proceso, debes crear un controlador que extienda de RProcessController . Ubicaci\u00f3n : App\\Controllers\\ o cualquier subcarpeta, siempre que el namespace sea correcto.","title":"Clase RProcessController"},{"location":"avanzado/server_side_events/#metodos-principales","text":"__construct() : Carga autom\u00e1ticamente el process_helper . showProgress() : Muestra la interfaz de usuario con la barra de progreso. Calcula autom\u00e1ticamente la URL del endpoint start bas\u00e1ndose en el nombre de la clase. start() : Debe ser sobreescrito . Aqu\u00ed reside la l\u00f3gica de tu proceso larga duraci\u00f3n.","title":"M\u00e9todos Principales"},{"location":"avanzado/server_side_events/#funciones-del-helper-process_helper","text":"Estas funciones est\u00e1n disponibles autom\u00e1ticamente dentro de tu controlador extendido.","title":"Funciones del Helper (process_helper)"},{"location":"avanzado/server_side_events/#processstarttitle-processing","text":"Inicializa el proceso SSE. Limpia buffers de salida y establece las cabeceras text/event-stream . Deshabilita l\u00edmites de tiempo ( set_time_limit(0) ) y memoria en PHP para evitar timeouts. Env\u00eda el t\u00edtulo del proceso al cliente.","title":"processStart($title = 'Processing...')"},{"location":"avanzado/server_side_events/#setprogresspercentage","text":"Actualiza la barra de progreso al porcentaje indicado. $percentage : N\u00famero entero (0-100).","title":"setProgress($percentage)"},{"location":"avanzado/server_side_events/#setprogresstexttext","text":"Actualiza el texto descriptivo debajo de la barra de progreso. \u00datil para informar al usuario qu\u00e9 se est\u00e1 haciendo exactamente (ej: \"Procesando fila 45...\").","title":"setProgressText($text)"},{"location":"avanzado/server_side_events/#setprogressofcurrentstep-total","text":"Una funci\u00f3n de utilidad que calcula el porcentaje autom\u00e1ticamente y llama a setProgress . $currentStep : El paso actual (iterador). $total : El total de pasos a realizar.","title":"setProgressOf($currentStep, $total)"},{"location":"avanzado/server_side_events/#endprocessadditionaldata-null","text":"Finaliza el proceso. Calcula el tiempo total de ejecuci\u00f3n. Env\u00eda el evento de finalizaci\u00f3n al cliente con datos opcionales. Termina la ejecuci\u00f3n del script ( exit ).","title":"endProcess($additionalData = null)"},{"location":"avanzado/server_side_events/#aplicaciones-comunes","text":"Esta funcionalidad es \u00fatil para: Importaciones Masivas : Carga de archivos Excel/CSV con miles de registros a la base de datos. Generaci\u00f3n de Reportes : Creaci\u00f3n de PDFs complejos o excels grandes. Mantenimiento : Tareas de limpieza, rec\u00e1lculo de precios, regeneraci\u00f3n de cach\u00e9 o im\u00e1genes. Env\u00edo de Correos Masivos : Env\u00edo de newsletters donde se requiere feedback de cada bloque enviado.","title":"Aplicaciones Comunes"},{"location":"avanzado/server_side_events/#ejemplos-de-implementacion","text":"","title":"Ejemplos de Implementaci\u00f3n"},{"location":"avanzado/server_side_events/#ejemplo-1-recalculo-de-precios-basico","text":"Este ejemplo simula un proceso que itera sobre 100 elementos. <?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class RecalculoPrecios extends RProcessController { // M\u00e9todo principal que ejecuta la l\u00f3gica public function start () { // 1. Iniciar el proceso processStart ( 'Recalculando precios del cat\u00e1logo' ); $totalProductos = 100 ; for ( $i = 1 ; $i <= $totalProductos ; $i ++ ) { // Simulamos trabajo pesado usleep ( 100000 ); // 0.1 segundos // 2. Actualizar progreso (calcula % autom\u00e1ticamente) setProgressOf ( $i , $totalProductos ); // 3. Actualizar texto informativo setProgressText ( \"Actualizando producto ID: # { $i } \" ); } // 4. Finalizar endProcess ([ 'mensaje' => 'Se han actualizado los precios correctamente' , 'total' => $totalProductos ]); } }","title":"Ejemplo 1: Rec\u00e1lculo de Precios (B\u00e1sico)"},{"location":"avanzado/server_side_events/#ejemplo-2-importacion-de-usuarios-con-validacion","text":"Un ejemplo m\u00e1s complejo simulando una importaci\u00f3n donde se valida informaci\u00f3n. <?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class ImportarUsuarios extends RProcessController { public function start () { processStart ( 'Importando Base de Datos de Usuarios' ); // Simular obtenci\u00f3n de datos (ej. leer un CSV) $usuarios = $this -> obtenerDatosSimulados ( 500 ); $total = count ( $usuarios ); $importados = 0 ; $errores = 0 ; foreach ( $usuarios as $index => $usuario ) { $paso = $index + 1 ; // L\u00f3gica de negocio simulada if ( $this -> guardarUsuario ( $usuario )) { $importados ++ ; setProgressText ( \"Usuario { $usuario [ 'nombre' ] } importado.\" ); } else { $errores ++ ; setProgressText ( \"Error importando { $usuario [ 'nombre' ] } .\" ); } // Actualizar barra de progreso cada 5 registros para no saturar la red // en procesos muy r\u00e1pidos if ( $paso % 5 === 0 || $paso === $total ) { setProgressOf ( $paso , $total ); } // Simular tiempo de base de datos usleep ( 20000 ); } endProcess ([ 'resultado' => \"Importaci\u00f3n finalizada. \u00c9xito: { $importados } , Errores: { $errores } \" ]); } private function obtenerDatosSimulados ( $qty ) { /* ... */ return array_fill ( 0 , $qty , [ 'nombre' => 'User' ]); } private function guardarUsuario ( $user ) { return rand ( 0 , 10 ) > 1 ; } }","title":"Ejemplo 2: Importaci\u00f3n de Usuarios (Con validaci\u00f3n)"},{"location":"avanzado/server_side_events/#ejemplo-3-generacion-de-copia-de-seguridad","text":"<?php namespace App\\Controllers\\Admin ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class BackupSystem extends RProcessController { public function start () { processStart ( 'Generando Backup del Sistema' ); $steps = [ 'Comprimiendo im\u00e1genes...' , 'Exportando base de datos...' , 'Generando archivos de log...' , 'Empaquetando ZIP final...' ]; $totalSteps = count ( $steps ); foreach ( $steps as $index => $stepName ) { setProgressText ( $stepName ); // Simular tarea larga sleep ( 2 ); setProgressOf ( $index + 1 , $totalSteps ); } endProcess ([ 'file' => 'backup_2023.zip' ]); } }","title":"Ejemplo 3: Generaci\u00f3n de Copia de Seguridad"},{"location":"datasets/campos/","text":"Tipos de campo soportados en Ragnos En Ragnos, los campos de un dataset se definen mediante el m\u00e9todo addField() . Este m\u00e9todo es parte fundamental de la configuraci\u00f3n de un RDatasetController . Cada campo es una descripci\u00f3n declarativa de c\u00f3mo un atributo del dominio: Se valida Se muestra en formularios Se muestra en grillas Se persiste (o no) en base de datos Ragnos utiliza esta metadata para generar autom\u00e1ticamente formularios, validaciones, listados y comportamiento CRUD. 1. Estructura general de addField() $this->addField('nombreCampo', [ 'label' => 'Etiqueta visible', 'rules' => 'reglas|de|validacion', 'type' => 'tipo', 'query' => 'expresion SQL' ]); Par\u00e1metros comunes Par\u00e1metro Descripci\u00f3n label Texto visible en formularios y grillas rules Reglas de validaci\u00f3n (CI4 + Ragnos) type Tipo de campo (opcional) query Expresi\u00f3n SQL para campos calculados tab Nombre de la pesta\u00f1a (opcional) Reglas de Validaci\u00f3n Ragnos adopta el potente motor de validaci\u00f3n de CodeIgniter 4. Puedes usar reglas como required , is_unique , min_length , valid_email , etc. Consulta todas las reglas disponibles en la documentaci\u00f3n oficial de CodeIgniter 4 Validaci\u00f3n is_unique Simplificada A diferencia de CodeIgniter 4, donde is_unique suele requerir par\u00e1metros como is_unique[tabla.campo] , en Ragnos se ha simplificado su uso: solo necesitas indicar la palabra clave is_unique . El framework detecta autom\u00e1ticamente sobre qu\u00e9 tabla y campo se est\u00e1 operando (usando lo definido en setTableName y el nombre del campo en addField ) para construir la consulta de verificaci\u00f3n. Adem\u00e1s, maneja correctamente las excepciones al editar un registro (autodetectando la clave primaria definida con setIdField para ignorar el registro actual). Casos de uso comunes: Es ideal para campos que deben ser \u00fanicos en todo el sistema, como: Direcciones de correo electr\u00f3nico en un registro de usuarios. Nombres de usuario o alias. C\u00f3digos de producto (SKU) o c\u00f3digos de barras. DNI o documentos de identidad. Organizaci\u00f3n en Pesta\u00f1as Ragnos permite organizar los campos del formulario en pesta\u00f1as para mejorar la usabilidad en formularios extensos. Simplemente agrega la clave tab al array de configuracion del campo con el nombre de la pesta\u00f1a deseada. $this->addField('informacion_basica', [ ... , 'tab' => 'General' ]); $this->addField('detalles_tecnicos', [ ... , 'tab' => 'Detalles' ]); $this->addField('precios', [ ... , 'tab' => 'Finanzas' ]); Los campos que no tengan definida una pesta\u00f1a ir\u00e1n autom\u00e1ticamente a una pesta\u00f1a etiquetada como \"General\" . Si ning\u00fan campo tiene definida una pesta\u00f1a, el formulario se mostrar\u00e1 sin pesta\u00f1as (comportamiento cl\u00e1sico). Si ocurre un error de validaci\u00f3n en un campo oculto por una pesta\u00f1a, Ragnos activar\u00e1 autom\u00e1ticamente esa pesta\u00f1a para mostrar el error. 2. Campo de texto (string) $this->addField('customerName', [ 'label' => 'Nombre', 'rules' => 'required' ]); Persistente Editable Texto libre 3. Campo de texto multil\u00ednea ( textarea ) Para textos largos como descripciones o comentarios. $this->addField('productDescription', [ 'label' => 'Descripci\u00f3n', 'type' => 'textarea', 'rules' => 'required' ]); Variante HTML: Si necesitas un editor b\u00e1sico, usa type => 'htmltextarea' . 4. Campo de Fecha y Hora Ragnos maneja autom\u00e1ticamente la selecci\u00f3n de fechas. $this->addField('orderDate', [ 'label' => 'Fecha de Orden', 'type' => 'datetime', // o 'date' 'rules' => 'required' ]); Incluye selector de fecha (datepicker). 5. Campo num\u00e9rico $this->addField('postalCode', [ 'label' => 'C\u00f3digo postal', 'rules' => 'required|numeric' ]); Persistente Editable Num\u00e9rico 6. Campo monetario ( money ) $this->addField('creditLimit', [ 'label' => 'L\u00edmite de cr\u00e9dito', 'rules' => 'required|money' ]); Validador custom Normalizaci\u00f3n autom\u00e1tica Uso financiero 7. Campo readonly $this->addField('Contacto', [ 'label' => 'Contacto', 'rules' => 'readonly' ]); Visible No editable 8. Campo hidden $this->addField('Contacto', [ 'label' => 'Contacto', 'rules' => 'readonly', 'type' => 'hidden' ]); No visible en formularios \u00datil para UX 9. Campo calculado ( query ) $this->addField('Contacto', [ 'label' => 'Contacto', 'rules' => 'readonly', 'query' => \"concat(contactLastName, ', ', contactFirstName)\", 'type' => 'hidden' ]); No persistente SQL din\u00e1mico Solo lectura 10. Campo relacionado ( addSearch ) $this->addSearch('salesRepEmployeeNumber', 'Tienda\\\\Empleados'); Clave for\u00e1nea l\u00f3gica Selector din\u00e1mico Sin JOIN manual Ver explicaci\u00f3n detallada sobre B\u00fasqueda Contextual y Reportes en la gu\u00eda de Datasets 11. Campo clave primaria $this->setIdField('customerNumber'); Identidad del dataset Obligatorio Por defecto, los campos Id se consideran autoincrementales. Si no es el caso, se debe incluir expl\u00edcitamente $this->setAutoIncrement(false); . 12. Campo dropdown (enum) Breve descripci\u00f3n: un dropdown (enum) presenta un conjunto cerrado de opciones (clave => etiqueta). Se almacena la clave seleccionada en la base de datos; la etiqueta se usa solo para la interfaz. Configuraci\u00f3n t\u00edpica: type: \"dropdown\" options: array asociativo [valor => etiqueta] default: clave por defecto rules: validar con reglas CI4 (ej. required, in_list) se recomienda para listas cortas y estables; para grandes vol\u00famenes usar addSearch (selector relacionado). Ejemplo est\u00e1tico: $this->addField('status', [ 'label' => 'Estado', 'type' => 'dropdown', 'options' => [ 'shipped' => 'Enviado', 'pending' => 'Pendiente', 'cancelled' => 'Cancelado' ], 'default' => 'pending', 'rules' => 'required|in_list[shipped,pending,cancelled]' ]); Ejemplo din\u00e1mico (cargar desde DB): $rows = $this->db->table('categories')->select('id, name')->get()->getResultArray(); $options = array_column($rows, 'name', 'id'); $this->addField('categoryId', [ 'label' => 'Categor\u00eda', 'type' => 'dropdown', 'options' => $options, 'rules' => 'required|in_list[' . implode(',', array_keys($options)) . ']' ]); Placeholder / opci\u00f3n vac\u00eda: agregar una entrada con clave vac\u00eda para forzar selecci\u00f3n: 'options' => ['' => '(Seleccione)'] + $options Validaci\u00f3n y seguridad: Use in_list para evitar valores no permitidos. Si las opciones son din\u00e1micas, regenere la lista en cada carga de formulario para que la in_list coincida. UX y performance: Dropdown para <~20-30 opciones. Para relaciones con muchas filas, usar addSearch o un componente tipo autocompletar. Si necesita seleccionar m\u00faltiples valores, prefiera un componente multiselect (o un campo tipo relaci\u00f3n); no use dropdown simple. Internacionalizaci\u00f3n: almacene claves estables y traduzca etiquetas en la generaci\u00f3n de options para facilitar cambios de idioma. Persistencia: el valor guardado es la clave; si necesita guardar la etiqueta, considere un campo calculado o una vista. 13. Campo Switch (Booleano) Renderiza un interruptor (toggle) moderno. Ideal para campos booleanos o de estado (activo/inactivo). $this->addField('isActive', [ 'label' => 'Publicado', 'type' => 'switch', 'default' => 1, // Valor por defecto (checkbox marcado) // Opcional: Personalizar valores (por defecto 1 y 0) 'onValue' => 'Y', 'offValue'=> 'N' ]); Interact\u00faa con valores 1/0 (o personalizados). UI moderna (Bootstrap switch). 14. Campo Pillbox (Etiquetas) Permite gestionar una lista de etiquetas (tags) simples. Se almacena en la base de datos como un array JSON. $this->addField('tags', [ 'label' => 'Etiquetas', 'type' => 'pillbox' ]); Interfaz: Input de texto que convierte entradas en \"pastillas\" al presionar Enter o Coma. Almacenamiento: JSON Array (ej. [\"Rojo\", \"Oferta\"] ). Requiere un campo tipo JSON o TEXT en BD. Uso: Categorizaci\u00f3n simple, palabras clave. 15. Carga de Archivos ( fileupload ) Permite subir archivos generales al servidor. Persistencia: Guarda la ruta relativa del archivo en la base de datos (ej: assets/uploads/documento.pdf ). Validaci\u00f3n Inteligente: Detecta autom\u00e1ticamente si se est\u00e1 insertando o editando. Al editar, si el usuario no sube un nuevo archivo, se mantiene el archivo anterior . Si el campo tiene reglas de archivo (ej: max_size , ext_in ), estas se ignoran autom\u00e1ticamente si no se sube un nuevo archivo en edici\u00f3n, evitando errores de validaci\u00f3n. Creaci\u00f3n autom\u00e1tica de carpetas: Si la ruta destino no existe, el sistema intenta crearla recursivamente. $this->addField('documento_adjunto', [ 'label' => 'Documento PDF', 'type' => 'fileupload', 'uploadPath' => 'assets/docs/contratos', // Carpeta destino (relativa a public/) 'rules' => 'uploaded[documento_adjunto]|ext_in[documento_adjunto,pdf,docx]|max_size[documento_adjunto,4096]' ]); Par\u00e1metros Espec\u00edficos Par\u00e1metro Descripci\u00f3n uploadPath Ruta relativa a la carpeta p\u00fablica donde se guardar\u00e1n los archivos. Por defecto: assets/uploads . rules Reglas de validaci\u00f3n est\u00e1ndar de CodeIgniter 4 para archivos ( uploaded , max_size , ext_in , mime_in , etc). Importante sobre uploaded Aunque Ragnos maneja la opcionalidad en edici\u00f3n, si deseas que el archivo sea obligatorio al crear , debes incluir la regla uploaded[campo] . Ragnos la remover\u00e1 autom\u00e1ticamente solo cuando sea seguro hacerlo (edici\u00f3n manteniendo archivo previo). 16. Carga de Im\u00e1genes ( imageupload ) Una especializaci\u00f3n de fileupload optimizada para im\u00e1genes. Previsualizaci\u00f3n: Muestra una vista previa inmediata de la imagen seleccionada antes de guardar. Visualizaci\u00f3n: Muestra la imagen actual almacenada si existe. Validaci\u00f3n: Id\u00e9ntica a fileupload , compatible con reglas is_image , max_dims , etc. $this->addField('foto_perfil', [ 'label' => 'Avatar', 'type' => 'imageupload', 'uploadPath' => 'assets/img/usuarios', 'rules' => 'is_image[foto_perfil]|max_size[foto_perfil,2048]', 'accept' => 'image/*' // Atributo HTML para el input file ]); Hacer la imagen opcional Si quieres que la imagen sea opcional incluso al crear el registro, simplemente omite la regla uploaded . 'rules' => 'is_image[foto_perfil]' // Opcional, pero si subes algo, debe ser imagen 17. Reglas de Validaci\u00f3n Personalizadas Ragnos hereda la capacidad de CodeIgniter 4 para definir reglas de validaci\u00f3n personalizadas. Si necesitas una validaci\u00f3n que no existe por defecto (por ejemplo, validar un formato espec\u00edfico de ID o verificar contra un servicio externo), sigue estos pasos: 1. Crear la clase de reglas Crea un archivo en el directorio app/Validation/MyCustomRules.php (deber\u00e1s crear la carpeta si no existe): namespace App\\Validation; class MyCustomRules { public function even_number(string $str, string &$error = null): bool { if ((int)$str % 2 !== 0) { $error = \"El campo {field} debe ser un n\u00famero par.\"; return false; } return true; } } 2. Registrar la regla Edita app/Config/Validation.php para incluir tu nueva clase en el array $ruleSets : public array $ruleSets = [ // ... otras reglas existentes \\App\\Validation\\MyCustomRules::class, ]; 3. Usar la regla en el Dataset Ahora puedes usar tu regla personalizada en el m\u00e9todo addField() de tu controlador: $this->addField('cantidad', [ 'label' => 'Cantidad Par', 'rules' => 'required|even_number' ]); En Ragnos, los campos son declaraciones del dominio, no simples inputs. 18. Resumen Tipo Persistente Editable Texto S\u00ed S\u00ed Texto Multil\u00ednea S\u00ed S\u00ed Fecha / Hora S\u00ed S\u00ed Num\u00e9rico S\u00ed S\u00ed Money S\u00ed S\u00ed Switch (Booleano) S\u00ed S\u00ed Pillbox (Tags) S\u00ed (JSON) S\u00ed Archivo S\u00ed (Ruta) S\u00ed Imagen S\u00ed (Ruta) S\u00ed Readonly Depende No Hidden Depende No Calculado No No Relaci\u00f3n S\u00ed S\u00ed Dropdown S\u00ed S\u00ed Clave PK S\u00ed S\u00ed","title":"Referencia de Campos"},{"location":"datasets/campos/#tipos-de-campo-soportados-en-ragnos","text":"En Ragnos, los campos de un dataset se definen mediante el m\u00e9todo addField() . Este m\u00e9todo es parte fundamental de la configuraci\u00f3n de un RDatasetController . Cada campo es una descripci\u00f3n declarativa de c\u00f3mo un atributo del dominio: Se valida Se muestra en formularios Se muestra en grillas Se persiste (o no) en base de datos Ragnos utiliza esta metadata para generar autom\u00e1ticamente formularios, validaciones, listados y comportamiento CRUD.","title":"Tipos de campo soportados en Ragnos"},{"location":"datasets/campos/#1-estructura-general-de-addfield","text":"$this->addField('nombreCampo', [ 'label' => 'Etiqueta visible', 'rules' => 'reglas|de|validacion', 'type' => 'tipo', 'query' => 'expresion SQL' ]);","title":"1. Estructura general de addField()"},{"location":"datasets/campos/#parametros-comunes","text":"Par\u00e1metro Descripci\u00f3n label Texto visible en formularios y grillas rules Reglas de validaci\u00f3n (CI4 + Ragnos) type Tipo de campo (opcional) query Expresi\u00f3n SQL para campos calculados tab Nombre de la pesta\u00f1a (opcional) Reglas de Validaci\u00f3n Ragnos adopta el potente motor de validaci\u00f3n de CodeIgniter 4. Puedes usar reglas como required , is_unique , min_length , valid_email , etc. Consulta todas las reglas disponibles en la documentaci\u00f3n oficial de CodeIgniter 4 Validaci\u00f3n is_unique Simplificada A diferencia de CodeIgniter 4, donde is_unique suele requerir par\u00e1metros como is_unique[tabla.campo] , en Ragnos se ha simplificado su uso: solo necesitas indicar la palabra clave is_unique . El framework detecta autom\u00e1ticamente sobre qu\u00e9 tabla y campo se est\u00e1 operando (usando lo definido en setTableName y el nombre del campo en addField ) para construir la consulta de verificaci\u00f3n. Adem\u00e1s, maneja correctamente las excepciones al editar un registro (autodetectando la clave primaria definida con setIdField para ignorar el registro actual). Casos de uso comunes: Es ideal para campos que deben ser \u00fanicos en todo el sistema, como: Direcciones de correo electr\u00f3nico en un registro de usuarios. Nombres de usuario o alias. C\u00f3digos de producto (SKU) o c\u00f3digos de barras. DNI o documentos de identidad.","title":"Par\u00e1metros comunes"},{"location":"datasets/campos/#organizacion-en-pestanas","text":"Ragnos permite organizar los campos del formulario en pesta\u00f1as para mejorar la usabilidad en formularios extensos. Simplemente agrega la clave tab al array de configuracion del campo con el nombre de la pesta\u00f1a deseada. $this->addField('informacion_basica', [ ... , 'tab' => 'General' ]); $this->addField('detalles_tecnicos', [ ... , 'tab' => 'Detalles' ]); $this->addField('precios', [ ... , 'tab' => 'Finanzas' ]); Los campos que no tengan definida una pesta\u00f1a ir\u00e1n autom\u00e1ticamente a una pesta\u00f1a etiquetada como \"General\" . Si ning\u00fan campo tiene definida una pesta\u00f1a, el formulario se mostrar\u00e1 sin pesta\u00f1as (comportamiento cl\u00e1sico). Si ocurre un error de validaci\u00f3n en un campo oculto por una pesta\u00f1a, Ragnos activar\u00e1 autom\u00e1ticamente esa pesta\u00f1a para mostrar el error.","title":"Organizaci\u00f3n en Pesta\u00f1as"},{"location":"datasets/campos/#2-campo-de-texto-string","text":"$this->addField('customerName', [ 'label' => 'Nombre', 'rules' => 'required' ]); Persistente Editable Texto libre","title":"2. Campo de texto (string)"},{"location":"datasets/campos/#3-campo-de-texto-multilinea-textarea","text":"Para textos largos como descripciones o comentarios. $this->addField('productDescription', [ 'label' => 'Descripci\u00f3n', 'type' => 'textarea', 'rules' => 'required' ]); Variante HTML: Si necesitas un editor b\u00e1sico, usa type => 'htmltextarea' .","title":"3. Campo de texto multil\u00ednea (textarea)"},{"location":"datasets/campos/#4-campo-de-fecha-y-hora","text":"Ragnos maneja autom\u00e1ticamente la selecci\u00f3n de fechas. $this->addField('orderDate', [ 'label' => 'Fecha de Orden', 'type' => 'datetime', // o 'date' 'rules' => 'required' ]); Incluye selector de fecha (datepicker).","title":"4. Campo de Fecha y Hora"},{"location":"datasets/campos/#5-campo-numerico","text":"$this->addField('postalCode', [ 'label' => 'C\u00f3digo postal', 'rules' => 'required|numeric' ]); Persistente Editable Num\u00e9rico","title":"5. Campo num\u00e9rico"},{"location":"datasets/campos/#6-campo-monetario-money","text":"$this->addField('creditLimit', [ 'label' => 'L\u00edmite de cr\u00e9dito', 'rules' => 'required|money' ]); Validador custom Normalizaci\u00f3n autom\u00e1tica Uso financiero","title":"6. Campo monetario (money)"},{"location":"datasets/campos/#7-campo-readonly","text":"$this->addField('Contacto', [ 'label' => 'Contacto', 'rules' => 'readonly' ]); Visible No editable","title":"7. Campo readonly"},{"location":"datasets/campos/#8-campo-hidden","text":"$this->addField('Contacto', [ 'label' => 'Contacto', 'rules' => 'readonly', 'type' => 'hidden' ]); No visible en formularios \u00datil para UX","title":"8. Campo hidden"},{"location":"datasets/campos/#9-campo-calculado-query","text":"$this->addField('Contacto', [ 'label' => 'Contacto', 'rules' => 'readonly', 'query' => \"concat(contactLastName, ', ', contactFirstName)\", 'type' => 'hidden' ]); No persistente SQL din\u00e1mico Solo lectura","title":"9. Campo calculado (query)"},{"location":"datasets/campos/#10-campo-relacionado-addsearch","text":"$this->addSearch('salesRepEmployeeNumber', 'Tienda\\\\Empleados'); Clave for\u00e1nea l\u00f3gica Selector din\u00e1mico Sin JOIN manual Ver explicaci\u00f3n detallada sobre B\u00fasqueda Contextual y Reportes en la gu\u00eda de Datasets","title":"10. Campo relacionado (addSearch)"},{"location":"datasets/campos/#11-campo-clave-primaria","text":"$this->setIdField('customerNumber'); Identidad del dataset Obligatorio Por defecto, los campos Id se consideran autoincrementales. Si no es el caso, se debe incluir expl\u00edcitamente $this->setAutoIncrement(false); .","title":"11. Campo clave primaria"},{"location":"datasets/campos/#12-campo-dropdown-enum","text":"Breve descripci\u00f3n: un dropdown (enum) presenta un conjunto cerrado de opciones (clave => etiqueta). Se almacena la clave seleccionada en la base de datos; la etiqueta se usa solo para la interfaz. Configuraci\u00f3n t\u00edpica: type: \"dropdown\" options: array asociativo [valor => etiqueta] default: clave por defecto rules: validar con reglas CI4 (ej. required, in_list) se recomienda para listas cortas y estables; para grandes vol\u00famenes usar addSearch (selector relacionado). Ejemplo est\u00e1tico: $this->addField('status', [ 'label' => 'Estado', 'type' => 'dropdown', 'options' => [ 'shipped' => 'Enviado', 'pending' => 'Pendiente', 'cancelled' => 'Cancelado' ], 'default' => 'pending', 'rules' => 'required|in_list[shipped,pending,cancelled]' ]); Ejemplo din\u00e1mico (cargar desde DB): $rows = $this->db->table('categories')->select('id, name')->get()->getResultArray(); $options = array_column($rows, 'name', 'id'); $this->addField('categoryId', [ 'label' => 'Categor\u00eda', 'type' => 'dropdown', 'options' => $options, 'rules' => 'required|in_list[' . implode(',', array_keys($options)) . ']' ]); Placeholder / opci\u00f3n vac\u00eda: agregar una entrada con clave vac\u00eda para forzar selecci\u00f3n: 'options' => ['' => '(Seleccione)'] + $options Validaci\u00f3n y seguridad: Use in_list para evitar valores no permitidos. Si las opciones son din\u00e1micas, regenere la lista en cada carga de formulario para que la in_list coincida. UX y performance: Dropdown para <~20-30 opciones. Para relaciones con muchas filas, usar addSearch o un componente tipo autocompletar. Si necesita seleccionar m\u00faltiples valores, prefiera un componente multiselect (o un campo tipo relaci\u00f3n); no use dropdown simple. Internacionalizaci\u00f3n: almacene claves estables y traduzca etiquetas en la generaci\u00f3n de options para facilitar cambios de idioma. Persistencia: el valor guardado es la clave; si necesita guardar la etiqueta, considere un campo calculado o una vista.","title":"12. Campo dropdown (enum)"},{"location":"datasets/campos/#13-campo-switch-booleano","text":"Renderiza un interruptor (toggle) moderno. Ideal para campos booleanos o de estado (activo/inactivo). $this->addField('isActive', [ 'label' => 'Publicado', 'type' => 'switch', 'default' => 1, // Valor por defecto (checkbox marcado) // Opcional: Personalizar valores (por defecto 1 y 0) 'onValue' => 'Y', 'offValue'=> 'N' ]); Interact\u00faa con valores 1/0 (o personalizados). UI moderna (Bootstrap switch).","title":"13. Campo Switch (Booleano)"},{"location":"datasets/campos/#14-campo-pillbox-etiquetas","text":"Permite gestionar una lista de etiquetas (tags) simples. Se almacena en la base de datos como un array JSON. $this->addField('tags', [ 'label' => 'Etiquetas', 'type' => 'pillbox' ]); Interfaz: Input de texto que convierte entradas en \"pastillas\" al presionar Enter o Coma. Almacenamiento: JSON Array (ej. [\"Rojo\", \"Oferta\"] ). Requiere un campo tipo JSON o TEXT en BD. Uso: Categorizaci\u00f3n simple, palabras clave.","title":"14. Campo Pillbox (Etiquetas)"},{"location":"datasets/campos/#15-carga-de-archivos-fileupload","text":"Permite subir archivos generales al servidor. Persistencia: Guarda la ruta relativa del archivo en la base de datos (ej: assets/uploads/documento.pdf ). Validaci\u00f3n Inteligente: Detecta autom\u00e1ticamente si se est\u00e1 insertando o editando. Al editar, si el usuario no sube un nuevo archivo, se mantiene el archivo anterior . Si el campo tiene reglas de archivo (ej: max_size , ext_in ), estas se ignoran autom\u00e1ticamente si no se sube un nuevo archivo en edici\u00f3n, evitando errores de validaci\u00f3n. Creaci\u00f3n autom\u00e1tica de carpetas: Si la ruta destino no existe, el sistema intenta crearla recursivamente. $this->addField('documento_adjunto', [ 'label' => 'Documento PDF', 'type' => 'fileupload', 'uploadPath' => 'assets/docs/contratos', // Carpeta destino (relativa a public/) 'rules' => 'uploaded[documento_adjunto]|ext_in[documento_adjunto,pdf,docx]|max_size[documento_adjunto,4096]' ]);","title":"15. Carga de Archivos (fileupload)"},{"location":"datasets/campos/#parametros-especificos","text":"Par\u00e1metro Descripci\u00f3n uploadPath Ruta relativa a la carpeta p\u00fablica donde se guardar\u00e1n los archivos. Por defecto: assets/uploads . rules Reglas de validaci\u00f3n est\u00e1ndar de CodeIgniter 4 para archivos ( uploaded , max_size , ext_in , mime_in , etc). Importante sobre uploaded Aunque Ragnos maneja la opcionalidad en edici\u00f3n, si deseas que el archivo sea obligatorio al crear , debes incluir la regla uploaded[campo] . Ragnos la remover\u00e1 autom\u00e1ticamente solo cuando sea seguro hacerlo (edici\u00f3n manteniendo archivo previo).","title":"Par\u00e1metros Espec\u00edficos"},{"location":"datasets/campos/#16-carga-de-imagenes-imageupload","text":"Una especializaci\u00f3n de fileupload optimizada para im\u00e1genes. Previsualizaci\u00f3n: Muestra una vista previa inmediata de la imagen seleccionada antes de guardar. Visualizaci\u00f3n: Muestra la imagen actual almacenada si existe. Validaci\u00f3n: Id\u00e9ntica a fileupload , compatible con reglas is_image , max_dims , etc. $this->addField('foto_perfil', [ 'label' => 'Avatar', 'type' => 'imageupload', 'uploadPath' => 'assets/img/usuarios', 'rules' => 'is_image[foto_perfil]|max_size[foto_perfil,2048]', 'accept' => 'image/*' // Atributo HTML para el input file ]); Hacer la imagen opcional Si quieres que la imagen sea opcional incluso al crear el registro, simplemente omite la regla uploaded . 'rules' => 'is_image[foto_perfil]' // Opcional, pero si subes algo, debe ser imagen","title":"16. Carga de Im\u00e1genes (imageupload)"},{"location":"datasets/campos/#17-reglas-de-validacion-personalizadas","text":"Ragnos hereda la capacidad de CodeIgniter 4 para definir reglas de validaci\u00f3n personalizadas. Si necesitas una validaci\u00f3n que no existe por defecto (por ejemplo, validar un formato espec\u00edfico de ID o verificar contra un servicio externo), sigue estos pasos:","title":"17. Reglas de Validaci\u00f3n Personalizadas"},{"location":"datasets/campos/#1-crear-la-clase-de-reglas","text":"Crea un archivo en el directorio app/Validation/MyCustomRules.php (deber\u00e1s crear la carpeta si no existe): namespace App\\Validation; class MyCustomRules { public function even_number(string $str, string &$error = null): bool { if ((int)$str % 2 !== 0) { $error = \"El campo {field} debe ser un n\u00famero par.\"; return false; } return true; } }","title":"1. Crear la clase de reglas"},{"location":"datasets/campos/#2-registrar-la-regla","text":"Edita app/Config/Validation.php para incluir tu nueva clase en el array $ruleSets : public array $ruleSets = [ // ... otras reglas existentes \\App\\Validation\\MyCustomRules::class, ];","title":"2. Registrar la regla"},{"location":"datasets/campos/#3-usar-la-regla-en-el-dataset","text":"Ahora puedes usar tu regla personalizada en el m\u00e9todo addField() de tu controlador: $this->addField('cantidad', [ 'label' => 'Cantidad Par', 'rules' => 'required|even_number' ]); En Ragnos, los campos son declaraciones del dominio, no simples inputs.","title":"3. Usar la regla en el Dataset"},{"location":"datasets/campos/#18-resumen","text":"Tipo Persistente Editable Texto S\u00ed S\u00ed Texto Multil\u00ednea S\u00ed S\u00ed Fecha / Hora S\u00ed S\u00ed Num\u00e9rico S\u00ed S\u00ed Money S\u00ed S\u00ed Switch (Booleano) S\u00ed S\u00ed Pillbox (Tags) S\u00ed (JSON) S\u00ed Archivo S\u00ed (Ruta) S\u00ed Imagen S\u00ed (Ruta) S\u00ed Readonly Depende No Hidden Depende No Calculado No No Relaci\u00f3n S\u00ed S\u00ed Dropdown S\u00ed S\u00ed Clave PK S\u00ed S\u00ed","title":"18. Resumen"},{"location":"datasets/datasets/","text":"\ud83d\udcbe Datasets en Ragnos \u00bfQu\u00e9 es un Dataset? Un dataset ( RDatasetController ) es el concepto central de Ragnos para el desarrollo declarativo . En lugar de escribir controladores, modelos y vistas para cada m\u00f3dulo CRUD, un dataset permite definir la estructura y comportamiento de una entidad mediante metadatos en el constructor. El framework utiliza esta definici\u00f3n para generar autom\u00e1ticamente: Interfaces de usuario (Formularios y Grillas/Listados). Validaciones de entrada (Backend y Frontend). Consultas SQL y persistencia en base de datos. Respuestas para APIs. Ventajas de los Datasets Centralizaci\u00f3n : Todo (validaci\u00f3n, display, persistencia) se define en un solo lugar. Productividad : Elimina la necesidad de escribir HTML repetitivo o consultas CRUD b\u00e1sicas. Consistencia : Todos los m\u00f3dulos se comportan y lucen igual. Flexibilidad : Extensiones mediante Hooks y campos virtuales. Crear un dataset Un dataset es un controlador que extiende RDatasetController . Toda la configuraci\u00f3n se realiza en el constructor. Ejemplo m\u00ednimo namespace App\\Controllers\\Tienda; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Clientes extends RDatasetController { public function __construct() { parent::__construct(); // Seguridad y contexto $this->checkLogin(); $this->setTitle('Clientes'); // Persistencia $this->setTableName('customers'); $this->setIdField('customerNumber'); $this->setAutoIncrement(false); // Campos $this->addField('customerName', [ 'label' => 'Nombre', 'rules' => 'required' ]); // Campo calculado $this->addField('Contacto', [ 'label' => 'Contacto', 'rules' => 'readonly', 'query' => \"concat(contactLastName, ', ', contactFirstName)\", 'type' => 'hidden' ]); // Relaciones $this->addSearch('salesRepEmployeeNumber', 'Tienda\\\\Empleados'); // Grilla $this->setTableFields([ 'customerName', 'Contacto', 'salesRepEmployeeNumber' ]); } } Seguridad y contexto checkLogin() para requerir sesi\u00f3n activa. setTitle() para t\u00edtulo del m\u00f3dulo y breadcrumbs. Seguridad por defecto Siempre llama a checkLogin() al principio del constructor si tu m\u00f3dulo debe ser privado. Si olvidas esta l\u00ednea, el m\u00f3dulo ser\u00e1 accesible p\u00fablicamente. Tabla y clave primaria setTableName('table') define la tabla principal. !!! warning \"Coherencia con la BD\" El valor de setTableName debe coincidir exactamente con el nombre de la tabla f\u00edsica en tu base de datos. Ragnos no crea la tabla por ti; asume que ya existe. setIdField('id') establece la clave primaria. setAutoIncrement(true|false) controla si la PK es autoincremental. Definici\u00f3n de campos Use addField(name, options) para describir validaci\u00f3n, presentaci\u00f3n y persistencia. Para una referencia completa de todas las opciones y tipos de campo, consulta la Gu\u00eda de Campos . Opciones habituales: label : texto visible. rules : reglas de validaci\u00f3n (CI4 + validadores Ragnos como money , readonly ). type : text , hidden , etc. query : expresi\u00f3n SQL para campos virtuales. Ejemplos: Campo simple: required, texto. Campo num\u00e9rico: numeric . Monetario: rules => 'required|money' . Readonly / Hidden: visible en grilla, no editable. Calculado: query => \"concat(...)\" (no se persiste). Relaciones entre datasets Para relaciones m\u00e1s complejas tipo cabecera-lineas, consulta la gu\u00eda de Maestro-Detalle . Relaciones entre datasets ( addSearch ) Para relaciones m\u00e1s complejas tipo cabecera-lineas, consulta la gu\u00eda de Maestro-Detalle . La funci\u00f3n addSearch(campoLocal, 'Namespace\\Del\\DatasetRelacionado') es una herramienta poderosa que conecta dos datasets. B\u00fasqueda Contextual Inteligente Al vincular un campo con otro dataset, Ragnos habilita autom\u00e1ticamente b\u00fasquedas contextuales . Esto significa que el criterio de b\u00fasqueda no se limita solo al ID o al campo principal, sino que se extiende a todos los campos visibles definidos en el setTableFields() del dataset relacionado. Ejemplo: Imagina que est\u00e1s en el m\u00f3dulo de Pagos ( Tienda/Pagos ) y necesitas seleccionar un Cliente . Si en el dataset de Clientes ( Tienda/Clientes ) definiste: $this->setTableFields([ 'customerName', 'Contacto', // Campo calculado: concat(contactLastName, ', ', contactFirstName) 'salesRepEmployeeNumber' // Empleado a cargo ]); Cuando busques un cliente desde el formulario de Pagos, podr\u00e1s escribir: Una parte del Nombre de la empresa ( customerName ). El Nombre del contacto ( Contacto ). O incluso el Nombre del empleado a cargo. Ragnos buscar\u00e1 coincidencias en cualquiera de esos campos definidos en el dataset destino, ofreciendo una experiencia de usuario mucho m\u00e1s flexible y potente sin escribir SQL adicional. Agrupaci\u00f3n Autom\u00e1tica en Reportes Otra ventaja clave es que los campos asociados mediante addSearch se convierten autom\u00e1ticamente en criterios de agrupaci\u00f3n disponibles en el generador de reportes. Esto permite agrupar m\u00e9tricas (como ventas totales) por cualquiera de los criterios de b\u00fasqueda (ej. Ventas por \"Empleado a cargo\" del cliente) sin configuraci\u00f3n extra. Ventajas de addSearch Reutilizaci\u00f3n : Define la l\u00f3gica de \"c\u00f3mo buscar un cliente\" una sola vez en el dataset de Clientes, y \u00fasalo en Pagos, \u00d3rdenes, etc. Sin Joins Manuales : El framework gestiona las consultas subyacentes. UX Superior : Selectores intuitivos que buscan por m\u00faltiples atributos relevantes. Configuraci\u00f3n de la grilla setTableFields([...]) define columnas visibles en el listado (DataTable). Importancia del primer campo El primer campo que se agrega en setTableFields() es muy relevante, pues es el campo que se usar\u00e1 como \"descripci\u00f3n\" del registro . Este es el texto que aparece al seleccionar el registro en los controles de b\u00fasqueda, o en los dropdowns asociados con este cat\u00e1logo. Por ello es importante seleccionarlo muy bien, y de hecho puede ser un campo calculado que combine dos o m\u00e1s campos, como en el caso del cat\u00e1logo de \"empleados\" donde se ha usado el nombreCompleto como primer campo. Puede incluir campos virtuales y etiquetas. setSortingFields([...]) para ordenar por defecto. Ciclo de vida (Hooks) Puedes intervenir en el ciclo de vida de los datos y de la interfaz mediante m\u00e9todos protegidos. \ud83d\udc49 Ver la Gu\u00eda Completa de Hooks y Eventos Tipos de campo soportados (resumen) Texto, Num\u00e9rico, Money (validador money ), Readonly, Hidden, Calculado ( query ), Relaci\u00f3n (v\u00eda addSearch ), Clave primaria. Campos con query o sin columna f\u00edsica no se insertan ni actualizan; solo se calculan en lectura. Qu\u00e9 NO se escribe en Ragnos Con RDatasetController no necesitas: Modelos CRUD manuales Controladores con SQL expl\u00edcito Formularios y validaciones duplicadas Todo se genera desde la metadata del dataset. Buenas Pr\u00e1cticas y Recomendaciones Dise\u00f1o First : Dise\u00f1a primero la base de datos de manera s\u00f3lida. Un dataset = una tabla : Cada dataset debe gestionar una tabla principal. Si necesitas vistas complejas, crea un RQueryController . Campos Virtuales : Usa query en addField para conciliar columnas (ej. nombre completo) en buscar/listar sin desnormalizar la BD. Centralizaci\u00f3n : Si una validaci\u00f3n es regla de negocio, ponla en rules del dataset, no en el cliente. Desacoplamiento : Usa los hooks para limpiar cach\u00e9 o loguear, pero evita poner l\u00f3gica de negocio pesada directamente en el controlador; llama a Servicios o Librer\u00edaa relaciones reutilizables. Centraliza l\u00f3gica en hooks. Pr\u00f3ximos pasos Crear nuevos datasets siguiendo este patr\u00f3n. Extender validadores y tipos. Integrar reportes y optimizar cache por eventos. Mantener la metadata consistente para escalabilidad.","title":"Creando Datasets"},{"location":"datasets/datasets/#datasets-en-ragnos","text":"","title":"\ud83d\udcbe Datasets en Ragnos"},{"location":"datasets/datasets/#que-es-un-dataset","text":"Un dataset ( RDatasetController ) es el concepto central de Ragnos para el desarrollo declarativo . En lugar de escribir controladores, modelos y vistas para cada m\u00f3dulo CRUD, un dataset permite definir la estructura y comportamiento de una entidad mediante metadatos en el constructor. El framework utiliza esta definici\u00f3n para generar autom\u00e1ticamente: Interfaces de usuario (Formularios y Grillas/Listados). Validaciones de entrada (Backend y Frontend). Consultas SQL y persistencia en base de datos. Respuestas para APIs.","title":"\u00bfQu\u00e9 es un Dataset?"},{"location":"datasets/datasets/#ventajas-de-los-datasets","text":"Centralizaci\u00f3n : Todo (validaci\u00f3n, display, persistencia) se define en un solo lugar. Productividad : Elimina la necesidad de escribir HTML repetitivo o consultas CRUD b\u00e1sicas. Consistencia : Todos los m\u00f3dulos se comportan y lucen igual. Flexibilidad : Extensiones mediante Hooks y campos virtuales.","title":"Ventajas de los Datasets"},{"location":"datasets/datasets/#crear-un-dataset","text":"Un dataset es un controlador que extiende RDatasetController . Toda la configuraci\u00f3n se realiza en el constructor.","title":"Crear un dataset"},{"location":"datasets/datasets/#ejemplo-minimo","text":"namespace App\\Controllers\\Tienda; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Clientes extends RDatasetController { public function __construct() { parent::__construct(); // Seguridad y contexto $this->checkLogin(); $this->setTitle('Clientes'); // Persistencia $this->setTableName('customers'); $this->setIdField('customerNumber'); $this->setAutoIncrement(false); // Campos $this->addField('customerName', [ 'label' => 'Nombre', 'rules' => 'required' ]); // Campo calculado $this->addField('Contacto', [ 'label' => 'Contacto', 'rules' => 'readonly', 'query' => \"concat(contactLastName, ', ', contactFirstName)\", 'type' => 'hidden' ]); // Relaciones $this->addSearch('salesRepEmployeeNumber', 'Tienda\\\\Empleados'); // Grilla $this->setTableFields([ 'customerName', 'Contacto', 'salesRepEmployeeNumber' ]); } }","title":"Ejemplo m\u00ednimo"},{"location":"datasets/datasets/#seguridad-y-contexto","text":"checkLogin() para requerir sesi\u00f3n activa. setTitle() para t\u00edtulo del m\u00f3dulo y breadcrumbs. Seguridad por defecto Siempre llama a checkLogin() al principio del constructor si tu m\u00f3dulo debe ser privado. Si olvidas esta l\u00ednea, el m\u00f3dulo ser\u00e1 accesible p\u00fablicamente.","title":"Seguridad y contexto"},{"location":"datasets/datasets/#tabla-y-clave-primaria","text":"setTableName('table') define la tabla principal. !!! warning \"Coherencia con la BD\" El valor de setTableName debe coincidir exactamente con el nombre de la tabla f\u00edsica en tu base de datos. Ragnos no crea la tabla por ti; asume que ya existe. setIdField('id') establece la clave primaria. setAutoIncrement(true|false) controla si la PK es autoincremental.","title":"Tabla y clave primaria"},{"location":"datasets/datasets/#definicion-de-campos","text":"Use addField(name, options) para describir validaci\u00f3n, presentaci\u00f3n y persistencia. Para una referencia completa de todas las opciones y tipos de campo, consulta la Gu\u00eda de Campos . Opciones habituales: label : texto visible. rules : reglas de validaci\u00f3n (CI4 + validadores Ragnos como money , readonly ). type : text , hidden , etc. query : expresi\u00f3n SQL para campos virtuales. Ejemplos: Campo simple: required, texto. Campo num\u00e9rico: numeric . Monetario: rules => 'required|money' . Readonly / Hidden: visible en grilla, no editable. Calculado: query => \"concat(...)\" (no se persiste).","title":"Definici\u00f3n de campos"},{"location":"datasets/datasets/#relaciones-entre-datasets","text":"Para relaciones m\u00e1s complejas tipo cabecera-lineas, consulta la gu\u00eda de Maestro-Detalle .","title":"Relaciones entre datasets"},{"location":"datasets/datasets/#relaciones-entre-datasets-addsearch","text":"Para relaciones m\u00e1s complejas tipo cabecera-lineas, consulta la gu\u00eda de Maestro-Detalle . La funci\u00f3n addSearch(campoLocal, 'Namespace\\Del\\DatasetRelacionado') es una herramienta poderosa que conecta dos datasets.","title":"Relaciones entre datasets (addSearch)"},{"location":"datasets/datasets/#busqueda-contextual-inteligente","text":"Al vincular un campo con otro dataset, Ragnos habilita autom\u00e1ticamente b\u00fasquedas contextuales . Esto significa que el criterio de b\u00fasqueda no se limita solo al ID o al campo principal, sino que se extiende a todos los campos visibles definidos en el setTableFields() del dataset relacionado. Ejemplo: Imagina que est\u00e1s en el m\u00f3dulo de Pagos ( Tienda/Pagos ) y necesitas seleccionar un Cliente . Si en el dataset de Clientes ( Tienda/Clientes ) definiste: $this->setTableFields([ 'customerName', 'Contacto', // Campo calculado: concat(contactLastName, ', ', contactFirstName) 'salesRepEmployeeNumber' // Empleado a cargo ]); Cuando busques un cliente desde el formulario de Pagos, podr\u00e1s escribir: Una parte del Nombre de la empresa ( customerName ). El Nombre del contacto ( Contacto ). O incluso el Nombre del empleado a cargo. Ragnos buscar\u00e1 coincidencias en cualquiera de esos campos definidos en el dataset destino, ofreciendo una experiencia de usuario mucho m\u00e1s flexible y potente sin escribir SQL adicional.","title":"B\u00fasqueda Contextual Inteligente"},{"location":"datasets/datasets/#agrupacion-automatica-en-reportes","text":"Otra ventaja clave es que los campos asociados mediante addSearch se convierten autom\u00e1ticamente en criterios de agrupaci\u00f3n disponibles en el generador de reportes. Esto permite agrupar m\u00e9tricas (como ventas totales) por cualquiera de los criterios de b\u00fasqueda (ej. Ventas por \"Empleado a cargo\" del cliente) sin configuraci\u00f3n extra.","title":"Agrupaci\u00f3n Autom\u00e1tica en Reportes"},{"location":"datasets/datasets/#ventajas-de-addsearch","text":"Reutilizaci\u00f3n : Define la l\u00f3gica de \"c\u00f3mo buscar un cliente\" una sola vez en el dataset de Clientes, y \u00fasalo en Pagos, \u00d3rdenes, etc. Sin Joins Manuales : El framework gestiona las consultas subyacentes. UX Superior : Selectores intuitivos que buscan por m\u00faltiples atributos relevantes.","title":"Ventajas de addSearch"},{"location":"datasets/datasets/#configuracion-de-la-grilla","text":"setTableFields([...]) define columnas visibles en el listado (DataTable). Importancia del primer campo El primer campo que se agrega en setTableFields() es muy relevante, pues es el campo que se usar\u00e1 como \"descripci\u00f3n\" del registro . Este es el texto que aparece al seleccionar el registro en los controles de b\u00fasqueda, o en los dropdowns asociados con este cat\u00e1logo. Por ello es importante seleccionarlo muy bien, y de hecho puede ser un campo calculado que combine dos o m\u00e1s campos, como en el caso del cat\u00e1logo de \"empleados\" donde se ha usado el nombreCompleto como primer campo. Puede incluir campos virtuales y etiquetas. setSortingFields([...]) para ordenar por defecto.","title":"Configuraci\u00f3n de la grilla"},{"location":"datasets/datasets/#ciclo-de-vida-hooks","text":"Puedes intervenir en el ciclo de vida de los datos y de la interfaz mediante m\u00e9todos protegidos. \ud83d\udc49 Ver la Gu\u00eda Completa de Hooks y Eventos","title":"Ciclo de vida (Hooks)"},{"location":"datasets/datasets/#tipos-de-campo-soportados-resumen","text":"Texto, Num\u00e9rico, Money (validador money ), Readonly, Hidden, Calculado ( query ), Relaci\u00f3n (v\u00eda addSearch ), Clave primaria. Campos con query o sin columna f\u00edsica no se insertan ni actualizan; solo se calculan en lectura.","title":"Tipos de campo soportados (resumen)"},{"location":"datasets/datasets/#que-no-se-escribe-en-ragnos","text":"Con RDatasetController no necesitas: Modelos CRUD manuales Controladores con SQL expl\u00edcito Formularios y validaciones duplicadas Todo se genera desde la metadata del dataset. Buenas Pr\u00e1cticas y Recomendaciones Dise\u00f1o First : Dise\u00f1a primero la base de datos de manera s\u00f3lida. Un dataset = una tabla : Cada dataset debe gestionar una tabla principal. Si necesitas vistas complejas, crea un RQueryController . Campos Virtuales : Usa query en addField para conciliar columnas (ej. nombre completo) en buscar/listar sin desnormalizar la BD. Centralizaci\u00f3n : Si una validaci\u00f3n es regla de negocio, ponla en rules del dataset, no en el cliente. Desacoplamiento : Usa los hooks para limpiar cach\u00e9 o loguear, pero evita poner l\u00f3gica de negocio pesada directamente en el controlador; llama a Servicios o Librer\u00edaa relaciones reutilizables. Centraliza l\u00f3gica en hooks.","title":"Qu\u00e9 NO se escribe en Ragnos"},{"location":"datasets/datasets/#proximos-pasos","text":"Crear nuevos datasets siguiendo este patr\u00f3n. Extender validadores y tipos. Integrar reportes y optimizar cache por eventos. Mantener la metadata consistente para escalabilidad.","title":"Pr\u00f3ximos pasos"},{"location":"datasets/guia_RQueryController/","text":"Gu\u00eda de Referencia: RQueryController RQueryController es una variante especializada del controlador base de Ragnos dise\u00f1ada para consultas de solo lectura y b\u00fasquedas avanzadas . A diferencia de RDatasetController (que se mapea a una tabla f\u00edsica para hacer CRUD), RQueryController se mapea a una Sentencia SQL Arbitraria . \ud83c\udfaf \u00bfCu\u00e1ndo usar RQueryController? Usa este controlador cuando: No necesitas editar: Solo quieres listar, buscar y filtrar datos. La data es compleja: Necesitas hacer JOINs , subconsultas o campos calculados (ej. CONCAT , CASE WHEN ) que no existen en una sola tabla f\u00edsica. Reportes R\u00e1pidos: Quieres exponer una vista de base de datos en el sistema administrativo r\u00e1pidamente. \ud83e\uddec Estructura B\u00e1sica Un controlador de consulta extiende de RQueryController y define su l\u00f3gica en el constructor. Ejemplo Analizado: Searchusuarios.php namespace App\\Controllers; use App\\ThirdParty\\Ragnos\\Controllers\\RQueryController; class Searchusuarios extends RQueryController { public function __construct() { parent::__construct(); // 1. Seguridad $this->checkUserInGroup('Administrador'); // 2. Configuraci\u00f3n Visual $this->setTitle('\ud83d\udd0e Usuarios'); // 3. La Fuente de Datos (SQL) $this->setQuery(\"SELECT usu_id, usu_nombre as 'Nombre', usu_login as 'Login', usu_activo as Activo, usu_grupo FROM gen_usuarios\"); // 4. Clave Primaria (Virtual o Real) $this->setIdField('usu_id'); // 5. Configuraci\u00f3n de Campos (Filtros y Visualizaci\u00f3n) $this->addField('Activo', [ 'label' => 'Activo', 'type' => 'dropdown', 'options' => ['S' => 'SI', 'N' => 'NO'], ]); $this->addField('usu_grupo', ['label' => 'Grupo']); // 6. Relaciones para B\u00fasqueda $this->addSearch('usu_grupo', 'Gruposdeusuarios'); // 7. Definici\u00f3n de la Grilla $this->setTableFields(['Nombre', 'Login', 'Activo', 'usu_grupo']); } } \ud83d\udcda M\u00e9todos Clave setQuery(string $sql) Define la fuente de datos. Importante: No uses ORDER BY o LIMIT aqu\u00ed; Ragnos los inyecta din\u00e1micamente seg\u00fan la interacci\u00f3n del usuario en la grilla. Alias: Es muy recomendable usar alias SQL ( AS 'Nombre' ) para que los encabezados de la tabla sean legibles autom\u00e1ticamente. setIdField(string $field) Aunque sea una consulta personalizada, Ragnos necesita saber cu\u00e1l es la columna que identifica un\u00edvocamente a cada fila (para selecci\u00f3n, detalles, etc.). Debe estar presente en el SELECT de setQuery . addField(string $name, array $config) Funciona igual que en RDatasetController , pero aqu\u00ed se usa principalmente para generar los filtros de b\u00fasqueda . Si defines un campo como 'type' => 'dropdown' , Ragnos crear\u00e1 un <select> en la barra de b\u00fasqueda avanzada. addSearch(string $field, string $controller) Permite vincular una columna de tu consulta con otro controlador Ragnos. Esto habilita el icono de lupa para buscar valores relacionados. checkUserInGroup(string|array $groups) Restringe el acceso a este controlador exclusivamente a los grupos de usuarios especificados. \u26a0\ufe0f Diferencias con RDatasetController Caracter\u00edstica RDatasetController RQueryController Fuente de Datos setTableName('tabla') setQuery('SELECT...') Edici\u00f3n (Save/Update) \u2705 Soportado (Autom\u00e1tico) \u274c No soportado Eliminaci\u00f3n (Delete) \u2705 Soportado \u274c No soportado Nuevo Registro \u2705 Soportado \u274c No soportado Uso Principal CRUDs (Cat\u00e1logos) Reportes, Dashboards, Buscadores \ud83d\udca1 Tips de Implementaci\u00f3n Campos Calculados: Puedes crear columnas \"virtuales\" en el SQL y usarlas en la grilla: $this->setQuery(\"SELECT id, precio * cantidad AS Total, ... FROM ventas\"); $this->setTableFields(['id', 'Total']); Uniones (JOINs): Ideal para mostrar nombres en lugar de IDs sin configurar addSearch visualmente: $this->setQuery(\" SELECT p.nombre, c.categoria_nombre FROM productos p JOIN categorias c ON p.cat_id = c.id \");","title":"Consultas Avanzadas (RQuery)"},{"location":"datasets/guia_RQueryController/#guia-de-referencia-rquerycontroller","text":"RQueryController es una variante especializada del controlador base de Ragnos dise\u00f1ada para consultas de solo lectura y b\u00fasquedas avanzadas . A diferencia de RDatasetController (que se mapea a una tabla f\u00edsica para hacer CRUD), RQueryController se mapea a una Sentencia SQL Arbitraria .","title":"Gu\u00eda de Referencia: RQueryController"},{"location":"datasets/guia_RQueryController/#cuando-usar-rquerycontroller","text":"Usa este controlador cuando: No necesitas editar: Solo quieres listar, buscar y filtrar datos. La data es compleja: Necesitas hacer JOINs , subconsultas o campos calculados (ej. CONCAT , CASE WHEN ) que no existen en una sola tabla f\u00edsica. Reportes R\u00e1pidos: Quieres exponer una vista de base de datos en el sistema administrativo r\u00e1pidamente.","title":"\ud83c\udfaf \u00bfCu\u00e1ndo usar RQueryController?"},{"location":"datasets/guia_RQueryController/#estructura-basica","text":"Un controlador de consulta extiende de RQueryController y define su l\u00f3gica en el constructor. Ejemplo Analizado: Searchusuarios.php namespace App\\Controllers; use App\\ThirdParty\\Ragnos\\Controllers\\RQueryController; class Searchusuarios extends RQueryController { public function __construct() { parent::__construct(); // 1. Seguridad $this->checkUserInGroup('Administrador'); // 2. Configuraci\u00f3n Visual $this->setTitle('\ud83d\udd0e Usuarios'); // 3. La Fuente de Datos (SQL) $this->setQuery(\"SELECT usu_id, usu_nombre as 'Nombre', usu_login as 'Login', usu_activo as Activo, usu_grupo FROM gen_usuarios\"); // 4. Clave Primaria (Virtual o Real) $this->setIdField('usu_id'); // 5. Configuraci\u00f3n de Campos (Filtros y Visualizaci\u00f3n) $this->addField('Activo', [ 'label' => 'Activo', 'type' => 'dropdown', 'options' => ['S' => 'SI', 'N' => 'NO'], ]); $this->addField('usu_grupo', ['label' => 'Grupo']); // 6. Relaciones para B\u00fasqueda $this->addSearch('usu_grupo', 'Gruposdeusuarios'); // 7. Definici\u00f3n de la Grilla $this->setTableFields(['Nombre', 'Login', 'Activo', 'usu_grupo']); } }","title":"\ud83e\uddec Estructura B\u00e1sica"},{"location":"datasets/guia_RQueryController/#metodos-clave","text":"","title":"\ud83d\udcda M\u00e9todos Clave"},{"location":"datasets/guia_RQueryController/#setquerystring-sql","text":"Define la fuente de datos. Importante: No uses ORDER BY o LIMIT aqu\u00ed; Ragnos los inyecta din\u00e1micamente seg\u00fan la interacci\u00f3n del usuario en la grilla. Alias: Es muy recomendable usar alias SQL ( AS 'Nombre' ) para que los encabezados de la tabla sean legibles autom\u00e1ticamente.","title":"setQuery(string $sql)"},{"location":"datasets/guia_RQueryController/#setidfieldstring-field","text":"Aunque sea una consulta personalizada, Ragnos necesita saber cu\u00e1l es la columna que identifica un\u00edvocamente a cada fila (para selecci\u00f3n, detalles, etc.). Debe estar presente en el SELECT de setQuery .","title":"setIdField(string $field)"},{"location":"datasets/guia_RQueryController/#addfieldstring-name-array-config","text":"Funciona igual que en RDatasetController , pero aqu\u00ed se usa principalmente para generar los filtros de b\u00fasqueda . Si defines un campo como 'type' => 'dropdown' , Ragnos crear\u00e1 un <select> en la barra de b\u00fasqueda avanzada.","title":"addField(string $name, array $config)"},{"location":"datasets/guia_RQueryController/#addsearchstring-field-string-controller","text":"Permite vincular una columna de tu consulta con otro controlador Ragnos. Esto habilita el icono de lupa para buscar valores relacionados.","title":"addSearch(string $field, string $controller)"},{"location":"datasets/guia_RQueryController/#checkuseringroupstringarray-groups","text":"Restringe el acceso a este controlador exclusivamente a los grupos de usuarios especificados.","title":"checkUserInGroup(string|array $groups)"},{"location":"datasets/guia_RQueryController/#diferencias-con-rdatasetcontroller","text":"Caracter\u00edstica RDatasetController RQueryController Fuente de Datos setTableName('tabla') setQuery('SELECT...') Edici\u00f3n (Save/Update) \u2705 Soportado (Autom\u00e1tico) \u274c No soportado Eliminaci\u00f3n (Delete) \u2705 Soportado \u274c No soportado Nuevo Registro \u2705 Soportado \u274c No soportado Uso Principal CRUDs (Cat\u00e1logos) Reportes, Dashboards, Buscadores","title":"\u26a0\ufe0f Diferencias con RDatasetController"},{"location":"datasets/guia_RQueryController/#tips-de-implementacion","text":"Campos Calculados: Puedes crear columnas \"virtuales\" en el SQL y usarlas en la grilla: $this->setQuery(\"SELECT id, precio * cantidad AS Total, ... FROM ventas\"); $this->setTableFields(['id', 'Total']); Uniones (JOINs): Ideal para mostrar nombres en lugar de IDs sin configurar addSearch visualmente: $this->setQuery(\" SELECT p.nombre, c.categoria_nombre FROM productos p JOIN categorias c ON p.cat_id = c.id \");","title":"\ud83d\udca1 Tips de Implementaci\u00f3n"},{"location":"datasets/maestro-detalle/","text":"\ud83d\udcd1 Relaci\u00f3n Maestro-Detalle en Ragnos Esta gu\u00eda explica c\u00f3mo crear una pantalla donde tienes un registro principal (como una Orden de compra ) y una lista de elementos relacionados (los Detalles o productos de esa orden). Arquitectura de la Relaci\u00f3n graph TD User[\"Usuario\"] -->|Abre Pantalla| Master[\"Controlador Maestro (Ordenes)\"] Master -->|Renderiza| View[\"Vista Principal\"] View -->|Contiene| Form[\"Formulario Maestro\"] subgraph Vinculacion [\"L\u00f3gica de Vinculaci\u00f3n\"] direction TB Form -->|\"ID Orden\"| Logic{\"\u00bfExiste Orden?\"} Logic -- NO --> Info(\"Solo muestra Formulario\") Logic -- \"SI (ID=100)\" --> LoadDetails[\"Carga Controlador Detalle\"] end LoadDetails -->|\"Inyecta ID=100 como $this->master\"| Detail[\"Controlador Detalle (OrdenesDetalles)\"] subgraph Detalle [\"Zona del Detalle\"] direction TB Detail -->|Aplica Filtro| Filter[\"WHERE orderNumber = 100\"] Filter -->|Muestra| Grid[\"Grilla de Productos\"] Grid -->|Nuevo Registro| NewLine[\"Formulario Detalle\"] NewLine -->|Campo Oculto| Hidden[\"orderNumber = 100\"] end %% Estilos Profesionales classDef mainNode fill:#f9f,stroke:#333,stroke-width:2px; classDef detailNode fill:#bbf,stroke:#333,stroke-width:2px; classDef logicNode fill:#fff9c4,stroke:#fbc02d,stroke-width:2px; style Master fill:#e1bee7,stroke:#4a148c,stroke-width:2px style Detail fill:#bbdefb,stroke:#0d47a1,stroke-width:2px style Hidden fill:#c8e6c9,stroke:#2e7d32,stroke-dasharray: 5 5 La idea b\u00e1sica es tener dos controladores: El Maestro (Ordenes): Controla la informaci\u00f3n general (fecha, cliente, total). El Detalle (OrdenesDetalles): Controla la lista de productos dentro de esa orden. 1. Configurando el Maestro (Controlador Ordenes ) Este es el \"padre\" de la relaci\u00f3n. Aqu\u00ed definimos la cabecera de la factura. Configuraci\u00f3n b\u00e1sica: Le decimos a Ragnos que use la tabla orders y que la clave principal es orderNumber . Campos: Definimos los campos normales como fecha ( orderDate ), estado ( status ) y cliente ( customerNumber ). Campo Total (Calculado): Para mostrar el total de la orden sin guardarlo manualmente, usamos una peque\u00f1a consulta SQL dentro de la configuraci\u00f3n del campo. Esta consulta suma cantidad * precio de la tabla de detalles. Activar el modo detalle: Hay una l\u00ednea clave que debes agregar en tu controlador maestro para avisar que tendr\u00e1 \"hijos\": $this->setDetailsController('Tienda\\Ordenesdetalles'); Esto le dice a Ragnos que el controlador Ordenesdetalles manejar\u00e1 los detalles relacionados con cada orden. La relaci\u00f3n se basa en que el campo orderNumber en ambos controladores es el mismo, y este es la llave primaria en el maestro. 2. Configurando el Detalle (Controlador Ordenesdetalles ) Este es el \"hijo\". Controla cada l\u00ednea de producto. El truco del campo oculto: Necesitamos que cada producto sepa a qu\u00e9 orden pertenece. Para eso, en el campo orderNumber del detalle hacemos dos cosas: Lo ponemos como hidden (oculto) para que el usuario no lo toque. Le asignamos el valor por defecto $this->master . \u00bfQu\u00e9 hace esto? Cuando creas un detalle desde la orden #100, Ragnos autom\u00e1ticamente rellena este campo con el n\u00famero 100. Filtrar los datos: No queremos ver todos los productos de todas las \u00f3rdenes. En el m\u00e9todo _filters() , agregamos una regla para que solo se carguen los productos que coincidan con el ID del maestro actual ( $this->master ). function _filters() { $this->modelo->builder()->where('orderNumber', $this->master); } En este fragmento, $this->modelo->builder() permite interactuar directamente con la consulta SQL que generar\u00e1 la grilla. La variable $this->master es inyectada autom\u00e1ticamente por el framework cuando detecta que este controlador se est\u00e1 ejecutando como \"hijo\", y contiene el ID del registro que se est\u00e1 visualizando en el maestro (en este caso, el n\u00famero de orden). Actualizar cambios: Usamos funciones especiales (llamadas hooks ) como _afterInsert o _afterUpdate para limpiar la memoria cach\u00e9. Esto asegura que si agregas un producto, el total de la orden principal se recalcule correctamente. \ud83d\udc49 Ver Gu\u00eda de Hooks Hooks de javascript personalizados (Opcional) En el archivo custom.js se ha agregado la siguiente funci\u00f3n: // con cada cambio en la tabla de detalles de ordenes // recalcula el total de la orden function _OrdenesdetallesOnChange ( tabla ) { let orden = $ ( \"input[name='orderNumber']\" ). val (); getObject ( \"tienda/ordenes/calculatotal\" , { orden : orden }, function ( data ) { $ ( 'input[name=\"total\"]' ). val ( data . total ); }); } Esta funci\u00f3n se ejecuta cada vez que hay un cambio en la tabla de detalles de \u00f3rdenes. Lo que hace es: Obtiene el n\u00famero de orden actual desde el campo oculto. Llama a un endpoint ( tienda/ordenes/calculatotal ) para recalcular el total de la orden. Actualiza el campo total en la pantalla con el nuevo valor. de este modo, el total siempre estar\u00e1 actualizado, cada que se agregue, modifique o elimine un producto en la orden. Esta funci\u00f3n se enlaza autom\u00e1ticamente gracias a la convenci\u00f3n de nombres: _NombreDelControladorOnChange . Resumen del flujo de trabajo Abres una Orden: Ves los datos generales (Maestro). El sistema verifica: \u00bfEsta orden ya existe? S\u00ed: Carga autom\u00e1ticamente la tabla de productos relacionados al final de la pantalla. No: Oculta la secci\u00f3n de productos hasta que guardes la orden por primera vez. Agregas un producto: Al crear una l\u00ednea en la tabla de detalles, el sistema le pega invisiblemente el n\u00famero de la orden padre. Guardas: Al guardar el detalle, el sistema actualiza los totales y todo se mantiene sincronizado. \u00a1Y listo! Con estos pasos logras que dos tablas funcionen como una sola pantalla integrada.","title":"Maestro-Detalle"},{"location":"datasets/maestro-detalle/#relacion-maestro-detalle-en-ragnos","text":"Esta gu\u00eda explica c\u00f3mo crear una pantalla donde tienes un registro principal (como una Orden de compra ) y una lista de elementos relacionados (los Detalles o productos de esa orden).","title":"\ud83d\udcd1 Relaci\u00f3n Maestro-Detalle en Ragnos"},{"location":"datasets/maestro-detalle/#arquitectura-de-la-relacion","text":"graph TD User[\"Usuario\"] -->|Abre Pantalla| Master[\"Controlador Maestro (Ordenes)\"] Master -->|Renderiza| View[\"Vista Principal\"] View -->|Contiene| Form[\"Formulario Maestro\"] subgraph Vinculacion [\"L\u00f3gica de Vinculaci\u00f3n\"] direction TB Form -->|\"ID Orden\"| Logic{\"\u00bfExiste Orden?\"} Logic -- NO --> Info(\"Solo muestra Formulario\") Logic -- \"SI (ID=100)\" --> LoadDetails[\"Carga Controlador Detalle\"] end LoadDetails -->|\"Inyecta ID=100 como $this->master\"| Detail[\"Controlador Detalle (OrdenesDetalles)\"] subgraph Detalle [\"Zona del Detalle\"] direction TB Detail -->|Aplica Filtro| Filter[\"WHERE orderNumber = 100\"] Filter -->|Muestra| Grid[\"Grilla de Productos\"] Grid -->|Nuevo Registro| NewLine[\"Formulario Detalle\"] NewLine -->|Campo Oculto| Hidden[\"orderNumber = 100\"] end %% Estilos Profesionales classDef mainNode fill:#f9f,stroke:#333,stroke-width:2px; classDef detailNode fill:#bbf,stroke:#333,stroke-width:2px; classDef logicNode fill:#fff9c4,stroke:#fbc02d,stroke-width:2px; style Master fill:#e1bee7,stroke:#4a148c,stroke-width:2px style Detail fill:#bbdefb,stroke:#0d47a1,stroke-width:2px style Hidden fill:#c8e6c9,stroke:#2e7d32,stroke-dasharray: 5 5 La idea b\u00e1sica es tener dos controladores: El Maestro (Ordenes): Controla la informaci\u00f3n general (fecha, cliente, total). El Detalle (OrdenesDetalles): Controla la lista de productos dentro de esa orden.","title":"Arquitectura de la Relaci\u00f3n"},{"location":"datasets/maestro-detalle/#1-configurando-el-maestro-controlador-ordenes","text":"Este es el \"padre\" de la relaci\u00f3n. Aqu\u00ed definimos la cabecera de la factura. Configuraci\u00f3n b\u00e1sica: Le decimos a Ragnos que use la tabla orders y que la clave principal es orderNumber . Campos: Definimos los campos normales como fecha ( orderDate ), estado ( status ) y cliente ( customerNumber ). Campo Total (Calculado): Para mostrar el total de la orden sin guardarlo manualmente, usamos una peque\u00f1a consulta SQL dentro de la configuraci\u00f3n del campo. Esta consulta suma cantidad * precio de la tabla de detalles. Activar el modo detalle: Hay una l\u00ednea clave que debes agregar en tu controlador maestro para avisar que tendr\u00e1 \"hijos\": $this->setDetailsController('Tienda\\Ordenesdetalles'); Esto le dice a Ragnos que el controlador Ordenesdetalles manejar\u00e1 los detalles relacionados con cada orden. La relaci\u00f3n se basa en que el campo orderNumber en ambos controladores es el mismo, y este es la llave primaria en el maestro.","title":"1. Configurando el Maestro (Controlador Ordenes)"},{"location":"datasets/maestro-detalle/#2-configurando-el-detalle-controlador-ordenesdetalles","text":"Este es el \"hijo\". Controla cada l\u00ednea de producto. El truco del campo oculto: Necesitamos que cada producto sepa a qu\u00e9 orden pertenece. Para eso, en el campo orderNumber del detalle hacemos dos cosas: Lo ponemos como hidden (oculto) para que el usuario no lo toque. Le asignamos el valor por defecto $this->master . \u00bfQu\u00e9 hace esto? Cuando creas un detalle desde la orden #100, Ragnos autom\u00e1ticamente rellena este campo con el n\u00famero 100. Filtrar los datos: No queremos ver todos los productos de todas las \u00f3rdenes. En el m\u00e9todo _filters() , agregamos una regla para que solo se carguen los productos que coincidan con el ID del maestro actual ( $this->master ). function _filters() { $this->modelo->builder()->where('orderNumber', $this->master); } En este fragmento, $this->modelo->builder() permite interactuar directamente con la consulta SQL que generar\u00e1 la grilla. La variable $this->master es inyectada autom\u00e1ticamente por el framework cuando detecta que este controlador se est\u00e1 ejecutando como \"hijo\", y contiene el ID del registro que se est\u00e1 visualizando en el maestro (en este caso, el n\u00famero de orden). Actualizar cambios: Usamos funciones especiales (llamadas hooks ) como _afterInsert o _afterUpdate para limpiar la memoria cach\u00e9. Esto asegura que si agregas un producto, el total de la orden principal se recalcule correctamente. \ud83d\udc49 Ver Gu\u00eda de Hooks","title":"2. Configurando el Detalle (Controlador Ordenesdetalles)"},{"location":"datasets/maestro-detalle/#hooks-de-javascript-personalizados-opcional","text":"En el archivo custom.js se ha agregado la siguiente funci\u00f3n: // con cada cambio en la tabla de detalles de ordenes // recalcula el total de la orden function _OrdenesdetallesOnChange ( tabla ) { let orden = $ ( \"input[name='orderNumber']\" ). val (); getObject ( \"tienda/ordenes/calculatotal\" , { orden : orden }, function ( data ) { $ ( 'input[name=\"total\"]' ). val ( data . total ); }); } Esta funci\u00f3n se ejecuta cada vez que hay un cambio en la tabla de detalles de \u00f3rdenes. Lo que hace es: Obtiene el n\u00famero de orden actual desde el campo oculto. Llama a un endpoint ( tienda/ordenes/calculatotal ) para recalcular el total de la orden. Actualiza el campo total en la pantalla con el nuevo valor. de este modo, el total siempre estar\u00e1 actualizado, cada que se agregue, modifique o elimine un producto en la orden. Esta funci\u00f3n se enlaza autom\u00e1ticamente gracias a la convenci\u00f3n de nombres: _NombreDelControladorOnChange .","title":"Hooks de javascript personalizados (Opcional)"},{"location":"datasets/maestro-detalle/#resumen-del-flujo-de-trabajo","text":"Abres una Orden: Ves los datos generales (Maestro). El sistema verifica: \u00bfEsta orden ya existe? S\u00ed: Carga autom\u00e1ticamente la tabla de productos relacionados al final de la pantalla. No: Oculta la secci\u00f3n de productos hasta que guardes la orden por primera vez. Agregas un producto: Al crear una l\u00ednea en la tabla de detalles, el sistema le pega invisiblemente el n\u00famero de la orden padre. Guardas: Al guardar el detalle, el sistema actualiza los totales y todo se mantiene sincronizado. \u00a1Y listo! Con estos pasos logras que dos tablas funcionen como una sola pantalla integrada.","title":"Resumen del flujo de trabajo"},{"location":"frontend/funciones_javascript/","text":"\u26a1 Funciones JavaScript: getValue y getObject Este documento describe las funciones utilitarias getValue y getObject , utilizadas en el proyecto para realizar peticiones as\u00edncronas al servidor. Estas funciones simplifican el uso de fetch y manejan la serializaci\u00f3n de par\u00e1metros, tiempos de espera y reintentos. getValue(url, params, callback) Realiza una petici\u00f3n HTTP POST a una URL especificada y devuelve la respuesta como texto plano. Par\u00e1metros url (string): La URL a la que se realizar\u00e1 la petici\u00f3n. Se procesa internamente con fixUrl , por lo que puede ser una ruta relativa. params (object, opcional): Un objeto con los par\u00e1metros que se enviar\u00e1n en el cuerpo de la petici\u00f3n (codificados como application/x-www-form-urlencoded ). Adem\u00e1s de los datos a enviar, este objeto acepta configuraciones especiales: timeout (number): Tiempo m\u00e1ximo de espera en milisegundos (por defecto: 12000). retryAttempts (number): N\u00famero de intentos en caso de fallo (por defecto: 1). retryDelay (number): Retardo entre intentos en milisegundos (por defecto: 1000). callback (function, opcional): Una funci\u00f3n que se ejecutar\u00e1 al completar la petici\u00f3n. Recibe dos argumentos: (response, error) . Retorno Si se proporciona un callback , la funci\u00f3n no retorna nada y el resultado se maneja en el callback. Si no se proporciona un callback , devuelve una Promise que resuelve con el texto de la respuesta o rechaza con un error. Ejemplos de uso Moderniza tu c\u00f3digo Aunque soportan callbacks, recomendamos fuertemente usar la sintaxis async/await para un c\u00f3digo m\u00e1s limpio y legible, evitando el \"callback hell\". Uso b\u00e1sico con Promesas (Async/Await): try { const respuestaTexto = await getValue ( \"controller/metodo\" , { id : 123 }); console . log ( \"Respuesta del servidor:\" , respuestaTexto ); } catch ( error ) { console . error ( \"Hubo un error:\" , error ); } Uso con Callback: getValue ( \"controller/metodo\" , { usuario : \"juan\" }, function ( response , error ) { if ( error ) { console . error ( \"Error:\" , error ); } else { console . log ( \"Respuesta:\" , response ); } }); Configuraci\u00f3n de timeout y reintentos: const params = { dato : \"valor\" , timeout : 5000 , // Esperar m\u00e1ximo 5 segundos retryAttempts : 3 , // Reintentar hasta 3 veces si falla }; try { const res = await getValue ( \"api/data\" , params ); } catch ( e ) { console . error ( \"Fall\u00f3 tras 3 intentos\" ); } getObject(purl, pparameters, callbackfunction) Es una funci\u00f3n envolvente (wrapper) de getValue . Realiza la petici\u00f3n y autom\u00e1ticamente intenta parsear la respuesta como un objeto JSON. Par\u00e1metros purl (string): La URL a la que se realizar\u00e1 la petici\u00f3n. pparameters (object): Objeto con los par\u00e1metros a enviar. callbackfunction (function, opcional): Funci\u00f3n de callback que recibe (objeto, error) . objeto : El resultado parseado como JSON si todo sali\u00f3 bien (o null si hubo error). error : Objeto de error si la petici\u00f3n fall\u00f3 o el JSON no es v\u00e1lido (o null si todo sali\u00f3 bien). Retorno Si se usa callbackfunction , no retorna nada expl\u00edcito. Si no se usa callbackfunction , devuelve una Promise que resuelve con el objeto JavaScript parseado o rechaza con el error. Ejemplos de uso Uso b\u00e1sico para obtener datos JSON: // Supongamos que el servidor devuelve: {\"nombre\": \"Ragnos\", \"version\": 1.0} try { const data = await getObject ( \"api/config\" , { modulo : \"admin\" }); console . log ( \"Nombre del sistema:\" , data . nombre ); } catch ( error ) { console . error ( \"Error obteniendo configuraci\u00f3n:\" , error ); } Uso con Callback: getObject ( \"clientes/buscar\" , { q : \"Empresa X\" }, function ( clientes , error ) { if ( error ) { alert ( \"Error en la b\u00fasqueda\" ); return ; } // 'clientes' ya es un array u objeto JS clientes . forEach (( c ) => console . log ( c . nombre )); }); RagnosSearch y Clases relacionadas La clase RagnosSearch y sus m\u00e9todos auxiliares proporcionan una interfaz estandarizada para realizar b\u00fasquedas en inputs, integrando interfaz gr\u00e1fica (botones) y manejo de resultados. RagnosSearch.setupSimpleSearch(elemento, ruta, params, callback) M\u00e9todo est\u00e1tico para configurar una b\u00fasqueda sencilla en un input existente. Transforma el input agregando botones de b\u00fasqueda y limpieza. Par\u00e1metros elemento (jQuery Selector | DOM Element): El input donde se habilitar\u00e1 la b\u00fasqueda. ruta (string): La URL del servidor (Controlador/M\u00e9todo) que procesar\u00e1 la b\u00fasqueda. params (object): Configuraci\u00f3n adicional. canSetToNull (boolean): Define si se muestra el bot\u00f3n \"X\" para limpiar el campo (Default: true ). callback (function): Funci\u00f3n a ejecutar tras una b\u00fasqueda exitosa. Recibe el objeto jQuery del input como argumento e . Retorno No retorna valor. Modifica el DOM del input. Ejemplo de uso RagnosSearch . setupSimpleSearch ( $ ( \"#miInput\" ), \"admin/usuarios/buscar\" , {}, function ( e ) { // Los datos del resultado se adjuntan al objeto jQuery en 'searchdata' let resultado = e . data ( \"searchdata\" ); if ( resultado ) { console . log ( \"ID seleccionado:\" , resultado . id ); console . log ( \"Nombre:\" , resultado . nombre ); // Asignar valor al input visible e . val ( resultado . nombre ); } } ); $(selector).RagnosSearch(params) Plugin de jQuery que instancia la clase RagnosSearch . Est\u00e1 dise\u00f1ado para b\u00fasquedas m\u00e1s complejas, t\u00edpicamente vinculadas a un controlador est\u00e1ndar del sistema ( RagnosController ) que implementa searchByAjax y soporta filtros estructurados. Par\u00e1metros ( params ) Objeto de configuraci\u00f3n con: controller (string): Nombre del controlador que gestiona la b\u00fasqueda (ej. 'usuarios' , 'productos' ). El sistema buscar\u00e1 en controller/searchByAjax . filter (string): Cadena en Base64 que contiene un array JSON de filtros. Estructura: Base64( JSON_String([ {field, op, value}, ... ]) ) . callback (function): Funci\u00f3n a ejecutar al seleccionar un resultado. canSetToNull (boolean): (Opcional) Permite limpiar el campo. Ejemplo de uso $ ( \"#inputBusquedaAvanzada\" ). RagnosSearch ({ controller : \"usuarios\" , // Busca en: usuarios/searchByAjax // Filtro: Usuarios activos (usu_activo = 'S') y del grupo 2 filter : btoa ( JSON . stringify ([ { field : \"usu_activo\" , op : \"=\" , value : \"S\" }, { field : \"usu_grupo\" , op : \"=\" , value : 2 }, ]) ), callback : function ( e ) { let datos = e . data ( \"searchdata\" ); console . log ( \"Datos recibidos:\" , datos ); if ( datos && datos . id ) { // L\u00f3gica personalizada } }, }); Hooks de Sistema y Funciones en custom.js El archivo custom.js es el lugar designado para l\u00f3gica espec\u00edfica de la aplicaci\u00f3n, incluyendo \"hooks\" (ganchos) que el sistema invoca autom\u00e1ticamente bas\u00e1ndose en convenciones de nombres. Esto permite extender la funcionalidad de b\u00fasquedas y tablas sin modificar el n\u00facleo. Convenci\u00f3n de Nombres para Hooks El sistema detecta autom\u00e1ticamente funciones globales con patrones espec\u00edficos de nombre para ejecutar acciones tras ciertos eventos. 1. Hooks de B\u00fasqueda ( _NombreCampoOnSearch ) Se ejecutan autom\u00e1ticamente despu\u00e9s de que un control RagnosSearch completa una selecci\u00f3n. Patr\u00f3n: _{id_del_input}OnSearch Par\u00e1metro: Recibe el objeto jQuery del control (input). Uso: Ideal para rellenar otros campos del formulario bas\u00e1ndose en el resultado de la b\u00fasqueda. Ejemplo del sistema ( _productCodeOnSearch ): Cuando se selecciona un producto en el input productCode , esta funci\u00f3n busca el input priceEach en el detalle de la orden y le asigna el precio sugerido (MSRP). // Se activa al seleccionar algo en <input id=\"productCode\" ...> function _productCodeOnSearch ( control ) { // 'control' es el input del c\u00f3digo de producto // Accedemos a los datos devueltos por la b\u00fasqueda con .data(\"searchdata\") let datos = control . data ( \"searchdata\" ); // Actualizamos otro campo (Precio Unitario) con el valor MSRP del producto $ ( '#detalleorden input[name=\"priceEach\"]' ). val ( datos . MSRP ); } 2. Hooks de Cambio en Tabla ( _NombreTablaOnChange ) Se ejecutan cuando ocurre un cambio en una tabla gestionada (por ejemplo, al agregar o editar filas en una tabla detalle). Patr\u00f3n: _{id_de_la_tabla}OnChange Par\u00e1metro: Recibe el objeto tabla o el contexto del cambio. Uso: Rec\u00e1lculos de totales, validaciones cruzadas. Ejemplo del sistema ( _OrdenesdetallesOnChange ): Cada vez que cambia algo en la tabla de detalles de \u00f3rdenes ( Ordenesdetalles ), se recalcula el total de la orden completa llamando al servidor. // Se activa al modificar la tabla <table id=\"Ordenesdetalles\" ...> function _OrdenesdetallesOnChange ( tabla ) { // Obtenemos el ID de la orden actual let orden = $ ( \"input[name='orderNumber']\" ). val (); // Llamamos al servidor para recalcular el total getObject ( \"tienda/ordenes/calculatotal\" , { orden : orden }, function ( data ) { // Actualizamos el campo visual de Total $ ( 'input[name=\"total\"]' ). val ( data . total ); }); } Funciones Utilitarias Personalizadas Tambi\u00e9n se pueden definir funciones normales para ser usadas como callbacks expl\u00edcitos en configuraciones de b\u00fasqueda. Ejemplo ( pruebaBusquedaOffice ): Una funci\u00f3n simple dise\u00f1ada para ser pasada como par\u00e1metro callback en RagnosSearch . function pruebaBusquedaOffice ( e ) { let datos = e . data ( \"searchdata\" ); console . log ( \"Los datos de la busqueda por oficina\" , datos ); } // Uso: // $('#oficina').RagnosSearch({ ..., callback: pruebaBusquedaOffice });","title":"Funciones JavaScript"},{"location":"frontend/funciones_javascript/#funciones-javascript-getvalue-y-getobject","text":"Este documento describe las funciones utilitarias getValue y getObject , utilizadas en el proyecto para realizar peticiones as\u00edncronas al servidor. Estas funciones simplifican el uso de fetch y manejan la serializaci\u00f3n de par\u00e1metros, tiempos de espera y reintentos.","title":"\u26a1 Funciones JavaScript: getValue y getObject"},{"location":"frontend/funciones_javascript/#getvalueurl-params-callback","text":"Realiza una petici\u00f3n HTTP POST a una URL especificada y devuelve la respuesta como texto plano.","title":"getValue(url, params, callback)"},{"location":"frontend/funciones_javascript/#parametros","text":"url (string): La URL a la que se realizar\u00e1 la petici\u00f3n. Se procesa internamente con fixUrl , por lo que puede ser una ruta relativa. params (object, opcional): Un objeto con los par\u00e1metros que se enviar\u00e1n en el cuerpo de la petici\u00f3n (codificados como application/x-www-form-urlencoded ). Adem\u00e1s de los datos a enviar, este objeto acepta configuraciones especiales: timeout (number): Tiempo m\u00e1ximo de espera en milisegundos (por defecto: 12000). retryAttempts (number): N\u00famero de intentos en caso de fallo (por defecto: 1). retryDelay (number): Retardo entre intentos en milisegundos (por defecto: 1000). callback (function, opcional): Una funci\u00f3n que se ejecutar\u00e1 al completar la petici\u00f3n. Recibe dos argumentos: (response, error) .","title":"Par\u00e1metros"},{"location":"frontend/funciones_javascript/#retorno","text":"Si se proporciona un callback , la funci\u00f3n no retorna nada y el resultado se maneja en el callback. Si no se proporciona un callback , devuelve una Promise que resuelve con el texto de la respuesta o rechaza con un error.","title":"Retorno"},{"location":"frontend/funciones_javascript/#ejemplos-de-uso","text":"Moderniza tu c\u00f3digo Aunque soportan callbacks, recomendamos fuertemente usar la sintaxis async/await para un c\u00f3digo m\u00e1s limpio y legible, evitando el \"callback hell\". Uso b\u00e1sico con Promesas (Async/Await): try { const respuestaTexto = await getValue ( \"controller/metodo\" , { id : 123 }); console . log ( \"Respuesta del servidor:\" , respuestaTexto ); } catch ( error ) { console . error ( \"Hubo un error:\" , error ); } Uso con Callback: getValue ( \"controller/metodo\" , { usuario : \"juan\" }, function ( response , error ) { if ( error ) { console . error ( \"Error:\" , error ); } else { console . log ( \"Respuesta:\" , response ); } }); Configuraci\u00f3n de timeout y reintentos: const params = { dato : \"valor\" , timeout : 5000 , // Esperar m\u00e1ximo 5 segundos retryAttempts : 3 , // Reintentar hasta 3 veces si falla }; try { const res = await getValue ( \"api/data\" , params ); } catch ( e ) { console . error ( \"Fall\u00f3 tras 3 intentos\" ); }","title":"Ejemplos de uso"},{"location":"frontend/funciones_javascript/#getobjectpurl-pparameters-callbackfunction","text":"Es una funci\u00f3n envolvente (wrapper) de getValue . Realiza la petici\u00f3n y autom\u00e1ticamente intenta parsear la respuesta como un objeto JSON.","title":"getObject(purl, pparameters, callbackfunction)"},{"location":"frontend/funciones_javascript/#parametros_1","text":"purl (string): La URL a la que se realizar\u00e1 la petici\u00f3n. pparameters (object): Objeto con los par\u00e1metros a enviar. callbackfunction (function, opcional): Funci\u00f3n de callback que recibe (objeto, error) . objeto : El resultado parseado como JSON si todo sali\u00f3 bien (o null si hubo error). error : Objeto de error si la petici\u00f3n fall\u00f3 o el JSON no es v\u00e1lido (o null si todo sali\u00f3 bien).","title":"Par\u00e1metros"},{"location":"frontend/funciones_javascript/#retorno_1","text":"Si se usa callbackfunction , no retorna nada expl\u00edcito. Si no se usa callbackfunction , devuelve una Promise que resuelve con el objeto JavaScript parseado o rechaza con el error.","title":"Retorno"},{"location":"frontend/funciones_javascript/#ejemplos-de-uso_1","text":"Uso b\u00e1sico para obtener datos JSON: // Supongamos que el servidor devuelve: {\"nombre\": \"Ragnos\", \"version\": 1.0} try { const data = await getObject ( \"api/config\" , { modulo : \"admin\" }); console . log ( \"Nombre del sistema:\" , data . nombre ); } catch ( error ) { console . error ( \"Error obteniendo configuraci\u00f3n:\" , error ); } Uso con Callback: getObject ( \"clientes/buscar\" , { q : \"Empresa X\" }, function ( clientes , error ) { if ( error ) { alert ( \"Error en la b\u00fasqueda\" ); return ; } // 'clientes' ya es un array u objeto JS clientes . forEach (( c ) => console . log ( c . nombre )); });","title":"Ejemplos de uso"},{"location":"frontend/funciones_javascript/#ragnossearch-y-clases-relacionadas","text":"La clase RagnosSearch y sus m\u00e9todos auxiliares proporcionan una interfaz estandarizada para realizar b\u00fasquedas en inputs, integrando interfaz gr\u00e1fica (botones) y manejo de resultados.","title":"RagnosSearch y Clases relacionadas"},{"location":"frontend/funciones_javascript/#ragnossearchsetupsimplesearchelemento-ruta-params-callback","text":"M\u00e9todo est\u00e1tico para configurar una b\u00fasqueda sencilla en un input existente. Transforma el input agregando botones de b\u00fasqueda y limpieza.","title":"RagnosSearch.setupSimpleSearch(elemento, ruta, params, callback)"},{"location":"frontend/funciones_javascript/#parametros_2","text":"elemento (jQuery Selector | DOM Element): El input donde se habilitar\u00e1 la b\u00fasqueda. ruta (string): La URL del servidor (Controlador/M\u00e9todo) que procesar\u00e1 la b\u00fasqueda. params (object): Configuraci\u00f3n adicional. canSetToNull (boolean): Define si se muestra el bot\u00f3n \"X\" para limpiar el campo (Default: true ). callback (function): Funci\u00f3n a ejecutar tras una b\u00fasqueda exitosa. Recibe el objeto jQuery del input como argumento e .","title":"Par\u00e1metros"},{"location":"frontend/funciones_javascript/#retorno_2","text":"No retorna valor. Modifica el DOM del input.","title":"Retorno"},{"location":"frontend/funciones_javascript/#ejemplo-de-uso","text":"RagnosSearch . setupSimpleSearch ( $ ( \"#miInput\" ), \"admin/usuarios/buscar\" , {}, function ( e ) { // Los datos del resultado se adjuntan al objeto jQuery en 'searchdata' let resultado = e . data ( \"searchdata\" ); if ( resultado ) { console . log ( \"ID seleccionado:\" , resultado . id ); console . log ( \"Nombre:\" , resultado . nombre ); // Asignar valor al input visible e . val ( resultado . nombre ); } } );","title":"Ejemplo de uso"},{"location":"frontend/funciones_javascript/#selectorragnossearchparams","text":"Plugin de jQuery que instancia la clase RagnosSearch . Est\u00e1 dise\u00f1ado para b\u00fasquedas m\u00e1s complejas, t\u00edpicamente vinculadas a un controlador est\u00e1ndar del sistema ( RagnosController ) que implementa searchByAjax y soporta filtros estructurados.","title":"$(selector).RagnosSearch(params)"},{"location":"frontend/funciones_javascript/#parametros-params","text":"Objeto de configuraci\u00f3n con: controller (string): Nombre del controlador que gestiona la b\u00fasqueda (ej. 'usuarios' , 'productos' ). El sistema buscar\u00e1 en controller/searchByAjax . filter (string): Cadena en Base64 que contiene un array JSON de filtros. Estructura: Base64( JSON_String([ {field, op, value}, ... ]) ) . callback (function): Funci\u00f3n a ejecutar al seleccionar un resultado. canSetToNull (boolean): (Opcional) Permite limpiar el campo.","title":"Par\u00e1metros (params)"},{"location":"frontend/funciones_javascript/#ejemplo-de-uso_1","text":"$ ( \"#inputBusquedaAvanzada\" ). RagnosSearch ({ controller : \"usuarios\" , // Busca en: usuarios/searchByAjax // Filtro: Usuarios activos (usu_activo = 'S') y del grupo 2 filter : btoa ( JSON . stringify ([ { field : \"usu_activo\" , op : \"=\" , value : \"S\" }, { field : \"usu_grupo\" , op : \"=\" , value : 2 }, ]) ), callback : function ( e ) { let datos = e . data ( \"searchdata\" ); console . log ( \"Datos recibidos:\" , datos ); if ( datos && datos . id ) { // L\u00f3gica personalizada } }, });","title":"Ejemplo de uso"},{"location":"frontend/funciones_javascript/#hooks-de-sistema-y-funciones-en-customjs","text":"El archivo custom.js es el lugar designado para l\u00f3gica espec\u00edfica de la aplicaci\u00f3n, incluyendo \"hooks\" (ganchos) que el sistema invoca autom\u00e1ticamente bas\u00e1ndose en convenciones de nombres. Esto permite extender la funcionalidad de b\u00fasquedas y tablas sin modificar el n\u00facleo.","title":"Hooks de Sistema y Funciones en custom.js"},{"location":"frontend/funciones_javascript/#convencion-de-nombres-para-hooks","text":"El sistema detecta autom\u00e1ticamente funciones globales con patrones espec\u00edficos de nombre para ejecutar acciones tras ciertos eventos.","title":"Convenci\u00f3n de Nombres para Hooks"},{"location":"frontend/funciones_javascript/#1-hooks-de-busqueda-_nombrecampoonsearch","text":"Se ejecutan autom\u00e1ticamente despu\u00e9s de que un control RagnosSearch completa una selecci\u00f3n. Patr\u00f3n: _{id_del_input}OnSearch Par\u00e1metro: Recibe el objeto jQuery del control (input). Uso: Ideal para rellenar otros campos del formulario bas\u00e1ndose en el resultado de la b\u00fasqueda. Ejemplo del sistema ( _productCodeOnSearch ): Cuando se selecciona un producto en el input productCode , esta funci\u00f3n busca el input priceEach en el detalle de la orden y le asigna el precio sugerido (MSRP). // Se activa al seleccionar algo en <input id=\"productCode\" ...> function _productCodeOnSearch ( control ) { // 'control' es el input del c\u00f3digo de producto // Accedemos a los datos devueltos por la b\u00fasqueda con .data(\"searchdata\") let datos = control . data ( \"searchdata\" ); // Actualizamos otro campo (Precio Unitario) con el valor MSRP del producto $ ( '#detalleorden input[name=\"priceEach\"]' ). val ( datos . MSRP ); }","title":"1. Hooks de B\u00fasqueda (_NombreCampoOnSearch)"},{"location":"frontend/funciones_javascript/#2-hooks-de-cambio-en-tabla-_nombretablaonchange","text":"Se ejecutan cuando ocurre un cambio en una tabla gestionada (por ejemplo, al agregar o editar filas en una tabla detalle). Patr\u00f3n: _{id_de_la_tabla}OnChange Par\u00e1metro: Recibe el objeto tabla o el contexto del cambio. Uso: Rec\u00e1lculos de totales, validaciones cruzadas. Ejemplo del sistema ( _OrdenesdetallesOnChange ): Cada vez que cambia algo en la tabla de detalles de \u00f3rdenes ( Ordenesdetalles ), se recalcula el total de la orden completa llamando al servidor. // Se activa al modificar la tabla <table id=\"Ordenesdetalles\" ...> function _OrdenesdetallesOnChange ( tabla ) { // Obtenemos el ID de la orden actual let orden = $ ( \"input[name='orderNumber']\" ). val (); // Llamamos al servidor para recalcular el total getObject ( \"tienda/ordenes/calculatotal\" , { orden : orden }, function ( data ) { // Actualizamos el campo visual de Total $ ( 'input[name=\"total\"]' ). val ( data . total ); }); }","title":"2. Hooks de Cambio en Tabla (_NombreTablaOnChange)"},{"location":"frontend/funciones_javascript/#funciones-utilitarias-personalizadas","text":"Tambi\u00e9n se pueden definir funciones normales para ser usadas como callbacks expl\u00edcitos en configuraciones de b\u00fasqueda. Ejemplo ( pruebaBusquedaOffice ): Una funci\u00f3n simple dise\u00f1ada para ser pasada como par\u00e1metro callback en RagnosSearch . function pruebaBusquedaOffice ( e ) { let datos = e . data ( \"searchdata\" ); console . log ( \"Los datos de la busqueda por oficina\" , datos ); } // Uso: // $('#oficina').RagnosSearch({ ..., callback: pruebaBusquedaOffice });","title":"Funciones Utilitarias Personalizadas"},{"location":"frontend/personalizacion_ui/","text":"Personalizaci\u00f3n de la Interfaz (UI) Ragnos utiliza AdminLTE 3 como base para su interfaz, integrado con el sistema de vistas de CodeIgniter 4. Aqu\u00ed te explicamos c\u00f3mo personalizar los elementos comunes como el men\u00fa lateral, el logotipo y la barra superior. Men\u00fa Lateral (Sidebar) El men\u00fa principal de la aplicaci\u00f3n se encuentra en una vista est\u00e1tica. Para agregar, quitar o reorganizar enlaces, debes editar el archivo: \ud83d\udcc2 app/Views/template/sidebar.php Estructura del Men\u00fa El men\u00fa utiliza una lista HTML est\u00e1ndar con clases de Bootstrap/AdminLTE. Iconos Disponibles Ragnos incluye la librer\u00eda Bootstrap Icons . Puedes navegar por la galer\u00eda oficial de iconos para encontrar los c\u00f3digos de clase (ej. bi-shop , bi-gear ). Ejemplo de c\u00f3mo agregar un enlace simple: <li class=\"nav-item\"> <a href=\" <? = site_url ( 'proceso/tareas' ) ?> \" class=\"nav-link\"> <i class=\"bi bi-check-square nav-icon\"></i> <p>Mis Tareas</p> </a> </li> Ejemplo de un submen\u00fa desplegable: <li class=\"nav-item\"> <a class=\"nav-link\"> <i class=\"bi bi-shop\"></i> <p> Tienda <i class=\"nav-arrow bi bi-chevron-right\"></i> </p> </a> <ul class=\"nav nav-treeview\"> <li class=\"nav-item\"> <a href=\" <? = site_url ( 'tienda/productos' ) ?> \" class=\"nav-link\"> <i class=\"bi bi-box nav-icon\"></i> <p>Productos</p> </a> </li> </ul> </li> Control de Acceso en el Men\u00fa Puedes mostrar u ocultar elementos del men\u00fa seg\u00fan el rol del usuario logueado utilizando el servicio Admin_aut . <?php // Obtener el servicio de autenticaci\u00f3n al inicio del archivo $auth = service ( 'Admin_aut' ); ?> <!-- ... en el men\u00fa ... --> <?php if ( $auth -> isUserInGroup ( 'administrador' )) : ?> <li class=\"nav-item\"> <a href=\" <? = site_url ( 'usuarios' ) ?> \" class=\"nav-link\"> ... </a> </li> <?php endif ; ?> Personalizaci\u00f3n del Logotipo y T\u00edtulo T\u00edtulo de la Aplicaci\u00f3n El nombre que aparece junto al logo se configura globalmente en app/Config/RagnosConfig.php : public $Ragnos_application_title = 'Mi Empresa'; Logotipo El logo se imprime en la parte superior del archivo sidebar.php : <div class=\"sidebar-brand\"> <a href=\" <? = site_url () ?> \" class=\"brand-link\"> <!-- Puedes cambiar este span por una etiqueta img --> <span class=\"brand-text font-weight-light\"> <? = Ragnos :: config () -> Ragnos_application_title ; ?> </span> </a> </div> Para usar una imagen: <img src=\" <? = base_url ( 'content/img/mi-logo.png' ) ?> \" alt=\"Logo\" class=\"brand-image img-circle elevation-3\" style=\"opacity: .8\"> Barra Superior (Topbar) La barra superior se encuentra en: \ud83d\udcc2 app/Views/template/topbar.php Aqu\u00ed puedes modificar los enlaces de la derecha (perfil, notificaciones) o agregar buscadores globales.","title":"Personalizaci\u00f3n UI"},{"location":"frontend/personalizacion_ui/#personalizacion-de-la-interfaz-ui","text":"Ragnos utiliza AdminLTE 3 como base para su interfaz, integrado con el sistema de vistas de CodeIgniter 4. Aqu\u00ed te explicamos c\u00f3mo personalizar los elementos comunes como el men\u00fa lateral, el logotipo y la barra superior.","title":"Personalizaci\u00f3n de la Interfaz (UI)"},{"location":"frontend/personalizacion_ui/#menu-lateral-sidebar","text":"El men\u00fa principal de la aplicaci\u00f3n se encuentra en una vista est\u00e1tica. Para agregar, quitar o reorganizar enlaces, debes editar el archivo: \ud83d\udcc2 app/Views/template/sidebar.php","title":"Men\u00fa Lateral (Sidebar)"},{"location":"frontend/personalizacion_ui/#estructura-del-menu","text":"El men\u00fa utiliza una lista HTML est\u00e1ndar con clases de Bootstrap/AdminLTE. Iconos Disponibles Ragnos incluye la librer\u00eda Bootstrap Icons . Puedes navegar por la galer\u00eda oficial de iconos para encontrar los c\u00f3digos de clase (ej. bi-shop , bi-gear ). Ejemplo de c\u00f3mo agregar un enlace simple: <li class=\"nav-item\"> <a href=\" <? = site_url ( 'proceso/tareas' ) ?> \" class=\"nav-link\"> <i class=\"bi bi-check-square nav-icon\"></i> <p>Mis Tareas</p> </a> </li> Ejemplo de un submen\u00fa desplegable: <li class=\"nav-item\"> <a class=\"nav-link\"> <i class=\"bi bi-shop\"></i> <p> Tienda <i class=\"nav-arrow bi bi-chevron-right\"></i> </p> </a> <ul class=\"nav nav-treeview\"> <li class=\"nav-item\"> <a href=\" <? = site_url ( 'tienda/productos' ) ?> \" class=\"nav-link\"> <i class=\"bi bi-box nav-icon\"></i> <p>Productos</p> </a> </li> </ul> </li>","title":"Estructura del Men\u00fa"},{"location":"frontend/personalizacion_ui/#control-de-acceso-en-el-menu","text":"Puedes mostrar u ocultar elementos del men\u00fa seg\u00fan el rol del usuario logueado utilizando el servicio Admin_aut . <?php // Obtener el servicio de autenticaci\u00f3n al inicio del archivo $auth = service ( 'Admin_aut' ); ?> <!-- ... en el men\u00fa ... --> <?php if ( $auth -> isUserInGroup ( 'administrador' )) : ?> <li class=\"nav-item\"> <a href=\" <? = site_url ( 'usuarios' ) ?> \" class=\"nav-link\"> ... </a> </li> <?php endif ; ?>","title":"Control de Acceso en el Men\u00fa"},{"location":"frontend/personalizacion_ui/#personalizacion-del-logotipo-y-titulo","text":"","title":"Personalizaci\u00f3n del Logotipo y T\u00edtulo"},{"location":"frontend/personalizacion_ui/#titulo-de-la-aplicacion","text":"El nombre que aparece junto al logo se configura globalmente en app/Config/RagnosConfig.php : public $Ragnos_application_title = 'Mi Empresa';","title":"T\u00edtulo de la Aplicaci\u00f3n"},{"location":"frontend/personalizacion_ui/#logotipo","text":"El logo se imprime en la parte superior del archivo sidebar.php : <div class=\"sidebar-brand\"> <a href=\" <? = site_url () ?> \" class=\"brand-link\"> <!-- Puedes cambiar este span por una etiqueta img --> <span class=\"brand-text font-weight-light\"> <? = Ragnos :: config () -> Ragnos_application_title ; ?> </span> </a> </div> Para usar una imagen: <img src=\" <? = base_url ( 'content/img/mi-logo.png' ) ?> \" alt=\"Logo\" class=\"brand-image img-circle elevation-3\" style=\"opacity: .8\">","title":"Logotipo"},{"location":"frontend/personalizacion_ui/#barra-superior-topbar","text":"La barra superior se encuentra en: \ud83d\udcc2 app/Views/template/topbar.php Aqu\u00ed puedes modificar los enlaces de la derecha (perfil, notificaciones) o agregar buscadores globales.","title":"Barra Superior (Topbar)"},{"location":"frontend/reportes_simples/","text":"\ud83d\udcca Generaci\u00f3n de Reportes Simples (RSimpleLevelReport) La clase RSimpleLevelReport permite generar reportes en formato de tabla HTML de manera r\u00e1pida y estructurada a partir de un array de datos. Es ideal para mostrar listados, res\u00famenes financieros o cualquier conjunto de datos que requiera una presentaci\u00f3n tabular, con soporte para agrupaci\u00f3n por niveles (cortes de control). Caracter\u00edsticas Principales Generaci\u00f3n autom\u00e1tica de tablas HTML con dise\u00f1o profesional. Soporte para m\u00faltiples niveles de agrupaci\u00f3n (encabezados por grupo). C\u00e1lculo autom\u00e1tico de totales de registros. Detecci\u00f3n y c\u00e1lculo de sumas en columnas num\u00e9ricas (subtotales y totales generales). F\u00e1cil integraci\u00f3n con vistas de Ragnos. Flujo B\u00e1sico de Uso Obtener los datos (generalmente desde un Modelo). Instanciar App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport . Configurar el reporte usando quickSetup . Renderizar el reporte y pasarlo a la vista. API de la Clase quickSetup($title, $data, $listfields, $groups = [], $desc_filter = '') Configura los par\u00e1metros principales del reporte de una sola vez. $title (string): El t\u00edtulo principal del reporte. $data (array): El conjunto de datos (array de arrays asociativos). $listfields (array): Lista de campos a mostrar. Si es un array simple ['Campo1', 'Campo2'] , se buscar\u00e1n esas claves en $data . Se recomienda que los nombres coincidan con las claves del array de datos. $groups (array): (Opcional) Configuraci\u00f3n de agrupamiento. Formato: ['campo_agrupador' => ['label' => 'Etiqueta del Grupo']] . $desc_filter (string): (Opcional) Subt\u00edtulo o descripci\u00f3n de filtros aplicados. setShowTotals(bool $showTotals) Habilita o deshabilita la visualizaci\u00f3n de los totales (conteo de registros y sumas financieras) al final de cada grupo y al final del reporte (por defecto true ). setSummableFields(array $fields) Define expl\u00edcitamente qu\u00e9 campos deben ser sumados matem\u00e1ticamente en los pies de tabla. $fields (array): Lista de nombres de campos (etiquetas) que contienen valores num\u00e9ricos. Nota: Si no se utiliza este m\u00e9todo, la clase intentar\u00e1 detectar autom\u00e1ticamente campos sumables buscando nombres como 'Total', 'Precio', 'Saldo', 'Deuda', etc. render($rutadevuelta = 'admin/index') Retorna el HTML del reporte renderizado dentro de la vista est\u00e1ndar de reportes. \u00datil para incrustar en layouts existentes. generate() Retorna solo el HTML de la tabla y los encabezados, sin envoltorio de vista completa. \u00datil para inyecciones AJAX o vistas personalizadas. Ejemplos de Implementaci\u00f3n 1. Reporte Simple (Listado Plano) Este ejemplo muestra un listado de ventas mensuales sin agrupaci\u00f3n. <?php namespace App\\Controllers\\Tienda ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; use App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport ; class Reportes extends BaseController { public function ventaspormes () { // 1. Obtener datos $model = new \\App\\Models\\Dashboard (); $datos = $model -> ventasultimos12meses (); // Estructura esperada de $datos: // [['Mes' => 'Enero', 'Total' => 1000], ['Mes' => 'Febrero', 'Total' => 1500], ...] // 2. Formatear datos (opcional pero recomendado) foreach ( $datos as $key => $value ) { $datos [ $key ][ 'Total' ] = '$ ' . number_format ( $value [ 'Total' ], 2 ); } // 3. Configurar Reporte $reporte = new RSimpleLevelReport (); $reporte -> setShowTotals ( false ); // Ocultar conteo de registros xq es irrelevante aqu\u00ed // quickSetup(T\u00edtulo, Datos, Columnas a mostrar) $reporte -> quickSetup ( 'Ventas por Mes' , $datos , [ 'Mes' , 'Total' ]); // 4. Renderizar $contenido = $reporte -> render (); return view ( 'admin/reporte_view' , [ 'contenido' => $contenido ]); } } 2. Reporte Agrupado (Corte de Control) Este ejemplo genera un listado de productos agrupados por Categor\u00eda . Cada vez que cambia la categor\u00eda, se genera un nuevo encabezado. Requisito Importante : Para que la agrupaci\u00f3n funcione correctamente, los datos de entrada deben estar ordenados por el campo de agrupaci\u00f3n. <?php namespace App\\Controllers\\Tienda ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; use App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport ; class Productos extends BaseController { public function listadoPorCategoria () { // 1. Obtener datos (\u00a1Ordenados por categor\u00eda!) $data = [ [ 'categoria' => 'Electr\u00f3nica' , 'producto' => 'Televisor' , 'precio' => 500 ], [ 'categoria' => 'Electr\u00f3nica' , 'producto' => 'Radio' , 'precio' => 50 ], [ 'categoria' => 'Hogar' , 'producto' => 'Silla' , 'precio' => 25 ], [ 'categoria' => 'Hogar' , 'producto' => 'Mesa' , 'precio' => 100 ], ]; $reporte = new RSimpleLevelReport (); // 2. Definir Agrupaci\u00f3n // La clave 'categoria' debe existir en $data. $grupos = [ 'categoria' => [ 'label' => 'Categor\u00eda de Producto' ] ]; // 3. Configurar $reporte -> quickSetup ( 'Listado de Productos' , $data , [ 'producto' , 'precio' ], // Campos a mostrar en las columnas $grupos , // Configuraci\u00f3n de grupos 'Filtro: Todos los productos activos' // Subt\u00edtulo opcional ); return view ( 'admin/reporte_view' , [ 'contenido' => $reporte -> render ()]); } } 3. Reporte Multi-Nivel Es posible agrupar por m\u00faltiples niveles (ej: Pa\u00eds -> Estado -> Ciudad). $grupos = [ 'pais' => ['label' => 'Pa\u00eds'], 'estado' => ['label' => 'Estado/Provincia'] ]; // Los datos deben venir ordenados por pais y luego por estado $reporte->quickSetup('Reporte Geogr\u00e1fico', $data, ['ciudad', 'poblacion'], $grupos); 4. Reporte Financiero con Totales Este ejemplo muestra c\u00f3mo la clase maneja autom\u00e1ticamente las sumas y totales generales. // Datos de ventas $data = [ ['vendedor' => 'Juan', 'venta' => 100.50, 'comision' => 10], ['vendedor' => 'Maria', 'venta' => 200.00, 'comision' => 20], ['vendedor' => 'Pedro', 'venta' => 150.00, 'comision' => 15], ]; $reporte = new RSimpleLevelReport(); $reporte->quickSetup('Reporte de Comisiones', $data, ['vendedor', 'venta', 'comision']); // Opcional: Forzar qu\u00e9 campos sumar (si no se detectan autom\u00e1ticamente) // $reporte->setSummableFields(['venta', 'comision']); // Al renderizar, se generar\u00e1: // - Una tabla con los datos. // - Un pie de tabla \"TOTAL GENERAL\" alineado. // - La columna 'venta' sumar\u00e1 450.50 // - La columna 'comision' sumar\u00e1 45 return $reporte->render(); Aplicaciones Comunes Listados de Inventario : Agrupados por almac\u00e9n o categor\u00eda. Reportes de Ventas : Diarios, mensuales o agrupados por vendedor. Auditor\u00eda : Listados de logs de sistema. Res\u00famenes Financieros : Listados simples de ingresos/egresos formateados.","title":"Reportes Simples"},{"location":"frontend/reportes_simples/#generacion-de-reportes-simples-rsimplelevelreport","text":"La clase RSimpleLevelReport permite generar reportes en formato de tabla HTML de manera r\u00e1pida y estructurada a partir de un array de datos. Es ideal para mostrar listados, res\u00famenes financieros o cualquier conjunto de datos que requiera una presentaci\u00f3n tabular, con soporte para agrupaci\u00f3n por niveles (cortes de control).","title":"\ud83d\udcca Generaci\u00f3n de Reportes Simples (RSimpleLevelReport)"},{"location":"frontend/reportes_simples/#caracteristicas-principales","text":"Generaci\u00f3n autom\u00e1tica de tablas HTML con dise\u00f1o profesional. Soporte para m\u00faltiples niveles de agrupaci\u00f3n (encabezados por grupo). C\u00e1lculo autom\u00e1tico de totales de registros. Detecci\u00f3n y c\u00e1lculo de sumas en columnas num\u00e9ricas (subtotales y totales generales). F\u00e1cil integraci\u00f3n con vistas de Ragnos.","title":"Caracter\u00edsticas Principales"},{"location":"frontend/reportes_simples/#flujo-basico-de-uso","text":"Obtener los datos (generalmente desde un Modelo). Instanciar App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport . Configurar el reporte usando quickSetup . Renderizar el reporte y pasarlo a la vista.","title":"Flujo B\u00e1sico de Uso"},{"location":"frontend/reportes_simples/#api-de-la-clase","text":"","title":"API de la Clase"},{"location":"frontend/reportes_simples/#quicksetuptitle-data-listfields-groups-desc_filter","text":"Configura los par\u00e1metros principales del reporte de una sola vez. $title (string): El t\u00edtulo principal del reporte. $data (array): El conjunto de datos (array de arrays asociativos). $listfields (array): Lista de campos a mostrar. Si es un array simple ['Campo1', 'Campo2'] , se buscar\u00e1n esas claves en $data . Se recomienda que los nombres coincidan con las claves del array de datos. $groups (array): (Opcional) Configuraci\u00f3n de agrupamiento. Formato: ['campo_agrupador' => ['label' => 'Etiqueta del Grupo']] . $desc_filter (string): (Opcional) Subt\u00edtulo o descripci\u00f3n de filtros aplicados.","title":"quickSetup($title, $data, $listfields, $groups = [], $desc_filter = '')"},{"location":"frontend/reportes_simples/#setshowtotalsbool-showtotals","text":"Habilita o deshabilita la visualizaci\u00f3n de los totales (conteo de registros y sumas financieras) al final de cada grupo y al final del reporte (por defecto true ).","title":"setShowTotals(bool $showTotals)"},{"location":"frontend/reportes_simples/#setsummablefieldsarray-fields","text":"Define expl\u00edcitamente qu\u00e9 campos deben ser sumados matem\u00e1ticamente en los pies de tabla. $fields (array): Lista de nombres de campos (etiquetas) que contienen valores num\u00e9ricos. Nota: Si no se utiliza este m\u00e9todo, la clase intentar\u00e1 detectar autom\u00e1ticamente campos sumables buscando nombres como 'Total', 'Precio', 'Saldo', 'Deuda', etc.","title":"setSummableFields(array $fields)"},{"location":"frontend/reportes_simples/#renderrutadevuelta-adminindex","text":"Retorna el HTML del reporte renderizado dentro de la vista est\u00e1ndar de reportes. \u00datil para incrustar en layouts existentes.","title":"render($rutadevuelta = 'admin/index')"},{"location":"frontend/reportes_simples/#generate","text":"Retorna solo el HTML de la tabla y los encabezados, sin envoltorio de vista completa. \u00datil para inyecciones AJAX o vistas personalizadas.","title":"generate()"},{"location":"frontend/reportes_simples/#ejemplos-de-implementacion","text":"","title":"Ejemplos de Implementaci\u00f3n"},{"location":"frontend/reportes_simples/#1-reporte-simple-listado-plano","text":"Este ejemplo muestra un listado de ventas mensuales sin agrupaci\u00f3n. <?php namespace App\\Controllers\\Tienda ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; use App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport ; class Reportes extends BaseController { public function ventaspormes () { // 1. Obtener datos $model = new \\App\\Models\\Dashboard (); $datos = $model -> ventasultimos12meses (); // Estructura esperada de $datos: // [['Mes' => 'Enero', 'Total' => 1000], ['Mes' => 'Febrero', 'Total' => 1500], ...] // 2. Formatear datos (opcional pero recomendado) foreach ( $datos as $key => $value ) { $datos [ $key ][ 'Total' ] = '$ ' . number_format ( $value [ 'Total' ], 2 ); } // 3. Configurar Reporte $reporte = new RSimpleLevelReport (); $reporte -> setShowTotals ( false ); // Ocultar conteo de registros xq es irrelevante aqu\u00ed // quickSetup(T\u00edtulo, Datos, Columnas a mostrar) $reporte -> quickSetup ( 'Ventas por Mes' , $datos , [ 'Mes' , 'Total' ]); // 4. Renderizar $contenido = $reporte -> render (); return view ( 'admin/reporte_view' , [ 'contenido' => $contenido ]); } }","title":"1. Reporte Simple (Listado Plano)"},{"location":"frontend/reportes_simples/#2-reporte-agrupado-corte-de-control","text":"Este ejemplo genera un listado de productos agrupados por Categor\u00eda . Cada vez que cambia la categor\u00eda, se genera un nuevo encabezado. Requisito Importante : Para que la agrupaci\u00f3n funcione correctamente, los datos de entrada deben estar ordenados por el campo de agrupaci\u00f3n. <?php namespace App\\Controllers\\Tienda ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; use App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport ; class Productos extends BaseController { public function listadoPorCategoria () { // 1. Obtener datos (\u00a1Ordenados por categor\u00eda!) $data = [ [ 'categoria' => 'Electr\u00f3nica' , 'producto' => 'Televisor' , 'precio' => 500 ], [ 'categoria' => 'Electr\u00f3nica' , 'producto' => 'Radio' , 'precio' => 50 ], [ 'categoria' => 'Hogar' , 'producto' => 'Silla' , 'precio' => 25 ], [ 'categoria' => 'Hogar' , 'producto' => 'Mesa' , 'precio' => 100 ], ]; $reporte = new RSimpleLevelReport (); // 2. Definir Agrupaci\u00f3n // La clave 'categoria' debe existir en $data. $grupos = [ 'categoria' => [ 'label' => 'Categor\u00eda de Producto' ] ]; // 3. Configurar $reporte -> quickSetup ( 'Listado de Productos' , $data , [ 'producto' , 'precio' ], // Campos a mostrar en las columnas $grupos , // Configuraci\u00f3n de grupos 'Filtro: Todos los productos activos' // Subt\u00edtulo opcional ); return view ( 'admin/reporte_view' , [ 'contenido' => $reporte -> render ()]); } }","title":"2. Reporte Agrupado (Corte de Control)"},{"location":"frontend/reportes_simples/#3-reporte-multi-nivel","text":"Es posible agrupar por m\u00faltiples niveles (ej: Pa\u00eds -> Estado -> Ciudad). $grupos = [ 'pais' => ['label' => 'Pa\u00eds'], 'estado' => ['label' => 'Estado/Provincia'] ]; // Los datos deben venir ordenados por pais y luego por estado $reporte->quickSetup('Reporte Geogr\u00e1fico', $data, ['ciudad', 'poblacion'], $grupos);","title":"3. Reporte Multi-Nivel"},{"location":"frontend/reportes_simples/#4-reporte-financiero-con-totales","text":"Este ejemplo muestra c\u00f3mo la clase maneja autom\u00e1ticamente las sumas y totales generales. // Datos de ventas $data = [ ['vendedor' => 'Juan', 'venta' => 100.50, 'comision' => 10], ['vendedor' => 'Maria', 'venta' => 200.00, 'comision' => 20], ['vendedor' => 'Pedro', 'venta' => 150.00, 'comision' => 15], ]; $reporte = new RSimpleLevelReport(); $reporte->quickSetup('Reporte de Comisiones', $data, ['vendedor', 'venta', 'comision']); // Opcional: Forzar qu\u00e9 campos sumar (si no se detectan autom\u00e1ticamente) // $reporte->setSummableFields(['venta', 'comision']); // Al renderizar, se generar\u00e1: // - Una tabla con los datos. // - Un pie de tabla \"TOTAL GENERAL\" alineado. // - La columna 'venta' sumar\u00e1 450.50 // - La columna 'comision' sumar\u00e1 45 return $reporte->render();","title":"4. Reporte Financiero con Totales"},{"location":"frontend/reportes_simples/#aplicaciones-comunes","text":"Listados de Inventario : Agrupados por almac\u00e9n o categor\u00eda. Reportes de Ventas : Diarios, mensuales o agrupados por vendedor. Auditor\u00eda : Listados de logs de sistema. Res\u00famenes Financieros : Listados simples de ingresos/egresos formateados.","title":"Aplicaciones Comunes"},{"location":"fundamentos/base_de_datos_demo/","text":"Base de Datos Demo (Classicmodels) Ragnos incluye la base de datos de ejemplo Classicmodels , una implementaci\u00f3n est\u00e1ndar conocida en el mundo del desarrollo para probar funcionalidades de bases de datos relacionales. Esta base de datos modela un negocio de venta de modelos a escala de coches cl\u00e1sicos . Contiene informaci\u00f3n t\u00edpica de un negocio: clientes, productos, pedidos, pagos, empleados y oficinas. \ud83d\udcca Estructura de la Base de Datos La base de datos consta de 8 tablas relacionadas entre s\u00ed. A continuaci\u00f3n se presenta un diagrama Entidad-Relaci\u00f3n (ER) que ilustra la estructura: erDiagram CUSTOMERS ||--o{ ORDERS : realiza CUSTOMERS ||--o{ PAYMENTS : efectua CUSTOMERS }|--|| EMPLOYEES : \"atendido por\" EMPLOYEES ||--|{ EMPLOYEES : \"reporta a\" EMPLOYEES }|--|| OFFICES : \"trabaja en\" ORDERS ||--|{ ORDERDETAILS : contiene PRODUCTS ||--o{ ORDERDETAILS : \"incluido en\" PRODUCTS }|--|| PRODUCTLINES : \"categoria\" CUSTOMERS { int customerNumber PK string customerName string contactLastName string contactFirstName string phone string addressLine1 string city string country int salesRepEmployeeNumber FK decimal creditLimit } EMPLOYEES { int employeeNumber PK string lastName string firstName string email string officeCode FK int reportsTo FK string jobTitle } OFFICES { string officeCode PK string city string phone string addressLine1 string country string territory } ORDERDETAILS { int orderNumber PK,FK string productCode PK,FK int quantityOrdered decimal priceEach } ORDERS { int orderNumber PK date orderDate date shippedDate string status int customerNumber FK } PAYMENTS { int customerNumber PK,FK string checkNumber PK date paymentDate decimal amount } PRODUCTS { string productCode PK string productName string productLine FK string productScale string productVendor int quantityInStock decimal buyPrice decimal MSRP } PRODUCTLINES { string productLine PK string textDescription } \ud83d\udcdd Descripci\u00f3n de las Tablas A continuaci\u00f3n se detalla el prop\u00f3sito de cada tabla: 1. Customers (Clientes) Almacena la informaci\u00f3n de los clientes de la empresa. Datos clave: Nombre, contacto, direcci\u00f3n, tel\u00e9fono, l\u00edmite de cr\u00e9dito. Relaciones: Se vincula con Employees (representante de ventas asignado), Orders (pedidos realizados) y Payments (pagos efectuados). 2. Products (Productos) Cat\u00e1logo de modelos a escala de coches, motos y otros veh\u00edculos cl\u00e1sicos. Datos clave: C\u00f3digo, nombre, escala, proveedor, descripci\u00f3n, stock, precio de compra y precio de venta sugerido (MSRP). Relaciones: Pertenece a una ProductLine y aparece en OrderDetails . 3. ProductLines (L\u00edneas de Productos) Categor\u00edas en las que se clasifican los productos (ej. \"Classic Cars\", \"Motorcycles\"). Datos clave: Nombre de la l\u00ednea, descripci\u00f3n. 4. Orders (Pedidos) Cabecera de los pedidos realizados por los clientes. Datos clave: Fechas (pedido, requerido, enviado), estado (Shipped, Cancelled, etc.), comentarios. Relaciones: Vinculado al Customer que hizo el pedido. 5. OrderDetails (Detalles de Pedido) L\u00edneas individuales de cada pedido, especificando qu\u00e9 productos se compraron. Datos clave: Cantidad ordenada, precio unitario real. Relaciones: Vincula Orders con Products (relaci\u00f3n muchos a muchos). 6. Payments (Pagos) Registro de pagos realizados por los clientes. Datos clave: N\u00famero de cheque, fecha de pago, monto. Relaciones: Vinculado a Customers . 7. Employees (Empleados) Informaci\u00f3n del personal de la empresa. Datos clave: Nombre, email, puesto de trabajo. Relaciones: Pertenece a una Office . Se reporta a otro empleado (estructura jer\u00e1rquica). Es representante de ventas de Customers . 8. Offices (Oficinas) Ubicaciones f\u00edsicas de las oficinas de ventas. Datos clave: Ciudad, tel\u00e9fono, direcci\u00f3n, pa\u00eds, territorio. \ud83d\udd10 Acceso a la Demo Si has instalado el proyecto y cargado estos datos de ejemplo, o est\u00e1s accediendo a nuestra demo en l\u00ednea, puedes utilizar las siguientes credenciales para acceder al panel administrativo: Credenciales de Acceso URL Demo: https://ragnos.yupii.org/ Usuario: admin Contrase\u00f1a: admin Una vez dentro, podr\u00e1s explorar los m\u00f3dulos creados sobre esta estructura de base de datos para ver Ragnos en acci\u00f3n (Datasets maestro-detalle, reportes, gr\u00e1ficos, etc.).","title":"Base de Datos Demo"},{"location":"fundamentos/base_de_datos_demo/#base-de-datos-demo-classicmodels","text":"Ragnos incluye la base de datos de ejemplo Classicmodels , una implementaci\u00f3n est\u00e1ndar conocida en el mundo del desarrollo para probar funcionalidades de bases de datos relacionales. Esta base de datos modela un negocio de venta de modelos a escala de coches cl\u00e1sicos . Contiene informaci\u00f3n t\u00edpica de un negocio: clientes, productos, pedidos, pagos, empleados y oficinas.","title":"Base de Datos Demo (Classicmodels)"},{"location":"fundamentos/base_de_datos_demo/#estructura-de-la-base-de-datos","text":"La base de datos consta de 8 tablas relacionadas entre s\u00ed. A continuaci\u00f3n se presenta un diagrama Entidad-Relaci\u00f3n (ER) que ilustra la estructura: erDiagram CUSTOMERS ||--o{ ORDERS : realiza CUSTOMERS ||--o{ PAYMENTS : efectua CUSTOMERS }|--|| EMPLOYEES : \"atendido por\" EMPLOYEES ||--|{ EMPLOYEES : \"reporta a\" EMPLOYEES }|--|| OFFICES : \"trabaja en\" ORDERS ||--|{ ORDERDETAILS : contiene PRODUCTS ||--o{ ORDERDETAILS : \"incluido en\" PRODUCTS }|--|| PRODUCTLINES : \"categoria\" CUSTOMERS { int customerNumber PK string customerName string contactLastName string contactFirstName string phone string addressLine1 string city string country int salesRepEmployeeNumber FK decimal creditLimit } EMPLOYEES { int employeeNumber PK string lastName string firstName string email string officeCode FK int reportsTo FK string jobTitle } OFFICES { string officeCode PK string city string phone string addressLine1 string country string territory } ORDERDETAILS { int orderNumber PK,FK string productCode PK,FK int quantityOrdered decimal priceEach } ORDERS { int orderNumber PK date orderDate date shippedDate string status int customerNumber FK } PAYMENTS { int customerNumber PK,FK string checkNumber PK date paymentDate decimal amount } PRODUCTS { string productCode PK string productName string productLine FK string productScale string productVendor int quantityInStock decimal buyPrice decimal MSRP } PRODUCTLINES { string productLine PK string textDescription }","title":"\ud83d\udcca Estructura de la Base de Datos"},{"location":"fundamentos/base_de_datos_demo/#descripcion-de-las-tablas","text":"A continuaci\u00f3n se detalla el prop\u00f3sito de cada tabla:","title":"\ud83d\udcdd Descripci\u00f3n de las Tablas"},{"location":"fundamentos/base_de_datos_demo/#1-customers-clientes","text":"Almacena la informaci\u00f3n de los clientes de la empresa. Datos clave: Nombre, contacto, direcci\u00f3n, tel\u00e9fono, l\u00edmite de cr\u00e9dito. Relaciones: Se vincula con Employees (representante de ventas asignado), Orders (pedidos realizados) y Payments (pagos efectuados).","title":"1. Customers (Clientes)"},{"location":"fundamentos/base_de_datos_demo/#2-products-productos","text":"Cat\u00e1logo de modelos a escala de coches, motos y otros veh\u00edculos cl\u00e1sicos. Datos clave: C\u00f3digo, nombre, escala, proveedor, descripci\u00f3n, stock, precio de compra y precio de venta sugerido (MSRP). Relaciones: Pertenece a una ProductLine y aparece en OrderDetails .","title":"2. Products (Productos)"},{"location":"fundamentos/base_de_datos_demo/#3-productlines-lineas-de-productos","text":"Categor\u00edas en las que se clasifican los productos (ej. \"Classic Cars\", \"Motorcycles\"). Datos clave: Nombre de la l\u00ednea, descripci\u00f3n.","title":"3. ProductLines (L\u00edneas de Productos)"},{"location":"fundamentos/base_de_datos_demo/#4-orders-pedidos","text":"Cabecera de los pedidos realizados por los clientes. Datos clave: Fechas (pedido, requerido, enviado), estado (Shipped, Cancelled, etc.), comentarios. Relaciones: Vinculado al Customer que hizo el pedido.","title":"4. Orders (Pedidos)"},{"location":"fundamentos/base_de_datos_demo/#5-orderdetails-detalles-de-pedido","text":"L\u00edneas individuales de cada pedido, especificando qu\u00e9 productos se compraron. Datos clave: Cantidad ordenada, precio unitario real. Relaciones: Vincula Orders con Products (relaci\u00f3n muchos a muchos).","title":"5. OrderDetails (Detalles de Pedido)"},{"location":"fundamentos/base_de_datos_demo/#6-payments-pagos","text":"Registro de pagos realizados por los clientes. Datos clave: N\u00famero de cheque, fecha de pago, monto. Relaciones: Vinculado a Customers .","title":"6. Payments (Pagos)"},{"location":"fundamentos/base_de_datos_demo/#7-employees-empleados","text":"Informaci\u00f3n del personal de la empresa. Datos clave: Nombre, email, puesto de trabajo. Relaciones: Pertenece a una Office . Se reporta a otro empleado (estructura jer\u00e1rquica). Es representante de ventas de Customers .","title":"7. Employees (Empleados)"},{"location":"fundamentos/base_de_datos_demo/#8-offices-oficinas","text":"Ubicaciones f\u00edsicas de las oficinas de ventas. Datos clave: Ciudad, tel\u00e9fono, direcci\u00f3n, pa\u00eds, territorio.","title":"8. Offices (Oficinas)"},{"location":"fundamentos/base_de_datos_demo/#acceso-a-la-demo","text":"Si has instalado el proyecto y cargado estos datos de ejemplo, o est\u00e1s accediendo a nuestra demo en l\u00ednea, puedes utilizar las siguientes credenciales para acceder al panel administrativo: Credenciales de Acceso URL Demo: https://ragnos.yupii.org/ Usuario: admin Contrase\u00f1a: admin Una vez dentro, podr\u00e1s explorar los m\u00f3dulos creados sobre esta estructura de base de datos para ver Ragnos en acci\u00f3n (Datasets maestro-detalle, reportes, gr\u00e1ficos, etc.).","title":"\ud83d\udd10 Acceso a la Demo"},{"location":"fundamentos/configuracion/","text":"Configuraci\u00f3n de Ragnos Adem\u00e1s de la configuraci\u00f3n est\u00e1ndar de CodeIgniter 4 (base de datos, rutas, etc.), Ragnos incluye un archivo de configuraci\u00f3n espec\u00edfico para personalizar el comportamiento global del framework. Archivo de Configuraci\u00f3n El archivo se encuentra en app/Config/RagnosConfig.php . namespace Config; use CodeIgniter\\Config\\BaseConfig; class RagnosConfig extends BaseConfig { public $Ragnos_application_title = '\ud83c\udfea Tienda'; public $Ragnos_all_to_uppercase = false; public $currency = 'USD'; public $locale = 'es_MX'; } Variables Disponibles Identidad de la Aplicaci\u00f3n Variable Tipo Descripci\u00f3n $Ragnos_application_title string Define el nombre p\u00fablico de la aplicaci\u00f3n. Este texto aparecer\u00e1 en la barra superior (Topbar), en el men\u00fa lateral (Sidebar) y en los encabezados de p\u00e1gina. Comportamiento de Datos Variable Tipo Descripci\u00f3n $Ragnos_all_to_uppercase bool Si se establece en true , fuerza la conversi\u00f3n a may\u00fasculas de ciertos campos de entrada predeterminados en los formularios generados autom\u00e1ticamente. Regionalizaci\u00f3n Variable Tipo Descripci\u00f3n $currency string Define el c\u00f3digo de moneda por defecto (ej. 'USD', 'MXN', 'EUR') utilizado en los helpers de formateo de dinero. $locale string Define el locale predeterminado para formatos de fecha y n\u00famero (ej. 'es_MX', 'en_US'). Nota: Esto es independiente del idioma de la interfaz que maneja CI4. Enrutamiento (Auto Routing) Una particularidad importante de Ragnos es que mantiene habilitada la caracter\u00edstica de Auto Routing ( $routes->setAutoRoute(true) ) de CodeIgniter 4 por defecto. \u00bfQu\u00e9 implica esto para el desarrollador? Cero Configuraci\u00f3n de Rutas: Al crear un nuevo controlador (por ejemplo, con el Generador CLI ), este es accesible inmediatamente v\u00eda URL ( /TuControlador/metodo ) sin necesidad de editar app/Config/Routes.php . Agilidad: Esto es fundamental para la filosof\u00eda \"Low Code\" de Ragnos, permitiendo prototipar y desplegar m\u00f3dulos CRUD en segundos. Seguridad y Personalizaci\u00f3n: Si necesitas URLs espec\u00edficas o restringir el acceso, puedes definir rutas manuales en Config/Routes.php . Las rutas manuales tienen prioridad sobre las autom\u00e1ticas. \u26a0\ufe0f Importante: Si decides desactivar el Auto Routing ( false ) por pol\u00edticas de seguridad estrictas, deber\u00e1s registrar manualmente cada ruta de tus Datasets, lo cual incrementa el trabajo de mantenimiento. Otras Configuraciones (CodeIgniter) Recuerda que Ragnos respeta la configuraci\u00f3n nativa de CI4. Archivos importantes en app/Config/ : App.php : Configuraci\u00f3n base ( baseURL , indexPage ). Database.php : Credenciales de conexi\u00f3n. Security.php : Configuraci\u00f3n CSRF y headers de seguridad.","title":"Configuraci\u00f3n"},{"location":"fundamentos/configuracion/#configuracion-de-ragnos","text":"Adem\u00e1s de la configuraci\u00f3n est\u00e1ndar de CodeIgniter 4 (base de datos, rutas, etc.), Ragnos incluye un archivo de configuraci\u00f3n espec\u00edfico para personalizar el comportamiento global del framework.","title":"Configuraci\u00f3n de Ragnos"},{"location":"fundamentos/configuracion/#archivo-de-configuracion","text":"El archivo se encuentra en app/Config/RagnosConfig.php . namespace Config; use CodeIgniter\\Config\\BaseConfig; class RagnosConfig extends BaseConfig { public $Ragnos_application_title = '\ud83c\udfea Tienda'; public $Ragnos_all_to_uppercase = false; public $currency = 'USD'; public $locale = 'es_MX'; }","title":"Archivo de Configuraci\u00f3n"},{"location":"fundamentos/configuracion/#variables-disponibles","text":"","title":"Variables Disponibles"},{"location":"fundamentos/configuracion/#identidad-de-la-aplicacion","text":"Variable Tipo Descripci\u00f3n $Ragnos_application_title string Define el nombre p\u00fablico de la aplicaci\u00f3n. Este texto aparecer\u00e1 en la barra superior (Topbar), en el men\u00fa lateral (Sidebar) y en los encabezados de p\u00e1gina.","title":"Identidad de la Aplicaci\u00f3n"},{"location":"fundamentos/configuracion/#comportamiento-de-datos","text":"Variable Tipo Descripci\u00f3n $Ragnos_all_to_uppercase bool Si se establece en true , fuerza la conversi\u00f3n a may\u00fasculas de ciertos campos de entrada predeterminados en los formularios generados autom\u00e1ticamente.","title":"Comportamiento de Datos"},{"location":"fundamentos/configuracion/#regionalizacion","text":"Variable Tipo Descripci\u00f3n $currency string Define el c\u00f3digo de moneda por defecto (ej. 'USD', 'MXN', 'EUR') utilizado en los helpers de formateo de dinero. $locale string Define el locale predeterminado para formatos de fecha y n\u00famero (ej. 'es_MX', 'en_US'). Nota: Esto es independiente del idioma de la interfaz que maneja CI4.","title":"Regionalizaci\u00f3n"},{"location":"fundamentos/configuracion/#enrutamiento-auto-routing","text":"Una particularidad importante de Ragnos es que mantiene habilitada la caracter\u00edstica de Auto Routing ( $routes->setAutoRoute(true) ) de CodeIgniter 4 por defecto.","title":"Enrutamiento (Auto Routing)"},{"location":"fundamentos/configuracion/#que-implica-esto-para-el-desarrollador","text":"Cero Configuraci\u00f3n de Rutas: Al crear un nuevo controlador (por ejemplo, con el Generador CLI ), este es accesible inmediatamente v\u00eda URL ( /TuControlador/metodo ) sin necesidad de editar app/Config/Routes.php . Agilidad: Esto es fundamental para la filosof\u00eda \"Low Code\" de Ragnos, permitiendo prototipar y desplegar m\u00f3dulos CRUD en segundos. Seguridad y Personalizaci\u00f3n: Si necesitas URLs espec\u00edficas o restringir el acceso, puedes definir rutas manuales en Config/Routes.php . Las rutas manuales tienen prioridad sobre las autom\u00e1ticas. \u26a0\ufe0f Importante: Si decides desactivar el Auto Routing ( false ) por pol\u00edticas de seguridad estrictas, deber\u00e1s registrar manualmente cada ruta de tus Datasets, lo cual incrementa el trabajo de mantenimiento.","title":"\u00bfQu\u00e9 implica esto para el desarrollador?"},{"location":"fundamentos/configuracion/#otras-configuraciones-codeigniter","text":"Recuerda que Ragnos respeta la configuraci\u00f3n nativa de CI4. Archivos importantes en app/Config/ : App.php : Configuraci\u00f3n base ( baseURL , indexPage ). Database.php : Credenciales de conexi\u00f3n. Security.php : Configuraci\u00f3n CSRF y headers de seguridad.","title":"Otras Configuraciones (CodeIgniter)"},{"location":"fundamentos/instalacion/","text":"Instalaci\u00f3n de Ragnos Esta gu\u00eda describe c\u00f3mo instalar Ragnos Framework a partir de un archivo ZIP distribuido. Requisitos del Servidor Ragnos est\u00e1 basado en CodeIgniter 4 , por lo que comparte sus requisitos m\u00ednimos: PHP : Versi\u00f3n 7.4 o superior (se recomienda PHP 8.1+). Extensiones PHP : intl mbstring json mysqlnd (si usas MySQL/MariaDB) curl gd (opcional, para manipulaci\u00f3n de im\u00e1genes) Base de Datos : MySQL (5.1+) o MariaDB. Pasos de Instalaci\u00f3n 1. Descarga y Extracci\u00f3n Descarga el archivo .zip con la \u00faltima versi\u00f3n de Ragnos. Extrae el contenido en el directorio de tu servidor web (por ejemplo, c:\\laragon\\www\\mi-proyecto o /var/www/html/mi-proyecto ). Verifique que la carpeta vendor existe y contiene las dependencias. Ragnos ya incluye todas las librer\u00edas necesarias. 2. Configuraci\u00f3n del Entorno Ubica el archivo env en la ra\u00edz del proyecto. Ren\u00f3mbralo o c\u00f3pialo a .env . Abre el archivo .env y ajusta las siguientes variables: Ojo con el punto Aseg\u00farate de que el archivo se llame exactamente .env (con el punto al inicio) y no solo env . Entorno: CI_ENVIRONMENT = development URL Base: app.baseURL = 'http://localhost/mi-proyecto/' Base de Datos: Descomenta y configura las credenciales de tu base de datos: database.default.hostname = localhost database.default.database = nombre_de_tu_bd database.default.username = tu_usuario database.default.password = tu_contrase\u00f1a database.default.DBDriver = MySQLi 3. Importar Base de Datos Ragnos requiere ciertas tablas base para funcionar (usuarios, sesiones, permisos). Crea una base de datos vac\u00eda en tu gestor (phpMyAdmin, HeidiSQL, etc.). Importa los archivos SQL ubicados en la carpeta sampledatabase/ : Ejecuta primero ragnos_mariadb.sql (o el dump principal que contenga la estructura base). Ejecuta ci_sessions.sql para la tabla de sesiones. (Opcional) Ejecuta mysqlsampledatabase.sql si deseas cargar los datos de ejemplo Classicmodels . Consulta Base de Datos Demo para m\u00e1s detalles. 4. Verificar Permisos Aseg\u00farate de que la carpeta writable/ y sus subcarpetas tengan permisos de escritura por parte del servidor web. 5. Ejecutar Accede a tu navegador en la URL configurada (ej. http://localhost/mi-proyecto/content o simplemente http://mi-proyecto.test si usas Laragon). Cambio de carpeta p\u00fablica En el c\u00f3digo fuente, la carpeta public ha sido renombrada a content . Sin embargo, no hay problema en cambiarle el nombre al que mejor convenga para tu servidor. Deber\u00edas ver la pantalla de inicio de sesi\u00f3n. 6. Acceso y Datos Demo Para obtener las credenciales de acceso predeterminadas y conocer m\u00e1s sobre los datos de ejemplo incluidos ( Classicmodels ), consulta la secci\u00f3n Base de Datos Demo .","title":"Instalaci\u00f3n"},{"location":"fundamentos/instalacion/#instalacion-de-ragnos","text":"Esta gu\u00eda describe c\u00f3mo instalar Ragnos Framework a partir de un archivo ZIP distribuido.","title":"Instalaci\u00f3n de Ragnos"},{"location":"fundamentos/instalacion/#requisitos-del-servidor","text":"Ragnos est\u00e1 basado en CodeIgniter 4 , por lo que comparte sus requisitos m\u00ednimos: PHP : Versi\u00f3n 7.4 o superior (se recomienda PHP 8.1+). Extensiones PHP : intl mbstring json mysqlnd (si usas MySQL/MariaDB) curl gd (opcional, para manipulaci\u00f3n de im\u00e1genes) Base de Datos : MySQL (5.1+) o MariaDB.","title":"Requisitos del Servidor"},{"location":"fundamentos/instalacion/#pasos-de-instalacion","text":"","title":"Pasos de Instalaci\u00f3n"},{"location":"fundamentos/instalacion/#1-descarga-y-extraccion","text":"Descarga el archivo .zip con la \u00faltima versi\u00f3n de Ragnos. Extrae el contenido en el directorio de tu servidor web (por ejemplo, c:\\laragon\\www\\mi-proyecto o /var/www/html/mi-proyecto ). Verifique que la carpeta vendor existe y contiene las dependencias. Ragnos ya incluye todas las librer\u00edas necesarias.","title":"1. Descarga y Extracci\u00f3n"},{"location":"fundamentos/instalacion/#2-configuracion-del-entorno","text":"Ubica el archivo env en la ra\u00edz del proyecto. Ren\u00f3mbralo o c\u00f3pialo a .env . Abre el archivo .env y ajusta las siguientes variables: Ojo con el punto Aseg\u00farate de que el archivo se llame exactamente .env (con el punto al inicio) y no solo env . Entorno: CI_ENVIRONMENT = development URL Base: app.baseURL = 'http://localhost/mi-proyecto/' Base de Datos: Descomenta y configura las credenciales de tu base de datos: database.default.hostname = localhost database.default.database = nombre_de_tu_bd database.default.username = tu_usuario database.default.password = tu_contrase\u00f1a database.default.DBDriver = MySQLi","title":"2. Configuraci\u00f3n del Entorno"},{"location":"fundamentos/instalacion/#3-importar-base-de-datos","text":"Ragnos requiere ciertas tablas base para funcionar (usuarios, sesiones, permisos). Crea una base de datos vac\u00eda en tu gestor (phpMyAdmin, HeidiSQL, etc.). Importa los archivos SQL ubicados en la carpeta sampledatabase/ : Ejecuta primero ragnos_mariadb.sql (o el dump principal que contenga la estructura base). Ejecuta ci_sessions.sql para la tabla de sesiones. (Opcional) Ejecuta mysqlsampledatabase.sql si deseas cargar los datos de ejemplo Classicmodels . Consulta Base de Datos Demo para m\u00e1s detalles.","title":"3. Importar Base de Datos"},{"location":"fundamentos/instalacion/#4-verificar-permisos","text":"Aseg\u00farate de que la carpeta writable/ y sus subcarpetas tengan permisos de escritura por parte del servidor web.","title":"4. Verificar Permisos"},{"location":"fundamentos/instalacion/#5-ejecutar","text":"Accede a tu navegador en la URL configurada (ej. http://localhost/mi-proyecto/content o simplemente http://mi-proyecto.test si usas Laragon). Cambio de carpeta p\u00fablica En el c\u00f3digo fuente, la carpeta public ha sido renombrada a content . Sin embargo, no hay problema en cambiarle el nombre al que mejor convenga para tu servidor. Deber\u00edas ver la pantalla de inicio de sesi\u00f3n.","title":"5. Ejecutar"},{"location":"fundamentos/instalacion/#6-acceso-y-datos-demo","text":"Para obtener las credenciales de acceso predeterminadas y conocer m\u00e1s sobre los datos de ejemplo incluidos ( Classicmodels ), consulta la secci\u00f3n Base de Datos Demo .","title":"6. Acceso y Datos Demo"},{"location":"fundamentos/plantilla/","text":"Ragnos CLI Generator El Generador CLI de Ragnos es una herramienta de l\u00ednea de comandos integrada en Spark (CodeIgniter 4) que permite crear esqueletos de RDatasetController en segundos. Puedes ver este generador en acci\u00f3n en la gu\u00eda de Primeros Pasos . \ud83d\udccb Tabla de Contenidos Instalaci\u00f3n Sintaxis del Comando Ejemplos de Uso Mapeo Inteligente de Tipos Beneficios Instalaci\u00f3n El Generador CLI de Ragnos viene preinstalado con el paquete Ragnos. Solo aseg\u00farate de tener Ragnos correctamente instalado en tu proyecto CodeIgniter 4. Verifica que la disponibilidad del comando ejecutando: php spark list Deber\u00edas ver el grupo Ragnos y los comandos ragnos:make y ragnos:make:query . Sintaxis del Comando 1. Generar desde Tabla (RDatasetController) php spark ragnos:make [ NombreControlador ] [ Opciones ] Argumentos (ragnos:make) Argumento Descripci\u00f3n NombreControlador La ruta y nombre de la clase (ej. Inventario/Productos ). Opciones (ragnos:make) Opci\u00f3n Descripci\u00f3n -table Nombre exacto de la tabla en BD. 2. Generar desde Consulta (RQueryController) php spark ragnos:make:query [ NombreControlador ] [ Opciones ] Argumentos (ragnos:make:query) Argumento Descripci\u00f3n NombreControlador La ruta y nombre de la clase (ej. Dashboard/Ventas ). Opciones (ragnos:make:query) Opci\u00f3n Descripci\u00f3n -query La consulta SQL entre comillas. Ejemplos de Uso 1. Uso B\u00e1sico (Tabla) Si tu controlador es Productos y tabla productos : php spark ragnos:make Tienda/Productos 2. Uso con Tabla Espec\u00edfica php spark ragnos:make Admin/Usuarios -table app_users_tbl Mapeo Inteligente de Tipos Ragnos elige el componente seg\u00fan tu BD: Tipo BD Tipo Ragnos Reglas Auto-generadas INT number required \\| integer DECIMAL money required \\| decimal DATE date required TEXT textarea required TINYINT(1) checkbox permit_empty VARCHAR text required \\| max_length[n] Beneficios Velocidad: Crea un CRUD en 10 segundos. Estandarizaci\u00f3n: Evita errores de copy-paste y namespaces. Limpieza: Genera etiquetas legibles (\"Fecha Alta\" en lugar de \"fecha_alta\"). Plantilla oficial de nuevo Dataset Si quieres crear un nuevo Dataset desde cero, sin utilizar la l\u00ednea de comandos, utiliza esta plantilla como gu\u00eda para definir la estructura y convenciones recomendadas. <?php namespace App\\Controllers\\Tienda ; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController ; class EjemploDataset extends RDatasetController { public function __construct () { parent :: __construct (); $this -> checkLogin (); $this -> setTitle ( 'Ejemplo' ); $this -> setTableName ( 'example_table' ); $this -> setIdField ( 'id' ); $this -> setAutoIncrement ( true ); $this -> addField ( 'name' , [ 'label' => 'Nombre' , 'rules' => 'required' ]); $this -> setTableFields ([ 'name' ]); } } \ud83d\udcc4 Documentaci\u00f3n de la plantilla de Dataset \ud83c\udfaf Prop\u00f3sito Esta plantilla sirve como punto de partida para crear un nuevo Dataset que se integrar\u00e1 en la tienda (store) del proyecto. Proporciona la estructura, convenciones y campos m\u00ednimos recomendados para que el Dataset funcione correctamente en el flujo existente. \ud83d\udcdd Instrucciones b\u00e1sicas Duplicar: Copia este archivo y col\u00f3calo en la ruta adecuada del repositorio para el nuevo Dataset. Ajustar: Modifica los nombres de clases, tablas y campos seg\u00fan tus necesidades (ver \"Convenciones\"). Registrar: Define el Dataset en el m\u00f3dulo/manifest de la tienda para que quede disponible en la interfaz y en la API. \ud83c\udff7 Convenciones de nombres Clase/Modelo: PascalCase (por ejemplo, MiDataset ). Tabla en BD: snake_case plural (por ejemplo, mi_datasets ). Campos: snake_case (por ejemplo, fecha_creacion , usuario_id ). Slug/identificador p\u00fablico: kebab-case (por ejemplo, mi-dataset ). \ud83c\udfd7 Estructura recomendada Metadatos: Nombre, slug, descripci\u00f3n corta, versi\u00f3n, autor/contacto. Esquema de datos: Lista de campos con nombre, tipo ( string , integer , boolean , date , json , etc.), nulabilidad y valores por defecto. Relaciones: Definir relaciones belongsTo / hasMany / hasOne con otras tablas (indicando FK). \u00cdndices: Declarar \u00edndices para campos de b\u00fasqueda y claves for\u00e1neas. \ud83d\uddc4 Migraciones y esquema Migraci\u00f3n: Crear una migraci\u00f3n que genere la tabla con todos los campos y restricciones. Claves for\u00e1neas: Incluir ON DELETE / ON UPDATE seg\u00fan la l\u00f3gica de negocio. Optimizaci\u00f3n: A\u00f1adir \u00edndices para consultas frecuentes. \u2705 Validaciones y tipos Servidor: Especificar validaciones (requerido, formato, rango) y tipos esperados. UI: Mapear validaciones a los formularios de la interfaz para ofrecer feedback consistente. \ud83d\uded2 Registro en la tienda (store) Manifest: A\u00f1adir el Dataset al listado de Datasets para que la tienda lo reconozca. API: Proveer endpoints o adaptadores para CRUD seg\u00fan la arquitectura del proyecto. Seguridad: Incluir permisos y roles necesarios para acceder o modificar el Dataset. \ud83e\udde9 Ejemplo de placeholders (sustituir por reales) Nombre clase: MiDataset Tabla: mi_datasets Campos: id (PK) titulo (string) descripcion (text) publicado (boolean) creado_en (datetime) usuario_id (FK) \ud83e\uddea Pruebas y verificaci\u00f3n Crear pruebas unitarias para validaciones y modelos. Probar migraciones en una copia de la BD y verificar la integridad referencial. Verificar el registro y visibilidad en la interfaz de la tienda. \ud83d\udca1 Buenas pr\u00e1cticas Autodocumentaci\u00f3n: Mantener la documentaci\u00f3n dentro del propio Dataset (metadatos) para facilitar su descubrimiento. Versionado: Controlar cambios en el esquema y documentar migraciones incompatibles. Compatibilidad: Evitar cambios breaking en campos p\u00fablicos sin migraciones previas y comunicaci\u00f3n a los consumidores. Notas finales: Aseg\u00farate de adaptar los nombres y tipos a la l\u00f3gica de tu dominio. Esta plantilla es una gu\u00eda; revisa las pol\u00edticas de la base de datos, seguridad y permisos de tu proyecto antes de publicar el Dataset. \u00a1Con esta plantilla y gu\u00eda, deber\u00edas estar listo para crear un nuevo Dataset que se integre perfectamente en tu proyecto!","title":"Generador CLI"},{"location":"fundamentos/plantilla/#ragnos-cli-generator","text":"El Generador CLI de Ragnos es una herramienta de l\u00ednea de comandos integrada en Spark (CodeIgniter 4) que permite crear esqueletos de RDatasetController en segundos. Puedes ver este generador en acci\u00f3n en la gu\u00eda de Primeros Pasos .","title":"Ragnos CLI Generator"},{"location":"fundamentos/plantilla/#tabla-de-contenidos","text":"Instalaci\u00f3n Sintaxis del Comando Ejemplos de Uso Mapeo Inteligente de Tipos Beneficios","title":"\ud83d\udccb Tabla de Contenidos"},{"location":"fundamentos/plantilla/#instalacion","text":"El Generador CLI de Ragnos viene preinstalado con el paquete Ragnos. Solo aseg\u00farate de tener Ragnos correctamente instalado en tu proyecto CodeIgniter 4. Verifica que la disponibilidad del comando ejecutando: php spark list Deber\u00edas ver el grupo Ragnos y los comandos ragnos:make y ragnos:make:query .","title":"Instalaci\u00f3n"},{"location":"fundamentos/plantilla/#sintaxis-del-comando","text":"","title":"Sintaxis del Comando"},{"location":"fundamentos/plantilla/#1-generar-desde-tabla-rdatasetcontroller","text":"php spark ragnos:make [ NombreControlador ] [ Opciones ]","title":"1. Generar desde Tabla (RDatasetController)"},{"location":"fundamentos/plantilla/#argumentos-ragnosmake","text":"Argumento Descripci\u00f3n NombreControlador La ruta y nombre de la clase (ej. Inventario/Productos ).","title":"Argumentos (ragnos:make)"},{"location":"fundamentos/plantilla/#opciones-ragnosmake","text":"Opci\u00f3n Descripci\u00f3n -table Nombre exacto de la tabla en BD.","title":"Opciones (ragnos:make)"},{"location":"fundamentos/plantilla/#2-generar-desde-consulta-rquerycontroller","text":"php spark ragnos:make:query [ NombreControlador ] [ Opciones ]","title":"2. Generar desde Consulta (RQueryController)"},{"location":"fundamentos/plantilla/#argumentos-ragnosmakequery","text":"Argumento Descripci\u00f3n NombreControlador La ruta y nombre de la clase (ej. Dashboard/Ventas ).","title":"Argumentos (ragnos:make:query)"},{"location":"fundamentos/plantilla/#opciones-ragnosmakequery","text":"Opci\u00f3n Descripci\u00f3n -query La consulta SQL entre comillas.","title":"Opciones (ragnos:make:query)"},{"location":"fundamentos/plantilla/#ejemplos-de-uso","text":"","title":"Ejemplos de Uso"},{"location":"fundamentos/plantilla/#1-uso-basico-tabla","text":"Si tu controlador es Productos y tabla productos : php spark ragnos:make Tienda/Productos","title":"1. Uso B\u00e1sico (Tabla)"},{"location":"fundamentos/plantilla/#2-uso-con-tabla-especifica","text":"php spark ragnos:make Admin/Usuarios -table app_users_tbl","title":"2. Uso con Tabla Espec\u00edfica"},{"location":"fundamentos/plantilla/#mapeo-inteligente-de-tipos","text":"Ragnos elige el componente seg\u00fan tu BD: Tipo BD Tipo Ragnos Reglas Auto-generadas INT number required \\| integer DECIMAL money required \\| decimal DATE date required TEXT textarea required TINYINT(1) checkbox permit_empty VARCHAR text required \\| max_length[n]","title":"Mapeo Inteligente de Tipos"},{"location":"fundamentos/plantilla/#beneficios","text":"Velocidad: Crea un CRUD en 10 segundos. Estandarizaci\u00f3n: Evita errores de copy-paste y namespaces. Limpieza: Genera etiquetas legibles (\"Fecha Alta\" en lugar de \"fecha_alta\").","title":"Beneficios"},{"location":"fundamentos/plantilla/#plantilla-oficial-de-nuevo-dataset","text":"Si quieres crear un nuevo Dataset desde cero, sin utilizar la l\u00ednea de comandos, utiliza esta plantilla como gu\u00eda para definir la estructura y convenciones recomendadas. <?php namespace App\\Controllers\\Tienda ; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController ; class EjemploDataset extends RDatasetController { public function __construct () { parent :: __construct (); $this -> checkLogin (); $this -> setTitle ( 'Ejemplo' ); $this -> setTableName ( 'example_table' ); $this -> setIdField ( 'id' ); $this -> setAutoIncrement ( true ); $this -> addField ( 'name' , [ 'label' => 'Nombre' , 'rules' => 'required' ]); $this -> setTableFields ([ 'name' ]); } }","title":"Plantilla oficial de nuevo Dataset"},{"location":"fundamentos/plantilla/#documentacion-de-la-plantilla-de-dataset","text":"","title":"\ud83d\udcc4 Documentaci\u00f3n de la plantilla de Dataset"},{"location":"fundamentos/plantilla/#proposito","text":"Esta plantilla sirve como punto de partida para crear un nuevo Dataset que se integrar\u00e1 en la tienda (store) del proyecto. Proporciona la estructura, convenciones y campos m\u00ednimos recomendados para que el Dataset funcione correctamente en el flujo existente.","title":"\ud83c\udfaf Prop\u00f3sito"},{"location":"fundamentos/plantilla/#instrucciones-basicas","text":"Duplicar: Copia este archivo y col\u00f3calo en la ruta adecuada del repositorio para el nuevo Dataset. Ajustar: Modifica los nombres de clases, tablas y campos seg\u00fan tus necesidades (ver \"Convenciones\"). Registrar: Define el Dataset en el m\u00f3dulo/manifest de la tienda para que quede disponible en la interfaz y en la API.","title":"\ud83d\udcdd Instrucciones b\u00e1sicas"},{"location":"fundamentos/plantilla/#convenciones-de-nombres","text":"Clase/Modelo: PascalCase (por ejemplo, MiDataset ). Tabla en BD: snake_case plural (por ejemplo, mi_datasets ). Campos: snake_case (por ejemplo, fecha_creacion , usuario_id ). Slug/identificador p\u00fablico: kebab-case (por ejemplo, mi-dataset ).","title":"\ud83c\udff7 Convenciones de nombres"},{"location":"fundamentos/plantilla/#estructura-recomendada","text":"Metadatos: Nombre, slug, descripci\u00f3n corta, versi\u00f3n, autor/contacto. Esquema de datos: Lista de campos con nombre, tipo ( string , integer , boolean , date , json , etc.), nulabilidad y valores por defecto. Relaciones: Definir relaciones belongsTo / hasMany / hasOne con otras tablas (indicando FK). \u00cdndices: Declarar \u00edndices para campos de b\u00fasqueda y claves for\u00e1neas.","title":"\ud83c\udfd7 Estructura recomendada"},{"location":"fundamentos/plantilla/#migraciones-y-esquema","text":"Migraci\u00f3n: Crear una migraci\u00f3n que genere la tabla con todos los campos y restricciones. Claves for\u00e1neas: Incluir ON DELETE / ON UPDATE seg\u00fan la l\u00f3gica de negocio. Optimizaci\u00f3n: A\u00f1adir \u00edndices para consultas frecuentes.","title":"\ud83d\uddc4 Migraciones y esquema"},{"location":"fundamentos/plantilla/#validaciones-y-tipos","text":"Servidor: Especificar validaciones (requerido, formato, rango) y tipos esperados. UI: Mapear validaciones a los formularios de la interfaz para ofrecer feedback consistente.","title":"\u2705 Validaciones y tipos"},{"location":"fundamentos/plantilla/#registro-en-la-tienda-store","text":"Manifest: A\u00f1adir el Dataset al listado de Datasets para que la tienda lo reconozca. API: Proveer endpoints o adaptadores para CRUD seg\u00fan la arquitectura del proyecto. Seguridad: Incluir permisos y roles necesarios para acceder o modificar el Dataset.","title":"\ud83d\uded2 Registro en la tienda (store)"},{"location":"fundamentos/plantilla/#ejemplo-de-placeholders-sustituir-por-reales","text":"Nombre clase: MiDataset Tabla: mi_datasets Campos: id (PK) titulo (string) descripcion (text) publicado (boolean) creado_en (datetime) usuario_id (FK)","title":"\ud83e\udde9 Ejemplo de placeholders (sustituir por reales)"},{"location":"fundamentos/plantilla/#pruebas-y-verificacion","text":"Crear pruebas unitarias para validaciones y modelos. Probar migraciones en una copia de la BD y verificar la integridad referencial. Verificar el registro y visibilidad en la interfaz de la tienda.","title":"\ud83e\uddea Pruebas y verificaci\u00f3n"},{"location":"fundamentos/plantilla/#buenas-practicas","text":"Autodocumentaci\u00f3n: Mantener la documentaci\u00f3n dentro del propio Dataset (metadatos) para facilitar su descubrimiento. Versionado: Controlar cambios en el esquema y documentar migraciones incompatibles. Compatibilidad: Evitar cambios breaking en campos p\u00fablicos sin migraciones previas y comunicaci\u00f3n a los consumidores. Notas finales: Aseg\u00farate de adaptar los nombres y tipos a la l\u00f3gica de tu dominio. Esta plantilla es una gu\u00eda; revisa las pol\u00edticas de la base de datos, seguridad y permisos de tu proyecto antes de publicar el Dataset. \u00a1Con esta plantilla y gu\u00eda, deber\u00edas estar listo para crear un nuevo Dataset que se integre perfectamente en tu proyecto!","title":"\ud83d\udca1 Buenas pr\u00e1cticas"},{"location":"fundamentos/primeros_pasos/","text":"Primeros Pasos: Hola Mundo En este tutorial crearemos un m\u00f3dulo funcional completo (CRUD) para gestionar una lista de \"Tareas\" en menos de 5 minutos. 1. Preparar la Base de Datos Primero, necesitamos una tabla f\u00edsica donde guardar los datos. Ejecuta este SQL en tu base de datos: CREATE TABLE ` tareas ` ( ` id_tarea ` int ( 11 ) NOT NULL AUTO_INCREMENT , ` titulo ` varchar ( 100 ) NOT NULL , ` descripcion ` text , ` estado ` enum ( 'pendiente' , 'en_progreso' , 'completada' ) DEFAULT 'pendiente' , ` fecha_vencimiento ` date DEFAULT NULL , PRIMARY KEY ( ` id_tarea ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 ; 2. Generar el Controlador Abre tu terminal en la carpeta ra\u00edz del proyecto y usa el generador de Ragnos: php spark ragnos:make Proceso/Tareas -table tareas Esto crear\u00e1 el archivo app/Controllers/Proceso/Tareas.php . 3. Configurar el Dataset Abre el archivo reci\u00e9n creado app/Controllers/Proceso/Tareas.php y completa la configuraci\u00f3n en el constructor. El generador habr\u00e1 creado una estructura b\u00e1sica; ed\u00edtala para que luzca as\u00ed: namespace App\\Controllers\\Proceso; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Tareas extends RDatasetController { public function __construct() { parent::__construct(); // 1. T\u00edtulo y Seguridad $this->checkLogin(); // Requiere estar logueado $this->setTitle('Gesti\u00f3n de Tareas'); // 2. Configuraci\u00f3n de la Tabla $this->setTableName('tareas'); $this->setIdField('id_tarea'); // 3. Definici\u00f3n de Campos $this->addField('titulo', [ 'label' => 'T\u00edtulo de la Tarea', 'rules' => 'required|min_length[5]' ]); $this->addField('descripcion', [ 'label' => 'Detalle', 'type' => 'textarea' ]); $this->addField('fecha_vencimiento', [ 'label' => 'Vence el', 'type' => 'date' ]); $this->addField('estado', [ 'label' => 'Estado Actual', 'type' => 'select', // O 'enum' 'options' => [ 'pendiente' => 'Pendiente', 'en_progreso' => 'En Progreso', 'completada' => 'Finalizada' ] ]); // 4. Configurar la Grilla (Listado) $this->setTableFields(['titulo', 'estado', 'fecha_vencimiento']); } } 4. Probar en el Navegador Abre tu navegador e ingresa al sistema. Navega manualmente a la URL de tu controlador. Si tu URL base es localhost/ragnos , ve a: http://localhost/ragnos/proceso/tareas \u00a1Listo! Deber\u00edas ver: Un listado de tareas (vac\u00edo por ahora). Un bot\u00f3n \"Nuevo\" que abre un formulario. Funcionalidad completa de Guardar, Editar y Eliminar. Siguientes Pasos Agrega este nuevo m\u00f3dulo al men\u00fa lateral (ver Personalizaci\u00f3n de UI ). Aprende sobre m\u00e1s tipos de campos en Referencia de Campos .","title":"Primeros Pasos"},{"location":"fundamentos/primeros_pasos/#primeros-pasos-hola-mundo","text":"En este tutorial crearemos un m\u00f3dulo funcional completo (CRUD) para gestionar una lista de \"Tareas\" en menos de 5 minutos.","title":"Primeros Pasos: Hola Mundo"},{"location":"fundamentos/primeros_pasos/#1-preparar-la-base-de-datos","text":"Primero, necesitamos una tabla f\u00edsica donde guardar los datos. Ejecuta este SQL en tu base de datos: CREATE TABLE ` tareas ` ( ` id_tarea ` int ( 11 ) NOT NULL AUTO_INCREMENT , ` titulo ` varchar ( 100 ) NOT NULL , ` descripcion ` text , ` estado ` enum ( 'pendiente' , 'en_progreso' , 'completada' ) DEFAULT 'pendiente' , ` fecha_vencimiento ` date DEFAULT NULL , PRIMARY KEY ( ` id_tarea ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 ;","title":"1. Preparar la Base de Datos"},{"location":"fundamentos/primeros_pasos/#2-generar-el-controlador","text":"Abre tu terminal en la carpeta ra\u00edz del proyecto y usa el generador de Ragnos: php spark ragnos:make Proceso/Tareas -table tareas Esto crear\u00e1 el archivo app/Controllers/Proceso/Tareas.php .","title":"2. Generar el Controlador"},{"location":"fundamentos/primeros_pasos/#3-configurar-el-dataset","text":"Abre el archivo reci\u00e9n creado app/Controllers/Proceso/Tareas.php y completa la configuraci\u00f3n en el constructor. El generador habr\u00e1 creado una estructura b\u00e1sica; ed\u00edtala para que luzca as\u00ed: namespace App\\Controllers\\Proceso; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Tareas extends RDatasetController { public function __construct() { parent::__construct(); // 1. T\u00edtulo y Seguridad $this->checkLogin(); // Requiere estar logueado $this->setTitle('Gesti\u00f3n de Tareas'); // 2. Configuraci\u00f3n de la Tabla $this->setTableName('tareas'); $this->setIdField('id_tarea'); // 3. Definici\u00f3n de Campos $this->addField('titulo', [ 'label' => 'T\u00edtulo de la Tarea', 'rules' => 'required|min_length[5]' ]); $this->addField('descripcion', [ 'label' => 'Detalle', 'type' => 'textarea' ]); $this->addField('fecha_vencimiento', [ 'label' => 'Vence el', 'type' => 'date' ]); $this->addField('estado', [ 'label' => 'Estado Actual', 'type' => 'select', // O 'enum' 'options' => [ 'pendiente' => 'Pendiente', 'en_progreso' => 'En Progreso', 'completada' => 'Finalizada' ] ]); // 4. Configurar la Grilla (Listado) $this->setTableFields(['titulo', 'estado', 'fecha_vencimiento']); } }","title":"3. Configurar el Dataset"},{"location":"fundamentos/primeros_pasos/#4-probar-en-el-navegador","text":"Abre tu navegador e ingresa al sistema. Navega manualmente a la URL de tu controlador. Si tu URL base es localhost/ragnos , ve a: http://localhost/ragnos/proceso/tareas \u00a1Listo! Deber\u00edas ver: Un listado de tareas (vac\u00edo por ahora). Un bot\u00f3n \"Nuevo\" que abre un formulario. Funcionalidad completa de Guardar, Editar y Eliminar.","title":"4. Probar en el Navegador"},{"location":"fundamentos/primeros_pasos/#siguientes-pasos","text":"Agrega este nuevo m\u00f3dulo al men\u00fa lateral (ver Personalizaci\u00f3n de UI ). Aprende sobre m\u00e1s tipos de campos en Referencia de Campos .","title":"Siguientes Pasos"},{"location":"en/","text":"Ragnos Framework Ragnos is a modern and lightweight framework for web application development. Its goal is to provide a solid and flexible foundation for building scalable and high-performance applications. It is based on CodeIgniter 4 , ensuring a robust and time-tested core. Additionally, it uses technologies like jQuery , DataTables , and AdminLTE to offer a complete and efficient development experience. Recommended Prerequisites Although Ragnos greatly simplifies development, it is highly recommended to familiarize yourself with CodeIgniter 4 and have basic knowledge of SQL before starting. This will allow you to make the most of the framework's flexibility and better understand what happens \"under the hood\". Features Lightweight and fast : Designed to be efficient and minimize resource usage. Modular : Modular structure allowing components to be added or removed as needed. Scalable : Ideal for both small and large projects, with the capacity to grow according to needs. Easy to use : Clear syntax and comprehensive documentation to facilitate development. Based on CodeIgniter 4 : Leverages the advantages of a modern PHP framework, with support for namespaces, controllers, models, and views. jQuery Integration : Simplifies DOM manipulation, AJAX requests, and user interaction. DataTables Usage : Enables the creation of dynamic tables with functionalities like searching, pagination, and sorting. AdminLTE Design : Provides a modern and responsive user interface, ideal for admin panels and web applications. Frontend Flexibility Although Ragnos uses jQuery by default for rapid development, you are not required to use it . If you feel more comfortable with modern reactive libraries like Alpine.js , Vue.js , or React , you can integrate them seamlessly. You can even choose to build your own fully custom user interfaces by consuming data through Ragnos's API Mode . Functionalities and Benefits Rapid Development : Thanks to its CodeIgniter 4-based structure, Ragnos allows developers to focus on business logic without worrying about complex configurations. Modern Interface : AdminLTE offers an attractive and responsive design, ensuring applications look good on any device. Efficient Data Management : DataTables facilitates the visualization and manipulation of large datasets interactively. Flexibility : Its modular architecture allows customizing the framework according to the specific needs of the project. Community and Support : Being based on widely used technologies like CodeIgniter and jQuery, developers have access to a vast amount of resources and online support. Documentation Organization This documentation is divided into four main sections to facilitate your learning: \ud83d\udd30 Fundamentals Everything you need to get started. Start with Installation , review Configuration , and create your first module in Getting Started . \ud83d\udcbe Datasets and Models The core of Ragnos. Learn to declare Datasets , define Fields , and handle Master-Detail relationships. \ud83d\ude80 Advanced Features For intermediate users. Dive into API Mode , Hooks system, and Production Deployment . \ud83c\udfa8 Frontend and UI Interface customization. Learn to modify Menus or Themes and generate Reports . Live Demo To see Ragnos in action with the Classicmodels sample database, visit the Demo Database section where you will find access credentials and a detailed explanation of the data.","title":"Home"},{"location":"en/#ragnos-framework","text":"Ragnos is a modern and lightweight framework for web application development. Its goal is to provide a solid and flexible foundation for building scalable and high-performance applications. It is based on CodeIgniter 4 , ensuring a robust and time-tested core. Additionally, it uses technologies like jQuery , DataTables , and AdminLTE to offer a complete and efficient development experience. Recommended Prerequisites Although Ragnos greatly simplifies development, it is highly recommended to familiarize yourself with CodeIgniter 4 and have basic knowledge of SQL before starting. This will allow you to make the most of the framework's flexibility and better understand what happens \"under the hood\".","title":"Ragnos Framework"},{"location":"en/#features","text":"Lightweight and fast : Designed to be efficient and minimize resource usage. Modular : Modular structure allowing components to be added or removed as needed. Scalable : Ideal for both small and large projects, with the capacity to grow according to needs. Easy to use : Clear syntax and comprehensive documentation to facilitate development. Based on CodeIgniter 4 : Leverages the advantages of a modern PHP framework, with support for namespaces, controllers, models, and views. jQuery Integration : Simplifies DOM manipulation, AJAX requests, and user interaction. DataTables Usage : Enables the creation of dynamic tables with functionalities like searching, pagination, and sorting. AdminLTE Design : Provides a modern and responsive user interface, ideal for admin panels and web applications. Frontend Flexibility Although Ragnos uses jQuery by default for rapid development, you are not required to use it . If you feel more comfortable with modern reactive libraries like Alpine.js , Vue.js , or React , you can integrate them seamlessly. You can even choose to build your own fully custom user interfaces by consuming data through Ragnos's API Mode .","title":"Features"},{"location":"en/#functionalities-and-benefits","text":"Rapid Development : Thanks to its CodeIgniter 4-based structure, Ragnos allows developers to focus on business logic without worrying about complex configurations. Modern Interface : AdminLTE offers an attractive and responsive design, ensuring applications look good on any device. Efficient Data Management : DataTables facilitates the visualization and manipulation of large datasets interactively. Flexibility : Its modular architecture allows customizing the framework according to the specific needs of the project. Community and Support : Being based on widely used technologies like CodeIgniter and jQuery, developers have access to a vast amount of resources and online support.","title":"Functionalities and Benefits"},{"location":"en/#documentation-organization","text":"This documentation is divided into four main sections to facilitate your learning: \ud83d\udd30 Fundamentals Everything you need to get started. Start with Installation , review Configuration , and create your first module in Getting Started . \ud83d\udcbe Datasets and Models The core of Ragnos. Learn to declare Datasets , define Fields , and handle Master-Detail relationships. \ud83d\ude80 Advanced Features For intermediate users. Dive into API Mode , Hooks system, and Production Deployment . \ud83c\udfa8 Frontend and UI Interface customization. Learn to modify Menus or Themes and generate Reports . Live Demo To see Ragnos in action with the Classicmodels sample database, visit the Demo Database section where you will find access credentials and a detailed explanation of the data.","title":"Documentation Organization"},{"location":"en/avanzado/auditlog/","text":"Audit Log Ragnos framework includes a native automatic system to log changes made to entity data. This system allows tracking who performed an action, when, from which IP address, and what specific data was modified, providing complete operation traceability. Configuration Usage in Datasets (RDatasetController) Enabled by default All classes extending RDatasetController have audit logging automatically enabled . If you wish to disable audit for a specific dataset (e.g. temporary tables or massive movements not needing traceability), use setEnableAudit(false) method inside constructor. Example: class TemporaryLogs extends RDatasetController { public function __construct() { parent::__construct(); $this->setTableName('temp_logs'); $this->setIdField('id'); // \u274c Disable audit for this controller $this->setEnableAudit(false); // ... rest of config } } Usage in Manual Models To activate audit log in custom model (not managed by Dataset), property $enableAudit must be set to true . Model must use CrudOperationsTrait (or inherit from base class using it, like RdatasetModel ). class CustomersModel extends RdatasetModel { protected $table = 'customers'; protected $primaryKey = 'customer_id'; // Enable automatic audit for this entity protected $enableAudit = true; // ... field definition } By enabling this property, all insert, update, delete operations via controller/model will be intercepted and logged automatically without extra code in controllers. Internal Functioning System works via App\\ThirdParty\\Ragnos\\Models\\Traits\\CrudOperationsTrait . When write action executes, system performs steps transparently: 1. Insertion (INSERT) Executed after record saved successfully. Saves all new record data in log under key new . 2. Update (UPDATE) Before saving, system compares current database values with sent new values. Only if real differences exist, log save proceeds. Optimization : Logs JSON containing only changed fields, with old value ( old ) and new ( new ). Example saved JSON: { \"status\" : { \"old\" : \"pending\" , \"new\" : \"active\" }, \"credit_limit\" : { \"old\" : \"1000.00\" , \"new\" : \"2500.00\" } } 3. Deletion (DELETE) Before deleting physical record, system queries for current data. Saves full copy of deleted record data under key deleted_data to allow historical query or manual restore. Logged Information For each event, AuditLogModel (table gen_audit_logs ) stores: Field Description user_id ID of user performing action. System resolves identity automatically by active session (Web) or Bearer Token (API). table_name Name of database table where change occurred. record_id ID (Primary Key) of affected record. action Operation type: INSERT , UPDATE or DELETE . changes Payload in JSON format with change details (see above). Stored with Unicode support for special characters. ip_address IP address originating request. user_agent Browser or HTTP client info used. User Detection (Web and API) Audit mechanism is agnostic to request origin. Method getCurrentUserId() resolves actor identity as follows: Web Session: Checks if CodeIgniter session active ( session()->get('usu_id') ). API Token: If API call, inspects Authorization header. Extracts Bearer token and looks up user in gen_usuarios . Fallback: If user not identified, logs ID 0 (System/Anonymous).","title":"Audit Log"},{"location":"en/avanzado/auditlog/#audit-log","text":"Ragnos framework includes a native automatic system to log changes made to entity data. This system allows tracking who performed an action, when, from which IP address, and what specific data was modified, providing complete operation traceability.","title":"Audit Log"},{"location":"en/avanzado/auditlog/#configuration","text":"","title":"Configuration"},{"location":"en/avanzado/auditlog/#usage-in-datasets-rdatasetcontroller","text":"Enabled by default All classes extending RDatasetController have audit logging automatically enabled . If you wish to disable audit for a specific dataset (e.g. temporary tables or massive movements not needing traceability), use setEnableAudit(false) method inside constructor. Example: class TemporaryLogs extends RDatasetController { public function __construct() { parent::__construct(); $this->setTableName('temp_logs'); $this->setIdField('id'); // \u274c Disable audit for this controller $this->setEnableAudit(false); // ... rest of config } }","title":"Usage in Datasets (RDatasetController)"},{"location":"en/avanzado/auditlog/#usage-in-manual-models","text":"To activate audit log in custom model (not managed by Dataset), property $enableAudit must be set to true . Model must use CrudOperationsTrait (or inherit from base class using it, like RdatasetModel ). class CustomersModel extends RdatasetModel { protected $table = 'customers'; protected $primaryKey = 'customer_id'; // Enable automatic audit for this entity protected $enableAudit = true; // ... field definition } By enabling this property, all insert, update, delete operations via controller/model will be intercepted and logged automatically without extra code in controllers.","title":"Usage in Manual Models"},{"location":"en/avanzado/auditlog/#internal-functioning","text":"System works via App\\ThirdParty\\Ragnos\\Models\\Traits\\CrudOperationsTrait . When write action executes, system performs steps transparently:","title":"Internal Functioning"},{"location":"en/avanzado/auditlog/#1-insertion-insert","text":"Executed after record saved successfully. Saves all new record data in log under key new .","title":"1. Insertion (INSERT)"},{"location":"en/avanzado/auditlog/#2-update-update","text":"Before saving, system compares current database values with sent new values. Only if real differences exist, log save proceeds. Optimization : Logs JSON containing only changed fields, with old value ( old ) and new ( new ). Example saved JSON: { \"status\" : { \"old\" : \"pending\" , \"new\" : \"active\" }, \"credit_limit\" : { \"old\" : \"1000.00\" , \"new\" : \"2500.00\" } }","title":"2. Update (UPDATE)"},{"location":"en/avanzado/auditlog/#3-deletion-delete","text":"Before deleting physical record, system queries for current data. Saves full copy of deleted record data under key deleted_data to allow historical query or manual restore.","title":"3. Deletion (DELETE)"},{"location":"en/avanzado/auditlog/#logged-information","text":"For each event, AuditLogModel (table gen_audit_logs ) stores: Field Description user_id ID of user performing action. System resolves identity automatically by active session (Web) or Bearer Token (API). table_name Name of database table where change occurred. record_id ID (Primary Key) of affected record. action Operation type: INSERT , UPDATE or DELETE . changes Payload in JSON format with change details (see above). Stored with Unicode support for special characters. ip_address IP address originating request. user_agent Browser or HTTP client info used.","title":"Logged Information"},{"location":"en/avanzado/auditlog/#user-detection-web-and-api","text":"Audit mechanism is agnostic to request origin. Method getCurrentUserId() resolves actor identity as follows: Web Session: Checks if CodeIgniter session active ( session()->get('usu_id') ). API Token: If API call, inspects Authorization header. Extracts Bearer token and looks up user in gen_usuarios . Fallback: If user not identified, logs ID 0 (System/Anonymous).","title":"User Detection (Web and API)"},{"location":"en/avanzado/autenticacion_integrada/","text":"Integrated Authentication and Permissions System Ragnos includes a lightweight flexible authentication system integrated directly into framework core. Handles user sessions, controller protection and Role Based Access Control (RBAC). System relies mainly on App\\Services\\Admin_aut service and BaseController class. Database Tables System expects specific database structure: gen_usuarios : Users table ( usu_id , usu_nombre , usu_login , usu_pword , usu_activo , usu_grupo ). gen_gruposdeusuarios : Roles table ( gru_id , gru_nombre ). Controller Protection All controllers extending BaseController (including RDatasetController , RProcessController , etc.) access simplified protection methods. Verification Flow graph TD Req[\"Incoming Request\"] --> Controller[\"Controller\"] Controller -->|Calls| Check{\"checkLogin( )\"} Check -- \"No session\" --> Type{\"Is API?\"} Type -- \"Yes\" --> Error401[\"JSON 401 Unauthorized\"] Type -- \"No\" --> Login[\"Redirect to Login\"] Check -- \"Has session\" --> Group{\"checkUserInGroup( )?\"} Group -- \"Not required\" --> Access[\"\u2705 Access Allowed\"] Group -- \"Required\" --> Role{\"User in Group?\"} Role -- \"Yes\" --> Access Role -- \"No\" --> Error403[\"\u26d4 Redirect / Error 403\"] %% Improved styles style Access fill:#d4edda,stroke:#155724,stroke-width:2px,color:#155724 style Error401 fill:#f8d7da,stroke:#721c24,stroke-width:2px,color:#721c24 style Login fill:#fff3cd,stroke:#856404,stroke-width:2px,color:#856404 style Error403 fill:#f8d7da,stroke:#721c24,stroke-width:2px,color:#721c24 checkLogin() Verifies if user has active session. If not: Web requests: Redirects to login ( admin/login ). API requests: Verifies Authorization header against usu_token in DB. If fails, returns JSON 401 error. Usage: Recommended to call at start of function requiring auth, or in constructor if whole controller private. Public Controllers If you have a public controller (e.g. Home page), simply do not call checkLogin() . public function myPrivateFunction() { $this->checkLogin(); // Rest of code only executes if user logged in return view('my_view'); } checkUserInGroup($groups) Restricts access exclusively to users belonging to specified groups. Parameter : Can be string with group name or array of strings for multiple groups. Behavior : If condition not met, redirects to admin/index (or returns 403/401 if API). Internally calls checkLogin() , so calling both is unnecessary. Usage: public function __construct() { // Only allow Administrator access $this->checkUserInGroup('Administrator'); } public function managementReport() { // Allow Admins or Management $this->checkUserInGroup(['Administrator', 'Management']); // Report logic... } Admin_aut Service For granular logic inside views/controllers, access auth service directly. Ideally invoke via service('Admin_aut') . Main Functions isLoggedIn() Returns true if user logged in, false otherwise. if (service('Admin_aut')->isLoggedIn()) { echo \"User connected\"; } id() Returns current user ID ( usu_id ). name() Returns current user full name ( usu_nombre ). isUserInGroup($group) Evaluates if current user belongs to indicated group. Useful for hiding/showing buttons in views or conditional logic. Case-insensitive. // In controller or view if (service('Admin_aut')->isUserInGroup('Sales')) { // Show create order button } getField($fieldName) Gets any field from gen_usuarios table for current user. Info lazily loaded on first request. // Get email or custom field $email = service('Admin_aut')->getField('usu_email'); API Authentication System supports authentication for REST APIs transparently. On login, secure token generated in usu_token . Client must send token in Authorization header. checkLogin() automatically detects API call ( isApiCall() ) and validates token instead of PHP session. Allows using same controllers for web interface and mobile apps or decoupled frontends. Complete Example <?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; class Orders extends BaseController { public function __construct () { // Load helpers helper ([ 'form' , 'url' ]); } public function index () { // 1. Ensure logged in $this -> checkLogin (); $auth = service ( 'Admin_aut' ); // 2. Get user data $data [ 'user' ] = $auth -> name (); $data [ 'isAdmin' ] = $auth -> isUserInGroup ( 'Administrator' ); return view ( 'orders/index' , $data ); } public function delete ( $id ) { // 3. Strict restriction: Only Admins can delete $this -> checkUserInGroup ( 'Administrator' ); $model = new \\App\\Models\\OrdersModel (); $model -> delete ( $id ); return redirect () -> to ( '/orders' ); } }","title":"Authentication"},{"location":"en/avanzado/autenticacion_integrada/#integrated-authentication-and-permissions-system","text":"Ragnos includes a lightweight flexible authentication system integrated directly into framework core. Handles user sessions, controller protection and Role Based Access Control (RBAC). System relies mainly on App\\Services\\Admin_aut service and BaseController class.","title":"Integrated Authentication and Permissions System"},{"location":"en/avanzado/autenticacion_integrada/#database-tables","text":"System expects specific database structure: gen_usuarios : Users table ( usu_id , usu_nombre , usu_login , usu_pword , usu_activo , usu_grupo ). gen_gruposdeusuarios : Roles table ( gru_id , gru_nombre ).","title":"Database Tables"},{"location":"en/avanzado/autenticacion_integrada/#controller-protection","text":"All controllers extending BaseController (including RDatasetController , RProcessController , etc.) access simplified protection methods.","title":"Controller Protection"},{"location":"en/avanzado/autenticacion_integrada/#verification-flow","text":"graph TD Req[\"Incoming Request\"] --> Controller[\"Controller\"] Controller -->|Calls| Check{\"checkLogin( )\"} Check -- \"No session\" --> Type{\"Is API?\"} Type -- \"Yes\" --> Error401[\"JSON 401 Unauthorized\"] Type -- \"No\" --> Login[\"Redirect to Login\"] Check -- \"Has session\" --> Group{\"checkUserInGroup( )?\"} Group -- \"Not required\" --> Access[\"\u2705 Access Allowed\"] Group -- \"Required\" --> Role{\"User in Group?\"} Role -- \"Yes\" --> Access Role -- \"No\" --> Error403[\"\u26d4 Redirect / Error 403\"] %% Improved styles style Access fill:#d4edda,stroke:#155724,stroke-width:2px,color:#155724 style Error401 fill:#f8d7da,stroke:#721c24,stroke-width:2px,color:#721c24 style Login fill:#fff3cd,stroke:#856404,stroke-width:2px,color:#856404 style Error403 fill:#f8d7da,stroke:#721c24,stroke-width:2px,color:#721c24","title":"Verification Flow"},{"location":"en/avanzado/autenticacion_integrada/#checklogin","text":"Verifies if user has active session. If not: Web requests: Redirects to login ( admin/login ). API requests: Verifies Authorization header against usu_token in DB. If fails, returns JSON 401 error. Usage: Recommended to call at start of function requiring auth, or in constructor if whole controller private. Public Controllers If you have a public controller (e.g. Home page), simply do not call checkLogin() . public function myPrivateFunction() { $this->checkLogin(); // Rest of code only executes if user logged in return view('my_view'); }","title":"checkLogin()"},{"location":"en/avanzado/autenticacion_integrada/#checkuseringroupgroups","text":"Restricts access exclusively to users belonging to specified groups. Parameter : Can be string with group name or array of strings for multiple groups. Behavior : If condition not met, redirects to admin/index (or returns 403/401 if API). Internally calls checkLogin() , so calling both is unnecessary. Usage: public function __construct() { // Only allow Administrator access $this->checkUserInGroup('Administrator'); } public function managementReport() { // Allow Admins or Management $this->checkUserInGroup(['Administrator', 'Management']); // Report logic... }","title":"checkUserInGroup($groups)"},{"location":"en/avanzado/autenticacion_integrada/#admin_aut-service","text":"For granular logic inside views/controllers, access auth service directly. Ideally invoke via service('Admin_aut') .","title":"Admin_aut Service"},{"location":"en/avanzado/autenticacion_integrada/#main-functions","text":"","title":"Main Functions"},{"location":"en/avanzado/autenticacion_integrada/#isloggedin","text":"Returns true if user logged in, false otherwise. if (service('Admin_aut')->isLoggedIn()) { echo \"User connected\"; }","title":"isLoggedIn()"},{"location":"en/avanzado/autenticacion_integrada/#id","text":"Returns current user ID ( usu_id ).","title":"id()"},{"location":"en/avanzado/autenticacion_integrada/#name","text":"Returns current user full name ( usu_nombre ).","title":"name()"},{"location":"en/avanzado/autenticacion_integrada/#isuseringroupgroup","text":"Evaluates if current user belongs to indicated group. Useful for hiding/showing buttons in views or conditional logic. Case-insensitive. // In controller or view if (service('Admin_aut')->isUserInGroup('Sales')) { // Show create order button }","title":"isUserInGroup($group)"},{"location":"en/avanzado/autenticacion_integrada/#getfieldfieldname","text":"Gets any field from gen_usuarios table for current user. Info lazily loaded on first request. // Get email or custom field $email = service('Admin_aut')->getField('usu_email');","title":"getField($fieldName)"},{"location":"en/avanzado/autenticacion_integrada/#api-authentication","text":"System supports authentication for REST APIs transparently. On login, secure token generated in usu_token . Client must send token in Authorization header. checkLogin() automatically detects API call ( isApiCall() ) and validates token instead of PHP session. Allows using same controllers for web interface and mobile apps or decoupled frontends.","title":"API Authentication"},{"location":"en/avanzado/autenticacion_integrada/#complete-example","text":"<?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; class Orders extends BaseController { public function __construct () { // Load helpers helper ([ 'form' , 'url' ]); } public function index () { // 1. Ensure logged in $this -> checkLogin (); $auth = service ( 'Admin_aut' ); // 2. Get user data $data [ 'user' ] = $auth -> name (); $data [ 'isAdmin' ] = $auth -> isUserInGroup ( 'Administrator' ); return view ( 'orders/index' , $data ); } public function delete ( $id ) { // 3. Strict restriction: Only Admins can delete $this -> checkUserInGroup ( 'Administrator' ); $model = new \\App\\Models\\OrdersModel (); $model -> delete ( $id ); return redirect () -> to ( '/orders' ); } }","title":"Complete Example"},{"location":"en/avanzado/despliegue/","text":"Deployment Guide (Production) This guide covers essential steps to take your Ragnos application from local development to production server. 1. Environment Configuration Important In production, never run application in development mode. Exposes sensitive info and slows down app. Edit .env file on server. Set environment variable: CI_ENVIRONMENT = production Disables debug toolbar, hides detailed PHP errors, activates config caching. 2. File System Permissions Ensure web server user (e.g. www-data on Apache/Nginx) has write permission on writable folder and subfolders. chmod -R 775 writable/ chown -R www-data:www-data writable/ Other folders ( app , system , public ) should be read-only for web server for security, unless specific needs. 3. Database Update connection credentials in .env pointing to production database. Ensure app.baseURL configured correctly with real domain (HTTPS recommended). app.baseURL = 'https://my-production-system.com/' 4. Remove Development Files Recommended not to upload unnecessary files to production: Tests ( tests/ ) Git files ( .git/ , .gitignore ) Internal documentation ( documentacion/ ) SQL sample files ( sampledatabase/ ) Common Troubleshooting 404 Error on all pages except Home: Usually web server config (Apache/Nginx) not redirecting requests to index.php . Ensure public/.htaccess present and mod_rewrite active in Apache. Blank Page or 500 Error: Check logs in writable/logs/ for real error, as production mode hides them.","title":"Deployment"},{"location":"en/avanzado/despliegue/#deployment-guide-production","text":"This guide covers essential steps to take your Ragnos application from local development to production server.","title":"Deployment Guide (Production)"},{"location":"en/avanzado/despliegue/#1-environment-configuration","text":"Important In production, never run application in development mode. Exposes sensitive info and slows down app. Edit .env file on server. Set environment variable: CI_ENVIRONMENT = production Disables debug toolbar, hides detailed PHP errors, activates config caching.","title":"1. Environment Configuration"},{"location":"en/avanzado/despliegue/#2-file-system-permissions","text":"Ensure web server user (e.g. www-data on Apache/Nginx) has write permission on writable folder and subfolders. chmod -R 775 writable/ chown -R www-data:www-data writable/ Other folders ( app , system , public ) should be read-only for web server for security, unless specific needs.","title":"2. File System Permissions"},{"location":"en/avanzado/despliegue/#3-database","text":"Update connection credentials in .env pointing to production database. Ensure app.baseURL configured correctly with real domain (HTTPS recommended). app.baseURL = 'https://my-production-system.com/'","title":"3. Database"},{"location":"en/avanzado/despliegue/#4-remove-development-files","text":"Recommended not to upload unnecessary files to production: Tests ( tests/ ) Git files ( .git/ , .gitignore ) Internal documentation ( documentacion/ ) SQL sample files ( sampledatabase/ )","title":"4. Remove Development Files"},{"location":"en/avanzado/despliegue/#common-troubleshooting","text":"404 Error on all pages except Home: Usually web server config (Apache/Nginx) not redirecting requests to index.php . Ensure public/.htaccess present and mod_rewrite active in Apache. Blank Page or 500 Error: Check logs in writable/logs/ for real error, as production mode hides them.","title":"Common Troubleshooting"},{"location":"en/avanzado/guia_modo_api/","text":"Usage Guide: Ragnos API Mode Starting from v1.1, Ragnos Framework supports hybrid controllers. This means same controller serving admin panel (HTML) can work as RESTful API (JSON) without extra code. \ud83d\udccb Prerequisites Access Token: Must have valid api_token assigned to user in database. Endpoint: URL is same as used in browser (e.g. https://your-site.com/store/products ). Authenticate with API Mode and get token To use API Mode, first authenticate and obtain token. Send POST request to login endpoint with credentials. Request: POST /admin/login Headers: Content-Type: application/json Accept: application/json Body (JSON): { \"usuario\": \"admin\", \"pword\": \"your_password\" } Response (200 OK): { \"status\" : \"success\" , \"message\" : \"Login successful\" , \"token\" : \"4984656be2ff893362b3b023d0b55df74494fb87552916031143e6431e8d9a7c\" , \"user_id\" : \"1\" } You get a token to use in headers for future API requests. \ud83d\udd10 Authentication and Headers To activate \"API Mode\", client must send following HTTP headers. If not sent, Ragnos responds with HTML. Header Value Description Accept application/json Mandatory. Tells Ragnos you want JSON, not HTML. Authorization Bearer YOUR_TOKEN Mandatory. Your security token. Content-Type application/json Necessary when sending data (POST/PUT). \ud83d\udce1 Endpoints and Operations Assume controller is Store/Products . 1. List Records (GET) Gets list of data applying grid filters. Request: GET /store/products Headers: Accept: application/json Authorization: Bearer xyz123 Response (200 OK): { \"status\" : 200 , \"data\" : [ { \"id\" : 1 , \"name\" : \"Laptop\" , \"price\" : 1500 }, { \"id\" : 2 , \"name\" : \"Mouse\" , \"price\" : 20 } ], \"count\" : 2 } 2. Create Record (POST) Request: POST /store/products/save Headers: Content-Type: application/json Accept: application/json Authorization: Bearer xyz123 Body (JSON): { \"name\": \"Mechanical Keyboard\", \"price\": 85.50, \"stock\": 10 } Response (201 Created): { \"status\" : 201 , \"message\" : \"Record created successfully.\" , \"data\" : { \"id\" : 15 } } 3. Update Record (POST/PUT) In Ragnos, update handled in same save endpoint. Difference is must include ID (primary key). Request: POST /store/products/save Headers: ... Body (JSON): { \"id\": 15, \"price\": 90.00 } Response (200 OK): { \"status\" : 200 , \"message\" : \"Record updated successfully.\" , \"data\" : { \"id\" : 15 } } 4. Delete Record (POST/DELETE) Can send ID in URL or JSON body. Option A (URL): POST /store/products/delete/15 Option B (JSON Body): Request: POST /store/products/delete Headers: ... Body (JSON): { \"id\": 15 } Response (200 OK): { \"status\" : 200 , \"message\" : \"Record deleted successfully\" } \u26a0\ufe0f Error Handling If something fails (validation or server), Ragnos returns appropriate HTTP status and error JSON. Example: Validation Error (400 Bad Request) { \"status\" : 400 , \"error\" : 400 , \"messages\" : { \"price\" : \"Price field is required.\" , \"stock\" : \"Stock field must be numeric.\" } } Example: Invalid Token (401 Unauthorized) { \"status\" : 401 , \"error\" : \"Token invalid or expired\" } \ud83d\udcbb Client Examples JavaScript (Fetch) const token = \"YOUR_API_TOKEN\" ; // Example: Save product fetch ( \"https://yoursite.com/store/products/save\" , { method : \"POST\" , headers : { \"Content-Type\" : \"application/json\" , Accept : \"application/json\" , Authorization : `Bearer ${ token } ` , }, body : JSON . stringify ({ name : \"4K Monitor\" , price : 300 , }), }) . then (( response ) => response . json ()) . then (( data ) => console . log ( data )) . catch (( error ) => console . error ( \"Error:\" , error )); cURL (Terminal) curl -X GET https://yoursite.com/store/products -H \"Accept: application/json\" -H \"Authorization: Bearer YOUR_API_TOKEN\"","title":"API Mode"},{"location":"en/avanzado/guia_modo_api/#usage-guide-ragnos-api-mode","text":"Starting from v1.1, Ragnos Framework supports hybrid controllers. This means same controller serving admin panel (HTML) can work as RESTful API (JSON) without extra code.","title":"Usage Guide: Ragnos API Mode"},{"location":"en/avanzado/guia_modo_api/#prerequisites","text":"Access Token: Must have valid api_token assigned to user in database. Endpoint: URL is same as used in browser (e.g. https://your-site.com/store/products ).","title":"\ud83d\udccb Prerequisites"},{"location":"en/avanzado/guia_modo_api/#authenticate-with-api-mode-and-get-token","text":"To use API Mode, first authenticate and obtain token. Send POST request to login endpoint with credentials. Request: POST /admin/login Headers: Content-Type: application/json Accept: application/json Body (JSON): { \"usuario\": \"admin\", \"pword\": \"your_password\" } Response (200 OK): { \"status\" : \"success\" , \"message\" : \"Login successful\" , \"token\" : \"4984656be2ff893362b3b023d0b55df74494fb87552916031143e6431e8d9a7c\" , \"user_id\" : \"1\" } You get a token to use in headers for future API requests.","title":"Authenticate with API Mode and get token"},{"location":"en/avanzado/guia_modo_api/#authentication-and-headers","text":"To activate \"API Mode\", client must send following HTTP headers. If not sent, Ragnos responds with HTML. Header Value Description Accept application/json Mandatory. Tells Ragnos you want JSON, not HTML. Authorization Bearer YOUR_TOKEN Mandatory. Your security token. Content-Type application/json Necessary when sending data (POST/PUT).","title":"\ud83d\udd10 Authentication and Headers"},{"location":"en/avanzado/guia_modo_api/#endpoints-and-operations","text":"Assume controller is Store/Products .","title":"\ud83d\udce1 Endpoints and Operations"},{"location":"en/avanzado/guia_modo_api/#1-list-records-get","text":"Gets list of data applying grid filters. Request: GET /store/products Headers: Accept: application/json Authorization: Bearer xyz123 Response (200 OK): { \"status\" : 200 , \"data\" : [ { \"id\" : 1 , \"name\" : \"Laptop\" , \"price\" : 1500 }, { \"id\" : 2 , \"name\" : \"Mouse\" , \"price\" : 20 } ], \"count\" : 2 }","title":"1. List Records (GET)"},{"location":"en/avanzado/guia_modo_api/#2-create-record-post","text":"Request: POST /store/products/save Headers: Content-Type: application/json Accept: application/json Authorization: Bearer xyz123 Body (JSON): { \"name\": \"Mechanical Keyboard\", \"price\": 85.50, \"stock\": 10 } Response (201 Created): { \"status\" : 201 , \"message\" : \"Record created successfully.\" , \"data\" : { \"id\" : 15 } }","title":"2. Create Record (POST)"},{"location":"en/avanzado/guia_modo_api/#3-update-record-postput","text":"In Ragnos, update handled in same save endpoint. Difference is must include ID (primary key). Request: POST /store/products/save Headers: ... Body (JSON): { \"id\": 15, \"price\": 90.00 } Response (200 OK): { \"status\" : 200 , \"message\" : \"Record updated successfully.\" , \"data\" : { \"id\" : 15 } }","title":"3. Update Record (POST/PUT)"},{"location":"en/avanzado/guia_modo_api/#4-delete-record-postdelete","text":"Can send ID in URL or JSON body. Option A (URL): POST /store/products/delete/15 Option B (JSON Body): Request: POST /store/products/delete Headers: ... Body (JSON): { \"id\": 15 } Response (200 OK): { \"status\" : 200 , \"message\" : \"Record deleted successfully\" }","title":"4. Delete Record (POST/DELETE)"},{"location":"en/avanzado/guia_modo_api/#error-handling","text":"If something fails (validation or server), Ragnos returns appropriate HTTP status and error JSON. Example: Validation Error (400 Bad Request) { \"status\" : 400 , \"error\" : 400 , \"messages\" : { \"price\" : \"Price field is required.\" , \"stock\" : \"Stock field must be numeric.\" } } Example: Invalid Token (401 Unauthorized) { \"status\" : 401 , \"error\" : \"Token invalid or expired\" }","title":"\u26a0\ufe0f Error Handling"},{"location":"en/avanzado/guia_modo_api/#client-examples","text":"","title":"\ud83d\udcbb Client Examples"},{"location":"en/avanzado/guia_modo_api/#javascript-fetch","text":"const token = \"YOUR_API_TOKEN\" ; // Example: Save product fetch ( \"https://yoursite.com/store/products/save\" , { method : \"POST\" , headers : { \"Content-Type\" : \"application/json\" , Accept : \"application/json\" , Authorization : `Bearer ${ token } ` , }, body : JSON . stringify ({ name : \"4K Monitor\" , price : 300 , }), }) . then (( response ) => response . json ()) . then (( data ) => console . log ( data )) . catch (( error ) => console . error ( \"Error:\" , error ));","title":"JavaScript (Fetch)"},{"location":"en/avanzado/guia_modo_api/#curl-terminal","text":"curl -X GET https://yoursite.com/store/products -H \"Accept: application/json\" -H \"Authorization: Bearer YOUR_API_TOKEN\"","title":"cURL (Terminal)"},{"location":"en/avanzado/helpers/","text":"PHP Helpers and Utilities Ragnos includes collection of global helper functions designed to speed up common tasks and improve application performance. Available throughout framework automatically. Database and Cache Management getCachedData() Executes raw SQL query and stores result in CodeIgniter 4 cache system. Ideal for heavy queries or reports not needing real-time data. function getCachedData(string $sql, array $params = [], ?string $cacheKey = null, int $ttl = 86400): array Parameters Parameter Type Description $sql string SQL query to execute. $params array (Optional) Array of values for bound parameters ( ? ) in query. $cacheKey string (Optional) Unique cache identifier. If null , hash generated automatically based on query and parameters. $ttl int (Optional) Time To Live in seconds. Default 86400 (24 hours). Return Returns associative array with query results. Usage Example // In Model or Controller public function getMetrics() { $sql = \"SELECT p.productLine, SUM(od.quantityOrdered * od.priceEach) as Total FROM products p JOIN orderdetails od ON p.productCode = od.productCode GROUP BY p.productLine\"; // Cache result for 1 hour (3600 seconds) with specific key return getCachedData($sql, [], 'dashboard_metrics', 3600); } \u26a0\ufe0f Warnings and Considerations Real Time Data: Do not use for critical data changing constantly (e.g. real time inventory with high concurrency, bank balances). Data served can be up to $ttl seconds old. Cache Invalidation: If using custom $cacheKey (like 'dashboard_metrics' ), can manually clear that cache when data changes using cache()->delete('dashboard_metrics') . Automatic keys harder to manually invalidate. Dev Environment: Remember if developing and changing data, might see old data until cache cleared ( php spark cache:clear ). queryToAssocArray() Executes SQL query and transforms result directly into associative array [id => value] . Extremely useful for populating dropdowns ( <select> ). function queryToAssocArray(string $sql, string $index_key, string $column_key): array Example // Get category list for Dropdown $sql = \"SELECT id, name FROM categories ORDER BY name ASC\"; $options = queryToAssocArray($sql, 'id', 'name'); // Result: [1 => 'Electronics', 2 => 'Home', ...] Debugging and Diagnostics dbgConsola() Sends PHP data directly to developer browser console. Uses console.log via script injection. Only works in development environment. function dbgConsola($data, string $label = 'dbgConsola') Example $users = $model->findAll(); dbgConsola($users, 'User List'); // Check Chrome/Firefox console (F12) dbgDie() Kills script execution and returns provided data in JSON format. Perfect for debugging API/AJAX calls. function dbgDie($data, int $statusCode = 200): never Format and UI currency() Formats numbers as currency respecting regional config ( locale ) without complex extensions. function currency(float|int $number, bool $includeSymbol = true): string Example echo currency(1500.50); // Shows \"$1,500.50\" (depending on config) returnAsJSON() Standardizes JSON responses for API or AJAX controllers. Automatically handles HTTP headers and UTF-8 encoding. function returnAsJSON($data, $statusCode = 200) Example if (!$user) { returnAsJSON(['error' => 'User not found'], 404); } returnAsJSON($user);","title":"Helpers & Utilities"},{"location":"en/avanzado/helpers/#php-helpers-and-utilities","text":"Ragnos includes collection of global helper functions designed to speed up common tasks and improve application performance. Available throughout framework automatically.","title":"PHP Helpers and Utilities"},{"location":"en/avanzado/helpers/#database-and-cache-management","text":"","title":"Database and Cache Management"},{"location":"en/avanzado/helpers/#getcacheddata","text":"Executes raw SQL query and stores result in CodeIgniter 4 cache system. Ideal for heavy queries or reports not needing real-time data. function getCachedData(string $sql, array $params = [], ?string $cacheKey = null, int $ttl = 86400): array","title":"getCachedData()"},{"location":"en/avanzado/helpers/#parameters","text":"Parameter Type Description $sql string SQL query to execute. $params array (Optional) Array of values for bound parameters ( ? ) in query. $cacheKey string (Optional) Unique cache identifier. If null , hash generated automatically based on query and parameters. $ttl int (Optional) Time To Live in seconds. Default 86400 (24 hours).","title":"Parameters"},{"location":"en/avanzado/helpers/#return","text":"Returns associative array with query results.","title":"Return"},{"location":"en/avanzado/helpers/#usage-example","text":"// In Model or Controller public function getMetrics() { $sql = \"SELECT p.productLine, SUM(od.quantityOrdered * od.priceEach) as Total FROM products p JOIN orderdetails od ON p.productCode = od.productCode GROUP BY p.productLine\"; // Cache result for 1 hour (3600 seconds) with specific key return getCachedData($sql, [], 'dashboard_metrics', 3600); }","title":"Usage Example"},{"location":"en/avanzado/helpers/#warnings-and-considerations","text":"Real Time Data: Do not use for critical data changing constantly (e.g. real time inventory with high concurrency, bank balances). Data served can be up to $ttl seconds old. Cache Invalidation: If using custom $cacheKey (like 'dashboard_metrics' ), can manually clear that cache when data changes using cache()->delete('dashboard_metrics') . Automatic keys harder to manually invalidate. Dev Environment: Remember if developing and changing data, might see old data until cache cleared ( php spark cache:clear ).","title":"\u26a0\ufe0f Warnings and Considerations"},{"location":"en/avanzado/helpers/#querytoassocarray","text":"Executes SQL query and transforms result directly into associative array [id => value] . Extremely useful for populating dropdowns ( <select> ). function queryToAssocArray(string $sql, string $index_key, string $column_key): array","title":"queryToAssocArray()"},{"location":"en/avanzado/helpers/#example","text":"// Get category list for Dropdown $sql = \"SELECT id, name FROM categories ORDER BY name ASC\"; $options = queryToAssocArray($sql, 'id', 'name'); // Result: [1 => 'Electronics', 2 => 'Home', ...]","title":"Example"},{"location":"en/avanzado/helpers/#debugging-and-diagnostics","text":"","title":"Debugging and Diagnostics"},{"location":"en/avanzado/helpers/#dbgconsola","text":"Sends PHP data directly to developer browser console. Uses console.log via script injection. Only works in development environment. function dbgConsola($data, string $label = 'dbgConsola')","title":"dbgConsola()"},{"location":"en/avanzado/helpers/#example_1","text":"$users = $model->findAll(); dbgConsola($users, 'User List'); // Check Chrome/Firefox console (F12)","title":"Example"},{"location":"en/avanzado/helpers/#dbgdie","text":"Kills script execution and returns provided data in JSON format. Perfect for debugging API/AJAX calls. function dbgDie($data, int $statusCode = 200): never","title":"dbgDie()"},{"location":"en/avanzado/helpers/#format-and-ui","text":"","title":"Format and UI"},{"location":"en/avanzado/helpers/#currency","text":"Formats numbers as currency respecting regional config ( locale ) without complex extensions. function currency(float|int $number, bool $includeSymbol = true): string","title":"currency()"},{"location":"en/avanzado/helpers/#example_2","text":"echo currency(1500.50); // Shows \"$1,500.50\" (depending on config)","title":"Example"},{"location":"en/avanzado/helpers/#returnasjson","text":"Standardizes JSON responses for API or AJAX controllers. Automatically handles HTTP headers and UTF-8 encoding. function returnAsJSON($data, $statusCode = 200)","title":"returnAsJSON()"},{"location":"en/avanzado/helpers/#example_3","text":"if (!$user) { returnAsJSON(['error' => 'User not found'], 404); } returnAsJSON($user);","title":"Example"},{"location":"en/avanzado/hooks/","text":"Hooks and Lifecycle in Ragnos In Ragnos, hooks allow executing custom logic at different moments of dataset lifecycle. Are main mechanism to extend behavior without breaking declarative model. Hooks defined as protected methods inside controller extending RDatasetController . Key Concept Controller does not implement CRUD manually. Ragnos handles database operation, you just \"hook\" into key points to inject business logic. Visual Lifecycle Understanding flow is crucial to know where to place logic. graph TD A[\"User Request\"] --> B{\"Field Validation\"} B -- Fail --> Z[\"Show Error\"] B -- Success --> C{\"Exists Hook _before*?\"} C -- Yes --> D[\"Execute _before*( )\"] D -- \"raise( )\" --> Z C -- No --> E[\"DB Operation\"] D -- Success --> E E --> F{\"Operation Successful?\"} F -- No --> Z F -- Yes --> G{\"Exists Hook _after*?\"} G -- Yes --> H[\"Execute _after*( )\"] G -- No --> I[\"Success Response\"] H --> I Available Hooks Ragnos exposes following hooks, all optional: Hook Execution Moment _beforeInsert() Before inserting record _afterInsert() After inserting record _beforeUpdate() Before updating record _afterUpdate() After updating record _beforeDelete() Before deleting record _afterDelete() After deleting record Fundamental Tools and Concepts Before writing specific functions, important to know tools Ragnos provides inside hooks to interact with data and app flow. 1. Basic Structure Hooks of type _before* (Insert and Update) receive $data array by reference, allowing value modification before reaching DB. If modification not needed, argument can be omitted. // Hook with data manipulation (by reference) protected function _beforeInsert(&$data) { $data['created_at'] = date('Y-m-d'); } 2. Value Access: newValue() and oldValue() To facilitate business logic, Ragnos provides helper functions to inspect data state: newValue('field') : Value trying to be saved (request payload). oldValue('field') : Original value existing in database (before modification). Helper Insert Update Delete newValue() \u2705 \u2705 \u274c oldValue() \u274c \u2705 \u2705 3. Change Detection: fieldHasChanged() Especially useful in updates to execute actions only if specific field modified. if (fieldHasChanged('status')) { // Send status change notification } 4. Safe Interruption: raise() If need to stop operation due to business rule, use raise() . Stops process and shows error message to user, preventing CRUD operation. if (oldValue('locked') === true) { raise('Cannot modify locked record.'); } Design Note raise() preferable to throw new Exception for logic validation errors (\"Soft errors\") that user must correct. Refactoring and Organization Although Ragnos does not force you to create external classes for hook functions (you can write logic directly in the controller), if business rules are sufficiently complex , it is convenient and recommended to refactor them into dedicated Models , Libraries , or Services . This helps keep code organized, reusable, and easier to maintain. Insertion Hooks Executed during creation of new records. _beforeInsert(&$data) Executed before INSERT. Receives $data by reference. Common uses: Initialize automatic values (dates, UUIDs). Normalize data (uppercase, formats). Custom payload validations. protected function _beforeInsert(&$data) { // Assign manual creation date $data['created_at'] = date('Y-m-d H:i:s'); // Force uppercase in RFC if (isset($data['rfc'])) { $data['rfc'] = strtoupper($data['rfc']); } } _afterInsert() Executed after successful INSERT. Common uses: Audit logs. Welcome notifications sending. protected function _afterInsert() { log_message('info', 'New user registered with ID ' . $this->insertID()); } Update Hooks Manage modification of existing records. Where most complex business logic resides. _beforeUpdate(&$data) Executed before UPDATE. Receives $data with fields to update. Common uses: State transition validations. Register edit metadata ( updated_by ). Critical field protection. protected function _beforeUpdate(&$data) { // Register who modified $data['updated_by'] = session('user_id'); // Validate business rule: Cannot reopen completed tasks if (oldValue('status') === 'completed' && newValue('status') === 'pending') { raise('Cannot reopen completed task.'); } } _afterUpdate() Executed after successful UPDATE. Common uses: Invalidate cache. Recalculate dependent data in other tables. protected function _afterUpdate() { // If credit limit changed, invalidate statement cache if (fieldHasChanged('creditLimit')) { \\Config\\Services::cache()->delete('accountstatements'); } } Deletion Hooks Manage information deletion. _beforeDelete() Executed before DELETE. Common uses: Validate dependencies (manual referential integrity). Prevent system record deletion. protected function _beforeDelete() { // Protect Administrator user (ID 1) if (oldValue('user_id') == 1) { raise('Cannot delete main admin user.'); } // Verify relations manually if ($this->hasRelations()) { raise('Cannot delete record because has associated data.'); } } _afterDelete() Executed after DELETE. Common uses: Cleanup attachments (images, docs). Activity logs. protected function _afterDelete() { log_message('info', 'Record deleted successfully.'); } Case Study: Password Hashing Real example combining hooks to manage user passwords securely. // On create, ALWAYS hash password public function _beforeInsert(&$userData) { $userData['usu_pword'] = md5(strtoupper($userData['usu_pword'])); } // On edit, ONLY hash if user wrote new password public function _beforeUpdate(&$userData) { if (fieldHasChanged('usu_pword')) { $userData['usu_pword'] = md5(strtoupper($userData['usu_pword'])); } } Explanation: In _beforeInsert , password always comes plaintext, so hash unconditionally. In _beforeUpdate , use fieldHasChanged to detect if user entered new key. If check skipped, existing hash re-hashed, corrupting password. UI Hooks Ragnos allows intervention in generated visual interface too. _customFormDataFooter() Inserts HTML or scripts at footer of edit form. function _customFormDataFooter() { $id = $this->request->getPost($this->getIdField()); // Return partial view return view('Store/order_detail', ['orderId' => $id]); } Best Practices Recommended Keep hooks small: Complex logic goes to Services or Libraries. Document side effects: If hook alters other table, leave clear comment. - Usa raise() for validation errors instead of hard exceptions. To Avoid Do not replace controller: Hooks are to extend , not rewrite CRUD flow. Careful with manual SQL: Try to use models whenever possible. Philosophy Hooks in Ragnos allow extending without breaking : Decoupling: Do not couple hard business logic to generic CRUD mechanism. Declarative: Keep config over programming approach. Maintainability: Clearly separate \"What to save\" from \"What to do when saving\". Ragnos Philosophy In Ragnos, hooks don't control flow: they react to domain.","title":"Hooks & Events"},{"location":"en/avanzado/hooks/#hooks-and-lifecycle-in-ragnos","text":"In Ragnos, hooks allow executing custom logic at different moments of dataset lifecycle. Are main mechanism to extend behavior without breaking declarative model. Hooks defined as protected methods inside controller extending RDatasetController . Key Concept Controller does not implement CRUD manually. Ragnos handles database operation, you just \"hook\" into key points to inject business logic.","title":"Hooks and Lifecycle in Ragnos"},{"location":"en/avanzado/hooks/#visual-lifecycle","text":"Understanding flow is crucial to know where to place logic. graph TD A[\"User Request\"] --> B{\"Field Validation\"} B -- Fail --> Z[\"Show Error\"] B -- Success --> C{\"Exists Hook _before*?\"} C -- Yes --> D[\"Execute _before*( )\"] D -- \"raise( )\" --> Z C -- No --> E[\"DB Operation\"] D -- Success --> E E --> F{\"Operation Successful?\"} F -- No --> Z F -- Yes --> G{\"Exists Hook _after*?\"} G -- Yes --> H[\"Execute _after*( )\"] G -- No --> I[\"Success Response\"] H --> I","title":"Visual Lifecycle"},{"location":"en/avanzado/hooks/#available-hooks","text":"Ragnos exposes following hooks, all optional: Hook Execution Moment _beforeInsert() Before inserting record _afterInsert() After inserting record _beforeUpdate() Before updating record _afterUpdate() After updating record _beforeDelete() Before deleting record _afterDelete() After deleting record","title":"Available Hooks"},{"location":"en/avanzado/hooks/#fundamental-tools-and-concepts","text":"Before writing specific functions, important to know tools Ragnos provides inside hooks to interact with data and app flow.","title":"Fundamental Tools and Concepts"},{"location":"en/avanzado/hooks/#1-basic-structure","text":"Hooks of type _before* (Insert and Update) receive $data array by reference, allowing value modification before reaching DB. If modification not needed, argument can be omitted. // Hook with data manipulation (by reference) protected function _beforeInsert(&$data) { $data['created_at'] = date('Y-m-d'); }","title":"1. Basic Structure"},{"location":"en/avanzado/hooks/#2-value-access-newvalue-and-oldvalue","text":"To facilitate business logic, Ragnos provides helper functions to inspect data state: newValue('field') : Value trying to be saved (request payload). oldValue('field') : Original value existing in database (before modification). Helper Insert Update Delete newValue() \u2705 \u2705 \u274c oldValue() \u274c \u2705 \u2705","title":"2. Value Access: newValue() and oldValue()"},{"location":"en/avanzado/hooks/#3-change-detection-fieldhaschanged","text":"Especially useful in updates to execute actions only if specific field modified. if (fieldHasChanged('status')) { // Send status change notification }","title":"3. Change Detection: fieldHasChanged()"},{"location":"en/avanzado/hooks/#4-safe-interruption-raise","text":"If need to stop operation due to business rule, use raise() . Stops process and shows error message to user, preventing CRUD operation. if (oldValue('locked') === true) { raise('Cannot modify locked record.'); } Design Note raise() preferable to throw new Exception for logic validation errors (\"Soft errors\") that user must correct. Refactoring and Organization Although Ragnos does not force you to create external classes for hook functions (you can write logic directly in the controller), if business rules are sufficiently complex , it is convenient and recommended to refactor them into dedicated Models , Libraries , or Services . This helps keep code organized, reusable, and easier to maintain.","title":"4. Safe Interruption: raise()"},{"location":"en/avanzado/hooks/#insertion-hooks","text":"Executed during creation of new records.","title":"Insertion Hooks"},{"location":"en/avanzado/hooks/#_beforeinsertdata","text":"Executed before INSERT. Receives $data by reference. Common uses: Initialize automatic values (dates, UUIDs). Normalize data (uppercase, formats). Custom payload validations. protected function _beforeInsert(&$data) { // Assign manual creation date $data['created_at'] = date('Y-m-d H:i:s'); // Force uppercase in RFC if (isset($data['rfc'])) { $data['rfc'] = strtoupper($data['rfc']); } }","title":"_beforeInsert(&amp;$data)"},{"location":"en/avanzado/hooks/#_afterinsert","text":"Executed after successful INSERT. Common uses: Audit logs. Welcome notifications sending. protected function _afterInsert() { log_message('info', 'New user registered with ID ' . $this->insertID()); }","title":"_afterInsert()"},{"location":"en/avanzado/hooks/#update-hooks","text":"Manage modification of existing records. Where most complex business logic resides.","title":"Update Hooks"},{"location":"en/avanzado/hooks/#_beforeupdatedata","text":"Executed before UPDATE. Receives $data with fields to update. Common uses: State transition validations. Register edit metadata ( updated_by ). Critical field protection. protected function _beforeUpdate(&$data) { // Register who modified $data['updated_by'] = session('user_id'); // Validate business rule: Cannot reopen completed tasks if (oldValue('status') === 'completed' && newValue('status') === 'pending') { raise('Cannot reopen completed task.'); } }","title":"_beforeUpdate(&amp;$data)"},{"location":"en/avanzado/hooks/#_afterupdate","text":"Executed after successful UPDATE. Common uses: Invalidate cache. Recalculate dependent data in other tables. protected function _afterUpdate() { // If credit limit changed, invalidate statement cache if (fieldHasChanged('creditLimit')) { \\Config\\Services::cache()->delete('accountstatements'); } }","title":"_afterUpdate()"},{"location":"en/avanzado/hooks/#deletion-hooks","text":"Manage information deletion.","title":"Deletion Hooks"},{"location":"en/avanzado/hooks/#_beforedelete","text":"Executed before DELETE. Common uses: Validate dependencies (manual referential integrity). Prevent system record deletion. protected function _beforeDelete() { // Protect Administrator user (ID 1) if (oldValue('user_id') == 1) { raise('Cannot delete main admin user.'); } // Verify relations manually if ($this->hasRelations()) { raise('Cannot delete record because has associated data.'); } }","title":"_beforeDelete()"},{"location":"en/avanzado/hooks/#_afterdelete","text":"Executed after DELETE. Common uses: Cleanup attachments (images, docs). Activity logs. protected function _afterDelete() { log_message('info', 'Record deleted successfully.'); }","title":"_afterDelete()"},{"location":"en/avanzado/hooks/#case-study-password-hashing","text":"Real example combining hooks to manage user passwords securely. // On create, ALWAYS hash password public function _beforeInsert(&$userData) { $userData['usu_pword'] = md5(strtoupper($userData['usu_pword'])); } // On edit, ONLY hash if user wrote new password public function _beforeUpdate(&$userData) { if (fieldHasChanged('usu_pword')) { $userData['usu_pword'] = md5(strtoupper($userData['usu_pword'])); } } Explanation: In _beforeInsert , password always comes plaintext, so hash unconditionally. In _beforeUpdate , use fieldHasChanged to detect if user entered new key. If check skipped, existing hash re-hashed, corrupting password.","title":"Case Study: Password Hashing"},{"location":"en/avanzado/hooks/#ui-hooks","text":"Ragnos allows intervention in generated visual interface too.","title":"UI Hooks"},{"location":"en/avanzado/hooks/#_customformdatafooter","text":"Inserts HTML or scripts at footer of edit form. function _customFormDataFooter() { $id = $this->request->getPost($this->getIdField()); // Return partial view return view('Store/order_detail', ['orderId' => $id]); }","title":"_customFormDataFooter()"},{"location":"en/avanzado/hooks/#best-practices","text":"Recommended Keep hooks small: Complex logic goes to Services or Libraries. Document side effects: If hook alters other table, leave clear comment. - Usa raise() for validation errors instead of hard exceptions. To Avoid Do not replace controller: Hooks are to extend , not rewrite CRUD flow. Careful with manual SQL: Try to use models whenever possible.","title":"Best Practices"},{"location":"en/avanzado/hooks/#philosophy","text":"Hooks in Ragnos allow extending without breaking : Decoupling: Do not couple hard business logic to generic CRUD mechanism. Declarative: Keep config over programming approach. Maintainability: Clearly separate \"What to save\" from \"What to do when saving\". Ragnos Philosophy In Ragnos, hooks don't control flow: they react to domain.","title":"Philosophy"},{"location":"en/avanzado/server_side_events/","text":"\u23f3 Long Running Processes with Server-Side Events (SSE) Ragnos framework includes implementation for handling long-running processes on server, allowing real-time progress updates to user browser using Server-Side Events (SSE) . Ideal for tasks exceeding usual HTTP request timeout or where user needs visual feedback of progress (progress bars). PHP Time Limits Although SSE keeps connection open, web server or PHP config ( max_execution_time ) might kill process if too long. Ensure set_time_limit(0) in logic if expecting very long processes. Architecture System based on two main components: App\\ThirdParty\\Ragnos\\Controllers\\RProcessController : Base class for controllers executing processes. process_helper.php : Helper containing functions managing SSE event flow (headers, sending data, buffer control, etc.). Workflow User accesses controller action rendering progress view (method showProgress ). View connects via JavaScript ( EventSource ) to start method of same controller. start method executes heavy logic, sending progress events periodically via helper functions. Upon completion, server sends finish event and closes connection. RProcessController Class To create new process, must create controller extending RProcessController . Location : App\\Controllers\\ or any subfolder, provided namespace correct. Main Methods __construct() : Automatically loads process_helper . showProgress() : Shows UI with progress bar. Automatically calculates URL of start endpoint based on class name. start() : Must be overridden . Logic of long running process resides here. Helper Functions (process_helper) These functions available automatically inside extended controller. processStart($title = 'Processing...') Initializes SSE process. Clears output buffers and sets text/event-stream headers. Disables time limits ( set_time_limit(0) ) and memory in PHP to avoid timeouts. Sends process title to client. setProgress($percentage) Updates progress bar to indicated percentage. $percentage : Integer (0-100). setProgressText($text) Updates descriptive text below progress bar. Useful to inform user what exactly is being done (e.g. \"Processing row 45...\"). setProgressOf($currentStep, $total) Utility function calculating percentage automatically and calling setProgress . $currentStep : Current step (iterator). $total : Total steps to perform. endProcess($additionalData = null) Finalizes process. Calculates total execution time. Sends finish event to client with optional data. Ends script execution ( exit ). Common Applications Useful for: Bulk Imports : Uploading Excel/CSV files with thousands of records to DB. Report Generation : Creating complex PDFs or large excels. Maintenance : Cleanup tasks, price recalculation, cache or image regeneration. Mass Emails : Sending newsletters requiring feedback per sent block. Implementation Examples Example 1: Price Recalculation (Basic) Simulates process iterating over 100 items. <?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class RecalculatePrices extends RProcessController { // Main method executing logic public function start () { // 1. Start process processStart ( 'Recalculating catalog prices' ); $totalProducts = 100 ; for ( $i = 1 ; $i <= $totalProducts ; $i ++ ) { // Simulate heavy work usleep ( 100000 ); // 0.1 seconds // 2. Update progress (calculates % automatically) setProgressOf ( $i , $totalProducts ); // 3. Update info text setProgressText ( \"Updating product ID: # { $i } \" ); } // 4. Finish endProcess ([ 'message' => 'Prices updated successfully' , 'total' => $totalProducts ]); } } Example 2: User Import (With Validation) More complex example simulating import where info validated. <?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class ImportUsers extends RProcessController { public function start () { processStart ( 'Importing User Database' ); // Simulate data fetching (e.g. read CSV) $users = $this -> getSimulatedData ( 500 ); $total = count ( $users ); $imported = 0 ; $errors = 0 ; foreach ( $users as $index => $user ) { $step = $index + 1 ; // Simulated business logic if ( $this -> saveUser ( $user )) { $imported ++ ; setProgressText ( \"User { $user [ 'name' ] } imported.\" ); } else { $errors ++ ; setProgressText ( \"Error importing { $user [ 'name' ] } .\" ); } // Update progress bar every 5 records to not saturate network // in very fast processes if ( $step % 5 === 0 || $step === $total ) { setProgressOf ( $step , $total ); } // Simulate DB time usleep ( 20000 ); } endProcess ([ 'result' => \"Import finished. Success: { $imported } , Errors: { $errors } \" ]); } private function getSimulatedData ( $qty ) { /* ... */ return array_fill ( 0 , $qty , [ 'name' => 'User' ]); } private function saveUser ( $user ) { return rand ( 0 , 10 ) > 1 ; } } Example 3: Backup Generation <?php namespace App\\Controllers\\Admin ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class BackupSystem extends RProcessController { public function start () { processStart ( 'Generating System Backup' ); $steps = [ 'Compressing images...' , 'Exporting database...' , 'Generating log files...' , 'Packaging final ZIP...' ]; $totalSteps = count ( $steps ); foreach ( $steps as $index => $stepName ) { setProgressText ( $stepName ); // Simulate long task sleep ( 2 ); setProgressOf ( $index + 1 , $totalSteps ); } endProcess ([ 'file' => 'backup_2023.zip' ]); } }","title":"Server Side Events"},{"location":"en/avanzado/server_side_events/#long-running-processes-with-server-side-events-sse","text":"Ragnos framework includes implementation for handling long-running processes on server, allowing real-time progress updates to user browser using Server-Side Events (SSE) . Ideal for tasks exceeding usual HTTP request timeout or where user needs visual feedback of progress (progress bars). PHP Time Limits Although SSE keeps connection open, web server or PHP config ( max_execution_time ) might kill process if too long. Ensure set_time_limit(0) in logic if expecting very long processes.","title":"\u23f3 Long Running Processes with Server-Side Events (SSE)"},{"location":"en/avanzado/server_side_events/#architecture","text":"System based on two main components: App\\ThirdParty\\Ragnos\\Controllers\\RProcessController : Base class for controllers executing processes. process_helper.php : Helper containing functions managing SSE event flow (headers, sending data, buffer control, etc.).","title":"Architecture"},{"location":"en/avanzado/server_side_events/#workflow","text":"User accesses controller action rendering progress view (method showProgress ). View connects via JavaScript ( EventSource ) to start method of same controller. start method executes heavy logic, sending progress events periodically via helper functions. Upon completion, server sends finish event and closes connection.","title":"Workflow"},{"location":"en/avanzado/server_side_events/#rprocesscontroller-class","text":"To create new process, must create controller extending RProcessController . Location : App\\Controllers\\ or any subfolder, provided namespace correct.","title":"RProcessController Class"},{"location":"en/avanzado/server_side_events/#main-methods","text":"__construct() : Automatically loads process_helper . showProgress() : Shows UI with progress bar. Automatically calculates URL of start endpoint based on class name. start() : Must be overridden . Logic of long running process resides here.","title":"Main Methods"},{"location":"en/avanzado/server_side_events/#helper-functions-process_helper","text":"These functions available automatically inside extended controller.","title":"Helper Functions (process_helper)"},{"location":"en/avanzado/server_side_events/#processstarttitle-processing","text":"Initializes SSE process. Clears output buffers and sets text/event-stream headers. Disables time limits ( set_time_limit(0) ) and memory in PHP to avoid timeouts. Sends process title to client.","title":"processStart($title = 'Processing...')"},{"location":"en/avanzado/server_side_events/#setprogresspercentage","text":"Updates progress bar to indicated percentage. $percentage : Integer (0-100).","title":"setProgress($percentage)"},{"location":"en/avanzado/server_side_events/#setprogresstexttext","text":"Updates descriptive text below progress bar. Useful to inform user what exactly is being done (e.g. \"Processing row 45...\").","title":"setProgressText($text)"},{"location":"en/avanzado/server_side_events/#setprogressofcurrentstep-total","text":"Utility function calculating percentage automatically and calling setProgress . $currentStep : Current step (iterator). $total : Total steps to perform.","title":"setProgressOf($currentStep, $total)"},{"location":"en/avanzado/server_side_events/#endprocessadditionaldata-null","text":"Finalizes process. Calculates total execution time. Sends finish event to client with optional data. Ends script execution ( exit ).","title":"endProcess($additionalData = null)"},{"location":"en/avanzado/server_side_events/#common-applications","text":"Useful for: Bulk Imports : Uploading Excel/CSV files with thousands of records to DB. Report Generation : Creating complex PDFs or large excels. Maintenance : Cleanup tasks, price recalculation, cache or image regeneration. Mass Emails : Sending newsletters requiring feedback per sent block.","title":"Common Applications"},{"location":"en/avanzado/server_side_events/#implementation-examples","text":"","title":"Implementation Examples"},{"location":"en/avanzado/server_side_events/#example-1-price-recalculation-basic","text":"Simulates process iterating over 100 items. <?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class RecalculatePrices extends RProcessController { // Main method executing logic public function start () { // 1. Start process processStart ( 'Recalculating catalog prices' ); $totalProducts = 100 ; for ( $i = 1 ; $i <= $totalProducts ; $i ++ ) { // Simulate heavy work usleep ( 100000 ); // 0.1 seconds // 2. Update progress (calculates % automatically) setProgressOf ( $i , $totalProducts ); // 3. Update info text setProgressText ( \"Updating product ID: # { $i } \" ); } // 4. Finish endProcess ([ 'message' => 'Prices updated successfully' , 'total' => $totalProducts ]); } }","title":"Example 1: Price Recalculation (Basic)"},{"location":"en/avanzado/server_side_events/#example-2-user-import-with-validation","text":"More complex example simulating import where info validated. <?php namespace App\\Controllers ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class ImportUsers extends RProcessController { public function start () { processStart ( 'Importing User Database' ); // Simulate data fetching (e.g. read CSV) $users = $this -> getSimulatedData ( 500 ); $total = count ( $users ); $imported = 0 ; $errors = 0 ; foreach ( $users as $index => $user ) { $step = $index + 1 ; // Simulated business logic if ( $this -> saveUser ( $user )) { $imported ++ ; setProgressText ( \"User { $user [ 'name' ] } imported.\" ); } else { $errors ++ ; setProgressText ( \"Error importing { $user [ 'name' ] } .\" ); } // Update progress bar every 5 records to not saturate network // in very fast processes if ( $step % 5 === 0 || $step === $total ) { setProgressOf ( $step , $total ); } // Simulate DB time usleep ( 20000 ); } endProcess ([ 'result' => \"Import finished. Success: { $imported } , Errors: { $errors } \" ]); } private function getSimulatedData ( $qty ) { /* ... */ return array_fill ( 0 , $qty , [ 'name' => 'User' ]); } private function saveUser ( $user ) { return rand ( 0 , 10 ) > 1 ; } }","title":"Example 2: User Import (With Validation)"},{"location":"en/avanzado/server_side_events/#example-3-backup-generation","text":"<?php namespace App\\Controllers\\Admin ; use App\\ThirdParty\\Ragnos\\Controllers\\RProcessController ; class BackupSystem extends RProcessController { public function start () { processStart ( 'Generating System Backup' ); $steps = [ 'Compressing images...' , 'Exporting database...' , 'Generating log files...' , 'Packaging final ZIP...' ]; $totalSteps = count ( $steps ); foreach ( $steps as $index => $stepName ) { setProgressText ( $stepName ); // Simulate long task sleep ( 2 ); setProgressOf ( $index + 1 , $totalSteps ); } endProcess ([ 'file' => 'backup_2023.zip' ]); } }","title":"Example 3: Backup Generation"},{"location":"en/datasets/campos/","text":"Supported Field Types in Ragnos In Ragnos, dataset fields are defined using the addField() method. This method is a fundamental part of the configuration of an RDatasetController . Each field is a declarative description of how a domain attribute: Is validated Is displayed in forms Is displayed in grids Is persisted (or not) in the database Ragnos uses this metadata to automatically generate forms, validations, listings, and CRUD behavior. 1. General Structure of addField() $this->addField('fieldName', [ 'label' => 'Visible label', 'rules' => 'validation|rules', 'type' => 'type', 'query' => 'SQL expression' ]); Common Parameters Parameter Description label Text visible in forms and grids rules Validation rules (CI4 + Ragnos) type Field type (optional) query SQL expression for calculated fields tab Tab name (optional) Validation Rules Ragnos adopts the powerful CodeIgniter 4 validation engine. You can use rules such as required , is_unique , min_length , valid_email , etc. Consult all available rules in the official CodeIgniter 4 documentation Simplified is_unique Validation Unlike CodeIgniter 4, where is_unique usually requires parameters like is_unique[table.field] , Ragnos simplifies its usage: you only need to specify the keyword is_unique . The framework automatically detects which table and field are being operated on (using the definitions in setTableName and the field name in addField ) to build the verification query. Additionally, it correctly handles exceptions when editing a record (auto-detecting the primary key defined with setIdField to ignore the current record). Common Use Cases: It is ideal for fields that must be unique across the system, such as: Email addresses in a user registry. Usernames or aliases. Product codes (SKU) or barcodes. National ID numbers. Tabbed Organization Ragnos allows you to organize form fields into tabs to improve usability in extensive forms. Simply add the tab key to the field configuration array with the desired tab name. $this->addField('basic_info', [ ... , 'tab' => 'General' ]); $this->addField('technical_details', [ ... , 'tab' => 'Details' ]); $this->addField('pricing', [ ... , 'tab' => 'Finance' ]); Fields without a defined tab will automatically be placed in a tab labeled \"General\" . If no field has a tab defined, the form will be displayed without tabs (classic behavior). If a validation error occurs in a field hidden by a tab, Ragnos will automatically activate that tab to show the error. 2. Text Field (string) $this->addField('customerName', [ 'label' => 'Name', 'rules' => 'required' ]); Persistent Editable Free text 3. Multiline Text Field ( textarea ) For long texts like descriptions or comments. $this->addField('productDescription', [ 'label' => 'Description', 'type' => 'textarea', 'rules' => 'required' ]); HTML Variant: Use type => 'htmltextarea' for a basic rich text editor. 4. Date and Time Field Ragnos automatically handles date selection. $this->addField('orderDate', [ 'label' => 'Order Date', 'type' => 'datetime', // or 'date' 'rules' => 'required' ]); Includes date/time picker (datepicker). 5. Numeric Field $this->addField('postalCode', [ 'label' => 'Postal code', 'rules' => 'required|numeric' ]); Persistent Editable Numeric 6. Monetary Field ( money ) $this->addField('creditLimit', [ 'label' => 'Credit limit', 'rules' => 'required|money' ]); Custom validator Automatic normalization Financial use 7. Readonly Field $this->addField('Contact', [ 'label' => 'Contact', 'rules' => 'readonly' ]); Visible Not editable 8. Hidden Field $this->addField('Contact', [ 'label' => 'Contact', 'rules' => 'readonly', 'type' => 'hidden' ]); Not visible in forms Useful for logic or UX 9. Calculated Field ( query ) $this->addField('fullName', [ 'label' => 'Full Name', 'rules' => 'readonly', 'query' => \"concat(contactLastName, ', ', contactFirstName)\", 'type' => 'hidden' ]); Non-persistent (not a real column in the table) Dynamic SQL expression Read-only 10. Related Field ( addSearch ) Links a field to another controller for selection (Foreign Key). $this->addSearch('salesRepEmployeeNumber', 'Shop\\\\Employees'); Logical foreign key Dynamic selector (modal or autocomplete) Automatic JOIN handling See detailed explanation on Contextual Search and Reports in the Datasets Guide 11. Primary Key Field $this->setIdField('customerNumber'); // Disable auto-increment if needed (e.g., for alphanumeric codes) $this->setAutoIncrement(false); Dataset identity Mandatory Defaults to auto-increment 12. Dropdown Field (Enum) Brief description: A dropdown (enum) presents a closed set of options (key => label). The selected key is stored in the database; the label is used only for the interface. Typical configuration: type : \"dropdown\" options : associative array [value => label] default : default key rules : validate with CI4 rules (e.g. required, in_list) Recommended for short and stable lists; for large volumes use addSearch (related selector). Static Example: $this->addField('status', [ 'label' => 'Status', 'type' => 'dropdown', 'options' => [ 'shipped' => 'Shipped', 'pending' => 'Pending', 'cancelled' => 'Cancelled' ], 'default' => 'pending', 'rules' => 'required|in_list[shipped,pending,cancelled]' ]); Dynamic Example (load from DB): $rows = $this->db->table('categories')->select('id, name')->get()->getResultArray(); $options = array_column($rows, 'name', 'id'); $this->addField('categoryId', [ 'label' => 'Category', 'type' => 'dropdown', 'options' => $options, 'rules' => 'required|in_list[' . implode(',', array_keys($options)) . ']' ]); Placeholder / empty option: Add an entry with an empty key to force selection: options => ['' => '(Select)'] + $options . Validation and Security: Use in_list to avoid disallowed values. If options are dynamic, regenerate the list on each form load so in_list matches. UX and Performance: Dropdown for <~20-30 options. For relations with many rows, use addSearch or an autocomplete component. If you need to select multiple values, prefer a multiselect component (or a relation type field); do not use a simple dropdown. Internationalization: Store stable keys and translate labels when generating options to facilitate language changes. Persistence: The stored value is the key; if you need to save the label, consider a calculated field or a view. 13. Switch Field (Boolean) Renders a modern toggle switch. Ideal for boolean or status fields (active/inactive). $this->addField('isActive', [ 'label' => 'Published', 'type' => 'switch', 'default' => 1, // Default value (checked) // Optional: Customize values (defaults are 1 and 0) 'onValue' => 'Y', 'offValue'=> 'N' ]); Handles 1/0 values (or custom). Modern UI (Bootstrap switch). 14. Pillbox Field (Tags) Allows managing a list of simple tags. It is stored in the database as a JSON array. $this->addField('tags', [ 'label' => 'Tags', 'type' => 'pillbox' ]); Interface: Text input that converts entries into \"pills\" upon pressing Enter or Comma. Storage: JSON Array (e.g., [\"Red\", \"Sale\"] ). Requires a JSON or TEXT field in DB. Usage: Simple categorization, keywords. 15. File Upload ( fileupload ) Allows uploading general files to the server. Persistence: Saves the relative path of the file in the database (e.g., assets/uploads/document.pdf ). Smart Validation: Automatically detects insert vs. update scenarios. When editing, if the user does not upload a new file, the previous file is preserved . If the field has file-specific rules (e.g., max_size , ext_in ), they are automatically ignored if no new file is uploaded during an update, preventing validation errors. Automatic Folder Creation: If the destination path does not exist, the system attempts to create it recursively. $this->addField('attached_document', [ 'label' => 'PDF Document', 'type' => 'fileupload', 'uploadPath' => 'assets/docs/contracts', // Destination folder (relative to public/) 'rules' => 'uploaded[attached_document]|ext_in[attached_document,pdf,docx]|max_size[attached_document,4096]' ]); Specific Parameters Parameter Description uploadPath Path relative to the public folder where files will be saved. Default: assets/uploads . rules Standard CodeIgniter 4 file validation rules ( uploaded , max_size , ext_in , mime_in , etc). Important on uploaded Although Ragnos handles optionality during editing, if you want the file to be mandatory upon creation , you must include the uploaded[field] rule. Ragnos will automatically remove it only when it is safe to do so (editing while keeping the previous file). 16. Image Upload ( imageupload ) A specialization of fileupload optimized for images. Preview: Shows an immediate preview of the selected image before saving. Visualization: Displays the currently stored image if it exists. Validation: Identical to fileupload , compatible with is_image , max_dims , etc. $this->addField('profile_photo', [ 'label' => 'Avatar', 'type' => 'imageupload', 'uploadPath' => 'assets/img/users', 'rules' => 'is_image[profile_photo]|max_size[profile_photo,2048]', 'accept' => 'image/*' // HTML attribute for input file ]); Making the image optional If you want the image to be optional even when creating the record, simply omit the uploaded rule. 'rules' => 'is_image[profile_photo]' // Optional, but if something is uploaded, it must be an image 17. Custom Validation Rules Ragnos inherits CodeIgniter 4's ability to define custom validation rules. If you need a validation that doesn't exist by default (for example, validating a specific ID format or checking against an external service), follow these steps: 1. Create the rule class Create a file in the app/Validation/MyCustomRules.php directory (you will need to create the folder if it doesn't exist): namespace App\\Validation; class MyCustomRules { public function even_number(string $str, string &$error = null): bool { if ((int)$str % 2 !== 0) { $error = \"The {field} field must be an even number.\"; return false; } return true; } } 2. Register the rule Edit app/Config/Validation.php to include your new class in the $ruleSets array: public array $ruleSets = [ // ... other existing rules \\App\\Validation\\MyCustomRules::class, ]; 3. Use the rule in the Dataset Now you can use your custom rule in the addField() method of your controller: $this->addField('quantity', [ 'label' => 'Even Quantity', 'rules' => 'required|even_number' ]); In Ragnos, fields are domain declarations, not simple inputs. 18. Summary Type Persistent Editable Text Yes Yes Multiline Text Yes Yes Date / Time Yes Yes Numeric Yes Yes Money Yes Yes Switch (Boolean) Yes Yes Pillbox (Tags) Yes (JSON) Yes File Upload Yes (Path) Yes Image Upload Yes (Path) Yes Readonly Depends No Hidden Depends No Calculated No No Relation Yes Yes Dropdown Yes Yes PK Key Yes Yes","title":"Field Reference"},{"location":"en/datasets/campos/#supported-field-types-in-ragnos","text":"In Ragnos, dataset fields are defined using the addField() method. This method is a fundamental part of the configuration of an RDatasetController . Each field is a declarative description of how a domain attribute: Is validated Is displayed in forms Is displayed in grids Is persisted (or not) in the database Ragnos uses this metadata to automatically generate forms, validations, listings, and CRUD behavior.","title":"Supported Field Types in Ragnos"},{"location":"en/datasets/campos/#1-general-structure-of-addfield","text":"$this->addField('fieldName', [ 'label' => 'Visible label', 'rules' => 'validation|rules', 'type' => 'type', 'query' => 'SQL expression' ]);","title":"1. General Structure of addField()"},{"location":"en/datasets/campos/#common-parameters","text":"Parameter Description label Text visible in forms and grids rules Validation rules (CI4 + Ragnos) type Field type (optional) query SQL expression for calculated fields tab Tab name (optional) Validation Rules Ragnos adopts the powerful CodeIgniter 4 validation engine. You can use rules such as required , is_unique , min_length , valid_email , etc. Consult all available rules in the official CodeIgniter 4 documentation Simplified is_unique Validation Unlike CodeIgniter 4, where is_unique usually requires parameters like is_unique[table.field] , Ragnos simplifies its usage: you only need to specify the keyword is_unique . The framework automatically detects which table and field are being operated on (using the definitions in setTableName and the field name in addField ) to build the verification query. Additionally, it correctly handles exceptions when editing a record (auto-detecting the primary key defined with setIdField to ignore the current record). Common Use Cases: It is ideal for fields that must be unique across the system, such as: Email addresses in a user registry. Usernames or aliases. Product codes (SKU) or barcodes. National ID numbers.","title":"Common Parameters"},{"location":"en/datasets/campos/#tabbed-organization","text":"Ragnos allows you to organize form fields into tabs to improve usability in extensive forms. Simply add the tab key to the field configuration array with the desired tab name. $this->addField('basic_info', [ ... , 'tab' => 'General' ]); $this->addField('technical_details', [ ... , 'tab' => 'Details' ]); $this->addField('pricing', [ ... , 'tab' => 'Finance' ]); Fields without a defined tab will automatically be placed in a tab labeled \"General\" . If no field has a tab defined, the form will be displayed without tabs (classic behavior). If a validation error occurs in a field hidden by a tab, Ragnos will automatically activate that tab to show the error.","title":"Tabbed Organization"},{"location":"en/datasets/campos/#2-text-field-string","text":"$this->addField('customerName', [ 'label' => 'Name', 'rules' => 'required' ]); Persistent Editable Free text","title":"2. Text Field (string)"},{"location":"en/datasets/campos/#3-multiline-text-field-textarea","text":"For long texts like descriptions or comments. $this->addField('productDescription', [ 'label' => 'Description', 'type' => 'textarea', 'rules' => 'required' ]); HTML Variant: Use type => 'htmltextarea' for a basic rich text editor.","title":"3. Multiline Text Field (textarea)"},{"location":"en/datasets/campos/#4-date-and-time-field","text":"Ragnos automatically handles date selection. $this->addField('orderDate', [ 'label' => 'Order Date', 'type' => 'datetime', // or 'date' 'rules' => 'required' ]); Includes date/time picker (datepicker).","title":"4. Date and Time Field"},{"location":"en/datasets/campos/#5-numeric-field","text":"$this->addField('postalCode', [ 'label' => 'Postal code', 'rules' => 'required|numeric' ]); Persistent Editable Numeric","title":"5. Numeric Field"},{"location":"en/datasets/campos/#6-monetary-field-money","text":"$this->addField('creditLimit', [ 'label' => 'Credit limit', 'rules' => 'required|money' ]); Custom validator Automatic normalization Financial use","title":"6. Monetary Field (money)"},{"location":"en/datasets/campos/#7-readonly-field","text":"$this->addField('Contact', [ 'label' => 'Contact', 'rules' => 'readonly' ]); Visible Not editable","title":"7. Readonly Field"},{"location":"en/datasets/campos/#8-hidden-field","text":"$this->addField('Contact', [ 'label' => 'Contact', 'rules' => 'readonly', 'type' => 'hidden' ]); Not visible in forms Useful for logic or UX","title":"8. Hidden Field"},{"location":"en/datasets/campos/#9-calculated-field-query","text":"$this->addField('fullName', [ 'label' => 'Full Name', 'rules' => 'readonly', 'query' => \"concat(contactLastName, ', ', contactFirstName)\", 'type' => 'hidden' ]); Non-persistent (not a real column in the table) Dynamic SQL expression Read-only","title":"9. Calculated Field (query)"},{"location":"en/datasets/campos/#10-related-field-addsearch","text":"Links a field to another controller for selection (Foreign Key). $this->addSearch('salesRepEmployeeNumber', 'Shop\\\\Employees'); Logical foreign key Dynamic selector (modal or autocomplete) Automatic JOIN handling See detailed explanation on Contextual Search and Reports in the Datasets Guide","title":"10. Related Field (addSearch)"},{"location":"en/datasets/campos/#11-primary-key-field","text":"$this->setIdField('customerNumber'); // Disable auto-increment if needed (e.g., for alphanumeric codes) $this->setAutoIncrement(false); Dataset identity Mandatory Defaults to auto-increment","title":"11. Primary Key Field"},{"location":"en/datasets/campos/#12-dropdown-field-enum","text":"Brief description: A dropdown (enum) presents a closed set of options (key => label). The selected key is stored in the database; the label is used only for the interface. Typical configuration: type : \"dropdown\" options : associative array [value => label] default : default key rules : validate with CI4 rules (e.g. required, in_list) Recommended for short and stable lists; for large volumes use addSearch (related selector). Static Example: $this->addField('status', [ 'label' => 'Status', 'type' => 'dropdown', 'options' => [ 'shipped' => 'Shipped', 'pending' => 'Pending', 'cancelled' => 'Cancelled' ], 'default' => 'pending', 'rules' => 'required|in_list[shipped,pending,cancelled]' ]); Dynamic Example (load from DB): $rows = $this->db->table('categories')->select('id, name')->get()->getResultArray(); $options = array_column($rows, 'name', 'id'); $this->addField('categoryId', [ 'label' => 'Category', 'type' => 'dropdown', 'options' => $options, 'rules' => 'required|in_list[' . implode(',', array_keys($options)) . ']' ]); Placeholder / empty option: Add an entry with an empty key to force selection: options => ['' => '(Select)'] + $options . Validation and Security: Use in_list to avoid disallowed values. If options are dynamic, regenerate the list on each form load so in_list matches. UX and Performance: Dropdown for <~20-30 options. For relations with many rows, use addSearch or an autocomplete component. If you need to select multiple values, prefer a multiselect component (or a relation type field); do not use a simple dropdown. Internationalization: Store stable keys and translate labels when generating options to facilitate language changes. Persistence: The stored value is the key; if you need to save the label, consider a calculated field or a view.","title":"12. Dropdown Field (Enum)"},{"location":"en/datasets/campos/#13-switch-field-boolean","text":"Renders a modern toggle switch. Ideal for boolean or status fields (active/inactive). $this->addField('isActive', [ 'label' => 'Published', 'type' => 'switch', 'default' => 1, // Default value (checked) // Optional: Customize values (defaults are 1 and 0) 'onValue' => 'Y', 'offValue'=> 'N' ]); Handles 1/0 values (or custom). Modern UI (Bootstrap switch).","title":"13. Switch Field (Boolean)"},{"location":"en/datasets/campos/#14-pillbox-field-tags","text":"Allows managing a list of simple tags. It is stored in the database as a JSON array. $this->addField('tags', [ 'label' => 'Tags', 'type' => 'pillbox' ]); Interface: Text input that converts entries into \"pills\" upon pressing Enter or Comma. Storage: JSON Array (e.g., [\"Red\", \"Sale\"] ). Requires a JSON or TEXT field in DB. Usage: Simple categorization, keywords.","title":"14. Pillbox Field (Tags)"},{"location":"en/datasets/campos/#15-file-upload-fileupload","text":"Allows uploading general files to the server. Persistence: Saves the relative path of the file in the database (e.g., assets/uploads/document.pdf ). Smart Validation: Automatically detects insert vs. update scenarios. When editing, if the user does not upload a new file, the previous file is preserved . If the field has file-specific rules (e.g., max_size , ext_in ), they are automatically ignored if no new file is uploaded during an update, preventing validation errors. Automatic Folder Creation: If the destination path does not exist, the system attempts to create it recursively. $this->addField('attached_document', [ 'label' => 'PDF Document', 'type' => 'fileupload', 'uploadPath' => 'assets/docs/contracts', // Destination folder (relative to public/) 'rules' => 'uploaded[attached_document]|ext_in[attached_document,pdf,docx]|max_size[attached_document,4096]' ]);","title":"15. File Upload (fileupload)"},{"location":"en/datasets/campos/#specific-parameters","text":"Parameter Description uploadPath Path relative to the public folder where files will be saved. Default: assets/uploads . rules Standard CodeIgniter 4 file validation rules ( uploaded , max_size , ext_in , mime_in , etc). Important on uploaded Although Ragnos handles optionality during editing, if you want the file to be mandatory upon creation , you must include the uploaded[field] rule. Ragnos will automatically remove it only when it is safe to do so (editing while keeping the previous file).","title":"Specific Parameters"},{"location":"en/datasets/campos/#16-image-upload-imageupload","text":"A specialization of fileupload optimized for images. Preview: Shows an immediate preview of the selected image before saving. Visualization: Displays the currently stored image if it exists. Validation: Identical to fileupload , compatible with is_image , max_dims , etc. $this->addField('profile_photo', [ 'label' => 'Avatar', 'type' => 'imageupload', 'uploadPath' => 'assets/img/users', 'rules' => 'is_image[profile_photo]|max_size[profile_photo,2048]', 'accept' => 'image/*' // HTML attribute for input file ]); Making the image optional If you want the image to be optional even when creating the record, simply omit the uploaded rule. 'rules' => 'is_image[profile_photo]' // Optional, but if something is uploaded, it must be an image","title":"16. Image Upload (imageupload)"},{"location":"en/datasets/campos/#17-custom-validation-rules","text":"Ragnos inherits CodeIgniter 4's ability to define custom validation rules. If you need a validation that doesn't exist by default (for example, validating a specific ID format or checking against an external service), follow these steps:","title":"17. Custom Validation Rules"},{"location":"en/datasets/campos/#1-create-the-rule-class","text":"Create a file in the app/Validation/MyCustomRules.php directory (you will need to create the folder if it doesn't exist): namespace App\\Validation; class MyCustomRules { public function even_number(string $str, string &$error = null): bool { if ((int)$str % 2 !== 0) { $error = \"The {field} field must be an even number.\"; return false; } return true; } }","title":"1. Create the rule class"},{"location":"en/datasets/campos/#2-register-the-rule","text":"Edit app/Config/Validation.php to include your new class in the $ruleSets array: public array $ruleSets = [ // ... other existing rules \\App\\Validation\\MyCustomRules::class, ];","title":"2. Register the rule"},{"location":"en/datasets/campos/#3-use-the-rule-in-the-dataset","text":"Now you can use your custom rule in the addField() method of your controller: $this->addField('quantity', [ 'label' => 'Even Quantity', 'rules' => 'required|even_number' ]); In Ragnos, fields are domain declarations, not simple inputs.","title":"3. Use the rule in the Dataset"},{"location":"en/datasets/campos/#18-summary","text":"Type Persistent Editable Text Yes Yes Multiline Text Yes Yes Date / Time Yes Yes Numeric Yes Yes Money Yes Yes Switch (Boolean) Yes Yes Pillbox (Tags) Yes (JSON) Yes File Upload Yes (Path) Yes Image Upload Yes (Path) Yes Readonly Depends No Hidden Depends No Calculated No No Relation Yes Yes Dropdown Yes Yes PK Key Yes Yes","title":"18. Summary"},{"location":"en/datasets/datasets/","text":"\ud83d\udcbe Datasets in Ragnos What is a Dataset? A dataset ( RDatasetController ) is the core concept of Ragnos for declarative development. Instead of writing controllers, models, and views for every CRUD module, a dataset allows defining the structure and behavior of an entity through metadata in the constructor. The framework uses this definition to automatically generate: User Interfaces (Forms and Grids/Lists). Input Validations (Backend and Frontend). SQL Queries and Database Persistence. API Responses. Advantages of Datasets Centralization : Everything (validation, display, persistence) is defined in one place. Productivity : Eliminates the need to write repetitive HTML or basic CRUD queries. Consistency : All modules behave and look the same. Flexibility : Extensions through Hooks and virtual fields. Create a Dataset A dataset is a controller that extends RDatasetController . All configuration is done in the constructor. Minimal Example namespace App\\Controllers\\Store; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Customers extends RDatasetController { public function __construct() { parent::__construct(); // Security and context $this->checkLogin(); $this->setTitle('Customers'); // Persistence $this->setTableName('customers'); $this->setIdField('customerNumber'); $this->setAutoIncrement(false); // Fields $this->addField('customerName', [ 'label' => 'Name', 'rules' => 'required' ]); // Calculated field $this->addField('Contact', [ 'label' => 'Contact', 'rules' => 'readonly', 'query' => \"concat(contactLastName, ', ', contactFirstName)\", 'type' => 'hidden' ]); // Relationships $this->addSearch('salesRepEmployeeNumber', 'Store\\\\Employees'); // Grid $this->setTableFields([ 'customerName', 'Contact', 'salesRepEmployeeNumber' ]); } } Security and Context checkLogin() to require active session. setTitle() for module title and breadcrumbs. Security by Default Always call checkLogin() at the beginning of the constructor if your module should be private. If you forget this line, the module will be publicly accessible. Table and Primary Key setTableName('table') defines the main table. !!! warning \"Consistency with DB\" The value of setTableName must exactly match the name of the physical table in your database. Ragnos does not create the table for you; it assumes it already exists. setIdField('id') establishes the primary key. setAutoIncrement(true|false) controls if the PK is auto-incrementing. Field Definition Use addField(name, options) to describe validation, presentation, and persistence. For a complete reference of all options and field types, consult the Field Guide . Common options: label : visible text. Relationships between Datasets ( addSearch ) For complex header-lines relationships, see Master-Detail . The addSearch(localField, 'Namespace\\Of\\RelatedDataset') function is a powerful tool connecting two datasets. Intelligent Contextual Search By linking a field to another dataset, Ragnos automatically enables contextual searches . This means the search criteria is not limited to just the ID or the main field, but extends to all visible fields defined in the setTableFields() of the related dataset. Example: Imagine you are in the Payments module ( Store/Payments ) and need to select a Customer . If in the Customers dataset ( Store/Customers ) you defined: $this->setTableFields([ 'customerName', 'Contact', // Calculated field: concat(contactLastName, ', ', contactFirstName) 'salesRepEmployeeNumber' // Sales Rep ]); When searching for a customer from the Payments form, you can type: Part of the Company Name ( customerName ). The Contact Name ( Contact ). Or even the Sales Rep Name . Ragnos will search for matches in any of those fields defined in the target dataset, offering a much more flexible and powerful user experience without writing additional SQL. Automatic Grouping in Reports Another key advantage is that fields associated via addSearch automatically become grouping criteria available in the report generator. This allows grouping metrics (like total sales) by any of the search criteria (e.g., Sales by Customer's \"Sales Rep\") with no extra configuration. Advantages of addSearch Reusability : Define the logic of \"how to search for a customer\" once in the Customers dataset, and reuse it in Payments, Orders, etc. No Manual Joins : The framework manages the underlying queries. Superior UX : Intuitive selectors searching by multiple relevant attributes. Grid Configuration setTableFields([...]) defines visible columns in the list (DataTable). Importance of the first field The first field added in setTableFields() is very relevant, as it is the field that will be used as the \"description\" of the record . This is the text that appears when selecting the record in search controls, or in dropdowns associated with this catalog. Therefore, it is important to select it very well. It can be a calculated field that combines two or more fields, as in the case of the \"employees\" catalog where fullName (or nombreCompleto ) is used as the first field. Can include virtual fields and labels. setSortingFields([...]) for default sorting.","title":"Creating Datasets"},{"location":"en/datasets/datasets/#datasets-in-ragnos","text":"","title":"\ud83d\udcbe Datasets in Ragnos"},{"location":"en/datasets/datasets/#what-is-a-dataset","text":"A dataset ( RDatasetController ) is the core concept of Ragnos for declarative development. Instead of writing controllers, models, and views for every CRUD module, a dataset allows defining the structure and behavior of an entity through metadata in the constructor. The framework uses this definition to automatically generate: User Interfaces (Forms and Grids/Lists). Input Validations (Backend and Frontend). SQL Queries and Database Persistence. API Responses.","title":"What is a Dataset?"},{"location":"en/datasets/datasets/#advantages-of-datasets","text":"Centralization : Everything (validation, display, persistence) is defined in one place. Productivity : Eliminates the need to write repetitive HTML or basic CRUD queries. Consistency : All modules behave and look the same. Flexibility : Extensions through Hooks and virtual fields.","title":"Advantages of Datasets"},{"location":"en/datasets/datasets/#create-a-dataset","text":"A dataset is a controller that extends RDatasetController . All configuration is done in the constructor.","title":"Create a Dataset"},{"location":"en/datasets/datasets/#minimal-example","text":"namespace App\\Controllers\\Store; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Customers extends RDatasetController { public function __construct() { parent::__construct(); // Security and context $this->checkLogin(); $this->setTitle('Customers'); // Persistence $this->setTableName('customers'); $this->setIdField('customerNumber'); $this->setAutoIncrement(false); // Fields $this->addField('customerName', [ 'label' => 'Name', 'rules' => 'required' ]); // Calculated field $this->addField('Contact', [ 'label' => 'Contact', 'rules' => 'readonly', 'query' => \"concat(contactLastName, ', ', contactFirstName)\", 'type' => 'hidden' ]); // Relationships $this->addSearch('salesRepEmployeeNumber', 'Store\\\\Employees'); // Grid $this->setTableFields([ 'customerName', 'Contact', 'salesRepEmployeeNumber' ]); } }","title":"Minimal Example"},{"location":"en/datasets/datasets/#security-and-context","text":"checkLogin() to require active session. setTitle() for module title and breadcrumbs. Security by Default Always call checkLogin() at the beginning of the constructor if your module should be private. If you forget this line, the module will be publicly accessible.","title":"Security and Context"},{"location":"en/datasets/datasets/#table-and-primary-key","text":"setTableName('table') defines the main table. !!! warning \"Consistency with DB\" The value of setTableName must exactly match the name of the physical table in your database. Ragnos does not create the table for you; it assumes it already exists. setIdField('id') establishes the primary key. setAutoIncrement(true|false) controls if the PK is auto-incrementing.","title":"Table and Primary Key"},{"location":"en/datasets/datasets/#field-definition","text":"Use addField(name, options) to describe validation, presentation, and persistence. For a complete reference of all options and field types, consult the Field Guide . Common options: label : visible text.","title":"Field Definition"},{"location":"en/datasets/datasets/#relationships-between-datasets-addsearch","text":"For complex header-lines relationships, see Master-Detail . The addSearch(localField, 'Namespace\\Of\\RelatedDataset') function is a powerful tool connecting two datasets.","title":"Relationships between Datasets (addSearch)"},{"location":"en/datasets/datasets/#intelligent-contextual-search","text":"By linking a field to another dataset, Ragnos automatically enables contextual searches . This means the search criteria is not limited to just the ID or the main field, but extends to all visible fields defined in the setTableFields() of the related dataset. Example: Imagine you are in the Payments module ( Store/Payments ) and need to select a Customer . If in the Customers dataset ( Store/Customers ) you defined: $this->setTableFields([ 'customerName', 'Contact', // Calculated field: concat(contactLastName, ', ', contactFirstName) 'salesRepEmployeeNumber' // Sales Rep ]); When searching for a customer from the Payments form, you can type: Part of the Company Name ( customerName ). The Contact Name ( Contact ). Or even the Sales Rep Name . Ragnos will search for matches in any of those fields defined in the target dataset, offering a much more flexible and powerful user experience without writing additional SQL.","title":"Intelligent Contextual Search"},{"location":"en/datasets/datasets/#automatic-grouping-in-reports","text":"Another key advantage is that fields associated via addSearch automatically become grouping criteria available in the report generator. This allows grouping metrics (like total sales) by any of the search criteria (e.g., Sales by Customer's \"Sales Rep\") with no extra configuration.","title":"Automatic Grouping in Reports"},{"location":"en/datasets/datasets/#advantages-of-addsearch","text":"Reusability : Define the logic of \"how to search for a customer\" once in the Customers dataset, and reuse it in Payments, Orders, etc. No Manual Joins : The framework manages the underlying queries. Superior UX : Intuitive selectors searching by multiple relevant attributes.","title":"Advantages of addSearch"},{"location":"en/datasets/datasets/#grid-configuration","text":"setTableFields([...]) defines visible columns in the list (DataTable). Importance of the first field The first field added in setTableFields() is very relevant, as it is the field that will be used as the \"description\" of the record . This is the text that appears when selecting the record in search controls, or in dropdowns associated with this catalog. Therefore, it is important to select it very well. It can be a calculated field that combines two or more fields, as in the case of the \"employees\" catalog where fullName (or nombreCompleto ) is used as the first field. Can include virtual fields and labels. setSortingFields([...]) for default sorting.","title":"Grid Configuration"},{"location":"en/datasets/guia_RQueryController/","text":"Reference Guide: RQueryController RQueryController is a specialized variant of the Ragnos base controller designed for read-only queries and advanced searches . Unlike RDatasetController (which maps to a physical table to perform CRUD), RQueryController maps to an Arbitrary SQL Query . \ud83c\udfaf When to use RQueryController? Use this controller when: You don't need to edit: You only want to list, search, and filter data. The data is complex: You need to perform JOINs , subqueries, or calculated fields (e.g., CONCAT , CASE WHEN ) that do not exist in a single physical table. Quick Reports: You want to expose a database view in the administrative system quickly. \ud83e\uddec Basic Structure A query controller extends from RQueryController and defines its logic in the constructor. Analyzed Example: Searchusuarios.php namespace App\\Controllers; use App\\ThirdParty\\Ragnos\\Controllers\\RQueryController; class SearchUsers extends RQueryController { public function __construct() { parent::__construct(); // 1. Security $this->checkUserInGroup('Administrator'); // 2. Visual Configuration $this->setTitle('\ud83d\udd0e Users'); // 3. Data Source (SQL) $this->setQuery(\"SELECT usu_id, usu_nombre as 'Name', usu_login as 'Login', usu_activo as Active, usu_grupo FROM gen_usuarios\"); // 4. Primary Key (Virtual or Real) $this->setIdField('usu_id'); // 5. Field Configuration (Filters and Visualization) $this->addField('Active', [ 'label' => 'Active', 'type' => 'dropdown', 'options' => ['S' => 'YES', 'N' => 'NO'], ]); $this->addField('usu_grupo', ['label' => 'Group']); // 6. Relationships for Search $this->addSearch('usu_grupo', 'UserGroups'); // 7. Grid Definition $this->setTableFields(['Name', 'Login', 'Active', 'usu_grupo']); } } \ud83d\udcda Key Methods setQuery(string $sql) Defines the data source. Important: Do not use ORDER BY or LIMIT here; Ragnos injects them dynamically according to user interaction in the grid. Alias: It is highly recommended to use SQL aliases ( AS 'Name' ) so table headers are automatically readable. setIdField(string $field) Even if it is a custom query, Ragnos needs to know which column uniquely identifies each row (for selection, details, etc.). Must be present in the SELECT of setQuery . addField(string $name, array $config) Works the same as in RDatasetController , but here it is mainly used to generate search filters . If you define a field as 'type' => 'dropdown' , Ragnos will create a <select> in the advanced search bar. addSearch(string $field, string $controller) Allows linking a column of your query to another Ragnos controller. This enables the magnifying glass icon to search for related values. checkUserInGroup(string|array $groups) Restricts access to this controller exclusively for the specified user groups.","title":"Advanced Queries (RQuery)"},{"location":"en/datasets/guia_RQueryController/#reference-guide-rquerycontroller","text":"RQueryController is a specialized variant of the Ragnos base controller designed for read-only queries and advanced searches . Unlike RDatasetController (which maps to a physical table to perform CRUD), RQueryController maps to an Arbitrary SQL Query .","title":"Reference Guide: RQueryController"},{"location":"en/datasets/guia_RQueryController/#when-to-use-rquerycontroller","text":"Use this controller when: You don't need to edit: You only want to list, search, and filter data. The data is complex: You need to perform JOINs , subqueries, or calculated fields (e.g., CONCAT , CASE WHEN ) that do not exist in a single physical table. Quick Reports: You want to expose a database view in the administrative system quickly.","title":"\ud83c\udfaf When to use RQueryController?"},{"location":"en/datasets/guia_RQueryController/#basic-structure","text":"A query controller extends from RQueryController and defines its logic in the constructor. Analyzed Example: Searchusuarios.php namespace App\\Controllers; use App\\ThirdParty\\Ragnos\\Controllers\\RQueryController; class SearchUsers extends RQueryController { public function __construct() { parent::__construct(); // 1. Security $this->checkUserInGroup('Administrator'); // 2. Visual Configuration $this->setTitle('\ud83d\udd0e Users'); // 3. Data Source (SQL) $this->setQuery(\"SELECT usu_id, usu_nombre as 'Name', usu_login as 'Login', usu_activo as Active, usu_grupo FROM gen_usuarios\"); // 4. Primary Key (Virtual or Real) $this->setIdField('usu_id'); // 5. Field Configuration (Filters and Visualization) $this->addField('Active', [ 'label' => 'Active', 'type' => 'dropdown', 'options' => ['S' => 'YES', 'N' => 'NO'], ]); $this->addField('usu_grupo', ['label' => 'Group']); // 6. Relationships for Search $this->addSearch('usu_grupo', 'UserGroups'); // 7. Grid Definition $this->setTableFields(['Name', 'Login', 'Active', 'usu_grupo']); } }","title":"\ud83e\uddec Basic Structure"},{"location":"en/datasets/guia_RQueryController/#key-methods","text":"","title":"\ud83d\udcda Key Methods"},{"location":"en/datasets/guia_RQueryController/#setquerystring-sql","text":"Defines the data source. Important: Do not use ORDER BY or LIMIT here; Ragnos injects them dynamically according to user interaction in the grid. Alias: It is highly recommended to use SQL aliases ( AS 'Name' ) so table headers are automatically readable.","title":"setQuery(string $sql)"},{"location":"en/datasets/guia_RQueryController/#setidfieldstring-field","text":"Even if it is a custom query, Ragnos needs to know which column uniquely identifies each row (for selection, details, etc.). Must be present in the SELECT of setQuery .","title":"setIdField(string $field)"},{"location":"en/datasets/guia_RQueryController/#addfieldstring-name-array-config","text":"Works the same as in RDatasetController , but here it is mainly used to generate search filters . If you define a field as 'type' => 'dropdown' , Ragnos will create a <select> in the advanced search bar.","title":"addField(string $name, array $config)"},{"location":"en/datasets/guia_RQueryController/#addsearchstring-field-string-controller","text":"Allows linking a column of your query to another Ragnos controller. This enables the magnifying glass icon to search for related values.","title":"addSearch(string $field, string $controller)"},{"location":"en/datasets/guia_RQueryController/#checkuseringroupstringarray-groups","text":"Restricts access to this controller exclusively for the specified user groups.","title":"checkUserInGroup(string|array $groups)"},{"location":"en/datasets/maestro-detalle/","text":"\ud83d\udcd1 Master-Detail Relationship in Ragnos This guide explains how to create a screen where you have a main record (like a Purchase Order ) and a list of related items (the Details or products of that order). Relationship Architecture graph TD User[\"User\"] -->|Opens Screen| Master[\"Master Controller (Orders)\"] Master -->|Renders| View[\"Main View\"] View -->|Contains| Form[\"Master Form\"] subgraph Linkage [\"Linkage Logic\"] direction TB Form -->|\"Order ID\"| Logic{\"Order Exists?\"} Logic -- NO --> Info(\"Only shows Form\") Logic -- \"YES (ID=100)\" --> LoadDetails[\"Load Detail Controller\"] end LoadDetails -->|\"Injects ID=100 as $this->master\"| Detail[\"Detail Controller (OrderDetails)\"] subgraph Detail [\"Detail Zone\"] direction TB Detail -->|Apply Filter| Filter[\"WHERE orderNumber = 100\"] Filter -->|Shows| Grid[\"Product Grid\"] Grid -->|New Record| NewLine[\"Detail Form\"] NewLine -->|Hidden Field| Hidden[\"orderNumber = 100\"] end %% Professional Styles classDef mainNode fill:#f9f,stroke:#333,stroke-width:2px; classDef detailNode fill:#bbf,stroke:#333,stroke-width:2px; classDef logicNode fill:#fff9c4,stroke:#fbc02d,stroke-width:2px; style Master fill:#e1bee7,stroke:#4a148c,stroke-width:2px style Detail fill:#bbdefb,stroke:#0d47a1,stroke-width:2px style Hidden fill:#c8e6c9,stroke:#2e7d32,stroke-dasharray: 5 5 The basic idea is to have two controllers: The Master (Orders): Controls general information (date, customer, total). The Detail (OrderDetails): Controls the list of products within that order. 1. Configuring the Master ( Orders Controller) This is the \"parent\" of the relationship. Here we define the invoice header. Basic Configuration: We tell Ragnos to use the orders table and that the primary key is orderNumber . Fields: We define normal fields like date ( orderDate ), status ( status ), and customer ( customerNumber ). Total Field (Calculated): To show the order total without saving it manually, we use a small SQL query within the field configuration. This query sums quantity * price from the details table. Activate Detail Mode: There is a key line you must add to your master controller to warn that it will have \"children\": $this->setDetailsController('Store\\OrderDetails'); This tells Ragnos that the OrderDetails controller will handle the details related to each order. The relationship is based on the orderNumber field in both controllers being the same, and this is the primary key in the master. 2. Configuring the Detail ( OrderDetails Controller) This is the \"child\". It controls each product line. The Hidden Field Trick: We need each product to know which order it belongs to. For that, in the orderNumber field of the detail, we do two things: We set it as hidden so the user doesn't touch it. We assign the default value $this->master . What does this do? When you create a detail from order #100, Ragnos automatically fills this field with the number 100. Filter Data: We don't want to see all products from all orders. In the _filters() method, we add a rule so that only products matching the current master ID ( $this->master ) are loaded. function _filters() { $this->modelo->builder()->where('orderNumber', $this->master); } In this snippet, $this->modelo->builder() allows you to interact directly with the SQL query that the grid will generate. The $this->master variable is automatically injected by the framework when it detects that this controller is running as a \"child\", and contains the ID of the record being viewed in the master (in this case, the order number). Update Changes: We use special functions (called hooks ) like _afterInsert or _afterUpdate to clear the cache. This ensures that if you add a product, the main order total is recalculated correctly. \ud83d\udc49 See Hooks Guide Custom JavaScript Hooks (Optional) The following function has been added to the custom.js file: // with every change in the order details table // recalculate the order total function _OrderDetailsOnChange ( table ) { let order = $ ( \"input[name='orderNumber']\" ). val (); getObject ( \"store/orders/calculatetotal\" , { order : order }, function ( data ) { $ ( 'input[name=\"total\"]' ). val ( data . total ); }); }","title":"Master-Detail"},{"location":"en/datasets/maestro-detalle/#master-detail-relationship-in-ragnos","text":"This guide explains how to create a screen where you have a main record (like a Purchase Order ) and a list of related items (the Details or products of that order).","title":"\ud83d\udcd1 Master-Detail Relationship in Ragnos"},{"location":"en/datasets/maestro-detalle/#relationship-architecture","text":"graph TD User[\"User\"] -->|Opens Screen| Master[\"Master Controller (Orders)\"] Master -->|Renders| View[\"Main View\"] View -->|Contains| Form[\"Master Form\"] subgraph Linkage [\"Linkage Logic\"] direction TB Form -->|\"Order ID\"| Logic{\"Order Exists?\"} Logic -- NO --> Info(\"Only shows Form\") Logic -- \"YES (ID=100)\" --> LoadDetails[\"Load Detail Controller\"] end LoadDetails -->|\"Injects ID=100 as $this->master\"| Detail[\"Detail Controller (OrderDetails)\"] subgraph Detail [\"Detail Zone\"] direction TB Detail -->|Apply Filter| Filter[\"WHERE orderNumber = 100\"] Filter -->|Shows| Grid[\"Product Grid\"] Grid -->|New Record| NewLine[\"Detail Form\"] NewLine -->|Hidden Field| Hidden[\"orderNumber = 100\"] end %% Professional Styles classDef mainNode fill:#f9f,stroke:#333,stroke-width:2px; classDef detailNode fill:#bbf,stroke:#333,stroke-width:2px; classDef logicNode fill:#fff9c4,stroke:#fbc02d,stroke-width:2px; style Master fill:#e1bee7,stroke:#4a148c,stroke-width:2px style Detail fill:#bbdefb,stroke:#0d47a1,stroke-width:2px style Hidden fill:#c8e6c9,stroke:#2e7d32,stroke-dasharray: 5 5 The basic idea is to have two controllers: The Master (Orders): Controls general information (date, customer, total). The Detail (OrderDetails): Controls the list of products within that order.","title":"Relationship Architecture"},{"location":"en/datasets/maestro-detalle/#1-configuring-the-master-orders-controller","text":"This is the \"parent\" of the relationship. Here we define the invoice header. Basic Configuration: We tell Ragnos to use the orders table and that the primary key is orderNumber . Fields: We define normal fields like date ( orderDate ), status ( status ), and customer ( customerNumber ). Total Field (Calculated): To show the order total without saving it manually, we use a small SQL query within the field configuration. This query sums quantity * price from the details table. Activate Detail Mode: There is a key line you must add to your master controller to warn that it will have \"children\": $this->setDetailsController('Store\\OrderDetails'); This tells Ragnos that the OrderDetails controller will handle the details related to each order. The relationship is based on the orderNumber field in both controllers being the same, and this is the primary key in the master.","title":"1. Configuring the Master (Orders Controller)"},{"location":"en/datasets/maestro-detalle/#2-configuring-the-detail-orderdetails-controller","text":"This is the \"child\". It controls each product line. The Hidden Field Trick: We need each product to know which order it belongs to. For that, in the orderNumber field of the detail, we do two things: We set it as hidden so the user doesn't touch it. We assign the default value $this->master . What does this do? When you create a detail from order #100, Ragnos automatically fills this field with the number 100. Filter Data: We don't want to see all products from all orders. In the _filters() method, we add a rule so that only products matching the current master ID ( $this->master ) are loaded. function _filters() { $this->modelo->builder()->where('orderNumber', $this->master); } In this snippet, $this->modelo->builder() allows you to interact directly with the SQL query that the grid will generate. The $this->master variable is automatically injected by the framework when it detects that this controller is running as a \"child\", and contains the ID of the record being viewed in the master (in this case, the order number). Update Changes: We use special functions (called hooks ) like _afterInsert or _afterUpdate to clear the cache. This ensures that if you add a product, the main order total is recalculated correctly. \ud83d\udc49 See Hooks Guide","title":"2. Configuring the Detail (OrderDetails Controller)"},{"location":"en/datasets/maestro-detalle/#custom-javascript-hooks-optional","text":"The following function has been added to the custom.js file: // with every change in the order details table // recalculate the order total function _OrderDetailsOnChange ( table ) { let order = $ ( \"input[name='orderNumber']\" ). val (); getObject ( \"store/orders/calculatetotal\" , { order : order }, function ( data ) { $ ( 'input[name=\"total\"]' ). val ( data . total ); }); }","title":"Custom JavaScript Hooks (Optional)"},{"location":"en/frontend/funciones_javascript/","text":"\u26a1 JavaScript Functions: getValue and getObject This document describes the utility functions getValue and getObject , used in the project to perform asynchronous requests to the server. These functions simplify the use of fetch and handle parameter serialization, timeouts, and retries. getValue(url, params, callback) Performs a POST HTTP request to a specified URL and returns the response as plain text. Parameters url (string): The URL to request. Internally processed with fixUrl , so it can be a relative path. params (object, optional): An object with parameters sent in the request body (encoded as application/x-www-form-urlencoded ). In addition to data, this object accepts special configurations: timeout (number): Max wait time in milliseconds (default: 12000). retryAttempts (number): Number of attempts in case of failure (default: 1). retryDelay (number): Delay between attempts in milliseconds (default: 1000). callback (function, optional): A function executed upon request completion. Receives two arguments: (response, error) . Return If callback is provided, the function returns nothing and result is handled in the callback. If no callback is provided, returns a Promise that resolves with the response text or rejects with an error. Reference Examples Modernize your code Although callbacks are supported, we strongly recommend using async/await syntax for cleaner and more readable code, avoiding \"callback hell\". Basic Usage with Promises (Async/Await): try { const responseText = await getValue ( \"controller/method\" , { id : 123 }); console . log ( \"Server response:\" , responseText ); } catch ( error ) { console . error ( \"An error occurred:\" , error ); } Usage with Callback: getValue ( \"controller/method\" , { user : \"juan\" }, function ( response , error ) { if ( error ) { console . error ( \"Error:\" , error ); } else { console . log ( \"Response:\" , response ); } }); Timeout and Retry Configuration: const params = { data : \"value\" , timeout : 5000 , // Wait max 5 seconds retryAttempts : 3 , // Retry up to 3 times if it fails }; try { const res = await getValue ( \"api/data\" , params ); } catch ( e ) { console . error ( \"Failed after 3 attempts\" ); } getObject(purl, pparameters, callbackfunction) A wrapper function for getValue . Performs the request and automatically tries to parse the response as a JSON object. Parameters purl (string): The URL to request. pparameters (object): Object with parameters to send. callbackfunction (function, optional): Callback function receiving (object, error) . object : The parsed JSON result if successful (or null if error). error : Error object if request failed or JSON is invalid (or null if successful). Return If callbackfunction is used, returns nothing explicit. If no callbackfunction is used, returns a Promise resolving with the parsed JavaScript object or rejects with error. Reference Examples Basic usage to get JSON data: // Suppose server returns: {\"name\": \"Ragnos\", \"version\": 1.0} try { const data = await getObject ( \"api/config\" , { module : \"admin\" }); console . log ( \"System Name:\" , data . name ); } catch ( error ) { console . error ( \"Error getting config:\" , error ); } Usage with Callback: getObject ( \"customers/search\" , { q : \"Company X\" }, function ( customers , error ) { if ( error ) { alert ( \"Search error\" ); return ; } // 'customers' is already a JS array or object customers . forEach (( c ) => console . log ( c . name )); }); RagnosSearch and Related Classes The RagnosSearch class and its helper methods provide a standardized interface for performing searches on inputs, integrating GUI (buttons) and result handling. RagnosSearch.setupSimpleSearch(element, route, params, callback) Static method to configure simple search on an existing input. Transforms input by adding search and clear buttons. Parameters element (jQuery Selector | DOM Element): The input to enable search on. route (string): Server URL (Controller/Method) to process search. params (object): Additional configuration. canSetToNull (boolean): Defines if \"X\" button is shown to clear field (Default: true ). callback (function): Function to execute after successful search. Receives jQuery object of input as argument e . Return Returns nothing. Modifies input DOM. Usage Example RagnosSearch . setupSimpleSearch ( $ ( \"#myInput\" ), \"admin/users/search\" , {}, function ( e ) { // Result data is attached to jQuery object in 'searchdata' let result = e . data ( \"searchdata\" ); if ( result ) { console . log ( \"Selected ID:\" , result . id ); console . log ( \"Name:\" , result . name ); // Assign value to visible input e . val ( result . name ); } }, ); $(selector).RagnosSearch(params) jQuery plugin instantiating RagnosSearch class. Designed for complex searches, typically linked to a standard system controller ( RagnosController ) implementing searchByAjax and supporting structured filters. Parameters ( params ) Configuration object with: controller (string): Name of controller managing search (e.g. 'users' , 'products' ). System searches controller/searchByAjax . filter (string): Base64 string containing JSON array of filters. Structure: Base64( JSON_String([ {field, op, value}, ... ]) ) . callback (function): Function to execute on result selection. canSetToNull (boolean): (Optional) Allows clearing the field. Usage Example $ ( \"#advancedSearchInput\" ). RagnosSearch ({ controller : \"users\" , // Searches in: users/searchByAjax // Filter: Active users (usu_activo = 'S') and group 2 filter : btoa ( JSON . stringify ([ { field : \"usu_activo\" , op : \"=\" , value : \"S\" }, { field : \"usu_grupo\" , op : \"=\" , value : 2 }, ]), ), callback : function ( e ) { let data = e . data ( \"searchdata\" ); console . log ( \"Received data:\" , data ); if ( data && data . id ) { // Custom logic } }, }); System Hooks and Functions in custom.js The custom.js file is the designated place for application-specific logic, including \"hooks\" (handlers) the system automatically invokes based on naming conventions. This allows extending search and table functionality without modifying core. Hook Naming Convention System automatically detects global functions with specific naming patterns to execute actions after events. 1. Search Hooks ( _FieldNameOnSearch ) Executed automatically after a RagnosSearch control completes a selection. Pattern: _{input_id}OnSearch Parameter: Receives control (input) jQuery object. Usage: Ideal for filling other form fields based on search result. System Example ( _productCodeOnSearch ): When a product is selected in productCode input, this function finds priceEach input in order detail and assigns MSRP. // Activated when selecting something in <input id=\"productCode\" ...> function _productCodeOnSearch ( control ) { // 'control' is product code input // Access data returned by search with .data(\"searchdata\") let data = control . data ( \"searchdata\" ); // Update another field (Unit Price) with product MSRP $ ( '#orderdetail input[name=\"priceEach\"]' ). val ( data . MSRP ); } 2. Table Change Hooks ( _TableNameOnChange ) Executed when a managed table changes (e.g. adding/editing rows in detail table). Pattern: _{table_id}OnChange Parameter: Receives table object or change context. Usage: Total recalculations, cross-validations. System Example ( _OrderDetailsOnChange ): Every time something changes in OrderDetails table, complete order total is recalculated by calling server. // Activated when modifying table <table id=\"OrderDetails\" ...> function _OrderDetailsOnChange ( table ) { // Get current order ID let order = $ ( \"input[name='orderNumber']\" ). val (); // Call server to recalculate total getObject ( \"store/orders/calculatetotal\" , { order : order }, function ( data ) { // Update visual Total field $ ( 'input[name=\"total\"]' ). val ( data . total ); }); } Custom Utility Functions Normal functions can also be defined for explicit callbacks in search configs. Example ( officeSearchTest ): Simple function designed to be passed as callback parameter in RagnosSearch . function officeSearchTest ( e ) { let data = e . data ( \"searchdata\" ); console . log ( \"Office search data:\" , data ); } // Usage: // $('#office').RagnosSearch({ ..., callback: officeSearchTest });","title":"JavaScript Functions"},{"location":"en/frontend/funciones_javascript/#javascript-functions-getvalue-and-getobject","text":"This document describes the utility functions getValue and getObject , used in the project to perform asynchronous requests to the server. These functions simplify the use of fetch and handle parameter serialization, timeouts, and retries.","title":"\u26a1 JavaScript Functions: getValue and getObject"},{"location":"en/frontend/funciones_javascript/#getvalueurl-params-callback","text":"Performs a POST HTTP request to a specified URL and returns the response as plain text.","title":"getValue(url, params, callback)"},{"location":"en/frontend/funciones_javascript/#parameters","text":"url (string): The URL to request. Internally processed with fixUrl , so it can be a relative path. params (object, optional): An object with parameters sent in the request body (encoded as application/x-www-form-urlencoded ). In addition to data, this object accepts special configurations: timeout (number): Max wait time in milliseconds (default: 12000). retryAttempts (number): Number of attempts in case of failure (default: 1). retryDelay (number): Delay between attempts in milliseconds (default: 1000). callback (function, optional): A function executed upon request completion. Receives two arguments: (response, error) .","title":"Parameters"},{"location":"en/frontend/funciones_javascript/#return","text":"If callback is provided, the function returns nothing and result is handled in the callback. If no callback is provided, returns a Promise that resolves with the response text or rejects with an error.","title":"Return"},{"location":"en/frontend/funciones_javascript/#reference-examples","text":"Modernize your code Although callbacks are supported, we strongly recommend using async/await syntax for cleaner and more readable code, avoiding \"callback hell\". Basic Usage with Promises (Async/Await): try { const responseText = await getValue ( \"controller/method\" , { id : 123 }); console . log ( \"Server response:\" , responseText ); } catch ( error ) { console . error ( \"An error occurred:\" , error ); } Usage with Callback: getValue ( \"controller/method\" , { user : \"juan\" }, function ( response , error ) { if ( error ) { console . error ( \"Error:\" , error ); } else { console . log ( \"Response:\" , response ); } }); Timeout and Retry Configuration: const params = { data : \"value\" , timeout : 5000 , // Wait max 5 seconds retryAttempts : 3 , // Retry up to 3 times if it fails }; try { const res = await getValue ( \"api/data\" , params ); } catch ( e ) { console . error ( \"Failed after 3 attempts\" ); }","title":"Reference Examples"},{"location":"en/frontend/funciones_javascript/#getobjectpurl-pparameters-callbackfunction","text":"A wrapper function for getValue . Performs the request and automatically tries to parse the response as a JSON object.","title":"getObject(purl, pparameters, callbackfunction)"},{"location":"en/frontend/funciones_javascript/#parameters_1","text":"purl (string): The URL to request. pparameters (object): Object with parameters to send. callbackfunction (function, optional): Callback function receiving (object, error) . object : The parsed JSON result if successful (or null if error). error : Error object if request failed or JSON is invalid (or null if successful).","title":"Parameters"},{"location":"en/frontend/funciones_javascript/#return_1","text":"If callbackfunction is used, returns nothing explicit. If no callbackfunction is used, returns a Promise resolving with the parsed JavaScript object or rejects with error.","title":"Return"},{"location":"en/frontend/funciones_javascript/#reference-examples_1","text":"Basic usage to get JSON data: // Suppose server returns: {\"name\": \"Ragnos\", \"version\": 1.0} try { const data = await getObject ( \"api/config\" , { module : \"admin\" }); console . log ( \"System Name:\" , data . name ); } catch ( error ) { console . error ( \"Error getting config:\" , error ); } Usage with Callback: getObject ( \"customers/search\" , { q : \"Company X\" }, function ( customers , error ) { if ( error ) { alert ( \"Search error\" ); return ; } // 'customers' is already a JS array or object customers . forEach (( c ) => console . log ( c . name )); });","title":"Reference Examples"},{"location":"en/frontend/funciones_javascript/#ragnossearch-and-related-classes","text":"The RagnosSearch class and its helper methods provide a standardized interface for performing searches on inputs, integrating GUI (buttons) and result handling.","title":"RagnosSearch and Related Classes"},{"location":"en/frontend/funciones_javascript/#ragnossearchsetupsimplesearchelement-route-params-callback","text":"Static method to configure simple search on an existing input. Transforms input by adding search and clear buttons.","title":"RagnosSearch.setupSimpleSearch(element, route, params, callback)"},{"location":"en/frontend/funciones_javascript/#parameters_2","text":"element (jQuery Selector | DOM Element): The input to enable search on. route (string): Server URL (Controller/Method) to process search. params (object): Additional configuration. canSetToNull (boolean): Defines if \"X\" button is shown to clear field (Default: true ). callback (function): Function to execute after successful search. Receives jQuery object of input as argument e .","title":"Parameters"},{"location":"en/frontend/funciones_javascript/#return_2","text":"Returns nothing. Modifies input DOM.","title":"Return"},{"location":"en/frontend/funciones_javascript/#usage-example","text":"RagnosSearch . setupSimpleSearch ( $ ( \"#myInput\" ), \"admin/users/search\" , {}, function ( e ) { // Result data is attached to jQuery object in 'searchdata' let result = e . data ( \"searchdata\" ); if ( result ) { console . log ( \"Selected ID:\" , result . id ); console . log ( \"Name:\" , result . name ); // Assign value to visible input e . val ( result . name ); } }, );","title":"Usage Example"},{"location":"en/frontend/funciones_javascript/#selectorragnossearchparams","text":"jQuery plugin instantiating RagnosSearch class. Designed for complex searches, typically linked to a standard system controller ( RagnosController ) implementing searchByAjax and supporting structured filters.","title":"$(selector).RagnosSearch(params)"},{"location":"en/frontend/funciones_javascript/#parameters-params","text":"Configuration object with: controller (string): Name of controller managing search (e.g. 'users' , 'products' ). System searches controller/searchByAjax . filter (string): Base64 string containing JSON array of filters. Structure: Base64( JSON_String([ {field, op, value}, ... ]) ) . callback (function): Function to execute on result selection. canSetToNull (boolean): (Optional) Allows clearing the field.","title":"Parameters (params)"},{"location":"en/frontend/funciones_javascript/#usage-example_1","text":"$ ( \"#advancedSearchInput\" ). RagnosSearch ({ controller : \"users\" , // Searches in: users/searchByAjax // Filter: Active users (usu_activo = 'S') and group 2 filter : btoa ( JSON . stringify ([ { field : \"usu_activo\" , op : \"=\" , value : \"S\" }, { field : \"usu_grupo\" , op : \"=\" , value : 2 }, ]), ), callback : function ( e ) { let data = e . data ( \"searchdata\" ); console . log ( \"Received data:\" , data ); if ( data && data . id ) { // Custom logic } }, });","title":"Usage Example"},{"location":"en/frontend/funciones_javascript/#system-hooks-and-functions-in-customjs","text":"The custom.js file is the designated place for application-specific logic, including \"hooks\" (handlers) the system automatically invokes based on naming conventions. This allows extending search and table functionality without modifying core.","title":"System Hooks and Functions in custom.js"},{"location":"en/frontend/funciones_javascript/#hook-naming-convention","text":"System automatically detects global functions with specific naming patterns to execute actions after events.","title":"Hook Naming Convention"},{"location":"en/frontend/funciones_javascript/#1-search-hooks-_fieldnameonsearch","text":"Executed automatically after a RagnosSearch control completes a selection. Pattern: _{input_id}OnSearch Parameter: Receives control (input) jQuery object. Usage: Ideal for filling other form fields based on search result. System Example ( _productCodeOnSearch ): When a product is selected in productCode input, this function finds priceEach input in order detail and assigns MSRP. // Activated when selecting something in <input id=\"productCode\" ...> function _productCodeOnSearch ( control ) { // 'control' is product code input // Access data returned by search with .data(\"searchdata\") let data = control . data ( \"searchdata\" ); // Update another field (Unit Price) with product MSRP $ ( '#orderdetail input[name=\"priceEach\"]' ). val ( data . MSRP ); }","title":"1. Search Hooks (_FieldNameOnSearch)"},{"location":"en/frontend/funciones_javascript/#2-table-change-hooks-_tablenameonchange","text":"Executed when a managed table changes (e.g. adding/editing rows in detail table). Pattern: _{table_id}OnChange Parameter: Receives table object or change context. Usage: Total recalculations, cross-validations. System Example ( _OrderDetailsOnChange ): Every time something changes in OrderDetails table, complete order total is recalculated by calling server. // Activated when modifying table <table id=\"OrderDetails\" ...> function _OrderDetailsOnChange ( table ) { // Get current order ID let order = $ ( \"input[name='orderNumber']\" ). val (); // Call server to recalculate total getObject ( \"store/orders/calculatetotal\" , { order : order }, function ( data ) { // Update visual Total field $ ( 'input[name=\"total\"]' ). val ( data . total ); }); }","title":"2. Table Change Hooks (_TableNameOnChange)"},{"location":"en/frontend/funciones_javascript/#custom-utility-functions","text":"Normal functions can also be defined for explicit callbacks in search configs. Example ( officeSearchTest ): Simple function designed to be passed as callback parameter in RagnosSearch . function officeSearchTest ( e ) { let data = e . data ( \"searchdata\" ); console . log ( \"Office search data:\" , data ); } // Usage: // $('#office').RagnosSearch({ ..., callback: officeSearchTest });","title":"Custom Utility Functions"},{"location":"en/frontend/personalizacion_ui/","text":"UI Customization Ragnos uses AdminLTE 3 as base for its interface, integrated with CodeIgniter 4 view system. Here we explain how to customize common elements like sidebar, logo and topbar. Sidebar Main application menu resides in a static view. To add, remove or reorganize links, you must edit file: \ud83d\udcc2 app/Views/template/sidebar.php Menu Structure Menu uses standard HTML list with Bootstrap/AdminLTE classes. Available Icons Ragnos includes Bootstrap Icons library. Browse official icon gallery to find class codes (e.g. bi-shop , bi-gear ). Example adding simple link: <li class=\"nav-item\"> <a href=\" <? = site_url ( 'process/tasks' ) ?> \" class=\"nav-link\"> <i class=\"bi bi-check-square nav-icon\"></i> <p>My Tasks</p> </a> </li> Example dropdown submenu: <li class=\"nav-item\"> <a class=\"nav-link\"> <i class=\"bi bi-shop\"></i> <p> Store <i class=\"nav-arrow bi bi-chevron-right\"></i> </p> </a> <ul class=\"nav nav-treeview\"> <li class=\"nav-item\"> <a href=\" <? = site_url ( 'store/products' ) ?> \" class=\"nav-link\"> <i class=\"bi bi-box nav-icon\"></i> <p>Products</p> </a> </li> </ul> </li> Menu Access Control You can show or hide menu elements based on logged-in user role using Admin_aut service. <?php // Get auth service at start of file $auth = service ( 'Admin_aut' ); ?> <!-- ... in menu ... --> <?php if ( $auth -> isUserInGroup ( 'administrator' )) : ?> <li class=\"nav-item\"> <a href=\" <? = site_url ( 'users' ) ?> \" class=\"nav-link\"> ... </a> </li> <?php endif ; ?> Logo and Title Customization Application Title Name appearing next to logo is configured globally in app/Config/RagnosConfig.php : public $Ragnos_application_title = 'My Company'; Logo Logo prints at top of sidebar.php : <div class=\"sidebar-brand\"> <a href=\" <? = site_url () ?> \" class=\"brand-link\"> <!-- You can change this span for an img tag --> <span class=\"brand-text font-weight-light\"> <? = Ragnos :: config () -> Ragnos_application_title ; ?> </span> </a> </div> To use an image: <img src=\" <? = base_url ( 'content/img/my-logo.png' ) ?> \" alt=\"Logo\" class=\"brand-image img-circle elevation-3\" style=\"opacity: .8\"> Topbar Topbar is located at: \ud83d\udcc2 app/Views/template/topbar.php Here you can modify right-side links (profile, notifications) or add global search.","title":"UI Customization"},{"location":"en/frontend/personalizacion_ui/#ui-customization","text":"Ragnos uses AdminLTE 3 as base for its interface, integrated with CodeIgniter 4 view system. Here we explain how to customize common elements like sidebar, logo and topbar.","title":"UI Customization"},{"location":"en/frontend/personalizacion_ui/#sidebar","text":"Main application menu resides in a static view. To add, remove or reorganize links, you must edit file: \ud83d\udcc2 app/Views/template/sidebar.php","title":"Sidebar"},{"location":"en/frontend/personalizacion_ui/#menu-structure","text":"Menu uses standard HTML list with Bootstrap/AdminLTE classes. Available Icons Ragnos includes Bootstrap Icons library. Browse official icon gallery to find class codes (e.g. bi-shop , bi-gear ). Example adding simple link: <li class=\"nav-item\"> <a href=\" <? = site_url ( 'process/tasks' ) ?> \" class=\"nav-link\"> <i class=\"bi bi-check-square nav-icon\"></i> <p>My Tasks</p> </a> </li> Example dropdown submenu: <li class=\"nav-item\"> <a class=\"nav-link\"> <i class=\"bi bi-shop\"></i> <p> Store <i class=\"nav-arrow bi bi-chevron-right\"></i> </p> </a> <ul class=\"nav nav-treeview\"> <li class=\"nav-item\"> <a href=\" <? = site_url ( 'store/products' ) ?> \" class=\"nav-link\"> <i class=\"bi bi-box nav-icon\"></i> <p>Products</p> </a> </li> </ul> </li>","title":"Menu Structure"},{"location":"en/frontend/personalizacion_ui/#menu-access-control","text":"You can show or hide menu elements based on logged-in user role using Admin_aut service. <?php // Get auth service at start of file $auth = service ( 'Admin_aut' ); ?> <!-- ... in menu ... --> <?php if ( $auth -> isUserInGroup ( 'administrator' )) : ?> <li class=\"nav-item\"> <a href=\" <? = site_url ( 'users' ) ?> \" class=\"nav-link\"> ... </a> </li> <?php endif ; ?>","title":"Menu Access Control"},{"location":"en/frontend/personalizacion_ui/#logo-and-title-customization","text":"","title":"Logo and Title Customization"},{"location":"en/frontend/personalizacion_ui/#application-title","text":"Name appearing next to logo is configured globally in app/Config/RagnosConfig.php : public $Ragnos_application_title = 'My Company';","title":"Application Title"},{"location":"en/frontend/personalizacion_ui/#logo","text":"Logo prints at top of sidebar.php : <div class=\"sidebar-brand\"> <a href=\" <? = site_url () ?> \" class=\"brand-link\"> <!-- You can change this span for an img tag --> <span class=\"brand-text font-weight-light\"> <? = Ragnos :: config () -> Ragnos_application_title ; ?> </span> </a> </div> To use an image: <img src=\" <? = base_url ( 'content/img/my-logo.png' ) ?> \" alt=\"Logo\" class=\"brand-image img-circle elevation-3\" style=\"opacity: .8\">","title":"Logo"},{"location":"en/frontend/personalizacion_ui/#topbar","text":"Topbar is located at: \ud83d\udcc2 app/Views/template/topbar.php Here you can modify right-side links (profile, notifications) or add global search.","title":"Topbar"},{"location":"en/frontend/reportes_simples/","text":"\ud83d\udcca Simple Report Generation (RSimpleLevelReport) The RSimpleLevelReport class allows generating reports in HTML table format quickly and structured directly from a data array. Ideal for displaying lists, financial summaries or any dataset requiring tabular presentation, with support for grouping levels (control breaks). Main Features Automatic HTML table generation with professional design. Support for multiple grouping levels (headers per group). Automatic record total calculation. Detection and calculation of sums for numeric columns (subtotals and grand totals). Easy integration with Ragnos views. Basic Usage Flow Get data (usually from Model). Instantiate App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport . Configure report using quickSetup . Render report and pass to view. Class API quickSetup($title, $data, $listfields, $groups = [], $desc_filter = '') Configures main report parameters at once. $title (string): Main report title. $data (array): Data set (array of associative arrays). $listfields (array): List of fields to show. If simple array ['Field1', 'Field2'] , keys are searched in $data . Recommended for names to match data array keys. $groups (array): (Optional) Grouping configuration. Format: ['grouping_field' => ['label' => 'Group Label']] . $desc_filter (string): (Optional) Subtitle or description of applied filters. setShowTotals(bool $showTotals) Enables or disables totals display (record count and financial sums) at the end of each group and report (default true ). setSummableFields(array $fields) Explicitly defines which fields should be mathematically summed in table footers. $fields (array): List of field names (labels) containing numeric values. Note: If this method is not used, the class attempts to automatically detect summable fields by looking for names like 'Total', 'Price', 'Balance', 'Debt', etc. render($returnRoute = 'admin/index') Returns rendered report HTML inside standard report view. Useful embedding in existing layouts. generate() Returns only HTML of table and headers, without full view wrapper. Useful for AJAX injections or custom views. Implementation Examples 1. Simple Report (Flat List) Example showing monthly sales list without grouping. <?php namespace App\\Controllers\\Store ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; use App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport ; class Reports extends BaseController { public function salesbymonth () { // 1. Get data $model = new \\App\\Models\\Dashboard (); $data = $model -> last12monthssales (); // Expected structure of $data: // [['Month' => 'January', 'Total' => 1000], ['Month' => 'February', 'Total' => 1500], ...] // 2. Format data (optional but recommended) foreach ( $data as $key => $value ) { $data [ $key ][ 'Total' ] = '$ ' . number_format ( $value [ 'Total' ], 2 ); } // 3. Configure Report $report = new RSimpleLevelReport (); $report -> setShowTotals ( false ); // Hide record count as irrelevant here // quickSetup(Title, Data, Columns to show) $report -> quickSetup ( 'Sales by Month' , $data , [ 'Month' , 'Total' ]); // 4. Render $content = $report -> render (); return view ( 'admin/report_view' , [ 'content' => $content ]); } } 2. Grouped Report (Control Break) Example generates product list grouped by Category . Every time category changes, new header is generated. Important Requirement : For grouping to work correctly, input data must be sorted by grouping field. <?php namespace App\\Controllers\\Store ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; use App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport ; class Products extends BaseController { public function listByCategory () { // 1. Get data (Sorted by category!) $data = [ [ 'category' => 'Electronics' , 'product' => 'TV' , 'price' => 500 ], [ 'category' => 'Electronics' , 'product' => 'Radio' , 'price' => 50 ], [ 'category' => 'Home' , 'product' => 'Chair' , 'price' => 25 ], [ 'category' => 'Home' , 'product' => 'Table' , 'price' => 100 ], ]; $report = new RSimpleLevelReport (); // 2. Define Grouping // Key 'category' must exist in $data. $groups = [ 'category' => [ 'label' => 'Product Category' ] ]; // 3. Configure $report -> quickSetup ( 'Product List' , $data , [ 'product' , 'price' ], // Fields to show in columns $groups , // Groups config 'Filter: All active products' // Optional subtitle ); return view ( 'admin/report_view' , [ 'content' => $report -> render ()]); } } 3. Multi-Level Report Possible to group by multiple levels (e.g. Country -> State -> City). $groups = [ 'country' => ['label' => 'Country'], 'state' => ['label' => 'State/Province'] ]; // Data must come sorted by country then state $report->quickSetup('Geographic Report', $data, ['city', 'population'], $groups); 4. Financial Report with Totals This example shows how the class automatically handles sums and grand totals. // Sales data $data = [ ['salesperson' => 'John', 'sale' => 100.50, 'commission' => 10], ['salesperson' => 'Mary', 'sale' => 200.00, 'commission' => 20], ['salesperson' => 'Pete', 'sale' => 150.00, 'commission' => 15], ]; $report = new RSimpleLevelReport(); $report->quickSetup('Commission Report', $data, ['salesperson', 'sale', 'commission']); // Optional: Force which fields to sum (if not automatically detected) // $report->setSummableFields(['sale', 'commission']); // Rendering will generate: // - A table with the data. // - A \"GRAND TOTAL\" footer aligned correctly. // - The 'sale' column will sum to 450.50 // - The 'commission' column will sum to 45 return $report->render(); Common Applications Inventory Lists : Grouped by warehouse or category. Sales Reports : Daily, monthly or grouped by salesperson. Audit : System log lists. Financial Summaries : Simple income/expense lists formatted.","title":"Simple Reports"},{"location":"en/frontend/reportes_simples/#simple-report-generation-rsimplelevelreport","text":"The RSimpleLevelReport class allows generating reports in HTML table format quickly and structured directly from a data array. Ideal for displaying lists, financial summaries or any dataset requiring tabular presentation, with support for grouping levels (control breaks).","title":"\ud83d\udcca Simple Report Generation (RSimpleLevelReport)"},{"location":"en/frontend/reportes_simples/#main-features","text":"Automatic HTML table generation with professional design. Support for multiple grouping levels (headers per group). Automatic record total calculation. Detection and calculation of sums for numeric columns (subtotals and grand totals). Easy integration with Ragnos views.","title":"Main Features"},{"location":"en/frontend/reportes_simples/#basic-usage-flow","text":"Get data (usually from Model). Instantiate App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport . Configure report using quickSetup . Render report and pass to view.","title":"Basic Usage Flow"},{"location":"en/frontend/reportes_simples/#class-api","text":"","title":"Class API"},{"location":"en/frontend/reportes_simples/#quicksetuptitle-data-listfields-groups-desc_filter","text":"Configures main report parameters at once. $title (string): Main report title. $data (array): Data set (array of associative arrays). $listfields (array): List of fields to show. If simple array ['Field1', 'Field2'] , keys are searched in $data . Recommended for names to match data array keys. $groups (array): (Optional) Grouping configuration. Format: ['grouping_field' => ['label' => 'Group Label']] . $desc_filter (string): (Optional) Subtitle or description of applied filters.","title":"quickSetup($title, $data, $listfields, $groups = [], $desc_filter = '')"},{"location":"en/frontend/reportes_simples/#setshowtotalsbool-showtotals","text":"Enables or disables totals display (record count and financial sums) at the end of each group and report (default true ).","title":"setShowTotals(bool $showTotals)"},{"location":"en/frontend/reportes_simples/#setsummablefieldsarray-fields","text":"Explicitly defines which fields should be mathematically summed in table footers. $fields (array): List of field names (labels) containing numeric values. Note: If this method is not used, the class attempts to automatically detect summable fields by looking for names like 'Total', 'Price', 'Balance', 'Debt', etc.","title":"setSummableFields(array $fields)"},{"location":"en/frontend/reportes_simples/#renderreturnroute-adminindex","text":"Returns rendered report HTML inside standard report view. Useful embedding in existing layouts.","title":"render($returnRoute = 'admin/index')"},{"location":"en/frontend/reportes_simples/#generate","text":"Returns only HTML of table and headers, without full view wrapper. Useful for AJAX injections or custom views.","title":"generate()"},{"location":"en/frontend/reportes_simples/#implementation-examples","text":"","title":"Implementation Examples"},{"location":"en/frontend/reportes_simples/#1-simple-report-flat-list","text":"Example showing monthly sales list without grouping. <?php namespace App\\Controllers\\Store ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; use App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport ; class Reports extends BaseController { public function salesbymonth () { // 1. Get data $model = new \\App\\Models\\Dashboard (); $data = $model -> last12monthssales (); // Expected structure of $data: // [['Month' => 'January', 'Total' => 1000], ['Month' => 'February', 'Total' => 1500], ...] // 2. Format data (optional but recommended) foreach ( $data as $key => $value ) { $data [ $key ][ 'Total' ] = '$ ' . number_format ( $value [ 'Total' ], 2 ); } // 3. Configure Report $report = new RSimpleLevelReport (); $report -> setShowTotals ( false ); // Hide record count as irrelevant here // quickSetup(Title, Data, Columns to show) $report -> quickSetup ( 'Sales by Month' , $data , [ 'Month' , 'Total' ]); // 4. Render $content = $report -> render (); return view ( 'admin/report_view' , [ 'content' => $content ]); } }","title":"1. Simple Report (Flat List)"},{"location":"en/frontend/reportes_simples/#2-grouped-report-control-break","text":"Example generates product list grouped by Category . Every time category changes, new header is generated. Important Requirement : For grouping to work correctly, input data must be sorted by grouping field. <?php namespace App\\Controllers\\Store ; use App\\ThirdParty\\Ragnos\\Controllers\\BaseController ; use App\\ThirdParty\\Ragnos\\Controllers\\RSimpleLevelReport ; class Products extends BaseController { public function listByCategory () { // 1. Get data (Sorted by category!) $data = [ [ 'category' => 'Electronics' , 'product' => 'TV' , 'price' => 500 ], [ 'category' => 'Electronics' , 'product' => 'Radio' , 'price' => 50 ], [ 'category' => 'Home' , 'product' => 'Chair' , 'price' => 25 ], [ 'category' => 'Home' , 'product' => 'Table' , 'price' => 100 ], ]; $report = new RSimpleLevelReport (); // 2. Define Grouping // Key 'category' must exist in $data. $groups = [ 'category' => [ 'label' => 'Product Category' ] ]; // 3. Configure $report -> quickSetup ( 'Product List' , $data , [ 'product' , 'price' ], // Fields to show in columns $groups , // Groups config 'Filter: All active products' // Optional subtitle ); return view ( 'admin/report_view' , [ 'content' => $report -> render ()]); } }","title":"2. Grouped Report (Control Break)"},{"location":"en/frontend/reportes_simples/#3-multi-level-report","text":"Possible to group by multiple levels (e.g. Country -> State -> City). $groups = [ 'country' => ['label' => 'Country'], 'state' => ['label' => 'State/Province'] ]; // Data must come sorted by country then state $report->quickSetup('Geographic Report', $data, ['city', 'population'], $groups);","title":"3. Multi-Level Report"},{"location":"en/frontend/reportes_simples/#4-financial-report-with-totals","text":"This example shows how the class automatically handles sums and grand totals. // Sales data $data = [ ['salesperson' => 'John', 'sale' => 100.50, 'commission' => 10], ['salesperson' => 'Mary', 'sale' => 200.00, 'commission' => 20], ['salesperson' => 'Pete', 'sale' => 150.00, 'commission' => 15], ]; $report = new RSimpleLevelReport(); $report->quickSetup('Commission Report', $data, ['salesperson', 'sale', 'commission']); // Optional: Force which fields to sum (if not automatically detected) // $report->setSummableFields(['sale', 'commission']); // Rendering will generate: // - A table with the data. // - A \"GRAND TOTAL\" footer aligned correctly. // - The 'sale' column will sum to 450.50 // - The 'commission' column will sum to 45 return $report->render();","title":"4. Financial Report with Totals"},{"location":"en/frontend/reportes_simples/#common-applications","text":"Inventory Lists : Grouped by warehouse or category. Sales Reports : Daily, monthly or grouped by salesperson. Audit : System log lists. Financial Summaries : Simple income/expense lists formatted.","title":"Common Applications"},{"location":"en/fundamentos/configuracion/","text":"Ragnos Configuration In addition to standard CodeIgniter 4 configuration (database, routes, etc.), Ragnos includes a specific configuration file to customize the global behavior of the framework. Configuration File The file is located at app/Config/RagnosConfig.php . namespace Config; use CodeIgniter\\Config\\BaseConfig; class RagnosConfig extends BaseConfig { public $Ragnos_application_title = '\ud83c\udfea Store'; public $Ragnos_all_to_uppercase = false; public $currency = 'USD'; public $locale = 'en_US'; } Available Variables Application Identity Variable Type Description $Ragnos_application_title string Defines the public name of the application. This text will appear in the top bar (Topbar), side menu (Sidebar), and page headers. Data Behavior Variable Type Description $Ragnos_all_to_uppercase bool If set to true , forces conversion to uppercase for certain default input fields in automatically generated forms. Localization Variable Type Description $currency string Defines the default currency code (e.g., 'USD', 'MXN', 'EUR') used in money formatting helpers. $locale string Defines the default locale for date and number formats (e.g., 'es_MX', 'en_US'). Note: This is independent of the interface language handled by CI4. Routing (Auto Routing) An important feature of Ragnos is that it keeps the Auto Routing feature ( $routes->setAutoRoute(true) ) of CodeIgniter 4 enabled by default. What does this imply for the developer? Zero Route Configuration: When creating a new controller (e.g., with the CLI Generator ), it is immediately accessible via URL ( /YourController/method ) without needing to edit app/Config/Routes.php . Agility: This is fundamental to Ragnos' \"Low Code\" philosophy, allowing CRUD modules to be prototyped and deployed in seconds. Security and Customization: If you need specific URLs or to restrict access, you can define manual routes in Config/Routes.php . Manual routes have priority over automatic ones. \u26a0\ufe0f Important: If you decide to disable Auto Routing ( false ) due to strict security policies, you will need to manually register each route for your Datasets, which increases maintenance work. Other Configurations (CodeIgniter) Remember that Ragnos respects the native CI4 configuration. Important files in app/Config/ : App.php : Base configuration ( baseURL , indexPage ). Database.php : Connection credentials. Security.php : CSRF configuration and security headers.","title":"Configuration"},{"location":"en/fundamentos/configuracion/#ragnos-configuration","text":"In addition to standard CodeIgniter 4 configuration (database, routes, etc.), Ragnos includes a specific configuration file to customize the global behavior of the framework.","title":"Ragnos Configuration"},{"location":"en/fundamentos/configuracion/#configuration-file","text":"The file is located at app/Config/RagnosConfig.php . namespace Config; use CodeIgniter\\Config\\BaseConfig; class RagnosConfig extends BaseConfig { public $Ragnos_application_title = '\ud83c\udfea Store'; public $Ragnos_all_to_uppercase = false; public $currency = 'USD'; public $locale = 'en_US'; }","title":"Configuration File"},{"location":"en/fundamentos/configuracion/#available-variables","text":"","title":"Available Variables"},{"location":"en/fundamentos/configuracion/#application-identity","text":"Variable Type Description $Ragnos_application_title string Defines the public name of the application. This text will appear in the top bar (Topbar), side menu (Sidebar), and page headers.","title":"Application Identity"},{"location":"en/fundamentos/configuracion/#data-behavior","text":"Variable Type Description $Ragnos_all_to_uppercase bool If set to true , forces conversion to uppercase for certain default input fields in automatically generated forms.","title":"Data Behavior"},{"location":"en/fundamentos/configuracion/#localization","text":"Variable Type Description $currency string Defines the default currency code (e.g., 'USD', 'MXN', 'EUR') used in money formatting helpers. $locale string Defines the default locale for date and number formats (e.g., 'es_MX', 'en_US'). Note: This is independent of the interface language handled by CI4.","title":"Localization"},{"location":"en/fundamentos/configuracion/#routing-auto-routing","text":"An important feature of Ragnos is that it keeps the Auto Routing feature ( $routes->setAutoRoute(true) ) of CodeIgniter 4 enabled by default.","title":"Routing (Auto Routing)"},{"location":"en/fundamentos/configuracion/#what-does-this-imply-for-the-developer","text":"Zero Route Configuration: When creating a new controller (e.g., with the CLI Generator ), it is immediately accessible via URL ( /YourController/method ) without needing to edit app/Config/Routes.php . Agility: This is fundamental to Ragnos' \"Low Code\" philosophy, allowing CRUD modules to be prototyped and deployed in seconds. Security and Customization: If you need specific URLs or to restrict access, you can define manual routes in Config/Routes.php . Manual routes have priority over automatic ones. \u26a0\ufe0f Important: If you decide to disable Auto Routing ( false ) due to strict security policies, you will need to manually register each route for your Datasets, which increases maintenance work.","title":"What does this imply for the developer?"},{"location":"en/fundamentos/configuracion/#other-configurations-codeigniter","text":"Remember that Ragnos respects the native CI4 configuration. Important files in app/Config/ : App.php : Base configuration ( baseURL , indexPage ). Database.php : Connection credentials. Security.php : CSRF configuration and security headers.","title":"Other Configurations (CodeIgniter)"},{"location":"en/fundamentos/demo_database/","text":"Demo Database (Classicmodels) Ragnos includes the Classicmodels sample database, a well-known standard implementation in the development world for testing relational database functionalities. This database models a retailer of scale models of classic cars . It contains typical business information: customers, products, orders, payments, employees, and offices. \ud83d\udcca Database Structure The database consists of 8 related tables. Below is an Entity-Relationship (ER) diagram illustrating the structure: erDiagram CUSTOMERS ||--o{ ORDERS : places CUSTOMERS ||--o{ PAYMENTS : makes CUSTOMERS }|--|| EMPLOYEES : \"served by\" EMPLOYEES ||--|{ EMPLOYEES : \"reports to\" EMPLOYEES }|--|| OFFICES : \"works in\" ORDERS ||--|{ ORDERDETAILS : contains PRODUCTS ||--o{ ORDERDETAILS : \"included in\" PRODUCTS }|--|| PRODUCTLINES : \"category\" CUSTOMERS { int customerNumber PK string customerName string contactLastName string contactFirstName string phone string addressLine1 string city string country int salesRepEmployeeNumber FK decimal creditLimit } EMPLOYEES { int employeeNumber PK string lastName string firstName string email string officeCode FK int reportsTo FK string jobTitle } OFFICES { string officeCode PK string city string phone string addressLine1 string country string territory } ORDERDETAILS { int orderNumber PK,FK string productCode PK,FK int quantityOrdered decimal priceEach } ORDERS { int orderNumber PK date orderDate date shippedDate string status int customerNumber FK } PAYMENTS { int customerNumber PK,FK string checkNumber PK date paymentDate decimal amount } PRODUCTS { string productCode PK string productName string productLine FK string productScale string productVendor int quantityInStock decimal buyPrice decimal MSRP } PRODUCTLINES { string productLine PK string textDescription } \ud83d\udcdd Table Descriptions Below is the purpose of each table: 1. Customers Stores information about the company's customers. Key Data: Name, contact, address, phone, credit limit. Relationships: Linked to Employees (assigned sales rep), Orders (placed orders), and Payments (payments made). 2. Products Catalog of scale models of cars, motorcycles, and other classic vehicles. Key Data: Code, name, scale, vendor, description, stock, buy price, and Manufacturer's Suggested Retail Price (MSRP). Relationships: Belongs to a ProductLine and appears in OrderDetails . 3. ProductLines Categories into which products are classified (e.g., \"Classic Cars\", \"Motorcycles\"). Key Data: Line name, description. 4. Orders Header of orders placed by customers. Key Data: Dates (order, required, shipped), status (Shipped, Cancelled, etc.), comments. Relationships: Linked to the Customer who placed the order. 5. OrderDetails Individual lines of each order, specifying which products were purchased. Key Data: Quantity ordered, actual unit price. Relationships: Links Orders with Products (many-to-many relationship). 6. Payments Record of payments made by customers. Key Data: Check number, payment date, amount. Relationships: Linked to Customers . 7. Employees Information about company staff. Key Data: Name, email, job title. Relationships: Belongs to an Office . Reports to another employee (hierarchical structure). Is the sales representative for Customers . 8. Offices Physical locations of sales offices. Key Data: City, phone, address, country, territory. \ud83d\udd10 Accessing the Demo If you have installed the project and loaded these sample data, or are accessing our online demo, you can use the following credentials to access the administrative panel: Access Credentials Demo URL: https://ragnos.yupii.org/ User: admin Password: admin Once inside, you will be able to explore the modules built upon this database structure to see Ragnos in action (Master-detail datasets, reports, charts, etc.).","title":"Demo Database"},{"location":"en/fundamentos/demo_database/#demo-database-classicmodels","text":"Ragnos includes the Classicmodels sample database, a well-known standard implementation in the development world for testing relational database functionalities. This database models a retailer of scale models of classic cars . It contains typical business information: customers, products, orders, payments, employees, and offices.","title":"Demo Database (Classicmodels)"},{"location":"en/fundamentos/demo_database/#database-structure","text":"The database consists of 8 related tables. Below is an Entity-Relationship (ER) diagram illustrating the structure: erDiagram CUSTOMERS ||--o{ ORDERS : places CUSTOMERS ||--o{ PAYMENTS : makes CUSTOMERS }|--|| EMPLOYEES : \"served by\" EMPLOYEES ||--|{ EMPLOYEES : \"reports to\" EMPLOYEES }|--|| OFFICES : \"works in\" ORDERS ||--|{ ORDERDETAILS : contains PRODUCTS ||--o{ ORDERDETAILS : \"included in\" PRODUCTS }|--|| PRODUCTLINES : \"category\" CUSTOMERS { int customerNumber PK string customerName string contactLastName string contactFirstName string phone string addressLine1 string city string country int salesRepEmployeeNumber FK decimal creditLimit } EMPLOYEES { int employeeNumber PK string lastName string firstName string email string officeCode FK int reportsTo FK string jobTitle } OFFICES { string officeCode PK string city string phone string addressLine1 string country string territory } ORDERDETAILS { int orderNumber PK,FK string productCode PK,FK int quantityOrdered decimal priceEach } ORDERS { int orderNumber PK date orderDate date shippedDate string status int customerNumber FK } PAYMENTS { int customerNumber PK,FK string checkNumber PK date paymentDate decimal amount } PRODUCTS { string productCode PK string productName string productLine FK string productScale string productVendor int quantityInStock decimal buyPrice decimal MSRP } PRODUCTLINES { string productLine PK string textDescription }","title":"\ud83d\udcca Database Structure"},{"location":"en/fundamentos/demo_database/#table-descriptions","text":"Below is the purpose of each table:","title":"\ud83d\udcdd Table Descriptions"},{"location":"en/fundamentos/demo_database/#1-customers","text":"Stores information about the company's customers. Key Data: Name, contact, address, phone, credit limit. Relationships: Linked to Employees (assigned sales rep), Orders (placed orders), and Payments (payments made).","title":"1. Customers"},{"location":"en/fundamentos/demo_database/#2-products","text":"Catalog of scale models of cars, motorcycles, and other classic vehicles. Key Data: Code, name, scale, vendor, description, stock, buy price, and Manufacturer's Suggested Retail Price (MSRP). Relationships: Belongs to a ProductLine and appears in OrderDetails .","title":"2. Products"},{"location":"en/fundamentos/demo_database/#3-productlines","text":"Categories into which products are classified (e.g., \"Classic Cars\", \"Motorcycles\"). Key Data: Line name, description.","title":"3. ProductLines"},{"location":"en/fundamentos/demo_database/#4-orders","text":"Header of orders placed by customers. Key Data: Dates (order, required, shipped), status (Shipped, Cancelled, etc.), comments. Relationships: Linked to the Customer who placed the order.","title":"4. Orders"},{"location":"en/fundamentos/demo_database/#5-orderdetails","text":"Individual lines of each order, specifying which products were purchased. Key Data: Quantity ordered, actual unit price. Relationships: Links Orders with Products (many-to-many relationship).","title":"5. OrderDetails"},{"location":"en/fundamentos/demo_database/#6-payments","text":"Record of payments made by customers. Key Data: Check number, payment date, amount. Relationships: Linked to Customers .","title":"6. Payments"},{"location":"en/fundamentos/demo_database/#7-employees","text":"Information about company staff. Key Data: Name, email, job title. Relationships: Belongs to an Office . Reports to another employee (hierarchical structure). Is the sales representative for Customers .","title":"7. Employees"},{"location":"en/fundamentos/demo_database/#8-offices","text":"Physical locations of sales offices. Key Data: City, phone, address, country, territory.","title":"8. Offices"},{"location":"en/fundamentos/demo_database/#accessing-the-demo","text":"If you have installed the project and loaded these sample data, or are accessing our online demo, you can use the following credentials to access the administrative panel: Access Credentials Demo URL: https://ragnos.yupii.org/ User: admin Password: admin Once inside, you will be able to explore the modules built upon this database structure to see Ragnos in action (Master-detail datasets, reports, charts, etc.).","title":"\ud83d\udd10 Accessing the Demo"},{"location":"en/fundamentos/instalacion/","text":"Installation of Ragnos This guide describes how to install Ragnos Framework from a distributed ZIP file. Server Requirements Ragnos is based on CodeIgniter 4 , so it shares its minimum requirements: PHP : Version 7.4 or higher (PHP 8.1+ recommended). PHP Extensions : intl mbstring json mysqlnd (if using MySQL/MariaDB) curl gd (optional, for image manipulation) Database : MySQL (5.1+) or MariaDB. Installation Steps 1. Download and Extraction Download the .zip file with the latest version of Ragnos. Extract the content into your web server directory (e.g., c:\\laragon\\www\\my-project or /var/www/html/my-project ). Verify that the vendor folder exists and contains dependencies. Ragnos already includes all necessary libraries. 2. Environment Configuration Locate the env file in the project root. Rename or copy it to .env . Open the .env file and adjust the following variables: Watch the dot Make sure the file is named exactly .env (with the dot at the beginning) and not just env . Environment: CI_ENVIRONMENT = development Base URL: app.baseURL = 'http://localhost/my-project/' Database: Uncomment and configure your database credentials: database.default.hostname = localhost database.default.database = your_db_name database.default.username = your_user database.default.password = your_password database.default.DBDriver = MySQLi 3. Import Database Ragnos requires certain base tables to function (users, sessions, permissions). Create an empty database in your manager (phpMyAdmin, HeidiSQL, etc.). Import the SQL files located in the sampledatabase/ folder: Run ragnos_mariadb.sql first (or the main dump containing the base structure). Run ci_sessions.sql for the sessions table. (Optional) Run mysqlsampledatabase.sql if you want to load the Classicmodels sample data. See Demo Database for more details. 4. Verify Permissions Ensure that the writable/ folder and its subfolders have write permissions by the web server. 5. Run Access your browser at the configured URL (e.g., http://localhost/my-project/content or simply http://my-project.test if using Laragon). Public folder change In the source code, the public folder has been renamed to content . However, it is fine to rename it to whatever suits your server best. You should see the login screen. 6. Access and Demo Data To obtain default access credentials and learn more about the included sample data ( Classicmodels ), please refer to the Demo Database section.","title":"Installation"},{"location":"en/fundamentos/instalacion/#installation-of-ragnos","text":"This guide describes how to install Ragnos Framework from a distributed ZIP file.","title":"Installation of Ragnos"},{"location":"en/fundamentos/instalacion/#server-requirements","text":"Ragnos is based on CodeIgniter 4 , so it shares its minimum requirements: PHP : Version 7.4 or higher (PHP 8.1+ recommended). PHP Extensions : intl mbstring json mysqlnd (if using MySQL/MariaDB) curl gd (optional, for image manipulation) Database : MySQL (5.1+) or MariaDB.","title":"Server Requirements"},{"location":"en/fundamentos/instalacion/#installation-steps","text":"","title":"Installation Steps"},{"location":"en/fundamentos/instalacion/#1-download-and-extraction","text":"Download the .zip file with the latest version of Ragnos. Extract the content into your web server directory (e.g., c:\\laragon\\www\\my-project or /var/www/html/my-project ). Verify that the vendor folder exists and contains dependencies. Ragnos already includes all necessary libraries.","title":"1. Download and Extraction"},{"location":"en/fundamentos/instalacion/#2-environment-configuration","text":"Locate the env file in the project root. Rename or copy it to .env . Open the .env file and adjust the following variables: Watch the dot Make sure the file is named exactly .env (with the dot at the beginning) and not just env . Environment: CI_ENVIRONMENT = development Base URL: app.baseURL = 'http://localhost/my-project/' Database: Uncomment and configure your database credentials: database.default.hostname = localhost database.default.database = your_db_name database.default.username = your_user database.default.password = your_password database.default.DBDriver = MySQLi","title":"2. Environment Configuration"},{"location":"en/fundamentos/instalacion/#3-import-database","text":"Ragnos requires certain base tables to function (users, sessions, permissions). Create an empty database in your manager (phpMyAdmin, HeidiSQL, etc.). Import the SQL files located in the sampledatabase/ folder: Run ragnos_mariadb.sql first (or the main dump containing the base structure). Run ci_sessions.sql for the sessions table. (Optional) Run mysqlsampledatabase.sql if you want to load the Classicmodels sample data. See Demo Database for more details.","title":"3. Import Database"},{"location":"en/fundamentos/instalacion/#4-verify-permissions","text":"Ensure that the writable/ folder and its subfolders have write permissions by the web server.","title":"4. Verify Permissions"},{"location":"en/fundamentos/instalacion/#5-run","text":"Access your browser at the configured URL (e.g., http://localhost/my-project/content or simply http://my-project.test if using Laragon). Public folder change In the source code, the public folder has been renamed to content . However, it is fine to rename it to whatever suits your server best. You should see the login screen.","title":"5. Run"},{"location":"en/fundamentos/instalacion/#6-access-and-demo-data","text":"To obtain default access credentials and learn more about the included sample data ( Classicmodels ), please refer to the Demo Database section.","title":"6. Access and Demo Data"},{"location":"en/fundamentos/plantilla/","text":"Ragnos CLI Generator The Ragnos CLI Generator is a command-line tool integrated into Spark (CodeIgniter 4) that allows creating RDatasetController skeletons in seconds. You can see this generator in action in the Getting Started guide. \ud83d\udccb Table of Contents Installation Command Syntax Usage Examples Intelligent Type Mapping Benefits Installation The Ragnos CLI Generator comes pre-installed with the Ragnos package. Just make sure you have Ragnos correctly installed in your CodeIgniter 4 project. Verify command availability by running: php spark list You should see the Ragnos group and the commands ragnos:make and ragnos:make:query . Command Syntax 1. Generate from Table (RDatasetController) php spark ragnos:make [ ControllerName ] [ Options ] Arguments (ragnos:make) Argument Description ControllerName The path and name of the class (e.g., Inventory/Products ). Options (ragnos:make) Option Description -table Exact name of the table in DB. 2. Generate from Query (RQueryController) php spark ragnos:make:query [ ControllerName ] [ Options ] Arguments (ragnos:make:query) Argument Description ControllerName The path and name of the class (e.g., Dashboard/Sales ). Options (ragnos:make:query) Option Description -query The SQL query in quotes. Usage Examples 1. Basic Usage (Auto-detection) If your controller is Products and table products : php spark ragnos:make Store/Products 2. Usage with Specific Table php spark ragnos:make Admin/Users -table app_users_tbl Intelligent Type Mapping Ragnos chooses the component according to your DB: DB Type Ragnos Type Auto-generated Rules INT number required \\| integer DECIMAL money required \\| decimal DATE date required TEXT textarea required TINYINT(1) checkbox permit_empty VARCHAR text required \\| max_length[n] Benefits Speed: Create a CRUD in 10 seconds. Standardization: Avoids copy-paste errors and namespace issues. Cleanliness: Generates readable labels (\"Start Date\" instead of \"start_date\"). Official New Dataset Template If you want to create a new Dataset from scratch, without using the command line, use this template as a guide to define the recommended structure and conventions. <?php namespace App\\Controllers\\Store ; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController ; class ExampleDataset extends RDatasetController { public function __construct () { parent :: __construct (); $this -> checkLogin (); $this -> setTitle ( 'Example' ); $this -> setTableName ( 'example_table' ); $this -> setIdField ( 'id' ); $this -> setAutoIncrement ( true ); $this -> addField ( 'name' , [ 'label' => 'Name' , 'rules' => 'required' ]); $this -> setTableFields ([ 'name' ]); } } \ud83d\udcc4 Dataset Template Documentation \ud83c\udfaf Purpose This template serves as a starting point for creating a new Dataset to be integrated into the project store. It provides the structure, conventions, and minimum recommended fields for the Dataset to function correctly in the existing flow. \ud83d\udcdd Basic Instructions Duplicate: Copy this file and place it in the appropriate path of the repository for the new Dataset. Adjust: Modify class names, tables, and fields according to your needs (see \"Conventions\"). Register: Define the Dataset in the store module/manifest so it becomes available in the interface and API. \ud83c\udff7 Naming Conventions Class/Model: PascalCase (e.g., MyDataset ). DB Table: snake_case plural (e.g., my_datasets ). Fields: snake_case (e.g., creation_date , user_id ). Slug/Public Identifier: kebab-case (e.g., my-dataset ). \ud83c\udfd7 Recommended Structure Metadata: Name, slug, short description, version, author/contact. Data Schema: List of fields with name, type ( string , integer , boolean , date , json , etc.), nullability, and default values. Relationships: Define belongsTo / hasMany / hasOne relationships with other tables (indicating FK). Indexes: Declare indexes for search fields and foreign keys. \ud83d\uddc4 Migrations and Schema Migration: Create a migration that generates the table with all fields and constraints. Foreign Keys: Include ON DELETE / ON UPDATE according to business logic. Optimization: Add indexes for frequent queries. \u2705 Validations and Types Server: Specify validations (required, format, range) and expected types. UI: Map validations to interface forms to offer consistent feedback. \ud83d\uded2 Store Registration Manifest: Add the Dataset to the Dataset list so the store recognizes it. API: Provide endpoints or adapters for CRUD according to project architecture. Security: Include necessary permissions and roles to access or modify the Dataset. \ud83e\udde9 Placeholder Examples (Replace with real ones) Class name: MyDataset Table: my_datasets Fields: id (PK) title (string) description (text) published (boolean) created_at (datetime) user_id (FK) \ud83e\uddea Testing and Verification Create unit tests for validations and models. Test migrations on a DB copy and verify referential integrity. Verify registration and visibility in the store interface. \ud83d\udca1 Best Practices Self-documentation: Maintain documentation within the Dataset itself (metadata) to facilitate discovery. Versioning: Control schema changes and document incompatible migrations. Compatibility: Avoid breaking changes in public fields without prior migrations and communication to consumers. Final Notes: Ensure you adapt names and types to your domain logic. This template is a guide; review your project's database policies, security, and permissions before publishing the Dataset. With this template and guide, you should be ready to create a new Dataset that integrates perfectly into your project!","title":"CLI Generator"},{"location":"en/fundamentos/plantilla/#ragnos-cli-generator","text":"The Ragnos CLI Generator is a command-line tool integrated into Spark (CodeIgniter 4) that allows creating RDatasetController skeletons in seconds. You can see this generator in action in the Getting Started guide.","title":"Ragnos CLI Generator"},{"location":"en/fundamentos/plantilla/#table-of-contents","text":"Installation Command Syntax Usage Examples Intelligent Type Mapping Benefits","title":"\ud83d\udccb Table of Contents"},{"location":"en/fundamentos/plantilla/#installation","text":"The Ragnos CLI Generator comes pre-installed with the Ragnos package. Just make sure you have Ragnos correctly installed in your CodeIgniter 4 project. Verify command availability by running: php spark list You should see the Ragnos group and the commands ragnos:make and ragnos:make:query .","title":"Installation"},{"location":"en/fundamentos/plantilla/#command-syntax","text":"","title":"Command Syntax"},{"location":"en/fundamentos/plantilla/#1-generate-from-table-rdatasetcontroller","text":"php spark ragnos:make [ ControllerName ] [ Options ]","title":"1. Generate from Table (RDatasetController)"},{"location":"en/fundamentos/plantilla/#arguments-ragnosmake","text":"Argument Description ControllerName The path and name of the class (e.g., Inventory/Products ).","title":"Arguments (ragnos:make)"},{"location":"en/fundamentos/plantilla/#options-ragnosmake","text":"Option Description -table Exact name of the table in DB.","title":"Options (ragnos:make)"},{"location":"en/fundamentos/plantilla/#2-generate-from-query-rquerycontroller","text":"php spark ragnos:make:query [ ControllerName ] [ Options ]","title":"2. Generate from Query (RQueryController)"},{"location":"en/fundamentos/plantilla/#arguments-ragnosmakequery","text":"Argument Description ControllerName The path and name of the class (e.g., Dashboard/Sales ).","title":"Arguments (ragnos:make:query)"},{"location":"en/fundamentos/plantilla/#options-ragnosmakequery","text":"Option Description -query The SQL query in quotes.","title":"Options (ragnos:make:query)"},{"location":"en/fundamentos/plantilla/#usage-examples","text":"","title":"Usage Examples"},{"location":"en/fundamentos/plantilla/#1-basic-usage-auto-detection","text":"If your controller is Products and table products : php spark ragnos:make Store/Products","title":"1. Basic Usage (Auto-detection)"},{"location":"en/fundamentos/plantilla/#2-usage-with-specific-table","text":"php spark ragnos:make Admin/Users -table app_users_tbl","title":"2. Usage with Specific Table"},{"location":"en/fundamentos/plantilla/#intelligent-type-mapping","text":"Ragnos chooses the component according to your DB: DB Type Ragnos Type Auto-generated Rules INT number required \\| integer DECIMAL money required \\| decimal DATE date required TEXT textarea required TINYINT(1) checkbox permit_empty VARCHAR text required \\| max_length[n]","title":"Intelligent Type Mapping"},{"location":"en/fundamentos/plantilla/#benefits","text":"Speed: Create a CRUD in 10 seconds. Standardization: Avoids copy-paste errors and namespace issues. Cleanliness: Generates readable labels (\"Start Date\" instead of \"start_date\").","title":"Benefits"},{"location":"en/fundamentos/plantilla/#official-new-dataset-template","text":"If you want to create a new Dataset from scratch, without using the command line, use this template as a guide to define the recommended structure and conventions. <?php namespace App\\Controllers\\Store ; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController ; class ExampleDataset extends RDatasetController { public function __construct () { parent :: __construct (); $this -> checkLogin (); $this -> setTitle ( 'Example' ); $this -> setTableName ( 'example_table' ); $this -> setIdField ( 'id' ); $this -> setAutoIncrement ( true ); $this -> addField ( 'name' , [ 'label' => 'Name' , 'rules' => 'required' ]); $this -> setTableFields ([ 'name' ]); } }","title":"Official New Dataset Template"},{"location":"en/fundamentos/plantilla/#dataset-template-documentation","text":"","title":"\ud83d\udcc4 Dataset Template Documentation"},{"location":"en/fundamentos/plantilla/#purpose","text":"This template serves as a starting point for creating a new Dataset to be integrated into the project store. It provides the structure, conventions, and minimum recommended fields for the Dataset to function correctly in the existing flow.","title":"\ud83c\udfaf Purpose"},{"location":"en/fundamentos/plantilla/#basic-instructions","text":"Duplicate: Copy this file and place it in the appropriate path of the repository for the new Dataset. Adjust: Modify class names, tables, and fields according to your needs (see \"Conventions\"). Register: Define the Dataset in the store module/manifest so it becomes available in the interface and API.","title":"\ud83d\udcdd Basic Instructions"},{"location":"en/fundamentos/plantilla/#naming-conventions","text":"Class/Model: PascalCase (e.g., MyDataset ). DB Table: snake_case plural (e.g., my_datasets ). Fields: snake_case (e.g., creation_date , user_id ). Slug/Public Identifier: kebab-case (e.g., my-dataset ).","title":"\ud83c\udff7 Naming Conventions"},{"location":"en/fundamentos/plantilla/#recommended-structure","text":"Metadata: Name, slug, short description, version, author/contact. Data Schema: List of fields with name, type ( string , integer , boolean , date , json , etc.), nullability, and default values. Relationships: Define belongsTo / hasMany / hasOne relationships with other tables (indicating FK). Indexes: Declare indexes for search fields and foreign keys.","title":"\ud83c\udfd7 Recommended Structure"},{"location":"en/fundamentos/plantilla/#migrations-and-schema","text":"Migration: Create a migration that generates the table with all fields and constraints. Foreign Keys: Include ON DELETE / ON UPDATE according to business logic. Optimization: Add indexes for frequent queries.","title":"\ud83d\uddc4 Migrations and Schema"},{"location":"en/fundamentos/plantilla/#validations-and-types","text":"Server: Specify validations (required, format, range) and expected types. UI: Map validations to interface forms to offer consistent feedback.","title":"\u2705 Validations and Types"},{"location":"en/fundamentos/plantilla/#store-registration","text":"Manifest: Add the Dataset to the Dataset list so the store recognizes it. API: Provide endpoints or adapters for CRUD according to project architecture. Security: Include necessary permissions and roles to access or modify the Dataset.","title":"\ud83d\uded2 Store Registration"},{"location":"en/fundamentos/plantilla/#placeholder-examples-replace-with-real-ones","text":"Class name: MyDataset Table: my_datasets Fields: id (PK) title (string) description (text) published (boolean) created_at (datetime) user_id (FK)","title":"\ud83e\udde9 Placeholder Examples (Replace with real ones)"},{"location":"en/fundamentos/plantilla/#testing-and-verification","text":"Create unit tests for validations and models. Test migrations on a DB copy and verify referential integrity. Verify registration and visibility in the store interface.","title":"\ud83e\uddea Testing and Verification"},{"location":"en/fundamentos/plantilla/#best-practices","text":"Self-documentation: Maintain documentation within the Dataset itself (metadata) to facilitate discovery. Versioning: Control schema changes and document incompatible migrations. Compatibility: Avoid breaking changes in public fields without prior migrations and communication to consumers. Final Notes: Ensure you adapt names and types to your domain logic. This template is a guide; review your project's database policies, security, and permissions before publishing the Dataset. With this template and guide, you should be ready to create a new Dataset that integrates perfectly into your project!","title":"\ud83d\udca1 Best Practices"},{"location":"en/fundamentos/primeros_pasos/","text":"Getting Started: Hello World In this tutorial, we will create a complete functional module (CRUD) to manage a list of \"Tasks\" in less than 5 minutes. 1. Prepare the Database First, we need a physical table to store the data. Execute this SQL in your database: CREATE TABLE ` tasks ` ( ` task_id ` int ( 11 ) NOT NULL AUTO_INCREMENT , ` title ` varchar ( 100 ) NOT NULL , ` description ` text , ` status ` enum ( 'pending' , 'in_progress' , 'completed' ) DEFAULT 'pending' , ` due_date ` date DEFAULT NULL , PRIMARY KEY ( ` task_id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 ; 2. Generate the Controller Open your terminal in the project root folder and use the Ragnos generator: php spark ragnos:make Process/Tasks -table tasks This will create the file app/Controllers/Process/Tasks.php . 3. Configure the Dataset Open the newly created file app/Controllers/Process/Tasks.php and complete the configuration in the constructor. The generator will have created a basic structure; edit it to look like this: namespace App\\Controllers\\Process; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Tasks extends RDatasetController { public function __construct() { parent::__construct(); // 1. Title and Security $this->checkLogin(); // Requires being logged in $this->setTitle('Task Management'); // 2. Table Configuration $this->setTableName('tasks'); $this->setIdField('task_id'); // 3. Field Definition $this->addField('title', [ 'label' => 'Task Title', 'rules' => 'required|min_length[5]' ]); $this->addField('description', [ 'label' => 'Detail', 'type' => 'textarea' ]); $this->addField('due_date', [ 'label' => 'Due Date', 'type' => 'date' ]); $this->addField('status', [ 'label' => 'Current Status', 'type' => 'select', // Or 'enum' 'options' => [ 'pending' => 'Pending', 'in_progress' => 'In Progress', 'completed' => 'Completed' ] ]); // 4. Configure Grid (Listing) $this->setTableFields(['title', 'status', 'due_date']); } } 4. Test in Browser Open your browser and log into the system. Manually navigate to your controller's URL. If your base URL is localhost/ragnos , go to: http://localhost/ragnos/process/tasks Ready! You should see: A list of tasks (empty for now). A \"New\" button that opens a form. Complete functionality to Save, Edit, and Delete. Next Steps Add this new module to the side menu (see UI Customization ). Learn about more field types in Field Reference .","title":"Getting Started"},{"location":"en/fundamentos/primeros_pasos/#getting-started-hello-world","text":"In this tutorial, we will create a complete functional module (CRUD) to manage a list of \"Tasks\" in less than 5 minutes.","title":"Getting Started: Hello World"},{"location":"en/fundamentos/primeros_pasos/#1-prepare-the-database","text":"First, we need a physical table to store the data. Execute this SQL in your database: CREATE TABLE ` tasks ` ( ` task_id ` int ( 11 ) NOT NULL AUTO_INCREMENT , ` title ` varchar ( 100 ) NOT NULL , ` description ` text , ` status ` enum ( 'pending' , 'in_progress' , 'completed' ) DEFAULT 'pending' , ` due_date ` date DEFAULT NULL , PRIMARY KEY ( ` task_id ` ) ) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 ;","title":"1. Prepare the Database"},{"location":"en/fundamentos/primeros_pasos/#2-generate-the-controller","text":"Open your terminal in the project root folder and use the Ragnos generator: php spark ragnos:make Process/Tasks -table tasks This will create the file app/Controllers/Process/Tasks.php .","title":"2. Generate the Controller"},{"location":"en/fundamentos/primeros_pasos/#3-configure-the-dataset","text":"Open the newly created file app/Controllers/Process/Tasks.php and complete the configuration in the constructor. The generator will have created a basic structure; edit it to look like this: namespace App\\Controllers\\Process; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Tasks extends RDatasetController { public function __construct() { parent::__construct(); // 1. Title and Security $this->checkLogin(); // Requires being logged in $this->setTitle('Task Management'); // 2. Table Configuration $this->setTableName('tasks'); $this->setIdField('task_id'); // 3. Field Definition $this->addField('title', [ 'label' => 'Task Title', 'rules' => 'required|min_length[5]' ]); $this->addField('description', [ 'label' => 'Detail', 'type' => 'textarea' ]); $this->addField('due_date', [ 'label' => 'Due Date', 'type' => 'date' ]); $this->addField('status', [ 'label' => 'Current Status', 'type' => 'select', // Or 'enum' 'options' => [ 'pending' => 'Pending', 'in_progress' => 'In Progress', 'completed' => 'Completed' ] ]); // 4. Configure Grid (Listing) $this->setTableFields(['title', 'status', 'due_date']); } }","title":"3. Configure the Dataset"},{"location":"en/fundamentos/primeros_pasos/#4-test-in-browser","text":"Open your browser and log into the system. Manually navigate to your controller's URL. If your base URL is localhost/ragnos , go to: http://localhost/ragnos/process/tasks Ready! You should see: A list of tasks (empty for now). A \"New\" button that opens a form. Complete functionality to Save, Edit, and Delete.","title":"4. Test in Browser"},{"location":"en/fundamentos/primeros_pasos/#next-steps","text":"Add this new module to the side menu (see UI Customization ). Learn about more field types in Field Reference .","title":"Next Steps"},{"location":"en/avanzado/reportes_automaticos/","text":"\ud83d\udcca Generador Autom\u00e1tico de Reportes Introducci\u00f3n El Generador Autom\u00e1tico de Reportes ( RDatasetReportGenerator ) es una caracter\u00edstica poderosa de Ragnos que permite crear reportes complejos y personalizados sin escribir c\u00f3digo adicional . Esta funcionalidad est\u00e1 integrada autom\u00e1ticamente en todos los datasets basados en RDatasetController , lo que significa que cualquier cat\u00e1logo que hayas creado ya tiene capacidades de reporter\u00eda avanzada disponibles desde el primer momento. Acceso desde la Interfaz Gr\u00e1fica Cada dataset basado en RDatasetController incluye autom\u00e1ticamente un bot\u00f3n de \"Reporte Avanzado\" (icono de impresora \ud83d\udda8\ufe0f) en la barra de herramientas de la vista de tabla: // Ubicado en: app/ThirdParty/Ragnos/Views/rdatasetcontroller/table_view.php <a href=\" <? = site_url ( $clase . '/genericAdvancedReport' ) ?> \" class=\"toolbtn btn btn-outline-secondary btn-lg bg-white shadow-sm\" title=\" <? = lang ( 'Ragnos.Ragnos_advanced_report_tooltip' ) ?> \"> <i class=\"bi bi-printer\"></i> </a> Al hacer clic en este bot\u00f3n, el usuario accede a una interfaz de configuraci\u00f3n de reportes donde puede: Generar reportes con totales y subtotales autom\u00e1ticos Mejoras de Experiencia de Usuario (UX) Premium El generador ha sido actualizado con una interfaz moderna y eficiente que optimiza el flujo de trabajo: 1. Dise\u00f1o Compacto y Eficiente Layout Optimizado: Se han reducido los espacios innecesarios (paddings y m\u00e1rgenes) para mostrar m\u00e1s informaci\u00f3n en menos pantalla, ideal para configuraciones con muchos filtros. Cabeceras y Pie de P\u00e1gina Pegajosos: El bot\u00f3n de \"Generar Reporte\" y la barra de herramientas de filtros est\u00e1n siempre visibles (sticky), eliminando la necesidad de hacer scroll infinito. Barra Lateral de Agrupamiento: En pantallas grandes, la configuraci\u00f3n de grupos se mantiene fija a la derecha para un acceso r\u00e1pido. 2. Navegaci\u00f3n Inteligente y AJAX Limpieza de Sesi\u00f3n sin Recarga: El bot\u00f3n \"Borrar/Limpiar\" ahora funciona mediante AJAX. Esto limpia los filtros instant\u00e1neamente sin recargar la p\u00e1gina, lo que evita \"ensuciar\" el historial del navegador. Ahora, al presionar el bot\u00f3n \"Volver atr\u00e1s\" del navegador, regresar\u00e1s a la p\u00e1gina anterior con un solo clic. Confirmaciones Profesionales: Se utiliza SweetAlert2 para confirmaciones cr\u00edticas, ofreciendo una est\u00e9tica mucho m\u00e1s integrada y profesional que los mensajes nativos del navegador. 3. Feedback Visual Din\u00e1mico Animaciones de Resaltado: Al agregar un nuevo filtro, este aparece con una suave animaci\u00f3n de pulso para indicar d\u00f3nde se ha a\u00f1adido. Scroll Autom\u00e1tico: La pantalla se desplaza suavemente hacia el nuevo filtro seleccionado. Estados de Carga: El bot\u00f3n de generaci\u00f3n muestra un spinner y se deshabilita durante el procesamiento para evitar env\u00edos duplicados. Funcionalidades Avanzadas de Configuraci\u00f3n 1. Auto-Agrupamiento Inteligente Cuando se a\u00f1ade un filtro de tipo B\u00fasqueda Contextual (campos con addSearch() ), el sistema intenta autom\u00e1ticamente asignar ese campo al primer nivel de agrupamiento disponible. Esto agiliza la creaci\u00f3n de reportes, ya que normalmente se desea ver los datos agrupados por la entidad que se est\u00e1 filtrando. 2. Niveles de Agrupaci\u00f3n Excluyentes Para evitar errores en la l\u00f3gica del reporte, los niveles de agrupaci\u00f3n (Nivel 1, 2 y 3) son inteligentes: si seleccionas un campo en el Nivel 1, esa opci\u00f3n se deshabilitar\u00e1 autom\u00e1ticamente en los niveles 2 y 3, asegurando una jerarqu\u00eda l\u00f3gica y sin duplicados. Caracter\u00edsticas Principales 1. Generaci\u00f3n Autom\u00e1tica de Filtros El generador analiza autom\u00e1ticamente todos los campos definidos en tu dataset mediante addField() y crea los filtros apropiados seg\u00fan el tipo de campo: Tipos de Filtros Detectados Autom\u00e1ticamente Tipo de Campo Tipo de Filtro Generado Descripci\u00f3n date / datetime Rango de Fechas Permite filtrar desde/hasta una fecha espec\u00edfica money / numeric / decimal Rango Num\u00e9rico Filtro min/max para valores num\u00e9ricos dropdown / enum Selector de Opciones Lista desplegable con las opciones definidas switch / boolean Selector Booleano Filtro S\u00ed/No o Activo/Inactivo Campos con addSearch() B\u00fasqueda Contextual Permite buscar en el dataset relacionado Texto (otros) Filtro de Texto B\u00fasqueda por coincidencia de texto Ejemplo de Detecci\u00f3n Autom\u00e1tica // En tu dataset de Clientes $this->addField('customerName', [ 'label' => 'Nombre del Cliente', 'rules' => 'required' ]); // \u2192 Se generar\u00e1 un filtro de TEXTO $this->addField('creditLimit', [ 'label' => 'L\u00edmite de Cr\u00e9dito', 'rules' => 'required|money' ]); // \u2192 Se generar\u00e1 un filtro de RANGO NUM\u00c9RICO (min/max) $this->addField('status', [ 'label' => 'Estado', 'type' => 'dropdown', 'options' => [ 'active' => 'Activo', 'inactive' => 'Inactivo', 'suspended' => 'Suspendido' ] ]); // \u2192 Se generar\u00e1 un filtro de SELECCI\u00d3N con las opciones definidas $this->addSearch('salesRepEmployeeNumber', 'Tienda\\\\Empleados'); // \u2192 Se generar\u00e1 un filtro de B\u00daSQUEDA que reutiliza el dataset de Empleados 2. Generaci\u00f3n Autom\u00e1tica de Agrupaciones Los criterios de agrupaci\u00f3n tambi\u00e9n se generan autom\u00e1ticamente bas\u00e1ndose en la configuraci\u00f3n de campos: Tipos de Agrupaci\u00f3n Detectados Tipo de Campo Agrupaciones Generadas date / datetime \u2022 Por Mes (A\u00f1o-Mes) \u2022 Por A\u00f1o Campos con addSearch() \u2022 Por Valor Exacto del campo relacionado dropdown / enum \u2022 Por Valor Exacto de la opci\u00f3n seleccionada Ejemplo de Agrupaciones Autom\u00e1ticas // Campo de fecha en el dataset de \u00d3rdenes $this->addField('orderDate', [ 'label' => 'Fecha de Orden', 'type' => 'date', 'rules' => 'required' ]); // \u2192 Genera dos opciones de agrupaci\u00f3n: // 1. \"Fecha de Orden (Por Mes)\" // 2. \"Fecha de Orden (Por A\u00f1o)\" // Campo relacionado en el dataset de Pagos $this->addSearch('customerNumber', 'Tienda\\\\Clientes'); // \u2192 Genera agrupaci\u00f3n: // \"customerNumber (Valor exacto)\" - agrupa por cliente 3. Agrupaci\u00f3n Multinivel El generador soporta hasta 3 niveles de agrupaci\u00f3n jer\u00e1rquica , permitiendo reportes complejos como: Ventas por A\u00f1o \u2192 Mes \u2192 Empleado Pagos por Cliente \u2192 A\u00f1o \u2192 M\u00e9todo de Pago Productos por L\u00ednea \u2192 A\u00f1o \u2192 Mes Cada nivel de agrupaci\u00f3n genera autom\u00e1ticamente subtotales y el reporte incluye un total general . 4. B\u00fasqueda Contextual en Filtros Cuando un campo est\u00e1 vinculado a otro dataset mediante addSearch() , el filtro del reporte hereda toda la funcionalidad de b\u00fasqueda contextual: Ejemplo Pr\u00e1ctico: En el dataset de Pagos , tienes: $this->addSearch('customerNumber', 'Tienda\\\\Clientes'); Y en el dataset de Clientes , definiste: $this->setTableFields([ 'customerName', 'Contacto', // Campo calculado 'salesRepEmployeeNumber' // Empleado a cargo ]); Resultado en el Generador de Reportes: Al filtrar pagos por cliente, el usuario puede buscar escribiendo: El nombre de la empresa El nombre del contacto El nombre del empleado a cargo \u00a1El sistema buscar\u00e1 autom\u00e1ticamente en todos los campos visibles del dataset de Clientes! Arquitectura y Funcionamiento Clase RDatasetReportGenerator Esta clase es el motor detr\u00e1s de la generaci\u00f3n autom\u00e1tica de reportes. Sus responsabilidades incluyen: Introspecci\u00f3n de Campos ( detectCapabilities() ) Analiza todos los campos del dataset Identifica tipos de filtros aplicables Detecta criterios de agrupaci\u00f3n viables Ignora campos no aptos (claves primarias, campos \u00fanicos, archivos) Procesamiento de Solicitudes ( processRequest() ) Lee los filtros y agrupaciones enviados desde el formulario Valida y normaliza los valores Construye las condiciones de consulta Generaci\u00f3n de Consultas SQL Aplica filtros simples ( WHERE campo = valor ) Aplica rangos de fechas ( WHERE fecha >= inicio AND fecha <= fin ) Aplica rangos num\u00e9ricos ( WHERE campo >= min AND campo <= max ) Maneja correctamente JOINs para campos relacionados Formateo y Agrupaci\u00f3n ( generateHTML() ) Ejecuta la consulta con todos los filtros aplicados Enriquece los datos con claves de agrupaci\u00f3n formateadas Ordena jer\u00e1rquicamente por los niveles de agrupaci\u00f3n Delega el formateo de valores al modelo (moneda, fechas, relaciones) Generaci\u00f3n de Reporte HTML Utiliza RSimpleLevelReport para generar HTML estructurado Incluye totales y subtotales autom\u00e1ticos Muestra descripci\u00f3n de filtros aplicados Flujo de Ejecuci\u00f3n graph TD A[Usuario hace clic en bot\u00f3n Reporte] --> B[genericAdvancedReport m\u00e9todo] B --> C{\u00bfEs POST?} C -->|No| D[Mostrar formulario de configuraci\u00f3n] C -->|S\u00ed| E[Procesar filtros y agrupaciones] E --> F[Ejecutar consulta SQL con filtros] F --> G[Formatear datos y agrupar] G --> H[Generar HTML con totales] H --> I[Mostrar reporte al usuario] D --> J[Usuario configura filtros/grupos] J --> K[Usuario env\u00eda formulario] K --> C Uso Pr\u00e1ctico: Ejemplo Completo Dataset de \u00d3rdenes namespace App\\Controllers\\Tienda; use App\\ThirdParty\\Ragnos\\Controllers\\RDatasetController; class Ordenes extends RDatasetController { public function __construct() { parent::__construct(); $this->checkLogin(); $this->setTitle('\u00d3rdenes de Compra'); $this->setTableName('orders'); $this->setIdField('orderNumber'); // Campo de fecha \u2192 generar\u00e1 filtro de rango + agrupaci\u00f3n por mes/a\u00f1o $this->addField('orderDate', [ 'label' => 'Fecha de Orden', 'type' => 'date', 'rules' => 'required' ]); // Campo relacionado \u2192 generar\u00e1 filtro de b\u00fasqueda + agrupaci\u00f3n por cliente $this->addSearch('customerNumber', 'Tienda\\\\Clientes'); // Campo enum \u2192 generar\u00e1 filtro de selecci\u00f3n + agrupaci\u00f3n por estado $this->addField('status', [ 'label' => 'Estado', 'type' => 'dropdown', 'options' => [ 'Shipped' => 'Enviado', 'Pending' => 'Pendiente', 'Cancelled' => 'Cancelado' ], 'rules' => 'required' ]); // Campo calculado (monto total) $this->addField('Total', [ 'label' => 'Total', 'query' => '(SELECT SUM(quantityOrdered * priceEach) FROM orderdetails WHERE orderdetails.orderNumber = orders.orderNumber)', 'rules' => 'readonly|money' ]); $this->setTableFields([ 'orderNumber', 'orderDate', 'customerNumber', 'status', 'Total' ]); } } Reportes Generados Autom\u00e1ticamente Con esta configuraci\u00f3n, el usuario puede generar reportes como: Ejemplo 1: Ventas por Cliente en un Rango de Fechas Filtro: Fecha desde 2024-01-01 hasta 2024-12-31 Agrupaci\u00f3n: Por Cliente Resultado: Lista de clientes con el total vendido a cada uno en 2024 Ejemplo 2: \u00d3rdenes Canceladas por Mes Filtro: Estado = \"Cancelado\" Agrupaci\u00f3n Nivel 1: Por Mes Resultado: Total de \u00f3rdenes canceladas agrupadas por mes con subtotales Ejemplo 3: An\u00e1lisis Jer\u00e1rquico Anual Agrupaci\u00f3n Nivel 1: Por A\u00f1o Agrupaci\u00f3n Nivel 2: Por Mes Agrupaci\u00f3n Nivel 3: Por Estado Resultado: Reporte jer\u00e1rquico: A\u00f1o \u2192 Mes \u2192 Estado con todos sus subtotales Ventajas del Sistema 1. Cero Configuraci\u00f3n Adicional No necesitas escribir controladores especiales, vistas o queries para reportes. Todo se genera autom\u00e1ticamente desde la definici\u00f3n del dataset. 2. Reutilizaci\u00f3n de L\u00f3gica Los filtros y agrupaciones reutilizan: Las validaciones definidas en addField() Las relaciones definidas con addSearch() El formateo definido en el modelo 3. Consistencia de Interfaz Todos los datasets tienen exactamente la misma interfaz de reportes, reduciendo la curva de aprendizaje para los usuarios. 4. Flexibilidad Total Los usuarios finales pueden combinar cualquier filtro con cualquier agrupaci\u00f3n, generando reportes ad-hoc seg\u00fan sus necesidades sin requerir desarrollo. 5. Escalabilidad A medida que agregas m\u00e1s campos a tu dataset, autom\u00e1ticamente se ampl\u00edan las opciones de filtros y agrupaciones disponibles. Limitaciones y Consideraciones Campos Excluidos Autom\u00e1ticamente El sistema ignora autom\u00e1ticamente ciertos tipos de campos para filtros y agrupaciones: Claves primarias : No suelen ser \u00fatiles para filtros generales Campos con is_unique : Pensados para identificadores \u00fanicos Archivos e im\u00e1genes ( fileupload , imageupload ) Contrase\u00f1as ( password ) Campos Calculados y Agrupaciones Los campos con query (calculados) pueden aparecer en el reporte, pero no se pueden usar como criterio de agrupaci\u00f3n ya que son expresiones SQL derivadas. Performance en Grandes Vol\u00famenes Para datasets con millones de registros, considera: A\u00f1adir \u00edndices en campos frecuentemente filtrados Limitar las opciones de agrupaci\u00f3n si son muy costosas Implementar paginaci\u00f3n o l\u00edmites en la consulta si es necesario Personalizaci\u00f3n Avanzada Aunque el generador es autom\u00e1tico, puedes influir en su comportamiento: Controlar qu\u00e9 Campos son Filtrables Al definir campos como hidden o con reglas espec\u00edficas, puedes controlar su aparici\u00f3n en filtros: // Este campo NO aparecer\u00e1 en filtros (es hidden y calculado) $this->addField('internalCode', [ 'label' => 'C\u00f3digo Interno', 'type' => 'hidden', 'query' => 'MD5(customerNumber)' ]); M\u00e9todos Program\u00e1ticos Tambi\u00e9n puedes usar el generador program\u00e1ticamente desde c\u00f3digo: public function reportePersonalizado() { $generator = new RDatasetReportGenerator($this); // Agregar filtros manualmente $generator->addDateRangeFilter('orderDate', '2024-01-01', '2024-12-31'); $generator->addFilter('status', 'Shipped'); // Configurar agrupaci\u00f3n $generator->setGrouping('customerNumber', 'raw', 'Cliente'); $generator->setGrouping('orderDate', 'date_month', 'Mes'); // Generar HTML $html = $generator->generateHTML(); return view('mi_plantilla_reporte', ['contenido' => $html]); } Integraci\u00f3n con el Ecosistema Ragnos Relaci\u00f3n con addSearch() Como se mencion\u00f3 en la gu\u00eda de Datasets , los campos definidos con addSearch() no solo crean selectores en formularios, sino que tambi\u00e9n: En Filtros de Reportes: Permiten b\u00fasqueda contextual avanzada En Agrupaciones: Se convierten autom\u00e1ticamente en criterios de agrupaci\u00f3n Esta sinergia hace que definir relaciones sea doblemente poderoso. Relaci\u00f3n con setTableFields() Los campos incluidos en setTableFields() son los que aparecer\u00e1n en el reporte generado. Esto te da control sobre qu\u00e9 columnas se muestran sin afectar la disponibilidad de filtros y agrupaciones. Conclusi\u00f3n El Generador Autom\u00e1tico de Reportes es una de las caracter\u00edsticas m\u00e1s potentes de Ragnos, transformando cada dataset simple en una herramienta de an\u00e1lisis avanzado sin esfuerzo adicional de desarrollo. Al aprovechar toda la metadata declarativa que defines en tu dataset ( addField , addSearch , setTableFields ), el sistema construye autom\u00e1ticamente una interfaz completa de reporter\u00eda con: \u2705 Filtros inteligentes seg\u00fan tipo de campo \u2705 Agrupaciones jer\u00e1rquicas multinivel \u2705 B\u00fasqueda contextual en relaciones \u2705 Totales y subtotales autom\u00e1ticos \u2705 Interfaz consistente en todos los m\u00f3dulos Resultado: Reportes empresariales de calidad profesional, disponibles en minutos, no en semanas.","title":"Automatic Reports"},{"location":"en/fundamentos/base_de_datos_demo/","text":"Base de Datos Demo (Classicmodels) Ragnos incluye la base de datos de ejemplo Classicmodels , una implementaci\u00f3n est\u00e1ndar conocida en el mundo del desarrollo para probar funcionalidades de bases de datos relacionales. Esta base de datos modela un negocio de venta de modelos a escala de coches cl\u00e1sicos . Contiene informaci\u00f3n t\u00edpica de un negocio: clientes, productos, pedidos, pagos, empleados y oficinas. \ud83d\udcca Estructura de la Base de Datos La base de datos consta de 8 tablas relacionadas entre s\u00ed. A continuaci\u00f3n se presenta un diagrama Entidad-Relaci\u00f3n (ER) que ilustra la estructura: erDiagram CUSTOMERS ||--o{ ORDERS : realiza CUSTOMERS ||--o{ PAYMENTS : efectua CUSTOMERS }|--|| EMPLOYEES : \"atendido por\" EMPLOYEES ||--|{ EMPLOYEES : \"reporta a\" EMPLOYEES }|--|| OFFICES : \"trabaja en\" ORDERS ||--|{ ORDERDETAILS : contiene PRODUCTS ||--o{ ORDERDETAILS : \"incluido en\" PRODUCTS }|--|| PRODUCTLINES : \"categoria\" CUSTOMERS { int customerNumber PK string customerName string contactLastName string contactFirstName string phone string addressLine1 string city string country int salesRepEmployeeNumber FK decimal creditLimit } EMPLOYEES { int employeeNumber PK string lastName string firstName string email string officeCode FK int reportsTo FK string jobTitle } OFFICES { string officeCode PK string city string phone string addressLine1 string country string territory } ORDERDETAILS { int orderNumber PK,FK string productCode PK,FK int quantityOrdered decimal priceEach } ORDERS { int orderNumber PK date orderDate date shippedDate string status int customerNumber FK } PAYMENTS { int customerNumber PK,FK string checkNumber PK date paymentDate decimal amount } PRODUCTS { string productCode PK string productName string productLine FK string productScale string productVendor int quantityInStock decimal buyPrice decimal MSRP } PRODUCTLINES { string productLine PK string textDescription } \ud83d\udcdd Descripci\u00f3n de las Tablas A continuaci\u00f3n se detalla el prop\u00f3sito de cada tabla: 1. Customers (Clientes) Almacena la informaci\u00f3n de los clientes de la empresa. Datos clave: Nombre, contacto, direcci\u00f3n, tel\u00e9fono, l\u00edmite de cr\u00e9dito. Relaciones: Se vincula con Employees (representante de ventas asignado), Orders (pedidos realizados) y Payments (pagos efectuados). 2. Products (Productos) Cat\u00e1logo de modelos a escala de coches, motos y otros veh\u00edculos cl\u00e1sicos. Datos clave: C\u00f3digo, nombre, escala, proveedor, descripci\u00f3n, stock, precio de compra y precio de venta sugerido (MSRP). Relaciones: Pertenece a una ProductLine y aparece en OrderDetails . 3. ProductLines (L\u00edneas de Productos) Categor\u00edas en las que se clasifican los productos (ej. \"Classic Cars\", \"Motorcycles\"). Datos clave: Nombre de la l\u00ednea, descripci\u00f3n. 4. Orders (Pedidos) Cabecera de los pedidos realizados por los clientes. Datos clave: Fechas (pedido, requerido, enviado), estado (Shipped, Cancelled, etc.), comentarios. Relaciones: Vinculado al Customer que hizo el pedido. 5. OrderDetails (Detalles de Pedido) L\u00edneas individuales de cada pedido, especificando qu\u00e9 productos se compraron. Datos clave: Cantidad ordenada, precio unitario real. Relaciones: Vincula Orders con Products (relaci\u00f3n muchos a muchos). 6. Payments (Pagos) Registro de pagos realizados por los clientes. Datos clave: N\u00famero de cheque, fecha de pago, monto. Relaciones: Vinculado a Customers . 7. Employees (Empleados) Informaci\u00f3n del personal de la empresa. Datos clave: Nombre, email, puesto de trabajo. Relaciones: Pertenece a una Office . Se reporta a otro empleado (estructura jer\u00e1rquica). Es representante de ventas de Customers . 8. Offices (Oficinas) Ubicaciones f\u00edsicas de las oficinas de ventas. Datos clave: Ciudad, tel\u00e9fono, direcci\u00f3n, pa\u00eds, territorio. \ud83d\udd10 Acceso a la Demo Si has instalado el proyecto y cargado estos datos de ejemplo, o est\u00e1s accediendo a nuestra demo en l\u00ednea, puedes utilizar las siguientes credenciales para acceder al panel administrativo: Credenciales de Acceso URL Demo: https://ragnos.yupii.org/ Usuario: admin Contrase\u00f1a: admin Una vez dentro, podr\u00e1s explorar los m\u00f3dulos creados sobre esta estructura de base de datos para ver Ragnos en acci\u00f3n (Datasets maestro-detalle, reportes, gr\u00e1ficos, etc.).","title":"Base de Datos Demo (Classicmodels)"}]}