<!DOCTYPE html>

<html data-bs-theme="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://cgarciagl.github.io/Ragnos/docs/en/avanzado/hooks/" rel="canonical"/>
<link href="../../../img/favicon.ico" rel="shortcut icon"/>
<title>Hooks &amp; Events - Ragnos Docs</title>
<link href="../../../css/bootstrap.min.css" rel="stylesheet"/>
<link href="../../../css/fontawesome.min.css" rel="stylesheet"/>
<link href="../../../css/brands.min.css" rel="stylesheet"/>
<link href="../../../css/solid.min.css" rel="stylesheet"/>
<link href="../../../css/v4-font-face.min.css" rel="stylesheet"/>
<link href="../../../css/base.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/panda-syntax-dark.min.css" id="hljs-light" rel="stylesheet"/>
<link disabled="" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" id="hljs-dark" rel="stylesheet"/>
<link href="../../../css/ragnos_style.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JGEDJD0GZP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "G-JGEDJD0GZP");
</script>
</head>
<body>
<div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
<div class="container">
<a class="navbar-brand" href="../../">Ragnos Docs</a>
<!-- Expander button -->
<button aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#navbar-collapse" data-bs-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<!-- Expanded navigation -->
<div class="navbar-collapse collapse" id="navbar-collapse">
<!-- Main navigation -->
<ul class="nav navbar-nav">
<li class="nav-item">
<a class="nav-link" href="../../">Home</a>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">Fundamentals</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../fundamentos/instalacion/">Installation</a>
</li>
<li>
<a class="dropdown-item" href="../../fundamentos/primeros_pasos/">Getting Started</a>
</li>
<li>
<a class="dropdown-item" href="../../fundamentos/demo_database/">Demo Database</a>
</li>
<li>
<a class="dropdown-item" href="../../fundamentos/configuracion/">Configuration</a>
</li>
<li>
<a class="dropdown-item" href="../../fundamentos/plantilla/">CLI Generator</a>
</li>
</ul>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">Datasets &amp; Models</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../datasets/datasets/">Creating Datasets</a>
</li>
<li>
<a class="dropdown-item" href="../../datasets/campos/">Field Reference</a>
</li>
<li>
<a class="dropdown-item" href="../../datasets/guia_RQueryController/">Advanced Queries (RQuery)</a>
</li>
<li>
<a class="dropdown-item" href="../../datasets/maestro-detalle/">Master-Detail</a>
</li>
</ul>
</li>
<li class="nav-item dropdown">
<a aria-current="page" aria-expanded="false" class="nav-link dropdown-toggle active" data-bs-toggle="dropdown" href="#" role="button">Advanced Backend</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../guia_modo_api/">API Mode</a>
</li>
<li>
<a class="dropdown-item" href="../helpers/">Helpers &amp; Utilities</a>
</li>
<li>
<a aria-current="page" class="dropdown-item active" href="./">Hooks &amp; Events</a>
</li>
<li>
<a class="dropdown-item" href="../autenticacion_integrada/">Authentication</a>
</li>
<li>
<a class="dropdown-item" href="../auditlog/">Audit Log</a>
</li>
<li>
<a class="dropdown-item" href="../server_side_events/">Server Side Events</a>
</li>
<li>
<a class="dropdown-item" href="../reportes_automaticos/">Automatic Reports</a>
</li>
<li>
<a class="dropdown-item" href="../despliegue/">Deployment</a>
</li>
</ul>
</li>
<li class="nav-item dropdown">
<a aria-expanded="false" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">Frontend &amp; Reports</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../../frontend/personalizacion_ui/">UI Customization</a>
</li>
<li>
<a class="dropdown-item" href="../../frontend/reportes_simples/">Simple Reports</a>
</li>
<li>
<a class="dropdown-item" href="../../frontend/funciones_javascript/">JavaScript Functions</a>
</li>
</ul>
</li>
<li class="nav-item">
<a class="nav-link" href="https://ragnos.build">üè† Website</a>
</li>
</ul>
<ul class="nav navbar-nav ms-md-auto">
<li class="nav-item">
<a class="nav-link" data-bs-target="#mkdocs_search_modal" data-bs-toggle="modal" href="#">
<i class="fa fa-search"></i> Search
                            </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../helpers/" rel="prev">
<i class="fa fa-arrow-left"></i> Previous
                                </a>
</li>
<li class="nav-item">
<a class="nav-link" href="../autenticacion_integrada/" rel="next">
                                    Next <i class="fa fa-arrow-right"></i>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://github.com/cgarciagl/ragnos"><i class="fa-brands fa-github"></i> GitHub</a>
</li>
</ul>
</div>
</div>
</div>
<div class="container">
<div class="row">
<div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
<div class="navbar-header">
<button class="navbar-toggler collapsed" data-bs-target="#toc-collapse" data-bs-toggle="collapse" title="Table of Contents" type="button">
<span class="fa fa-angle-down"></span>
</button>
</div>
<div class="navbar-collapse collapse card bg-body-tertiary" id="toc-collapse">
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="1"><a class="nav-link" href="#hooks-and-lifecycle-in-ragnos">Hooks and Lifecycle in Ragnos</a>
<ul class="nav flex-column">
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#visual-lifecycle">Visual Lifecycle</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#available-hooks">Available Hooks</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#fundamental-tools-and-concepts">Fundamental Tools and Concepts</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#insertion-hooks">Insertion Hooks</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#update-hooks">Update Hooks</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#deletion-hooks">Deletion Hooks</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#case-study-password-hashing">Case Study: Password Hashing</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#ui-hooks">UI Hooks</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#best-practices">Best Practices</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-bs-level="2"><a class="nav-link" href="#philosophy">Philosophy</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div></div>
<div class="col-md-9" role="main">
<h1 id="hooks-and-lifecycle-in-ragnos">Hooks and Lifecycle in Ragnos</h1>
<p>In Ragnos, <strong>hooks</strong> allow executing custom logic at different moments of dataset lifecycle.
Are main mechanism to <strong>extend behavior</strong> without breaking declarative model.</p>
<p>Hooks defined as protected methods inside controller extending <code>RDatasetController</code>.</p>
<div class="admonition info">
<p class="admonition-title">Key Concept</p>
<p>Controller <strong>does not implement CRUD</strong> manually. Ragnos handles database operation, you just "hook" into key points to inject business logic.</p>
</div>
<hr/>
<h2 id="visual-lifecycle">Visual Lifecycle</h2>
<p>Understanding flow is crucial to know where to place logic.</p>
<div class="mermaid">graph TD
    A["User Request"] --&gt; B{"Field Validation"}
    B -- Fail --&gt; Z["Show Error"]
    B -- Success --&gt; C{"Exists Hook _before*?"}
    C -- Yes --&gt; D["Execute _before*( )"]
    D -- "raise( )" --&gt; Z
    C -- No --&gt; E["DB Operation"]
    D -- Success --&gt; E
    E --&gt; F{"Operation Successful?"}
    F -- No --&gt; Z
    F -- Yes --&gt; G{"Exists Hook _after*?"}
    G -- Yes --&gt; H["Execute _after*( )"]
    G -- No --&gt; I["Success Response"]
    H --&gt; I
</div>
<hr/>
<h2 id="available-hooks">Available Hooks</h2>
<p>Ragnos exposes following hooks, all optional:</p>
<table>
<thead>
<tr>
<th>Hook</th>
<th>Execution Moment</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>_beforeInsert()</code></td>
<td>Before inserting record</td>
</tr>
<tr>
<td><code>_afterInsert()</code></td>
<td>After inserting record</td>
</tr>
<tr>
<td><code>_beforeUpdate()</code></td>
<td>Before updating record</td>
</tr>
<tr>
<td><code>_afterUpdate()</code></td>
<td>After updating record</td>
</tr>
<tr>
<td><code>_beforeDelete()</code></td>
<td>Before deleting record</td>
</tr>
<tr>
<td><code>_afterDelete()</code></td>
<td>After deleting record</td>
</tr>
</tbody>
</table>
<hr/>
<h2 id="fundamental-tools-and-concepts">Fundamental Tools and Concepts</h2>
<p>Before writing specific functions, important to know tools Ragnos provides inside hooks to interact with data and app flow.</p>
<h3 id="1-basic-structure">1. Basic Structure</h3>
<p>Hooks of type <code>_before*</code> (Insert and Update) receive <code>$data</code> array by reference, allowing value modification before reaching DB. If modification not needed, argument can be omitted.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="x">// Hook with data manipulation (by reference)</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="x">protected function _beforeInsert(&amp;$data)</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="x">{</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="x">    $data['created_at'] = date('Y-m-d');</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="x">}</span>
</code></pre></div>
<h3 id="2-value-access-newvalue-and-oldvalue">2. Value Access: <code>newValue()</code> and <code>oldValue()</code></h3>
<p>To facilitate business logic, Ragnos provides helper functions to inspect data state:</p>
<ul>
<li><strong><code>newValue('field')</code></strong>: Value trying to be saved (request payload).</li>
<li><strong><code>oldValue('field')</code></strong>: Original value existing in database (before modification).</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Helper</th>
<th style="text-align: center;">Insert</th>
<th style="text-align: center;">Update</th>
<th style="text-align: center;">Delete</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>newValue()</code></td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚ùå</td>
</tr>
<tr>
<td style="text-align: left;"><code>oldValue()</code></td>
<td style="text-align: center;">‚ùå</td>
<td style="text-align: center;">‚úÖ</td>
<td style="text-align: center;">‚úÖ</td>
</tr>
</tbody>
</table>
<h3 id="3-change-detection-fieldhaschanged">3. Change Detection: <code>fieldHasChanged()</code></h3>
<p>Especially useful in updates to execute actions only if specific field modified.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="x">if (fieldHasChanged('status')) {</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="x">    // Send status change notification</span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="x">}</span>
</code></pre></div>
<h3 id="4-safe-interruption-raise">4. Safe Interruption: <code>raise()</code></h3>
<p>If need to stop operation due to business rule, use <code>raise()</code>. Stops process and shows error message to user, preventing CRUD operation.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="x">if (oldValue('locked') === true) {</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="x">    raise('Cannot modify locked record.');</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="x">}</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Design Note</p>
<p><code>raise()</code> preferable to <code>throw new Exception</code> for logic validation errors ("Soft errors") that user must correct.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Refactoring and Organization</p>
<p>Although Ragnos <strong>does not force</strong> you to create external classes for hook functions (you can write logic directly in the controller), if <strong>business rules are sufficiently complex</strong>, it is convenient and recommended to refactor them into dedicated <strong>Models</strong>, <strong>Libraries</strong>, or <strong>Services</strong>. This helps keep code organized, reusable, and easier to maintain.</p>
</div>
<hr/>
<h2 id="insertion-hooks">Insertion Hooks</h2>
<p>Executed during creation of new records.</p>
<h3 id="_beforeinsertdata"><code>_beforeInsert(&amp;$data)</code></h3>
<p>Executed <strong>before</strong> INSERT. Receives <code>$data</code> by reference.</p>
<p><strong>Common uses:</strong></p>
<ul>
<li>Initialize automatic values (dates, UUIDs).</li>
<li>Normalize data (uppercase, formats).</li>
<li>Custom payload validations.</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="x">protected function _beforeInsert(&amp;$data)</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="x">{</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="x">    // Assign manual creation date</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="x">    $data['created_at'] = date('Y-m-d H:i:s');</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="x">    // Force uppercase in RFC</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="x">    if (isset($data['rfc'])) {</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="x">        $data['rfc'] = strtoupper($data['rfc']);</span>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="x">    }</span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="x">}</span>
</code></pre></div>
<h3 id="_afterinsert"><code>_afterInsert()</code></h3>
<p>Executed <strong>after</strong> successful INSERT.</p>
<p><strong>Common uses:</strong></p>
<ul>
<li>Audit logs.</li>
<li>Welcome notifications sending.</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="x">protected function _afterInsert()</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="x">{</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="x">    log_message('info', 'New user registered with ID ' . $this-&gt;insertID());</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="x">}</span>
</code></pre></div>
<hr/>
<h2 id="update-hooks">Update Hooks</h2>
<p>Manage modification of existing records. Where most complex business logic resides.</p>
<h3 id="_beforeupdatedata"><code>_beforeUpdate(&amp;$data)</code></h3>
<p>Executed <strong>before</strong> UPDATE. Receives <code>$data</code> with fields to update.</p>
<p><strong>Common uses:</strong></p>
<ul>
<li>State transition validations.</li>
<li>Register edit metadata (<code>updated_by</code>).</li>
<li>Critical field protection.</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="x">protected function _beforeUpdate(&amp;$data)</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="x">{</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="x">    // Register who modified</span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="x">    $data['updated_by'] = session('user_id');</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="x">    // Validate business rule: Cannot reopen completed tasks</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="x">    if (oldValue('status') === 'completed' &amp;&amp; newValue('status') === 'pending') {</span>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="x">        raise('Cannot reopen completed task.');</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="x">    }</span>
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="x">}</span>
</code></pre></div>
<h3 id="_afterupdate"><code>_afterUpdate()</code></h3>
<p>Executed <strong>after</strong> successful UPDATE.</p>
<p><strong>Common uses:</strong></p>
<ul>
<li>Invalidate cache.</li>
<li>Recalculate dependent data in other tables.</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="x">protected function _afterUpdate()</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="x">{</span>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="x">    // If credit limit changed, invalidate statement cache</span>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="x">    if (fieldHasChanged('creditLimit')) {</span>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="x">        \Config\Services::cache()-&gt;delete('accountstatements');</span>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="x">    }</span>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="x">}</span>
</code></pre></div>
<hr/>
<h2 id="deletion-hooks">Deletion Hooks</h2>
<p>Manage information deletion.</p>
<h3 id="_beforedelete"><code>_beforeDelete()</code></h3>
<p>Executed <strong>before</strong> DELETE.</p>
<p><strong>Common uses:</strong></p>
<ul>
<li>Validate dependencies (manual referential integrity).</li>
<li>Prevent system record deletion.</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="x">protected function _beforeDelete()</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="x">{</span>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="x">    // Protect Administrator user (ID 1)</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="x">    if (oldValue('user_id') == 1) {</span>
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="x">        raise('Cannot delete main admin user.');</span>
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="x">    }</span>
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="x">    // Verify relations manually</span>
<a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="x">    if ($this-&gt;hasRelations()) {</span>
<a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="x">        raise('Cannot delete record because has associated data.');</span>
<a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="x">    }</span>
<a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="x">}</span>
</code></pre></div>
<h3 id="_afterdelete"><code>_afterDelete()</code></h3>
<p>Executed <strong>after</strong> DELETE.</p>
<p><strong>Common uses:</strong></p>
<ul>
<li>Cleanup attachments (images, docs).</li>
<li>Activity logs.</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="x">protected function _afterDelete()</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="x">{</span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="x">    log_message('info', 'Record deleted successfully.');</span>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="x">}</span>
</code></pre></div>
<hr/>
<h2 id="case-study-password-hashing">Case Study: Password Hashing</h2>
<p>Real example combining hooks to manage user passwords securely.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="x">// On create, ALWAYS hash password</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="x">public function _beforeInsert(&amp;$userData)</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="x">{</span>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="x">    $userData['usu_pword'] = md5(strtoupper($userData['usu_pword']));</span>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="x">}</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="x">// On edit, ONLY hash if user wrote new password</span>
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="x">public function _beforeUpdate(&amp;$userData)</span>
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="x">{</span>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="x">    if (fieldHasChanged('usu_pword')) {</span>
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="x">        $userData['usu_pword'] = md5(strtoupper($userData['usu_pword']));</span>
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="x">    }</span>
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="x">}</span>
</code></pre></div>
<p><strong>Explanation:</strong></p>
<ol>
<li>In <code>_beforeInsert</code>, password always comes plaintext, so hash unconditionally.</li>
<li>In <code>_beforeUpdate</code>, use <code>fieldHasChanged</code> to detect if user entered new key. If check skipped, existing hash re-hashed, corrupting password.</li>
</ol>
<hr/>
<h2 id="ui-hooks">UI Hooks</h2>
<p>Ragnos allows intervention in generated visual interface too.</p>
<h3 id="_customformdatafooter"><code>_customFormDataFooter()</code></h3>
<p>Inserts HTML or scripts at footer of edit form.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="x">function _customFormDataFooter()</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="x">{</span>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="x">    $id = $this-&gt;request-&gt;getPost($this-&gt;getIdField());</span>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="x">    // Return partial view</span>
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="x">    return view('Store/order_detail', ['orderId' =&gt; $id]);</span>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="x">}</span>
</code></pre></div>
<hr/>
<h2 id="best-practices">Best Practices</h2>
<div class="admonition success">
<p class="admonition-title">Recommended</p>
<p><strong>Keep hooks small:</strong> Complex logic goes to Services or Libraries.</p>
<p><strong>Document side effects:</strong> If hook alters other table, leave clear comment. - <strong>Usa <code>raise()</code></strong> for validation errors instead of hard exceptions.</p>
</div>
<div class="admonition fail">
<p class="admonition-title">To Avoid</p>
<p><strong>Do not replace controller:</strong> Hooks are to <em>extend</em>, not rewrite CRUD flow.</p>
<p><strong>Careful with manual SQL:</strong> Try to use models whenever possible.</p>
</div>
<hr/>
<h2 id="philosophy">Philosophy</h2>
<p>Hooks in Ragnos allow <strong>extending without breaking</strong>:</p>
<ul>
<li><strong>Decoupling:</strong> Do not couple hard business logic to generic CRUD mechanism.</li>
<li><strong>Declarative:</strong> Keep config over programming approach.</li>
<li><strong>Maintainability:</strong> Clearly separate "What to save" from "What to do when saving".</li>
</ul>
<div class="admonition quote">
<p class="admonition-title">Ragnos Philosophy</p>
<p><strong>In Ragnos, hooks don't control flow: they react to domain.</strong></p>
</div></div>
</div>
</div>
<footer class="col-md-12">
<hr/>
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
</footer>
<script src="../../../js/bootstrap.bundle.min.js"></script>
<script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
<script src="../../../js/base.js"></script>
<script src="../../../back_particles.js"></script>
<script src="../../../search/main.js"></script>
<div aria-hidden="true" aria-labelledby="searchModalLabel" class="modal" id="mkdocs_search_modal" role="dialog" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="searchModalLabel">Search</h4>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<p>From here you can search these documents. Enter your search terms below.</p>
<form>
<div class="form-group">
<input class="form-control" id="mkdocs-search-query" placeholder="Search..." title="Type search term here" type="search"/>
</div>
</form>
<div data-no-results-text="No results found" id="mkdocs-search-results"></div>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div><div aria-hidden="true" aria-labelledby="keyboardModalLabel" class="modal" id="mkdocs_keyboard_modal" role="dialog" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<table class="table">
<thead>
<tr>
<th style="width: 20%;">Keys</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="help shortcut"><kbd>?</kbd></td>
<td>Open this help</td>
</tr>
<tr>
<td class="next shortcut"><kbd>n</kbd></td>
<td>Next page</td>
</tr>
<tr>
<td class="prev shortcut"><kbd>p</kbd></td>
<td>Previous page</td>
</tr>
<tr>
<td class="search shortcut"><kbd>s</kbd></td>
<td>Search</td>
</tr>
</tbody>
</table>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.6.1/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>
