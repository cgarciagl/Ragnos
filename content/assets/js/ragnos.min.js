class RagnosSearch{static searchStack=new class{constructor(){this.items=[]}push(t){this.items.push(t)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}get length(){return this.items.length}clear(){this.items=[]}};static setupSimpleSearch(t,e,s,n){const a=$(t);a.wrap('<div class="input-group"></div>');const r=$('\n      <button class="btn btn-outline-secondary" type="button" aria-label="Search">\n        <i class="bi bi-search"></i>\n      </button>\n    ');r.insertAfter(a);const o=async(t="")=>{try{const r={valorabuscar:t.replace(/[^a-zA-Z0-9 ]/g,"").trim(),ruta:e,params:s},o=await getValue("admin/busqueda",r);showModal(o,"","busquedaModal",(()=>{const t=$("#busquedaModal").data("ResultData");a.data("searchdata",t),n&&n(a)}))}catch(t){}};a.attr("autocomplete","off").on("input",(function(){const t=$(this).val();t.trim().length>0&&debounce((function(){o(t)}),400)})),r.on("click",(()=>o()))}static instances=new Map;constructor(t,e){this.control=$(t),this.params={controller:e.controller.toLowerCase(),filter:e.filter,callback:e.callback||(()=>{}),canSetToNull:void 0===e.canSetToNull||e.canSetToNull},this.initialize()}initialize(){if(this.control.hasClass("Ragnosffied"))return;const t=this.control.attr("name"),e=this.createSearchButton();let s=$();this.params.canSetToNull&&(s=this.createRemoveButton());const n=this.createHiddenField(t);this.setupDOM(e,n,s),this.setupEventListeners(e,s),RagnosSearch.instances.set(t,this)}createSearchButton(){return $('\n      <button class="btn btn-outline-secondary" type="button" aria-label="Search">\n        <i class="bi bi-search"></i>\n      </button>\n    ')}createRemoveButton(){return $('\n      <button class="btn btn-outline-secondary" type="button" aria-label="Remove">\n        <i class="bi bi-x-lg"></i>\n      </button>\n    ')}createHiddenField(t){return $(`\n      <input \n        type="hidden" \n        class="searchhiddenfield" \n        name="Ragnos_id_${t}" \n        id="Ragnos_id_${t}"\n      >\n    `)}setupDOM(t,e,s){t.insertAfter(this.control);const n=this.control.closest(".input-group");e.insertAfter(n),s.insertAfter(t),this.control.addClass("Ragnosffied")}setupEventListeners(t,e){this.control.is("[readonly]")||(this.control.on("input",(()=>{const t=this.control.val();debounce((()=>{this.search(t,!1)}),400)})),t.on("click",(t=>{t.preventDefault(),this.search("",!0)})),this.params.canSetToNull&&e.on("click",(t=>{t.preventDefault(),this.control.val(null);const e=this.control.closest(".input-group").next("input[type=hidden]");e.length&&e.val(null)})))}processFilter(){let t=this.params.filter;try{const e=atob(t);if(!e)return btoa(JSON.stringify([]));const s=JSON.parse(e).map((t=>{if("string"==typeof t.value){const e=t.value.replace(/\[([^\]]+)]/g,((t,e)=>{const s=$(`#${e}`);return s.length?s.val()??"":""}));return{...t,value:e}}return t})),n=JSON.stringify(s);return btoa(n)}catch(t){return btoa(JSON.stringify([]))}}sanitizeSearchText(t){return t.replace(/[^a-zA-Z0-9 ]/g,"").trim()}async search(t,e){const s=this.sanitizeSearchText(t);if(s||e){RagnosSearch.searchStack.push(this.control);try{const t={sSearch:s,sFilter:this.processFilter(),..."undefined"!=typeof Ragnos_csrf?Ragnos_csrf:{}},e=await getValue(`${this.params.controller}/searchByAjax`,t);await this.showSearchResults(e),this.params.callback(this.control)}catch(t){}}else{const t=this.control.closest(".input-group").next("input[type=hidden]");t.length&&t.val("")}}showSearchResults(t){return new Promise((e=>{showModal(t,"BÃºsqueda","YSearchModal",e)}))}}$.fn.RagnosSearch=function(t){return this.each((function(){new RagnosSearch(this,{controller:t.controller||"",filter:t.filter||"",callback:t.callback||(()=>{}),canSetToNull:void 0===t.canSetToNull||t.canSetToNull})}))};class RagnosUtils{static async showControllerTableIn(t,e,s=""){try{s&&(Ragnos_csrf.Ragnos_master=s);const n=await getValue(`${e}/tableByAjax`,Ragnos_csrf);$(t).html(n)}catch(t){}}static async showControllerReportIn(t,e){try{const s=await getValue(`${e}/reportByAjax`,Ragnos_csrf);$(t).html(s)}catch(t){}}}