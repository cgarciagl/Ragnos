class RagnosSearch{static searchStack=new class{constructor(){this.items=[]}push(t){this.items.push(t)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}get length(){return this.items.length}clear(){this.items=[]}};static setupSimpleSearch(t,s,e,a){const n=$(t);n.wrap('<div class="input-group"></div>');const r=$('\n      <button class="btn btn-outline-secondary" type="button" aria-label="Search">\n        <i class="bi bi-search"></i>\n      </button>\n    ');r.insertAfter(n);const i=async(t="")=>{try{const r={valorabuscar:t.replace(/[^a-zA-Z0-9 ]/g,"").trim(),ruta:s,params:e},i=await getValue("admin/busqueda",r);showModal(i,"","busquedaModal",(()=>{const t=$("#busquedaModal").data("ResultData");n.data("searchdata",t),a&&a(n)}))}catch(t){}};n.attr("autocomplete","off").on("input",(function(){const t=$(this).val();t.trim().length>0&&debounce((function(){i(t)}),400)})),r.on("click",(()=>i()))}static instances=new Map;constructor(t,s){this.control=$(t),this.params={controller:s.controller.toLowerCase(),filter:s.filter,callback:s.callback||(()=>{})},this.initialize()}initialize(){if(this.control.hasClass("Ragnosffied"))return;const t=this.control.attr("name"),s=this.createSearchButton(),e=this.createHiddenField(t);this.setupDOM(s,e),this.setupEventListeners(s),RagnosSearch.instances.set(t,this)}createSearchButton(){return $('\n      <button class="btn btn-outline-secondary" type="button" aria-label="Search">\n        <i class="bi bi-search"></i>\n      </button>\n    ')}createHiddenField(t){return $(`\n      <input \n        type="hidden" \n        class="searchhiddenfield" \n        name="Ragnos_id_${t}" \n        id="Ragnos_id_${t}"\n      >\n    `)}setupDOM(t,s){t.insertAfter(this.control);const e=this.control.closest(".input-group");s.insertAfter(e),this.control.addClass("Ragnosffied")}setupEventListeners(t){this.control.is("[readonly]")||(this.control.on("input",(()=>{const t=this.control.val();debounce((()=>{this.search(t,!1)}),400)})),t.on("click",(t=>{t.preventDefault(),this.search("",!0)})))}processFilter(){let t=this.params.filter;try{const s=atob(t);if(!s)return btoa(JSON.stringify([]));const e=JSON.parse(s).map((t=>{if("string"==typeof t.value){const s=t.value.replace(/\[([^\]]+)]/g,((t,s)=>{const e=$(`#${s}`);return e.length?e.val()??"":""}));return{...t,value:s}}return t})),a=JSON.stringify(e);return btoa(a)}catch(t){return btoa(JSON.stringify([]))}}sanitizeSearchText(t){return t.replace(/[^a-zA-Z0-9 ]/g,"").trim()}async search(t,s){const e=this.sanitizeSearchText(t);if(e||s){RagnosSearch.searchStack.push(this.control);try{const t={sSearch:e,sFilter:this.processFilter(),..."undefined"!=typeof Ragnos_csrf?Ragnos_csrf:{}},s=await getValue(`${this.params.controller}/searchByAjax`,t);await this.showSearchResults(s),this.params.callback(this.control)}catch(t){}}else{const t=this.control.closest(".input-group").next("input[type=hidden]");t.length&&t.val("")}}showSearchResults(t){return new Promise((s=>{showModal(t,"BÃºsqueda","YSearchModal",s)}))}}$.fn.RagnosSearch=function(t){return this.each((function(){new RagnosSearch(this,{controller:t.controller||"",filter:t.filter||"",callback:t.callback||(()=>{})})}))};class RagnosUtils{static async showControllerTableIn(t,s,e=""){try{e&&(Ragnos_csrf.Ragnos_master=e);const a=await getValue(`${s}/tableByAjax`,Ragnos_csrf);$(t).html(a)}catch(t){}}static async showControllerReportIn(t,s){try{const e=await getValue(`${s}/reportByAjax`,Ragnos_csrf);$(t).html(e)}catch(t){}}}