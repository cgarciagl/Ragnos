if(!base_url||"string"!=typeof base_url)try{const t=new URL(window.location.href),e=t.pathname.replace(/^\/|\/$/g,"").split("/").filter(Boolean);base_url=`${t.protocol}//${t.host}/${encodeURIComponent(e[0]||"")}/`}catch(t){base_url="/"}function fixUrl(t){try{if("string"!=typeof t||!t.trim())return"";if(/^https?:\/\//i.test(t)||"undefined"==typeof base_url)return t;if("string"!=typeof base_url||!base_url.trim())return t;const e=base_url.replace(/\/+$/,"");return`${e}/index.php/${t.replace(/^\/+/,"")}`}catch(t){return""}}function redirectTo(t){setTimeout((function(){window.location.href=fixUrl(t)}),0)}function openInNew(t){window.open(fixUrl(t),"_new")}function redirectByPost(t,e={},n=!0){try{if("string"!=typeof t||!t.trim())return!1;const r=crearFormulario(fixUrl(t),e,n);return document.body.appendChild(r),r.submit(),document.body.removeChild(r),!0}catch(t){return!1}}function crearFormulario(t,e,n){const r=document.createElement("form");return r.method="post",r.action=t,n&&(r.target="_blank"),"undefined"!=typeof csrfToken&&agregarCampoOculto(r,"csrf_token",csrfToken),Object.entries(e).forEach((([t,e])=>{agregarCampoOculto(r,t,String(e))})),r}function agregarCampoOculto(t,e,n){const r=document.createElement("input");r.type="hidden",r.name=e,r.value=n,t.appendChild(r)}function trim(t){return t.trim()}function refreshPage(){location.reload()}function ponTotalesEnTabla(t,e=!1,n=!0){if(!t||!t.length)return;const r=t.find("tbody"),o=r.find("tr");let a=o.first().find("td").length;n&&(agregarColumnaTotal(t,o,a),a+=1),e&&agregarRenglonTotal(r,o,a)}function agregarRenglonTotal(t,e,n){if(e.length<=1)return;const r=$("<tr>").appendTo(t);for(let t=0;t<n;t++){const n=0===t?"Total":calcularColumnaTotal(e,t);$("<td>").addClass("totalt").css("font-weight","bold").text(n).appendTo(r)}}function agregarColumnaTotal(t,e,n){n<=2||(t.find("thead tr").append($("<th>").addClass("totalt").css("font-weight","bold").text("Total")),e.each((function(){const t=$(this),e=calcularFilaTotal(t,n);t.append($("<td>").addClass("totalt").css("font-weight","bold").text(e))})))}function calcularColumnaTotal(t,e){let n=!1;return formatearTotal(t.toArray().reduce(((t,r)=>{const o=$(r).find(`td:eq(${e})`).text();return o.startsWith("$")&&(n=!0),t+(moneyToNumber(o)||0)}),0),n)}function calcularFilaTotal(t,e){let n=!1;return formatearTotal(t.find("td").toArray().slice(1,e-1).reduce(((t,e)=>{const r=$(e).text();return r.startsWith("$")&&(n=!0),t+(moneyToNumber(r)||0)}),0),n)}function formatearTotal(t,e){return e?moneyFormat(t):Number.isInteger(t)?t.toFixed(0):t.toFixed(2)}function exportToExcel(t,e){try{if(!t||"string"!=typeof t)throw new Error("Invalid file name");if(!e||"string"!=typeof e)throw new Error("Invalid HTML content");const n="data:application/vnd.ms-excel;charset=UTF-8;base64,",r='\n      <html xmlns:o="urn:schemas-microsoft-com:office:office" \n          xmlns:x="urn:schemas-microsoft-com:office:excel" \n          xmlns="http://www.w3.org/TR/REC-html40">\n        <head>\n          <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n          <meta charset="utf-8" />\n          \x3c!--[if gte mso 9]>\n          <xml>\n            <x:ExcelWorkbook>\n              <x:ExcelWorksheets>\n                <x:ExcelWorksheet>\n                  <x:Name>{worksheet}</x:Name>\n                  <x:WorksheetOptions>\n                    <x:DisplayGridlines/>\n                  </x:WorksheetOptions>\n                </x:ExcelWorksheet>\n              </x:ExcelWorksheets>\n            </x:ExcelWorkbook>\n          </xml>\n          <![endif]--\x3e\n        </head>\n        <body>\n          <table>{table}</table>\n        </body>\n      </html>',o=t=>window.btoa(unescape(encodeURIComponent(t))),a=(t,e)=>t.replace(/{(\w+)}/g,((t,n)=>e[n]||"")),i=document.createElement("a");return i.download=`${t.trim()}.xls`,i.href=n+o(a(r,{worksheet:"Worksheet",table:e})),document.body.appendChild(i),i.click(),document.body.removeChild(i),!0}catch(t){return showToast("Error al exportar a Excel","error"),!1}}function tablaCompleta(t){try{if(!t||!$(t).length)throw new Error("Invalid table element");const e=$(t).DataTable();if(!e)throw new Error("DataTable not initialized");const n=e.rows().data().toArray(),r=e.columns().header().toArray().map((t=>$(t).text().trim()));let o='<table border="1">';return o+="<thead><tr>",r.slice(0,-1).forEach((t=>{o+=`<th style="background-color: #f2f2f2; padding: 8px;">${escapeHtml(t)}</th>`})),o+="</tr></thead>",o+="<tbody>",n.forEach((t=>{o+="<tr>",Object.values(t).forEach((t=>{o+=`<td style="padding: 6px;">${escapeHtml(String(t))}</td>`})),o+="</tr>"})),o+="</tbody></table>",o}catch(t){return showToast("Error al generar la tabla","error"),""}}function escapeHtml(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function exportaTablaCompletaAExcel(t,e){exportToExcel(t,tablaCompleta(e))}function ponTablaPaginada(t,e={}){let n={pagingType:"numbers",order:[],oLanguage:{sProcessing:"Procesando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron registros",sInfo:"Mostrando desde _START_ hasta _END_ de _TOTAL_ registros",sInfoEmpty:"Mostrando desde 0 hasta 0 de 0 registros",sInfoFiltered:"",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",oPaginate:{sFirst:"Primero",sPrevious:"Anterior",sNext:"Siguiente",sLast:"Último"}}};$.extend(n,e),$(t).DataTable(n)}$.fn.serializeObject=function(){if(!this.is("form"))return{};const t={};return $(this).find("input, select, textarea").each((function(){const e=$(this),n=e.attr("name");if(!n)return;let r;switch(e.attr("type")){case"checkbox":r=e.prop("checked");break;case"radio":e.prop("checked")&&(r=e.val());break;default:r=e.val()||""}void 0!==t[n]?(Array.isArray(t[n])||(t[n]=[t[n]]),void 0!==r&&t[n].push(r)):void 0!==r&&(t[n]=r)})),t},$.fn.shake=function(t){let e,n={shakes:2,distance:10,duration:400};return t&&$.extend(n,t),this.each((function(){let t=$(this);e=t.css("position"),e&&"static"!==e||t.css("position","relative");for(let e=1;e<=n.shakes;e++)t.animate({left:-1*n.distance},n.duration/n.shakes/4).animate({left:n.distance},n.duration/n.shakes/2).animate({left:0},n.duration/n.shakes/4)}))},$(document).ajaxStart((function(){mostrarCargando()})).ajaxStop((function(){ocultarCargando()}));const Toast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:t=>{t.onmouseenter=Swal.stopTimer,t.onmouseleave=Swal.resumeTimer}}),ToastBottom=Swal.mixin({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:t=>{t.onmouseenter=Swal.stopTimer,t.onmouseleave=Swal.resumeTimer}});function showToast(t="",e="info",n=3e3){Toast.fire({icon:e,title:t,timer:n})}function showToastDown(t="",e="info",n=3e3){ToastBottom.fire({icon:e,title:t,timer:n})}function showModal(t,e="",n="miModal",r=null){try{if("string"!=typeof t&&!(t instanceof jQuery))throw new Error("Invalid HTML content");if("string"!=typeof n||!n.trim())throw new Error("Invalid modal ID");const o=n.trim();if(!$(`#${o}`).length){const t=`\n        <div id="${o}" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="${o}Label" aria-hidden="true">\n          <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">\n            <div class="modal-content">\n              <div class="modal-header">\n                <h5 class="modal-title" id="${o}-modaltitle"></h5>\n                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n              </div>\n              <div class="modal-body">\n                <div id="${o}-modalescondido"></div> \n              </div>\n              <div class="modal-footer"></div>\n            </div>\n          </div>\n        </div>`;$("body").append(t)}const a=$(`#${o}`),i=$(`#${o}-modalescondido`),l=$(`#${o}-modaltitle`);return i.html(t),l.text(e||""),a.off("hidden.bs.modal").on("hidden.bs.modal",(function(){if("function"==typeof r)try{r()}catch(t){}a.off("hidden.bs.modal")})),a.modal("show"),a}catch(t){return showToast("Error al mostrar la ventana modal","error"),null}}function cierraModal(t){$("#"+t).modal("hide")}function convertToTable(t,e={}){if(!t)return"";const n={tableClass:"table",stripHtml:!0,maxCellLength:100,emptyText:"-",...e};try{return Array.isArray(t)?arrayToTable(t,n):objectToTable(t,n)}catch(t){return""}}function objectToTable(t,e){const n=Object.keys(t);return 0===n.length?e.emptyText:`\n    <table class="${escapeHtml(e.tableClass)}">\n      <thead>\n        ${createHeaderRow(n,e)}\n      </thead>\n      <tbody>\n        ${objectToRow(t,n,e)}\n      </tbody>\n    </table>\n  `}function arrayToTable(t,e){if(!t.length)return e.emptyText;const n=Object.keys(t[0]);return 0===n.length?e.emptyText:`\n    <table class="${escapeHtml(e.tableClass)}">\n      <thead>\n        ${createHeaderRow(n,e)}\n      </thead>\n      <tbody>\n        ${t.map((t=>objectToRow(t,n,e))).join("")}\n      </tbody>\n    </table>\n  `}function objectToRow(t,e,n){return`\n    <tr>\n      ${e.map((e=>`<td>${formatCellContent(t[e],n)}</td>`)).join("")}\n    </tr>\n  `}function createHeaderRow(t,e){return`\n    <tr>\n      ${t.map((t=>`<th>${formatCellContent(t,e)}</th>`)).join("")}\n    </tr>\n  `}function formatCellContent(t,e){if(null==t)return e.emptyText;let n=String(t);if(e.maxCellLength&&n.length>e.maxCellLength&&(n=`${n.substring(0,e.maxCellLength)}...`),e.stripHtml){const t=document.createElement("div");t.innerHTML=n,n=t.textContent||t.innerText||""}return escapeHtml(n)}function limitText(t,e){t.value.length>e&&(t.value=t.value.slice(0,e))}function ponValorEnSelect(t,e,n){t.find("option[value='"+e+"']").remove(),t.find("option").prop("selected",!1).removeAttr("selected");let r=$("<option></option>").val(e).text(n).attr("selected","selected");t.append(r).val(e).trigger("change")}function limpia(t){return t.replace("-"," ").replace(/\s+/g," ").trim()}function inArray(t,e){return e.includes(t)}async function getValue(t,e={},n){const r={timeout:e.timeout||12e5,retryAttempts:e.retryAttempts||1,retryDelay:e.retryDelay||1e3},o=async()=>{let n=0,o=null;for(;n<r.retryAttempts;)try{return{response:await $.ajax({url:fixUrl(t),type:"POST",data:e,dataType:"text",timeout:r.timeout}),error:null}}catch(t){if(o={error:t.statusText||"Error desconocido",status:t.status||0,jqXHR:t},n++,n<r.retryAttempts){await new Promise((t=>setTimeout(t,r.retryDelay*n)));continue}return manejaError(t),{response:null,error:o}}};if("function"==typeof n){const t=await o();return void n(t.response,t.error)}const a=await o();if(a.error)throw a.error;return a.response}function manejaError(t){const e={401:"Su sesión ha expirado, por favor inicie sesión nuevamente",403:"No tiene permiso para realizar esta acción",404:"No se encontró la página solicitada",500:"Error interno del servidor"};showToast(e[t.status]||"Error desconocido","error"),401==t.status&&Swal.fire({icon:"error",title:"Error",text:e[t.status],timer:2e3,didClose:()=>{window.location.href=fixUrl("admin/login")}})}async function getObject(t,e,n){const r=async t=>{try{return{result:JSON.parse(t),error:null}}catch(t){return{result:null,error:t}}};if("function"!=typeof n)try{const n=await getValue(t,e),{result:o,error:a}=await r(n);if(a)throw a;return o}catch(t){throw t}try{await getValue(t,e,(async(t,e)=>{if(e)return void n(null,e);const{result:o,error:a}=await r(t);n(o,a)}))}catch(t){n(null,t)}}async function getSession(){return await getObject("admin/sess",{})}function mostrarCargando(){if(!document.querySelector(".loading-container")){let t=document.createElement("div");t.classList.add("loading-container");let e=document.createElement("div");e.classList.add("loading"),t.appendChild(e),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(255, 255, 255, 0.8)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="9999",e.style.border="5px solid #f3f3f3",e.style.borderTop="5px solid #3498db",e.style.borderRadius="50%",e.style.width="50px",e.style.height="50px",e.style.animation="spin 2s linear infinite",document.body.appendChild(t)}}function ocultarCargando(){let t=document.querySelector(".loading-container");t&&t.remove()}function moneyFormat(t,e="USD"){return t&&t.toString().includes("$")?t:new Intl.NumberFormat("en-US",{style:"currency",currency:e}).format(t)}function moneyToNumber(t){return parseFloat(t.replace(/[^0-9.-]+/g,""))}